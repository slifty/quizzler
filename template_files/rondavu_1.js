(function(){window.rondavu=window.rondavu||{},rondavu._=rondavu._||{},rondavu._.customer_config={customer_name:"Boston_PROD",customer_timestamp:1355954323e3,app_ids:{"boston.com":"135637993114591"},facebook_xd_channel:null,og_primary_mo_enable:!1,forceNativeJSON:!1,default_rondavudata_version:"1.2",facebook_parse_xfbml:!1,ab_testing_enabled:!0,evershare_enabled:!0,fblogin_enabled:!1,preload_m_init:!0,user_load_percentage_start:6,user_load_percentage_end:10,always_load_referred_users:!0,always_load_connected_users:!1,track_throttle_control_group:!0,enabled:!0,disable_browsers:{ie:[],ff:[],safari:[],chrome:[]},build_version:"1.BigBang_2012_12_04-e0e4620",realtime:"http://web.rondavu.com/",cdn:"http://static.rondavu.com/",cdn_secure:"https://s3.amazonaws.com/static.rondavu.com/",logger_url:"//logger.sociablelabs.com/logger.gif",cdn_data_ttl:43200,rondavu_css_url:"C/Boston_PROD/rondavu_1.BigBang_2012_12_04-e0e4620_1355954323.min.css"},function(window,undefined){var rootjQuery,readyList,document=window.document,location=window.location,navigator=window.navigator,_jQuery=window.jQuery,_$=window.$,core_push=Array.prototype.push,core_slice=Array.prototype.slice,core_indexOf=Array.prototype.indexOf,core_toString=Object.prototype.toString,core_hasOwn=Object.prototype.hasOwnProperty,core_trim=String.prototype.trim,jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery)},core_pnum=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,core_rnotwhite=/\S/,core_rspace=/\s+/,rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rquickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rvalidchars=/^[\],:{}\s]*$/,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rvalidescape=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rvalidtokens=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return(letter+"").toUpperCase()},DOMContentLoaded=function(){document.addEventListener?(document.removeEventListener("DOMContentLoaded",DOMContentLoaded,!1),jQuery.ready()):document.readyState==="complete"&&(document.detachEvent("onreadystatechange",DOMContentLoaded),jQuery.ready())},class2type={};jQuery.fn=jQuery.prototype={constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem,ret,doc;if(!selector)return this;if(selector.nodeType)return this.context=this[0]=selector,this.length=1,this;if(typeof selector=="string"){selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3?match=[null,selector,null]:match=rquickExpr.exec(selector);if(match&&(match[1]||!context)){if(match[1])return context=context instanceof jQuery?context[0]:context,doc=context&&context.nodeType?context.ownerDocument||context:document,selector=jQuery.parseHTML(match[1],doc,!0),rsingleTag.test(match[1])&&jQuery.isPlainObject(context)&&this.attr.call(selector,context,!0),jQuery.merge(this,selector);elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2])return rootjQuery.find(selector);this.length=1,this[0]=elem}return this.context=document,this.selector=selector,this}return!context||context.jquery?(context||rootjQuery).find(selector):this.constructor(context).find(selector)}return jQuery.isFunction(selector)?rootjQuery.ready(selector):(selector.selector!==undefined&&(this.selector=selector.selector,this.context=selector.context),jQuery.makeArray(selector,this))},selector:"",jquery:"1.8.2",length:0,size:function(){return this.length},toArray:function(){return core_slice.call(this)},get:function(num){return num==null?this.toArray():num<0?this[this.length+num]:this[num]},pushStack:function(elems,name,selector){var ret=jQuery.merge(this.constructor(),elems);return ret.prevObject=this,ret.context=this.context,name==="find"?ret.selector=this.selector+(this.selector?" ":"")+selector:name&&(ret.selector=this.selector+"."+name+"("+selector+")"),ret},each:function(callback,args){return jQuery.each(this,callback,args)},ready:function(fn){return jQuery.ready.promise().done(fn),this},eq:function(i){return i=+i,i===-1?this.slice(i):this.slice(i,i+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(core_slice.apply(this,arguments),"slice",core_slice.call(arguments).join(","))},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice},jQuery.fn.init.prototype=jQuery.fn,jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;typeof target=="boolean"&&(deep=target,target=arguments[1]||{},i=2),typeof target!="object"&&!jQuery.isFunction(target)&&(target={}),length===i&&(target=this,--i);for(;i<length;i++)if((options=arguments[i])!=null)for(name in options){src=target[name],copy=options[name];if(target===copy)continue;deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&jQuery.isArray(src)?src:[]):clone=src&&jQuery.isPlainObject(src)?src:{},target[name]=jQuery.extend(deep,clone,copy)):copy!==undefined&&(target[name]=copy)}return target},jQuery.extend({noConflict:function(deep){return window.$===jQuery&&(window.$=_$),deep&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},isReady:!1,readyWait:1,holdReady:function(hold){hold?jQuery.readyWait++:jQuery.ready(!0)},ready:function(wait){if(wait===!0?--jQuery.readyWait:jQuery.isReady)return;if(!document.body)return setTimeout(jQuery.ready,1);jQuery.isReady=!0;if(wait!==!0&&--jQuery.readyWait>0)return;readyList.resolveWith(document,[jQuery]),jQuery.fn.trigger&&jQuery(document).trigger("ready").off("ready")},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray||function(obj){return jQuery.type(obj)==="array"},isWindow:function(obj){return obj!=null&&obj==obj.window},isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj)},type:function(obj){return obj==null?String(obj):class2type[core_toString.call(obj)]||"object"},isPlainObject:function(obj){if(!obj||jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj))return!1;try{if(obj.constructor&&!core_hasOwn.call(obj,"constructor")&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var key;for(key in obj);return key===undefined||core_hasOwn.call(obj,key)},isEmptyObject:function(obj){var name;for(name in obj)return!1;return!0},error:function(msg){throw new Error(msg)},parseHTML:function(data,context,scripts){var parsed;return!data||typeof data!="string"?null:(typeof context=="boolean"&&(scripts=context,context=0),context=context||document,(parsed=rsingleTag.exec(data))?[context.createElement(parsed[1])]:(parsed=jQuery.buildFragment([data],context,scripts?null:[]),jQuery.merge([],(parsed.cacheable?jQuery.clone(parsed.fragment):parsed.fragment).childNodes)))},parseJSON:function(data){if(!data||typeof data!="string")return null;data=jQuery.trim(data);if(window.JSON&&window.JSON.parse)return window.JSON.parse(data);if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,"")))return(new Function("return "+data))();jQuery.error("Invalid JSON: "+data)},parseXML:function(data){var xml,tmp;if(!data||typeof data!="string")return null;try{window.DOMParser?(tmp=new DOMParser,xml=tmp.parseFromString(data,"text/xml")):(xml=new ActiveXObject("Microsoft.XMLDOM"),xml.async="false",xml.loadXML(data))}catch(e){xml=undefined}return(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length)&&jQuery.error("Invalid XML: "+data),xml},noop:function(){},globalEval:function(data){data&&core_rnotwhite.test(data)&&(window.execScript||function(data){window.eval.call(window,data)})(data)},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var name,i=0,length=obj.length,isObj=length===undefined||jQuery.isFunction(obj);if(args){if(isObj){for(name in obj)if(callback.apply(obj[name],args)===!1)break}else for(;i<length;)if(callback.apply(obj[i++],args)===!1)break}else if(isObj){for(name in obj)if(callback.call(obj[name],name,obj[name])===!1)break}else for(;i<length;)if(callback.call(obj[i],i,obj[i++])===!1)break;return obj},trim:core_trim&&!core_trim.call("﻿ ")?function(text){return text==null?"":core_trim.call(text)}:function(text){return text==null?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var type,ret=results||[];return arr!=null&&(type=jQuery.type(arr),arr.length==null||type==="string"||type==="function"||type==="regexp"||jQuery.isWindow(arr)?core_push.call(ret,arr):jQuery.merge(ret,arr)),ret},inArray:function(elem,arr,i){var len;if(arr){if(core_indexOf)return core_indexOf.call(arr,elem,i);len=arr.length,i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++)if(i in arr&&arr[i]===elem)return i}return-1},merge:function(first,second){var l=second.length,i=first.length,j=0;if(typeof l=="number")for(;j<l;j++)first[i++]=second[j];else while(second[j]!==undefined)first[i++]=second[j++];return first.length=i,first},grep:function(elems,callback,inv){var retVal,ret=[],i=0,length=elems.length;inv=!!inv;for(;i<length;i++)retVal=!!callback(elems[i],i),inv!==retVal&&ret.push(elems[i]);return ret},map:function(elems,callback,arg){var value,key,ret=[],i=0,length=elems.length,isArray=elems instanceof jQuery||length!==undefined&&typeof length=="number"&&(length>0&&elems[0]&&elems[length-1]||length===0||jQuery.isArray(elems));if(isArray)for(;i<length;i++)value=callback(elems[i],i,arg),value!=null&&(ret[ret.length]=value);else for(key in elems)value=callback(elems[key],key,arg),value!=null&&(ret[ret.length]=value);return ret.concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;return typeof context=="string"&&(tmp=fn[context],context=fn,fn=tmp),jQuery.isFunction(fn)?(args=core_slice.call(arguments,2),proxy=function(){return fn.apply(context,args.concat(core_slice.call(arguments)))},proxy.guid=fn.guid=fn.guid||jQuery.guid++,proxy):undefined},access:function(elems,fn,key,value,chainable,emptyGet,pass){var exec,bulk=key==null,i=0,length=elems.length;if(key&&typeof key=="object"){for(i in key)jQuery.access(elems,fn,i,key[i],1,emptyGet,value);chainable=1}else if(value!==undefined){exec=pass===undefined&&jQuery.isFunction(value),bulk&&(exec?(exec=fn,fn=function(elem,key,value){return exec.call(jQuery(elem),value)}):(fn.call(elems,value),fn=null));if(fn)for(;i<length;i++)fn(elems[i],key,exec?value.call(elems[i],i,fn(elems[i],key)):value,pass);chainable=1}return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet},now:function(){return(new Date).getTime()}}),jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete")setTimeout(jQuery.ready,1);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",DOMContentLoaded,!1),window.addEventListener("load",jQuery.ready,!1);else{document.attachEvent("onreadystatechange",DOMContentLoaded),window.attachEvent("onload",jQuery.ready);var top=!1;try{top=window.frameElement==null&&document.documentElement}catch(e){}top&&top.doScroll&&function doScrollCheck(){if(!jQuery.isReady){try{top.doScroll("left")}catch(e){return setTimeout(doScrollCheck,50)}jQuery.ready()}}()}}return readyList.promise(obj)},jQuery.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()}),rootjQuery=jQuery(document);var optionsCache={};function createOptions(options){var object=optionsCache[options]={};return jQuery.each(options.split(core_rspace),function(_,flag){object[flag]=!0}),object}jQuery.Callbacks=function(options){options=typeof options=="string"?optionsCache[options]||createOptions(options):jQuery.extend({},options);var memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data,fired=!0,firingIndex=firingStart||0,firingStart=0,firingLength=list.length,firing=!0;for(;list&&firingIndex<firingLength;firingIndex++)if(list[firingIndex].apply(data[0],data[1])===!1&&options.stopOnFalse){memory=!1;break}firing=!1,list&&(stack?stack.length&&fire(stack.shift()):memory?list=[]:self.disable())},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);type==="function"&&(!options.unique||!self.has(arg))?list.push(arg):arg&&arg.length&&type!=="string"&&add(arg)})})(arguments),firing?firingLength=list.length:memory&&(firingStart=start,fire(memory))}return this},remove:function(){return list&&jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1)list.splice(index,1),firing&&(index<=firingLength&&firingLength--,index<=firingIndex&&firingIndex--)}),this},has:function(fn){return jQuery.inArray(fn,list)>-1},empty:function(){return list=[],this},disable:function(){return list=stack=memory=undefined,this},disabled:function(){return!list},lock:function(){return stack=undefined,memory||self.disable(),this},locked:function(){return!stack},fireWith:function(context,args){return args=args||[],args=[context,args.slice?args.slice():args],list&&(!fired||stack)&&(firing?stack.push(args):fire(args)),this},fire:function(){return self.fireWith(this,arguments),this},fired:function(){return!!fired}};return self},jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){return deferred.done(arguments).fail(arguments),this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var action=tuple[0],fn=fns[i];deferred[tuple[1]](jQuery.isFunction(fn)?function(){var returned=fn.apply(this,arguments);returned&&jQuery.isFunction(returned.promise)?returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify):newDefer[action+"With"](this===deferred?newDefer:this,[returned])}:newDefer[action])}),fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};return promise.pipe=promise.then,jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add,stateString&&list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock),deferred[tuple[0]]=list.fire,deferred[tuple[0]+"With"]=list.fireWith}),promise.promise(deferred),func&&func.call(deferred,deferred),deferred},when:function(subordinate){var i=0,resolveValues=core_slice.call(arguments),length=resolveValues.length,remaining=length!==1||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this,values[i]=arguments.length>1?core_slice.call(arguments):value,values===progressValues?deferred.notifyWith(contexts,values):--remaining||deferred.resolveWith(contexts,values)}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length),progressContexts=new Array(length),resolveContexts=new Array(length);for(;i<length;i++)resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)?resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues)):--remaining}return remaining||deferred.resolveWith(resolveContexts,resolveValues),deferred.promise()}}),jQuery.support=function(){var support,all,a,select,opt,input,fragment,eventName,i,isSupported,clickFn,div=document.createElement("div");div.setAttribute("className","t"),div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",all=div.getElementsByTagName("*"),a=div.getElementsByTagName("a")[0],a.style.cssText="top:1px;float:left;opacity:.5";if(!all||!all.length)return{};select=document.createElement("select"),opt=select.appendChild(document.createElement("option")),input=div.getElementsByTagName("input")[0],support={leadingWhitespace:div.firstChild.nodeType===3,tbody:!div.getElementsByTagName("tbody").length,htmlSerialize:!!div.getElementsByTagName("link").length,style:/top/.test(a.getAttribute("style")),hrefNormalized:a.getAttribute("href")==="/a",opacity:/^0.5/.test(a.style.opacity),cssFloat:!!a.style.cssFloat,checkOn:input.value==="on",optSelected:opt.selected,getSetAttribute:div.className!=="t",enctype:!!document.createElement("form").enctype,html5Clone:document.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:document.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},input.checked=!0,support.noCloneChecked=input.cloneNode(!0).checked,select.disabled=!0,support.optDisabled=!opt.disabled;try{delete div.test}catch(e){support.deleteExpando=!1}!div.addEventListener&&div.attachEvent&&div.fireEvent&&(div.attachEvent("onclick",clickFn=function(){support.noCloneEvent=!1}),div.cloneNode(!0).fireEvent("onclick"),div.detachEvent("onclick",clickFn)),input=document.createElement("input"),input.value="t",input.setAttribute("type","radio"),support.radioValue=input.value==="t",input.setAttribute("checked","checked"),input.setAttribute("name","t"),div.appendChild(input),fragment=document.createDocumentFragment(),fragment.appendChild(div.lastChild),support.checkClone=fragment.cloneNode(!0).cloneNode(!0).lastChild.checked,support.appendChecked=input.checked,fragment.removeChild(input),fragment.appendChild(div);if(div.attachEvent)for(i in{submit:!0,change:!0,focusin:!0})eventName="on"+i,isSupported=eventName in div,isSupported||(div.setAttribute(eventName,"return;"),isSupported=typeof div[eventName]=="function"),support[i+"Bubbles"]=isSupported;return jQuery(function(){var container,div,tds,marginDiv,divReset="padding:0;margin:0;border:0;display:block;overflow:hidden;",body=document.getElementsByTagName("body")[0];if(!body)return;container=document.createElement("div"),container.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",body.insertBefore(container,body.firstChild),div=document.createElement("div"),container.appendChild(div),div.innerHTML="<table><tr><td></td><td>t</td></tr></table>",tds=div.getElementsByTagName("td"),tds[0].style.cssText="padding:0;margin:0;border:0;display:none",isSupported=tds[0].offsetHeight===0,tds[0].style.display="",tds[1].style.display="none",support.reliableHiddenOffsets=isSupported&&tds[0].offsetHeight===0,div.innerHTML="",div.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",support.boxSizing=div.offsetWidth===4,support.doesNotIncludeMarginInBodyOffset=body.offsetTop!==1,window.getComputedStyle&&(support.pixelPosition=(window.getComputedStyle(div,null)||{}).top!=="1%",support.boxSizingReliable=(window.getComputedStyle(div,null)||{width:"4px"}).width==="4px",marginDiv=document.createElement("div"),marginDiv.style.cssText=div.style.cssText=divReset,marginDiv.style.marginRight=marginDiv.style.width="0",div.style.width="1px",div.appendChild(marginDiv),support.reliableMarginRight=!parseFloat((window.getComputedStyle(marginDiv,null)||{}).marginRight)),typeof div.style.zoom!="undefined"&&(div.innerHTML="",div.style.cssText=divReset+"width:1px;padding:1px;display:inline;zoom:1",support.inlineBlockNeedsLayout=div.offsetWidth===3,div.style.display="block",div.style.overflow="visible",div.innerHTML="<div></div>",div.firstChild.style.width="5px",support.shrinkWrapBlocks=div.offsetWidth!==3,container.style.zoom=1),body.removeChild(container),container=div=tds=marginDiv=null}),fragment.removeChild(div),all=a=select=opt=input=fragment=div=null,support}();var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;jQuery.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(jQuery.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(elem){return elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando],!!elem&&!isEmptyDataObject(elem)},data:function(elem,name,data,pvt){if(!jQuery.acceptData(elem))return;var thisCache,ret,internalKey=jQuery.expando,getByName=typeof name=="string",isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey;if((!id||!cache[id]||!pvt&&!cache[id].data)&&getByName&&data===undefined)return;id||(isNode?elem[internalKey]=id=jQuery.deletedIds.pop()||jQuery.guid++:id=internalKey),cache[id]||(cache[id]={},isNode||(cache[id].toJSON=jQuery.noop));if(typeof name=="object"||typeof name=="function")pvt?cache[id]=jQuery.extend(cache[id],name):cache[id].data=jQuery.extend(cache[id].data,name);return thisCache=cache[id],pvt||(thisCache.data||(thisCache.data={}),thisCache=thisCache.data),data!==undefined&&(thisCache[jQuery.camelCase(name)]=data),getByName?(ret=thisCache[name],ret==null&&(ret=thisCache[jQuery.camelCase(name)])):ret=thisCache,ret},removeData:function(elem,name,pvt){if(!jQuery.acceptData(elem))return;var thisCache,i,l,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;if(!cache[id])return;if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){jQuery.isArray(name)||(name in thisCache?name=[name]:(name=jQuery.camelCase(name),name in thisCache?name=[name]:name=name.split(" ")));for(i=0,l=name.length;i<l;i++)delete thisCache[name[i]];if(!(pvt?isEmptyDataObject:jQuery.isEmptyObject)(thisCache))return}}if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id]))return}isNode?jQuery.cleanData([elem],!0):jQuery.support.deleteExpando||cache!=cache.window?delete cache[id]:cache[id]=null},_data:function(elem,name,data){return jQuery.data(elem,name,data,!0)},acceptData:function(elem){var noData=elem.nodeName&&jQuery.noData[elem.nodeName.toLowerCase()];return!noData||noData!==!0&&elem.getAttribute("classid")===noData}}),jQuery.fn.extend({data:function(key,value){var parts,part,attr,name,l,elem=this[0],i=0,data=null;if(key===undefined){if(this.length){data=jQuery.data(elem);if(elem.nodeType===1&&!jQuery._data(elem,"parsedAttrs")){attr=elem.attributes;for(l=attr.length;i<l;i++)name=attr[i].name,name.indexOf("data-")||(name=jQuery.camelCase(name.substring(5)),dataAttr(elem,name,data[name]));jQuery._data(elem,"parsedAttrs",!0)}}return data}return typeof key=="object"?this.each(function(){jQuery.data(this,key)}):(parts=key.split(".",2),parts[1]=parts[1]?"."+parts[1]:"",part=parts[1]+"!",jQuery.access(this,function(value){if(value===undefined)return data=this.triggerHandler("getData"+part,[parts[0]]),data===undefined&&elem&&(data=jQuery.data(elem,key),data=dataAttr(elem,key,data)),data===undefined&&parts[1]?this.data(parts[0]):data;parts[1]=value,this.each(function(){var self=jQuery(this);self.triggerHandler("setData"+part,parts),jQuery.data(this,key,value),self.triggerHandler("changeData"+part,parts)})},null,value,arguments.length>1,null,!1))},removeData:function(key){return this.each(function(){jQuery.removeData(this,key)})}});function dataAttr(elem,key,data){if(data===undefined&&elem.nodeType===1){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data=="string"){try{data=data==="true"?!0:data==="false"?!1:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}jQuery.data(elem,key,data)}else data=undefined}return data}function isEmptyDataObject(obj){var name;for(name in obj){if(name==="data"&&jQuery.isEmptyObject(obj[name]))continue;if(name!=="toJSON")return!1}return!0}jQuery.extend({queue:function(elem,type,data){var queue;if(elem)return type=(type||"fx")+"queue",queue=jQuery._data(elem,type),data&&(!queue||jQuery.isArray(data)?queue=jQuery._data(elem,type,jQuery.makeArray(data)):queue.push(data)),queue||[]},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};fn==="inprogress"&&(fn=queue.shift(),startLength--),fn&&(type==="fx"&&queue.unshift("inprogress"),delete hooks.stop,fn.call(elem,next,hooks)),!startLength&&hooks&&hooks.empty.fire()},_queueHooks:function(elem,type){var key=type+"queueHooks";return jQuery._data(elem,key)||jQuery._data(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){jQuery.removeData(elem,type+"queue",!0),jQuery.removeData(elem,key,!0)})})}}),jQuery.fn.extend({queue:function(type,data){var setter=2;return typeof type!="string"&&(data=type,type="fx",setter--),arguments.length<setter?jQuery.queue(this[0],type):data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type),type==="fx"&&queue[0]!=="inprogress"&&jQuery.dequeue(this,type)})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},delay:function(time,type){return time=jQuery.fx?jQuery.fx.speeds[time]||time:time,type=type||"fx",this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){--count||defer.resolveWith(elements,[elements])};typeof type!="string"&&(obj=type,type=undefined),type=type||"fx";while(i--)tmp=jQuery._data(elements[i],type+"queueHooks"),tmp&&tmp.empty&&(count++,tmp.empty.add(resolve));return resolve(),defer.promise(obj)}});var nodeHook,boolHook,fixSpecified,rclass=/[\t\r\n]/g,rreturn=/\r/g,rtype=/^(?:button|input)$/i,rfocusable=/^(?:button|input|object|select|textarea)$/i,rclickable=/^a(?:rea|)$/i,rboolean=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,getSetAttribute=jQuery.support.getSetAttribute;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})},prop:function(name,value){return jQuery.access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return name=jQuery.propFix[name]||name,this.each(function(){try{this[name]=undefined,delete this[name]}catch(e){}})},addClass:function(value){var classNames,i,l,elem,setClass,c,cl;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))});if(value&&typeof value=="string"){classNames=value.split(core_rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1)if(!elem.className&&classNames.length===1)elem.className=value;else{setClass=" "+elem.className+" ";for(c=0,cl=classNames.length;c<cl;c++)setClass.indexOf(" "+classNames[c]+" ")<0&&(setClass+=classNames[c]+" ");elem.className=jQuery.trim(setClass)}}}return this},removeClass:function(value){var removes,className,elem,c,cl,i,l;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))});if(value&&typeof value=="string"||value===undefined){removes=(value||"").split(core_rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1&&elem.className){className=(" "+elem.className+" ").replace(rclass," ");for(c=0,cl=removes.length;c<cl;c++)while(className.indexOf(" "+removes[c]+" ")>=0)className=className.replace(" "+removes[c]+" "," ");elem.className=value?jQuery.trim(className):""}}}return this},toggleClass:function(value,stateVal){var type=typeof value,isBool=typeof stateVal=="boolean";return jQuery.isFunction(value)?this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)}):this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),state=stateVal,classNames=value.split(core_rspace);while(className=classNames[i++])state=isBool?state:!self.hasClass(className),self[state?"addClass":"removeClass"](className)}else if(type==="undefined"||type==="boolean")this.className&&jQuery._data(this,"__className__",this.className),this.className=this.className||value===!1?"":jQuery._data(this,"__className__")||""})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++)if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0)return!0;return!1},val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem)return hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()],hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined?ret:(ret=elem.value,typeof ret=="string"?ret.replace(rreturn,""):ret==null?"":ret);return}return isFunction=jQuery.isFunction(value),this.each(function(i){var val,self=jQuery(this);if(this.nodeType!==1)return;isFunction?val=value.call(this,i,self.val()):val=value,val==null?val="":typeof val=="number"?val+="":jQuery.isArray(val)&&(val=jQuery.map(val,function(value){return value==null?"":value+""})),hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined)this.value=val})}}),jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return!val||val.specified?elem.value:elem.text}},select:{get:function(elem){var value,i,max,option,index=elem.selectedIndex,values=[],options=elem.options,one=elem.type==="select-one";if(index<0)return null;i=one?index:0,max=one?index+1:options.length;for(;i<max;i++){option=options[i];if(option.selected&&(jQuery.support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one)return value;values.push(value)}}return one&&!values.length&&options.length?jQuery(options[index]).val():values},set:function(elem,value){var values=jQuery.makeArray(value);return jQuery(elem).find("option").each(function(){this.selected=jQuery.inArray(jQuery(this).val(),values)>=0}),values.length||(elem.selectedIndex=-1),values}}},attrFn:{},attr:function(elem,name,value,pass){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2)return;if(pass&&jQuery.isFunction(jQuery.fn[name]))return jQuery(elem)[name](value);if(typeof elem.getAttribute=="undefined")return jQuery.prop(elem,name,value);notxml=nType!==1||!jQuery.isXMLDoc(elem),notxml&&(name=name.toLowerCase(),hooks=jQuery.attrHooks[name]||(rboolean.test(name)?boolHook:nodeHook));if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return}return hooks&&"set"in hooks&&notxml&&(ret=hooks.set(elem,value,name))!==undefined?ret:(elem.setAttribute(name,value+""),value)}return hooks&&"get"in hooks&&notxml&&(ret=hooks.get(elem,name))!==null?ret:(ret=elem.getAttribute(name),ret===null?undefined:ret)},removeAttr:function(elem,value){var propName,attrNames,name,isBool,i=0;if(value&&elem.nodeType===1){attrNames=value.split(core_rspace);for(;i<attrNames.length;i++)name=attrNames[i],name&&(propName=jQuery.propFix[name]||name,isBool=rboolean.test(name),isBool||jQuery.attr(elem,name,""),elem.removeAttribute(getSetAttribute?name:propName),isBool&&propName in elem&&(elem[propName]=!1))}},attrHooks:{type:{set:function(elem,value){if(rtype.test(elem.nodeName)&&elem.parentNode)jQuery.error("type property can't be changed");else if(!jQuery.support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;return elem.setAttribute("type",value),val&&(elem.value=val),value}}},value:{get:function(elem,name){return nodeHook&&jQuery.nodeName(elem,"button")?nodeHook.get(elem,name):name in elem?elem.value:null},set:function(elem,value,name){if(nodeHook&&jQuery.nodeName(elem,"button"))return nodeHook.set(elem,value,name);elem.value=value}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2)return;return notxml=nType!==1||!jQuery.isXMLDoc(elem),notxml&&(name=jQuery.propFix[name]||name,hooks=jQuery.propHooks[name]),value!==undefined?hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value:hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null?ret:elem[name]},propHooks:{tabIndex:{get:function(elem){var attributeNode=elem.getAttributeNode("tabindex");return attributeNode&&attributeNode.specified?parseInt(attributeNode.value,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:undefined}}}}),boolHook={get:function(elem,name){var attrNode,property=jQuery.prop(elem,name);return property===!0||typeof property!="boolean"&&(attrNode=elem.getAttributeNode(name))&&attrNode.nodeValue!==!1?name.toLowerCase():undefined},set:function(elem,value,name){var propName;return value===!1?jQuery.removeAttr(elem,name):(propName=jQuery.propFix[name]||name,propName in elem&&(elem[propName]=!0),elem.setAttribute(name,name.toLowerCase())),name}},getSetAttribute||(fixSpecified={name:!0,id:!0,coords:!0},nodeHook=jQuery.valHooks.button={get:function(elem,name){var ret;return ret=elem.getAttributeNode(name),ret&&(fixSpecified[name]?ret.value!=="":ret.specified)?ret.value:undefined},set:function(elem,value,name){var ret=elem.getAttributeNode(name);return ret||(ret=document.createAttribute(name),elem.setAttributeNode(ret)),ret.value=value+""}},jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{set:function(elem,value){if(value==="")return elem.setAttribute(name,"auto"),value}})}),jQuery.attrHooks.contenteditable={get:nodeHook.get,set:function(elem,value,name){value===""&&(value="false"),nodeHook.set(elem,value,name)}}),jQuery.support.hrefNormalized||jQuery.each(["href","src","width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{get:function(elem){var ret=elem.getAttribute(name,2);return ret===null?undefined:ret}})}),jQuery.support.style||(jQuery.attrHooks.style={get:function(elem){return elem.style.cssText.toLowerCase()||undefined},set:function(elem,value){return elem.style.cssText=value+""}}),jQuery.support.optSelected||(jQuery.propHooks.selected=jQuery.extend(jQuery.propHooks.selected,{get:function(elem){var parent=elem.parentNode;return parent&&(parent.selectedIndex,parent.parentNode&&parent.parentNode.selectedIndex),null}})),jQuery.support.enctype||(jQuery.propFix.enctype="encoding"),jQuery.support.checkOn||jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={get:function(elem){return elem.getAttribute("value")===null?"on":elem.value}}}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]=jQuery.extend(jQuery.valHooks[this],{set:function(elem,value){if(jQuery.isArray(value))return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0}})});var rformElems=/^(?:textarea|input|select)$/i,rtypenamespace=/^([^\.]*|)(?:\.(.+)|)$/,rhoverHack=/(?:^|\s)hover(\.\S+|)\b/,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,hoverHack=function(events){return jQuery.event.special.hover?events:events.replace(rhoverHack,"mouseenter$1 mouseleave$1")};jQuery.event={add:function(elem,types,handler,data,selector){var elemData,eventHandle,events,t,tns,type,namespaces,handleObj,handleObjIn,handlers,special;if(elem.nodeType===3||elem.nodeType===8||!types||!handler||!(elemData=jQuery._data(elem)))return;handler.handler&&(handleObjIn=handler,handler=handleObjIn.handler,selector=handleObjIn.selector),handler.guid||(handler.guid=jQuery.guid++),events=elemData.events,events||(elemData.events=events={}),eventHandle=elemData.handle,eventHandle||(elemData.handle=eventHandle=function(e){return typeof jQuery=="undefined"||!!e&&jQuery.event.triggered===e.type?undefined:jQuery.event.dispatch.apply(eventHandle.elem,arguments)},eventHandle.elem=elem),types=jQuery.trim(hoverHack(types)).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[],type=tns[1],namespaces=(tns[2]||"").split(".").sort(),special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,special=jQuery.event.special[type]||{},handleObj=jQuery.extend({type:type,origType:tns[1],data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn),handlers=events[type];if(!handlers){handlers=events[type]=[],handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===!1)elem.addEventListener?elem.addEventListener(type,eventHandle,!1):elem.attachEvent&&elem.attachEvent("on"+type,eventHandle)}special.add&&(special.add.call(elem,handleObj),handleObj.handler.guid||(handleObj.handler.guid=handler.guid)),selector?handlers.splice(handlers.delegateCount++,0,handleObj):handlers.push(handleObj),jQuery.event.global[type]=!0}elem=null},global:{},remove:function(elem,types,handler,selector,mappedTypes){var t,tns,type,origType,namespaces,origCount,j,events,special,eventType,handleObj,elemData=jQuery.hasData(elem)&&jQuery._data(elem);if(!elemData||!(events=elemData.events))return;types=jQuery.trim(hoverHack(types||"")).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[],type=origType=tns[1],namespaces=tns[2];if(!type){for(type in events)jQuery.event.remove(elem,type+types[t],handler,selector,!0);continue}special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,eventType=events[type]||[],origCount=eventType.length,namespaces=namespaces?new RegExp("(^|\\.)"+namespaces.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(j=0;j<eventType.length;j++)handleObj=eventType[j],(mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!namespaces||namespaces.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)&&(eventType.splice(j--,1),handleObj.selector&&eventType.delegateCount--,special.remove&&special.remove.call(elem,handleObj));eventType.length===0&&origCount!==eventType.length&&((!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===!1)&&jQuery.removeEvent(elem,type,elemData.handle),delete events[type])}jQuery.isEmptyObject(events)&&(delete elemData.handle,jQuery.removeData(elem,"events",!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(event,data,elem,onlyHandlers){if(!elem||elem.nodeType!==3&&elem.nodeType!==8){var cache,exclusive,i,cur,old,ontype,special,handle,eventPath,bubbleType,type=event.type||event,namespaces=[];if(rfocusMorph.test(type+jQuery.event.triggered))return;type.indexOf("!")>=0&&(type=type.slice(0,-1),exclusive=!0),type.indexOf(".")>=0&&(namespaces=type.split("."),type=namespaces.shift(),namespaces.sort());if((!elem||jQuery.event.customEvent[type])&&!jQuery.event.global[type])return;event=typeof event=="object"?event[jQuery.expando]?event:new jQuery.Event(type,event):new jQuery.Event(type),event.type=type,event.isTrigger=!0,event.exclusive=exclusive,event.namespace=namespaces.join("."),event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,ontype=type.indexOf(":")<0?"on"+type:"";if(!elem){cache=jQuery.cache;for(i in cache)cache[i].events&&cache[i].events[type]&&jQuery.event.trigger(event,data,cache[i].handle.elem,!0);return}event.result=undefined,event.target||(event.target=elem),data=data!=null?jQuery.makeArray(data):[],data.unshift(event),special=jQuery.event.special[type]||{};if(special.trigger&&special.trigger.apply(elem,data)===!1)return;eventPath=[[elem,special.bindType||type]];if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type,cur=rfocusMorph.test(bubbleType+type)?elem:elem.parentNode;for(old=elem;cur;cur=cur.parentNode)eventPath.push([cur,bubbleType]),old=cur;old===(elem.ownerDocument||document)&&eventPath.push([old.defaultView||old.parentWindow||window,bubbleType])}for(i=0;i<eventPath.length&&!event.isPropagationStopped();i++)cur=eventPath[i][0],event.type=eventPath[i][1],handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle"),handle&&handle.apply(cur,data),handle=ontype&&cur[ontype],handle&&jQuery.acceptData(cur)&&handle.apply&&handle.apply(cur,data)===!1&&event.preventDefault();return event.type=type,!onlyHandlers&&!event.isDefaultPrevented()&&(!special._default||special._default.apply(elem.ownerDocument,data)===!1)&&(type!=="click"||!jQuery.nodeName(elem,"a"))&&jQuery.acceptData(elem)&&ontype&&elem[type]&&(type!=="focus"&&type!=="blur"||event.target.offsetWidth!==0)&&!jQuery.isWindow(elem)&&(old=elem[ontype],old&&(elem[ontype]=null),jQuery.event.triggered=type,elem[type](),jQuery.event.triggered=undefined,old&&(elem[ontype]=old)),event.result}return},dispatch:function(event){event=jQuery.event.fix(event||window.event);var i,j,cur,ret,selMatch,matched,matches,handleObj,sel,related,handlers=(jQuery._data(this,"events")||{})[event.type]||[],delegateCount=handlers.delegateCount,args=core_slice.call(arguments),run_all=!event.exclusive&&!event.namespace,special=jQuery.event.special[event.type]||{},handlerQueue=[];args[0]=event,event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===!1)return;if(delegateCount&&(!event.button||event.type!=="click"))for(cur=event.target;cur!=this;cur=cur.parentNode||this)if(cur.disabled!==!0||event.type!=="click"){selMatch={},matches=[];for(i=0;i<delegateCount;i++)handleObj=handlers[i],sel=handleObj.selector,selMatch[sel]===undefined&&(selMatch[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length),selMatch[sel]&&matches.push(handleObj);matches.length&&handlerQueue.push({elem:cur,matches:matches})}handlers.length>delegateCount&&handlerQueue.push({elem:this,matches:handlers.slice(delegateCount)});for(i=0;i<handlerQueue.length&&!event.isPropagationStopped();i++){matched=handlerQueue[i],event.currentTarget=matched.elem;for(j=0;j<matched.matches.length&&!event.isImmediatePropagationStopped();j++){handleObj=matched.matches[j];if(run_all||!event.namespace&&!handleObj.namespace||event.namespace_re&&event.namespace_re.test(handleObj.namespace))event.data=handleObj.data,event.handleObj=handleObj,ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args),ret!==undefined&&(event.result=ret,ret===!1&&(event.preventDefault(),event.stopPropagation()))}}return special.postDispatch&&special.postDispatch.call(this,event),event.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){return event.which==null&&(event.which=original.charCode!=null?original.charCode:original.keyCode),event}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button,fromElement=original.fromElement;return event.pageX==null&&original.clientX!=null&&(eventDoc=event.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body,event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)),!event.relatedTarget&&fromElement&&(event.relatedTarget=fromElement===event.target?original.toElement:fromElement),!event.which&&button!==undefined&&(event.which=button&1?1:button&2?3:button&4?2:0),event}},fix:function(event){if(event[jQuery.expando])return event;var i,prop,originalEvent=event,fixHook=jQuery.event.fixHooks[event.type]||{},copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=jQuery.Event(originalEvent);for(i=copy.length;i;)prop=copy[--i],event[prop]=originalEvent[prop];return event.target||(event.target=originalEvent.srcElement||document),event.target.nodeType===3&&(event.target=event.target.parentNode),event.metaKey=!!event.metaKey,fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(data,namespaces,eventHandle){jQuery.isWindow(this)&&(this.onbeforeunload=eventHandle)},teardown:function(namespaces,eventHandle){this.onbeforeunload===eventHandle&&(this.onbeforeunload=null)}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:!0,originalEvent:{}});bubble?jQuery.event.trigger(e,null,elem):jQuery.event.dispatch.call(elem,e),e.isDefaultPrevented()&&event.preventDefault()}},jQuery.event.handle=jQuery.event.dispatch,jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){elem.removeEventListener&&elem.removeEventListener(type,handle,!1)}:function(elem,type,handle){var name="on"+type;elem.detachEvent&&(typeof elem[name]=="undefined"&&(elem[name]=null),elem.detachEvent(name,handle))},jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event))return new jQuery.Event(src,props);src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented||src.returnValue===!1||src.getPreventDefault&&src.getPreventDefault()?returnTrue:returnFalse):this.type=src,props&&jQuery.extend(this,props),this.timeStamp=src&&src.timeStamp||jQuery.now(),this[jQuery.expando]=!0};function returnFalse(){return!1}function returnTrue(){return!0}jQuery.Event.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj,selector=handleObj.selector;if(!related||related!==target&&!jQuery.contains(target,related))event.type=handleObj.origType,ret=handleObj.handler.apply(this,arguments),event.type=fix;return ret}}}),jQuery.support.submitBubbles||(jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,"form"))return!1;jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?elem.form:undefined;form&&!jQuery._data(form,"_submit_attached")&&(jQuery.event.add(form,"submit._submit",function(event){event._submit_bubble=!0}),jQuery._data(form,"_submit_attached",!0))})},postDispatch:function(event){event._submit_bubble&&(delete event._submit_bubble,this.parentNode&&!event.isTrigger&&jQuery.event.simulate("submit",this.parentNode,event,!0))},teardown:function(){if(jQuery.nodeName(this,"form"))return!1;jQuery.event.remove(this,"._submit")}}),jQuery.support.changeBubbles||(jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")jQuery.event.add(this,"propertychange._change",function(event){event.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),jQuery.event.add(this,"click._change",function(event){this._just_changed&&!event.isTrigger&&(this._just_changed=!1),jQuery.event.simulate("change",this,event,!0)});return!1}jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;rformElems.test(elem.nodeName)&&!jQuery._data(elem,"_change_attached")&&(jQuery.event.add(elem,"change._change",function(event){this.parentNode&&!event.isSimulated&&!event.isTrigger&&jQuery.event.simulate("change",this.parentNode,event,!0)}),jQuery._data(elem,"_change_attached",!0))})},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||elem.type!=="radio"&&elem.type!=="checkbox")return event.handleObj.handler.apply(this,arguments)},teardown:function(){return jQuery.event.remove(this,"._change"),!rformElems.test(this.nodeName)}}),jQuery.support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),!0)};jQuery.event.special[fix]={setup:function(){attaches++===0&&document.addEventListener(orig,handler,!0)},teardown:function(){--attaches===0&&document.removeEventListener(orig,handler,!0)}}}),jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types=="object"){typeof selector!="string"&&(data=data||selector,selector=undefined);for(type in types)this.on(type,selector,data,types[type],one);return this}data==null&&fn==null?(fn=selector,data=selector=undefined):fn==null&&(typeof selector=="string"?(fn=data,data=undefined):(fn=data,data=selector,selector=undefined));if(fn===!1)fn=returnFalse;else if(!fn)return this;return one===1&&(origFn=fn,fn=function(event){return jQuery().off(event),origFn.apply(this,arguments)},fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)),this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj)return handleObj=types.handleObj,jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler),this;if(typeof types=="object"){for(type in types)this.off(type,selector,types[type]);return this}if(selector===!1||typeof selector=="function")fn=selector,selector=undefined;return fn===!1&&(fn=returnFalse),this.each(function(){jQuery.event.remove(this,types,fn,selector)})},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},live:function(types,data,fn){return jQuery(this.context).on(types,this.selector,data,fn),this},die:function(types,fn){return jQuery(this.context).off(types,this.selector||"**",fn),this},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){if(this[0])return jQuery.event.trigger(type,data,this[0],!0)},toggle:function(fn){var args=arguments,guid=fn.guid||jQuery.guid++,i=0,toggler=function(event){var lastToggle=(jQuery._data(this,"lastToggle"+fn.guid)||0)%i;return jQuery._data(this,"lastToggle"+fn.guid,lastToggle+1),event.preventDefault(),args[lastToggle].apply(this,arguments)||!1};toggler.guid=guid;while(i<args.length)args[i++].guid=guid;return this.click(toggler)},hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)}}),jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return fn==null&&(fn=data,data=null),arguments.length>0?this.on(name,null,data,fn):this.trigger(name)},rkeyEvent.test(name)&&(jQuery.event.fixHooks[name]=jQuery.event.keyHooks),rmouseEvent.test(name)&&(jQuery.event.fixHooks[name]=jQuery.event.mouseHooks)}),function(window,undefined){var cachedruns,assertGetIdNotName,Expr,getText,isXML,contains,compile,sortOrder,hasDuplicate,outermostContext,baseHasDuplicate=!0,strundefined="undefined",expando=("sizcache"+Math.random()).replace(".",""),Token=String,document=window.document,docElem=document.documentElement,dirruns=0,done=0,pop=[].pop,push=[].push,slice=[].slice,indexOf=[].indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++)if(this[i]===elem)return i;return-1},markFunction=function(fn,value){return fn[expando]=value==null||value,fn},createCache=function(){var cache={},keys=[];return markFunction(function(key,value){return keys.push(key)>Expr.cacheLength&&delete cache[keys.shift()],cache[key]=value},cache)},classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),operators="([*^$|!~]?=)",attributes="\\["+whitespace+"*("+characterEncoding+")"+whitespace+"*(?:"+operators+whitespace+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+identifier+")|)|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+attributes+")|[^:]|\\\\.)*|.*))\\)|)",pos=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([\\x20\\t\\r\\n\\f>+~])"+whitespace+"*"),rpseudo=new RegExp(pseudos),rquickExpr=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,rnot=/^:not/,rsibling=/[\x20\t\r\n\f]*[+~]/,rendsWithNot=/:not\($/,rheader=/h\d/i,rinputs=/input|select|textarea|button/i,rbackslash=/\\(?!\\)/g,matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),NAME:new RegExp("^\\[name=['\"]?("+characterEncoding+")['\"]?\\]"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),POS:new RegExp(pos,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|"+pos,"i")},assert=function(fn){var div=document.createElement("div");try{return fn(div)}catch(e){return!1}finally{div=null}},assertTagNameNoComments=assert(function(div){return div.appendChild(document.createComment("")),!div.getElementsByTagName("*").length}),assertHrefNotNormalized=assert(function(div){return div.innerHTML="<a href='#'></a>",div.firstChild&&typeof div.firstChild.getAttribute!==strundefined&&div.firstChild.getAttribute("href")==="#"}),assertAttributes=assert(function(div){div.innerHTML="<select></select>";var type=typeof div.lastChild.getAttribute("multiple");return type!=="boolean"&&type!=="string"}),assertUsableClassName=assert(function(div){return div.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!div.getElementsByClassName||!div.getElementsByClassName("e").length?!1:(div.lastChild.className="e",div.getElementsByClassName("e").length===2)}),assertUsableName=assert(function(div){div.id=expando+0,div.innerHTML="<a name='"+expando+"'></a><div name='"+expando+"'></div>",docElem.insertBefore(div,docElem.firstChild);var pass=document.getElementsByName&&document.getElementsByName(expando).length===2+document.getElementsByName(expando+0).length;return assertGetIdNotName=!document.getElementById(expando),docElem.removeChild(div),pass});try{slice.call(docElem.childNodes,0)[0].nodeType}catch(e){slice=function(i){var elem,results=[];for(;elem=this[i];i++)results.push(elem);return results}}function Sizzle(selector,context,results,seed){results=results||[],context=context||document;var match,elem,xml,m,nodeType=context.nodeType;if(!selector||typeof selector!="string")return results;if(nodeType!==1&&nodeType!==9)return[];xml=isXML(context);if(!xml&&!seed)if(match=rquickExpr.exec(selector))if(m=match[1]){if(nodeType===9){elem=context.getElementById(m);if(!elem||!elem.parentNode)return results;if(elem.id===m)return results.push(elem),results}else if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,slice.call(context.getElementsByTagName(selector),0)),results;if((m=match[3])&&assertUsableClassName&&context.getElementsByClassName)return push.apply(results,slice.call(context.getElementsByClassName(m),0)),results}return select(selector.replace(rtrim,"$1"),context,results,seed,xml)}Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){return Sizzle(expr,null,null,[elem]).length>0};function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent=="string")return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(nodeType===3||nodeType===4)return elem.nodeValue}else for(;node=elem[i];i++)ret+=getText(node);return ret},isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":!1},contains=Sizzle.contains=docElem.contains?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&adown.contains&&adown.contains(bup))}:docElem.compareDocumentPosition?function(a,b){return b&&!!(a.compareDocumentPosition(b)&16)}:function(a,b){while(b=b.parentNode)if(b===a)return!0;return!1},Sizzle.attr=function(elem,name){var val,xml=isXML(elem);return xml||(name=name.toLowerCase()),(val=Expr.attrHandle[name])?val(elem):xml||assertAttributes?elem.getAttribute(name):(val=elem.getAttributeNode(name),val?typeof elem[name]=="boolean"?elem[name]?name:null:val.specified?val.value:null:null)},Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:assertHrefNotNormalized?{}:{href:function(elem){return elem.getAttribute("href",2)},type:function(elem){return elem.getAttribute("type")}},find:{ID:assertGetIdNotName?function(id,context,xml){if(typeof context.getElementById!==strundefined&&!xml){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}}:function(id,context,xml){if(typeof context.getElementById!==strundefined&&!xml){var m=context.getElementById(id);return m?m.id===id||typeof m.getAttributeNode!==strundefined&&m.getAttributeNode("id").value===id?[m]:undefined:[]}},TAG:assertTagNameNoComments?function(tag,context){if(typeof context.getElementsByTagName!==strundefined)return context.getElementsByTagName(tag)}:function(tag,context){var results=context.getElementsByTagName(tag);if(tag==="*"){var elem,tmp=[],i=0;for(;elem=results[i];i++)elem.nodeType===1&&tmp.push(elem);return tmp}return results},NAME:assertUsableName&&function(tag,context){if(typeof context.getElementsByName!==strundefined)return context.getElementsByName(name)},CLASS:assertUsableClassName&&function(className,context,xml){if(typeof context.getElementsByClassName!==strundefined&&!xml)return context.getElementsByClassName(className)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(rbackslash,""),match[3]=(match[4]||match[5]||"").replace(rbackslash,""),match[2]==="~="&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),match[1]==="nth"?(match[2]||Sizzle.error(match[0]),match[3]=+(match[3]?match[4]+(match[5]||1):2*(match[2]==="even"||match[2]==="odd")),match[4]=+(match[6]+match[7]||match[2]==="odd")):match[2]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var unquoted,excess;if(matchExpr.CHILD.test(match[0]))return null;if(match[3])match[2]=match[3];else if(unquoted=match[4])rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(unquoted=unquoted.slice(0,excess),match[0]=match[0].slice(0,excess)),match[2]=unquoted;return match.slice(0,3)}},filter:{ID:assertGetIdNotName?function(id){return id=id.replace(rbackslash,""),function(elem){return elem.getAttribute("id")===id}}:function(id){return id=id.replace(rbackslash,""),function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===id}},TAG:function(nodeName){return nodeName==="*"?function(){return!0}:(nodeName=nodeName.replace(rbackslash,"").toLowerCase(),function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName})},CLASS:function(className){var pattern=classCache[expando][className];return pattern||(pattern=classCache(className,new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))),function(elem){return pattern.test(elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")}},ATTR:function(name,operator,check){return function(elem,context){var result=Sizzle.attr(elem,name);return result==null?operator==="!=":operator?(result+="",operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.substr(result.length-check.length)===check:operator==="~="?(" "+result+" ").indexOf(check)>-1:operator==="|="?result===check||result.substr(0,check.length+1)===check+"-":!1):!0}},CHILD:function(type,argument,first,last){return type==="nth"?function(elem){var node,diff,parent=elem.parentNode;if(first===1&&last===0)return!0;if(parent){diff=0;for(node=parent.firstChild;node;node=node.nextSibling)if(node.nodeType===1){diff++;if(elem===node)break}}return diff-=last,diff===first||diff%first===0&&diff/first>=0}:function(elem){var node=elem;switch(type){case"only":case"first":while(node=node.previousSibling)if(node.nodeType===1)return!1;if(type==="first")return!0;node=elem;case"last":while(node=node.nextSibling)if(node.nodeType===1)return!1;return!0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--)idx=indexOf.call(seed,matched[i]),seed[idx]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--)if(elem=unmatched[i])seed[i]=!(matches[i]=elem)}):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),enabled:function(elem){return elem.disabled===!1},disabled:function(elem){return elem.disabled===!0},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==="input"&&!!elem.checked||nodeName==="option"&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,elem.selected===!0},parent:function(elem){return!Expr.pseudos.empty(elem)},empty:function(elem){var nodeType;elem=elem.firstChild;while(elem){if(elem.nodeName>"@"||(nodeType=elem.nodeType)===3||nodeType===4)return!1;elem=elem.nextSibling}return!0},header:function(elem){return rheader.test(elem.nodeName)},text:function(elem){var type,attr;return elem.nodeName.toLowerCase()==="input"&&(type=elem.type)==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()===type)},radio:createInputPseudo("radio"),checkbox:createInputPseudo("checkbox"),file:createInputPseudo("file"),password:createInputPseudo("password"),image:createInputPseudo("image"),submit:createButtonPseudo("submit"),reset:createButtonPseudo("reset"),button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},input:function(elem){return rinputs.test(elem.nodeName)},focus:function(elem){var doc=elem.ownerDocument;return elem===doc.activeElement&&(!doc.hasFocus||doc.hasFocus())&&(!!elem.type||!!elem.href)},active:function(elem){return elem===elem.ownerDocument.activeElement},first:createPositionalPseudo(function(matchIndexes,length,argument){return[0]}),last:createPositionalPseudo(function(matchIndexes,length,argument){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}};function siblingCheck(a,b,ret){if(a===b)return ret;var cur=a.nextSibling;while(cur){if(cur===b)return-1;cur=cur.nextSibling}return 1}sortOrder=docElem.compareDocumentPosition?function(a,b){return a===b?(hasDuplicate=!0,0):(!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition:a.compareDocumentPosition(b)&4)?-1:1}:function(a,b){if(a===b)return hasDuplicate=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var al,bl,ap=[],bp=[],aup=a.parentNode,bup=b.parentNode,cur=aup;if(aup===bup)return siblingCheck(a,b);if(!aup)return-1;if(!bup)return 1;while(cur)ap.unshift(cur),cur=cur.parentNode;cur=bup;while(cur)bp.unshift(cur),cur=cur.parentNode;al=ap.length,bl=bp.length;for(var i=0;i<al&&i<bl;i++)if(ap[i]!==bp[i])return siblingCheck(ap[i],bp[i]);return i===al?siblingCheck(a,bp[i],-1):siblingCheck(ap[i],b,1)},[0,0].sort(sortOrder),baseHasDuplicate=!hasDuplicate,Sizzle.uniqueSort=function(results){var elem,i=1;hasDuplicate=baseHasDuplicate,results.sort(sortOrder);if(hasDuplicate)for(;elem=results[i];i++)elem===results[i-1]&&results.splice(i--,1);return results},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};function tokenize(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[expando][selector];if(cached)return parseOnly?0:cached.slice(0);soFar=selector,groups=[],preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar)))match&&(soFar=soFar.slice(match[0].length)),groups.push(tokens=[]);matched=!1;if(match=rcombinators.exec(soFar))tokens.push(matched=new Token(match.shift())),soFar=soFar.slice(matched.length),matched.type=match[0].replace(rtrim," ");for(type in Expr.filter)(match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match,document,!0)))&&(tokens.push(matched=new Token(match.shift())),soFar=soFar.slice(matched.length),matched.type=type,matched.matches=match);if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&combinator.dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while(elem=elem[dir])if(checkNonElements||elem.nodeType===1)return matcher(elem,context,xml)}:function(elem,context,xml){if(!xml){var cache,dirkey=dirruns+" "+doneName+" ",cachedkey=dirkey+cachedruns;while(elem=elem[dir])if(checkNonElements||elem.nodeType===1){if((cache=elem[expando])===cachedkey)return elem.sizset;if(typeof cache=="string"&&cache.indexOf(dirkey)===0){if(elem.sizset)return elem}else{elem[expando]=cachedkey;if(matcher(elem,context,xml))return elem.sizset=!0,elem;elem.sizset=!1}}}else while(elem=elem[dir])if(checkNonElements||elem.nodeType===1)if(matcher(elem,context,xml))return elem}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++)if(elem=unmatched[i])if(!filter||filter(elem,context,xml))newUnmatched.push(elem),mapped&&map.push(i);return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){if(seed&&postFinder)return;var i,elem,postFilterIn,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[],seed),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;matcher&&matcher(matcherIn,matcherOut,context,xml);if(postFilter){postFilterIn=condense(matcherOut,postMap),postFilter(postFilterIn,[],context,xml),i=postFilterIn.length;while(i--)if(elem=postFilterIn[i])matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}if(seed){i=preFilter&&matcherOut.length;while(i--)if(elem=matcherOut[i])seed[preMap[i]]=!(results[preMap[i]]=elem)}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,!0),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];for(;i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++)if(Expr.relative[tokens[j].type])break;return setMatcher(i>1&&elementMatcher(matchers),i>1&&tokens.slice(0,i-1).join("").replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&tokens.join(""))}matchers.push(matcher)}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,expandContext){var elem,j,matcher,setMatched=[],matchedCount=0,i="0",unmatched=seed&&[],outermost=expandContext!=null,contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",expandContext&&context.parentNode||context),dirrunsUnique=dirruns+=contextBackup==null?1:Math.E;outermost&&(outermostContext=context!==document&&context,cachedruns=superMatcher.el);for(;(elem=elems[i])!=null;i++){if(byElement&&elem){for(j=0;matcher=elementMatchers[j];j++)if(matcher(elem,context,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique,cachedruns=++superMatcher.el)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}matchedCount+=i;if(bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j];j++)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)while(i--)!unmatched[i]&&!setMatched[i]&&(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return superMatcher.el=0,bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,group){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[expando][selector];if(!cached){group||(group=tokenize(selector)),i=group.length;while(i--)cached=matcherFromTokens(group[i]),cached[expando]?setMatchers.push(cached):elementMatchers.push(cached);cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))}return cached};function multipleContexts(selector,contexts,results,seed){var i=0,len=contexts.length;for(;i<len;i++)Sizzle(selector,contexts[i],results,seed);return results}function select(selector,context,results,seed,xml){var i,tokens,token,type,find,match=tokenize(selector),j=match.length;if(!seed&&match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&context.nodeType===9&&!xml&&Expr.relative[tokens[1].type]){context=Expr.find.ID(token.matches[0].replace(rbackslash,""),context,xml)[0];if(!context)return results;selector=selector.slice(tokens.shift().length)}for(i=matchExpr.POS.test(selector)?-1:tokens.length-1;i>=0;i--){token=tokens[i];if(Expr.relative[type=token.type])break;if(find=Expr.find[type])if(seed=find(token.matches[0].replace(rbackslash,""),rsibling.test(tokens[0].type)&&context.parentNode||context,xml)){tokens.splice(i,1),selector=seed.length&&tokens.join("");if(!selector)return push.apply(results,slice.call(seed,0)),results;break}}}return compile(selector,match)(seed,context,xml,results,rsibling.test(selector)),results}document.querySelectorAll&&function(){var disconnectedMatch,oldSelect=select,rescape=/'|\\/g,rattributeQuotes=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,rbuggyQSA=[":focus"],rbuggyMatches=[":active",":focus"],matches=docElem.matchesSelector||docElem.mozMatchesSelector||docElem.webkitMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector;assert(function(div){div.innerHTML="<select><option selected=''></option></select>",div.querySelectorAll("[selected]").length||rbuggyQSA.push("\\["+whitespace+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),div.querySelectorAll(":checked").length||rbuggyQSA.push(":checked")}),assert(function(div){div.innerHTML="<p test=''></p>",div.querySelectorAll("[test^='']").length&&rbuggyQSA.push("[*^$]="+whitespace+"*(?:\"\"|'')"),div.innerHTML="<input type='hidden'/>",div.querySelectorAll(":enabled").length||rbuggyQSA.push(":enabled",":disabled")}),rbuggyQSA=new RegExp(rbuggyQSA.join("|")),select=function(selector,context,results,seed,xml){if(!seed&&!xml&&(!rbuggyQSA||!rbuggyQSA.test(selector))){var groups,i,old=!0,nid=expando,newContext=context,newSelector=context.nodeType===9&&selector;if(context.nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector),(old=context.getAttribute("id"))?nid=old.replace(rescape,"\\$&"):context.setAttribute("id",nid),nid="[id='"+nid+"'] ",i=groups.length;while(i--)groups[i]=nid+groups[i].join("");newContext=rsibling.test(selector)&&context.parentNode||context,newSelector=groups.join(",")}if(newSelector)try{return push.apply(results,slice.call(newContext.querySelectorAll(newSelector),0)),results}catch(qsaError){}finally{old||context.removeAttribute("id")}}return oldSelect(selector,context,results,seed,xml)},matches&&(assert(function(div){disconnectedMatch=matches.call(div,"div");try{matches.call(div,"[test!='']:sizzle"),rbuggyMatches.push("!=",pseudos)}catch(e){}}),rbuggyMatches=new RegExp(rbuggyMatches.join("|")),Sizzle.matchesSelector=function(elem,expr){expr=expr.replace(rattributeQuotes,"='$1']");if(!isXML(elem)&&!rbuggyMatches.test(expr)&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||disconnectedMatch||elem.document&&elem.document.nodeType!==11)return ret}catch(e){}return Sizzle(expr,null,null,[elem]).length>0})}(),Expr.pseudos.nth=Expr.pseudos.eq;function setFilters(){}Expr.filters=setFilters.prototype=Expr.pseudos,Expr.setFilters=new setFilters,Sizzle.attr=jQuery.attr,jQuery.find=Sizzle,jQuery.expr=Sizzle.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains}(window);var runtil=/Until$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,isSimple=/^.[^:#\[\.,]*$/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};jQuery.fn.extend({find:function(selector){var i,l,length,n,r,ret,self=this;if(typeof selector!="string")return jQuery(selector).filter(function(){for(i=0,l=self.length;i<l;i++)if(jQuery.contains(self[i],this))return!0});ret=this.pushStack("","find",selector);for(i=0,l=this.length;i<l;i++){length=ret.length,jQuery.find(selector,this[i],ret);if(i>0)for(n=length;n<ret.length;n++)for(r=0;r<length;r++)if(ret[r]===ret[n]){ret.splice(n--,1);break}}return ret},has:function(target){var i,targets=jQuery(target,this),len=targets.length;return this.filter(function(){for(i=0;i<len;i++)if(jQuery.contains(this,targets[i]))return!0})},not:function(selector){return this.pushStack(winnow(this,selector,!1),"not",selector)},filter:function(selector){return this.pushStack(winnow(this,selector,!0),"filter",selector)},is:function(selector){return!!selector&&(typeof selector=="string"?rneedsContext.test(selector)?jQuery(selector,this.context).index(this[0])>=0:jQuery.filter(selector,this).length>0:this.filter(selector).length>0)},closest:function(selectors,context){var cur,i=0,l=this.length,ret=[],pos=rneedsContext.test(selectors)||typeof selectors!="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){cur=this[i];while(cur&&cur.ownerDocument&&cur!==context&&cur.nodeType!==11){if(pos?pos.index(cur)>-1:jQuery.find.matchesSelector(cur,selectors)){ret.push(cur);break}cur=cur.parentNode}}return ret=ret.length>1?jQuery.unique(ret):ret,this.pushStack(ret,"closest",selectors)},index:function(elem){return elem?typeof elem=="string"?jQuery.inArray(this[0],jQuery(elem)):jQuery.inArray(elem.jquery?elem[0]:elem,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(selector,context){var set=typeof selector=="string"?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(isDisconnected(set[0])||isDisconnected(all[0])?all:jQuery.unique(all))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}}),jQuery.fn.andSelf=jQuery.fn.addBack;function isDisconnected(node){return!node||!node.parentNode||node.parentNode.nodeType===11}function sibling(cur,dir){do cur=cur[dir];while(cur&&cur.nodeType!==1);return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);return runtil.test(name)||(selector=until),selector&&typeof selector=="string"&&(ret=jQuery.filter(selector,ret)),ret=this.length>1&&!guaranteedUnique[name]?jQuery.unique(ret):ret,this.length>1&&rparentsprev.test(name)&&(ret=ret.reverse()),this.pushStack(ret,name,core_slice.call(arguments).join(","))}}),jQuery.extend({filter:function(expr,elems,not){return not&&(expr=":not("+expr+")"),elems.length===1?jQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:jQuery.find.matches(expr,elems)},dir:function(elem,dir,until){var matched=[],cur=elem[dir];while(cur&&cur.nodeType!==9&&(until===undefined||cur.nodeType!==1||!jQuery(cur).is(until)))cur.nodeType===1&&matched.push(cur),cur=cur[dir];return matched},sibling:function(n,elem){var r=[];for(;n;n=n.nextSibling)n.nodeType===1&&n!==elem&&r.push(n);return r}});function winnow(elements,qualifier,keep){qualifier=qualifier||0;if(jQuery.isFunction(qualifier))return jQuery.grep(elements,function(elem,i){var retVal=!!qualifier.call(elem,i,elem);return retVal===keep});if(qualifier.nodeType)return jQuery.grep(elements,function(elem,i){return elem===qualifier===keep});if(typeof qualifier=="string"){var filtered=jQuery.grep(elements,function(elem){return elem.nodeType===1});if(isSimple.test(qualifier))return jQuery.filter(qualifier,filtered,!keep);qualifier=jQuery.filter(qualifier,filtered)}return jQuery.grep(elements,function(elem,i){return jQuery.inArray(elem,qualifier)>=0===keep})}function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement)while(list.length)safeFrag.createElement(list.pop());return safeFrag}var nodeNames="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",rinlinejQuery=/ jQuery\d+="(?:null|\d+)"/g,rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rnocache=/<(?:script|object|embed|option|style)/i,rnoshimcache=new RegExp("<(?:"+nodeNames+")[\\s/>]","i"),rcheckableType=/^(?:checkbox|radio)$/,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/\/(java|ecma)script/i,rcleanScript=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},safeFragment=createSafeFragment(document),fragmentDiv=safeFragment.appendChild(document.createElement("div"));wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,jQuery.support.htmlSerialize||(wrapMap._default=[1,"X<div>","</div>"]),jQuery.fn.extend({text:function(value){return jQuery.access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},wrapAll:function(html){if(jQuery.isFunction(html))return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))});if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&wrap.insertBefore(this[0]),wrap.map(function(){var elem=this;while(elem.firstChild&&elem.firstChild.nodeType===1)elem=elem.firstChild;return elem}).append(this)}return this},wrapInner:function(html){return jQuery.isFunction(html)?this.each(function(i){jQuery(this).wrapInner(html.call(this,i))}):this.each(function(){var self=jQuery(this),contents=self.contents();contents.length?contents.wrapAll(html):self.append(html)})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(elem){(this.nodeType===1||this.nodeType===11)&&this.appendChild(elem)})},prepend:function(){return this.domManip(arguments,!0,function(elem){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(elem,this.firstChild)})},before:function(){if(!isDisconnected(this[0]))return this.domManip(arguments,!1,function(elem){this.parentNode.insertBefore(elem,this)});if(arguments.length){var set=jQuery.clean(arguments);return this.pushStack(jQuery.merge(set,this),"before",this.selector)}},after:function(){if(!isDisconnected(this[0]))return this.domManip(arguments,!1,function(elem){this.parentNode.insertBefore(elem,this.nextSibling)});if(arguments.length){var set=jQuery.clean(arguments);return this.pushStack(jQuery.merge(this,set),"after",this.selector)}},remove:function(selector,keepData){var elem,i=0;for(;(elem=this[i])!=null;i++)if(!selector||jQuery.filter(selector,[elem]).length)!keepData&&elem.nodeType===1&&(jQuery.cleanData(elem.getElementsByTagName("*")),jQuery.cleanData([elem])),elem.parentNode&&elem.parentNode.removeChild(elem);return this},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){elem.nodeType===1&&jQuery.cleanData(elem.getElementsByTagName("*"));while(elem.firstChild)elem.removeChild(elem.firstChild)}return this},clone:function(dataAndEvents,deepDataAndEvents){return dataAndEvents=dataAndEvents==null?!1:dataAndEvents,deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents,this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return jQuery.access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined)return elem.nodeType===1?elem.innerHTML.replace(rinlinejQuery,""):undefined;if(typeof value=="string"&&!rnoInnerhtml.test(value)&&(jQuery.support.htmlSerialize||!rnoshimcache.test(value))&&(jQuery.support.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++)elem=this[i]||{},elem.nodeType===1&&(jQuery.cleanData(elem.getElementsByTagName("*")),elem.innerHTML=value);elem=0}catch(e){}}elem&&this.empty().append(value)},null,value,arguments.length)},replaceWith:function(value){return isDisconnected(this[0])?this.length?this.pushStack(jQuery(jQuery.isFunction(value)?value():value),"replaceWith",value):this:jQuery.isFunction(value)?this.each(function(i){var self=jQuery(this),old=self.html();self.replaceWith(value.call(this,i,old))}):(typeof value!="string"&&(value=jQuery(value).detach()),this.each(function(){var next=this.nextSibling,parent=this.parentNode;jQuery(this).remove(),next?jQuery(next).before(value):jQuery(parent).append(value)}))},detach:function(selector){return this.remove(selector,!0)},domManip:function(args,table,callback){args=[].concat.apply([],args);var results,first,fragment,iNoClone,i=0,value=args[0],scripts=[],l=this.length;if(!jQuery.support.checkClone&&l>1&&typeof value=="string"&&rchecked.test(value))return this.each(function(){jQuery(this).domManip(args,table,callback)});if(jQuery.isFunction(value))return this.each(function(i){var self=jQuery(this);args[0]=value.call(this,i,table?self.html():undefined),self.domManip(args,table,callback)});if(this[0]){results=jQuery.buildFragment(args,this,scripts),fragment=results.fragment,first=fragment.firstChild,fragment.childNodes.length===1&&(fragment=first);if(first){table=table&&jQuery.nodeName(first,"tr");for(iNoClone=results.cacheable||l-1;i<l;i++)callback.call(table&&jQuery.nodeName(this[i],"table")?findOrAppend(this[i],"tbody"):this[i],i===iNoClone?fragment:jQuery.clone(fragment,!0,!0))}fragment=first=null,scripts.length&&jQuery.each(scripts,function(i,elem){elem.src?jQuery.ajax?jQuery.ajax({url:elem.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):jQuery.error("no ajax"):jQuery.globalEval((elem.text||elem.textContent||elem.innerHTML||"").replace(rcleanScript,"")),elem.parentNode&&elem.parentNode.removeChild(elem)})}return this}});function findOrAppend(elem,tag){return elem.getElementsByTagName(tag)[0]||elem.appendChild(elem.ownerDocument.createElement(tag))}function cloneCopyEvent(src,dest){if(dest.nodeType!==1||!jQuery.hasData(src))return;var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle,curData.events={};for(type in events)for(i=0,l=events[type].length;i<l;i++)jQuery.event.add(dest,type,events[type][i])}curData.data&&(curData.data=jQuery.extend({},curData.data))}function cloneFixAttributes(src,dest){var nodeName;if(dest.nodeType!==1)return;dest.clearAttributes&&dest.clearAttributes(),dest.mergeAttributes&&dest.mergeAttributes(src),nodeName=dest.nodeName.toLowerCase(),nodeName==="object"?(dest.parentNode&&(dest.outerHTML=src.outerHTML),jQuery.support.html5Clone&&src.innerHTML&&!jQuery.trim(dest.innerHTML)&&(dest.innerHTML=src.innerHTML)):nodeName==="input"&&rcheckableType.test(src.type)?(dest.defaultChecked=dest.checked=src.checked,dest.value!==src.value&&(dest.value=src.value)):nodeName==="option"?dest.selected=src.defaultSelected:nodeName==="input"||nodeName==="textarea"?dest.defaultValue=src.defaultValue:nodeName==="script"&&dest.text!==src.text&&(dest.text=src.text),dest.removeAttribute(jQuery.expando)}jQuery.buildFragment=function(args,context,scripts){var fragment,cacheable,cachehit,first=args[0];return context=context||document,context=!context.nodeType&&context[0]||context,context=context.ownerDocument||context,args.length===1&&typeof first=="string"&&first.length<512&&context===document&&first.charAt(0)==="<"&&!rnocache.test(first)&&(jQuery.support.checkClone||!rchecked.test(first))&&(jQuery.support.html5Clone||!rnoshimcache.test(first))&&(cacheable=!0,fragment=jQuery.fragments[first],cachehit=fragment!==undefined),fragment||(fragment=context.createDocumentFragment(),jQuery.clean(args,context,fragment,scripts),cacheable&&(jQuery.fragments[first]=cachehit&&fragment)),{fragment:fragment,cacheable:cacheable}},jQuery.fragments={},jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,i=0,ret=[],insert=jQuery(selector),l=insert.length,parent=this.length===1&&this[0].parentNode;if((parent==null||parent&&parent.nodeType===11&&parent.childNodes.length===1)&&l===1)return insert[original](this[0]),this;for(;i<l;i++)elems=(i>0?this.clone(!0):this).get(),jQuery(insert[i])[original](elems),ret=ret.concat(elems);return this.pushStack(ret,name,insert.selector)}});function getAll(elem){return typeof elem.getElementsByTagName!="undefined"?elem.getElementsByTagName("*"):typeof elem.querySelectorAll!="undefined"?elem.querySelectorAll("*"):[]}function fixDefaultChecked(elem){rcheckableType.test(elem.type)&&(elem.defaultChecked=elem.checked)}jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var srcElements,destElements,i,clone;jQuery.support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test("<"+elem.nodeName+">")?clone=elem.cloneNode(!0):(fragmentDiv.innerHTML=elem.outerHTML,fragmentDiv.removeChild(clone=fragmentDiv.firstChild));if((!jQuery.support.noCloneEvent||!jQuery.support.noCloneChecked)&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){cloneFixAttributes(elem,clone),srcElements=getAll(elem),destElements=getAll(clone);for(i=0;srcElements[i];++i)destElements[i]&&cloneFixAttributes(srcElements[i],destElements[i])}if(dataAndEvents){cloneCopyEvent(elem,clone);if(deepDataAndEvents){srcElements=getAll(elem),destElements=getAll(clone);for(i=0;srcElements[i];++i)cloneCopyEvent(srcElements[i],destElements[i])}}return srcElements=destElements=null,clone},clean:function(elems,context,fragment,scripts){var i,j,elem,tag,wrap,depth,div,hasBody,tbody,len,handleScript,jsTags,safe=context===document&&safeFragment,ret=[];if(!context||typeof context.createDocumentFragment=="undefined")context=document;for(i=0;(elem=elems[i])!=null;i++){typeof elem=="number"&&(elem+="");if(!elem)continue;if(typeof elem=="string")if(!rhtml.test(elem))elem=context.createTextNode(elem);else{safe=safe||createSafeFragment(context),div=context.createElement("div"),safe.appendChild(div),elem=elem.replace(rxhtmlTag,"<$1></$2>"),tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,depth=wrap[0],div.innerHTML=wrap[1]+elem+wrap[2];while(depth--)div=div.lastChild;if(!jQuery.support.tbody){hasBody=rtbody.test(elem),tbody=tag==="table"&&!hasBody?div.firstChild&&div.firstChild.childNodes:wrap[1]==="<table>"&&!hasBody?div.childNodes:[];for(j=tbody.length-1;j>=0;--j)jQuery.nodeName(tbody[j],"tbody")&&!tbody[j].childNodes.length&&tbody[j].parentNode.removeChild(tbody[j])}!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(elem)&&div.insertBefore(context.createTextNode(rleadingWhitespace.exec(elem)[0]),div.firstChild),elem=div.childNodes,div.parentNode.removeChild(div)}elem.nodeType?ret.push(elem):jQuery.merge(ret,elem)}div&&(elem=div=safe=null);if(!jQuery.support.appendChecked)for(i=0;(elem=ret[i])!=null;i++)jQuery.nodeName(elem,"input")?fixDefaultChecked(elem):typeof elem.getElementsByTagName!="undefined"&&jQuery.grep(elem.getElementsByTagName("input"),fixDefaultChecked);if(fragment){handleScript=function(elem){if(!elem.type||rscriptType.test(elem.type))return scripts?scripts.push(elem.parentNode?elem.parentNode.removeChild(elem):elem):fragment.appendChild(elem)};for(i=0;(elem=ret[i])!=null;i++)if(!jQuery.nodeName(elem,"script")||!handleScript(elem))fragment.appendChild(elem),typeof elem.getElementsByTagName!="undefined"&&(jsTags=jQuery.grep(jQuery.merge([],elem.getElementsByTagName("script")),handleScript),ret.splice.apply(ret,[i+1,0].concat(jsTags)),i+=jsTags.length)}return ret},cleanData:function(elems,acceptData){var data,id,elem,type,i=0,internalKey=jQuery.expando,cache=jQuery.cache,deleteExpando=jQuery.support.deleteExpando,special=jQuery.event.special;for(;(elem=elems[i])!=null;i++)if(acceptData||jQuery.acceptData(elem)){id=elem[internalKey],data=id&&cache[id];if(data){if(data.events)for(type in data.events)special[type]?jQuery.event.remove(elem,type):jQuery.removeEvent(elem,type,data.handle);cache[id]&&(delete cache[id],deleteExpando?delete elem[internalKey]:elem.removeAttribute?elem.removeAttribute(internalKey):elem[internalKey]=null,jQuery.deletedIds.push(id))}}}}),function(){var matched,browser;jQuery.uaMatch=function(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"}},matched=jQuery.uaMatch(navigator.userAgent),browser={},matched.browser&&(browser[matched.browser]=!0,browser.version=matched.version),browser.chrome?browser.webkit=!0:browser.webkit&&(browser.safari=!0),jQuery.browser=browser,jQuery.sub=function(){function jQuerySub(selector,context){return new jQuerySub.fn.init(selector,context)}jQuery.extend(!0,jQuerySub,this),jQuerySub.superclass=this,jQuerySub.fn=jQuerySub.prototype=this(),jQuerySub.fn.constructor=jQuerySub,jQuerySub.sub=this.sub,jQuerySub.fn.init=function init(selector,context){return context&&context instanceof jQuery&&!(context instanceof jQuerySub)&&(context=jQuerySub(context)),jQuery.fn.init.call(this,selector,context,rootjQuerySub)},jQuerySub.fn.init.prototype=jQuerySub.fn;var rootjQuerySub=jQuerySub(document);return jQuerySub}}();var curCSS,iframe,iframeDoc,ralpha=/alpha\([^)]*\)/i,ropacity=/opacity=([^)]*)/,rposition=/^(top|right|bottom|left)$/,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([-+])=("+core_pnum+")","i"),elemdisplay={},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"],eventsToggle=jQuery.fn.toggle;function vendorPropName(style,name){if(name in style)return name;var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style)return name}return origName}function isHidden(elem,el){return elem=el||elem,jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)}function showHide(elements,show){var elem,display,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style)continue;values[index]=jQuery._data(elem,"olddisplay"),show?(!values[index]&&elem.style.display==="none"&&(elem.style.display=""),elem.style.display===""&&isHidden(elem)&&(values[index]=jQuery._data(elem,"olddisplay",css_defaultDisplay(elem.nodeName)))):(display=curCSS(elem,"display"),!values[index]&&display!=="none"&&jQuery._data(elem,"olddisplay",display))}for(index=0;index<length;index++){elem=elements[index];if(!elem.style)continue;if(!show||elem.style.display==="none"||elem.style.display==="")elem.style.display=show?values[index]||"":"none"}return elements}jQuery.fn.extend({css:function(name,value){return jQuery.access(this,function(elem,name,value){return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(state,fn2){var bool=typeof state=="boolean";return jQuery.isFunction(state)&&jQuery.isFunction(fn2)?eventsToggle.apply(this,arguments):this.each(function(){(bool?state:isHidden(this))?jQuery(this).show():jQuery(this).hide()})}}),jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":jQuery.support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style)return;var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value===undefined)return hooks&&"get"in hooks&&(ret=hooks.get(elem,!1,extra))!==undefined?ret:style[name];type=typeof value,type==="string"&&(ret=rrelNum.exec(value))&&(value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name)),type="number");if(value==null||type==="number"&&isNaN(value))return;type==="number"&&!jQuery.cssNumber[origName]&&(value+="px");if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined)try{style[name]=value}catch(e){}},css:function(elem,name,numeric,extra){var val,num,hooks,origName=jQuery.camelCase(name);return name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],hooks&&"get"in hooks&&(val=hooks.get(elem,!0,extra)),val===undefined&&(val=curCSS(elem,name)),val==="normal"&&name in cssNormalTransform&&(val=cssNormalTransform[name]),numeric||extra!==undefined?(num=parseFloat(val),numeric||jQuery.isNumeric(num)?num||0:val):val},swap:function(elem,options,callback){var ret,name,old={};for(name in options)old[name]=elem.style[name],elem.style[name]=options[name];ret=callback.call(elem);for(name in options)elem.style[name]=old[name];return ret}}),window.getComputedStyle?curCSS=function(elem,name){var ret,width,minWidth,maxWidth,computed=window.getComputedStyle(elem,null),style=elem.style;return computed&&(ret=computed[name],ret===""&&!jQuery.contains(elem.ownerDocument,elem)&&(ret=jQuery.style(elem,name)),rnumnonpx.test(ret)&&rmargin.test(name)&&(width=style.width,minWidth=style.minWidth,maxWidth=style.maxWidth,style.minWidth=style.maxWidth=style.width=ret,ret=computed.width,style.width=width,style.minWidth=minWidth,style.maxWidth=maxWidth)),ret}:document.documentElement.currentStyle&&(curCSS=function(elem,name){var left,rsLeft,ret=elem.currentStyle&&elem.currentStyle[name],style=elem.style;return ret==null&&style&&style[name]&&(ret=style[name]),rnumnonpx.test(ret)&&!rposition.test(name)&&(left=style.left,rsLeft=elem.runtimeStyle&&elem.runtimeStyle.left,rsLeft&&(elem.runtimeStyle.left=elem.currentStyle.left),style.left=name==="fontSize"?"1em":ret,ret=style.pixelLeft+"px",style.left=left,rsLeft&&(elem.runtimeStyle.left=rsLeft)),ret===""?"auto":ret});function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2)extra==="margin"&&(val+=jQuery.css(elem,extra+cssExpand[i],!0)),isBorderBox?(extra==="content"&&(val-=parseFloat(curCSS(elem,"padding"+cssExpand[i]))||0),extra!=="margin"&&(val-=parseFloat(curCSS(elem,"border"+cssExpand[i]+"Width"))||0)):(val+=parseFloat(curCSS(elem,"padding"+cssExpand[i]))||0,extra!=="padding"&&(val+=parseFloat(curCSS(elem,"border"+cssExpand[i]+"Width"))||0));return val}function getWidthOrHeight(elem,name,extra){var val=name==="width"?elem.offsetWidth:elem.offsetHeight,valueIsBorderBox=!0,isBorderBox=jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing")==="border-box";if(val<=0||val==null){val=curCSS(elem,name);if(val<0||val==null)val=elem.style[name];if(rnumnonpx.test(val))return val;valueIsBorderBox=isBorderBox&&(jQuery.support.boxSizingReliable||val===elem.style[name]),val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox)+"px"}function css_defaultDisplay(nodeName){if(elemdisplay[nodeName])return elemdisplay[nodeName];var elem=jQuery("<"+nodeName+">").appendTo(document.body),display=elem.css("display");elem.remove();if(display==="none"||display===""){iframe=document.body.appendChild(iframe||jQuery.extend(document.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!iframeDoc||!iframe.createElement)iframeDoc=(iframe.contentWindow||iframe.contentDocument).document,iframeDoc.write("<!doctype html><html><body>"),iframeDoc.close();elem=iframeDoc.body.appendChild(iframeDoc.createElement(nodeName)),display=curCSS(elem,"display"),document.body.removeChild(iframe)}return elemdisplay[nodeName]=display,display}jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed)return elem.offsetWidth===0&&rdisplayswap.test(curCSS(elem,"display"))?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)},set:function(elem,value,extra){return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing")==="border-box"):0)}}}),jQuery.support.opacity||(jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":computed?"1":""},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+value*100+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1;if(value>=1&&jQuery.trim(filter.replace(ralpha,""))===""&&style.removeAttribute){style.removeAttribute("filter");if(currentStyle&&!currentStyle.filter)return}style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity}}),jQuery(function(){jQuery.support.reliableMarginRight||(jQuery.cssHooks.marginRight={get:function(elem,computed){return jQuery.swap(elem,{display:"inline-block"},function(){if(computed)return curCSS(elem,"marginRight")})}}),!jQuery.support.pixelPosition&&jQuery.fn.position&&jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]={get:function(elem,computed){if(computed){var ret=curCSS(elem,prop);return rnumnonpx.test(ret)?jQuery(elem).position()[prop]+"px":ret}}}})}),jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth===0&&elem.offsetHeight===0||!jQuery.support.reliableHiddenOffsets&&(elem.style&&elem.style.display||curCSS(elem,"display"))==="none"},jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)}),jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i,parts=typeof value=="string"?value.split(" "):[value],expanded={};for(i=0;i<4;i++)expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];return expanded}},rmargin.test(prefix)||(jQuery.cssHooks[prefix+suffix].set=setPositiveNumber)});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rinput=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,rselectTextarea=/^(?:select|textarea)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?jQuery.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||rselectTextarea.test(this.nodeName)||rinput.test(this.type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val,i){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}}),jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value==null?"":value,s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};traditional===undefined&&(traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional);if(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,function(){add(this.name,this.value)});else for(prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join("&").replace(r20,"+")};function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj))jQuery.each(obj,function(i,v){traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+(typeof v=="object"?i:"")+"]",v,traditional,add)});else if(!traditional&&jQuery.type(obj)==="object")for(name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add);else add(prefix,obj)}var ajaxLocParts,ajaxLocation,rhash=/#.*$/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,rlocalProtocol=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rquery=/\?/,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,rts=/([?&])_=[^&]*/,rurl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes=["*/"]+["*"];try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a"),ajaxLocation.href="",ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){typeof dataTypeExpression!="string"&&(func=dataTypeExpression,dataTypeExpression="*");var dataType,list,placeBefore,dataTypes=dataTypeExpression.toLowerCase().split(core_rspace),i=0,length=dataTypes.length;if(jQuery.isFunction(func))for(;i<length;i++)dataType=dataTypes[i],placeBefore=/^\+/.test(dataType),placeBefore&&(dataType=dataType.substr(1)||"*"),list=structure[dataType]=structure[dataType]||[],list[placeBefore?"unshift":"push"](func)}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,dataType,inspected){dataType=dataType||options.dataTypes[0],inspected=inspected||{},inspected[dataType]=!0;var selection,list=structure[dataType],i=0,length=list?list.length:0,executeOnly=structure===prefilters;for(;i<length&&(executeOnly||!selection);i++)selection=list[i](options,originalOptions,jqXHR),typeof selection=="string"&&(!executeOnly||inspected[selection]?selection=undefined:(options.dataTypes.unshift(selection),selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,selection,inspected)));return(executeOnly||!selection)&&!inspected["*"]&&(selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,"*",inspected)),selection}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src)src[key]!==undefined&&((flatOptions[key]?target:deep||(deep={}))[key]=src[key]);deep&&jQuery.extend(!0,target,deep)}jQuery.fn.load=function(url,params,callback){if(typeof url!="string"&&_load)return _load.apply(this,arguments);if(!this.length)return this;var selector,type,response,self=this,off=url.indexOf(" ");return off>=0&&(selector=url.slice(off,url.length),url=url.slice(0,off)),jQuery.isFunction(params)?(callback=params,params=undefined):params&&typeof params=="object"&&(type="POST"),jQuery.ajax({url:url,type:type,dataType:"html",data:params,complete:function(jqXHR,status){callback&&self.each(callback,response||[jqXHR.responseText,status,jqXHR])}}).done(function(responseText){response=arguments,self.html(selector?jQuery("<div>").append(responseText.replace(rscript,"")).find(selector):responseText)}),this},jQuery.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(i,o){jQuery.fn[o]=function(f){return this.on(o,f)}}),jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){return jQuery.isFunction(data)&&(type=type||callback,callback=data,data=undefined),jQuery.ajax({type:method,url:url,data:data,success:callback,dataType:type})}}),jQuery.extend({getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},ajaxSetup:function(target,settings){return settings?ajaxExtend(target,jQuery.ajaxSettings):(settings=target,target=jQuery.ajaxSettings),ajaxExtend(target,settings),target},ajaxSettings:{url:ajaxLocation,isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":allTypes},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":window.String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){typeof url=="object"&&(options=url,url=undefined),options=options||{};var ifModifiedKey,responseHeadersString,responseHeaders,transport,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=callbackContext!==s&&(callbackContext.nodeType||callbackContext instanceof jQuery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,setRequestHeader:function(name,value){if(!state){var lname=name.toLowerCase();name=requestHeadersNames[lname]=requestHeadersNames[lname]||name,requestHeaders[name]=value}return this},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while(match=rheaders.exec(responseHeadersString))responseHeaders[match[1].toLowerCase()]=match[2]}match=responseHeaders[key.toLowerCase()]}return match===undefined?null:match},overrideMimeType:function(type){return state||(s.mimeType=type),this},abort:function(statusText){return statusText=statusText||strAbort,transport&&transport.abort(statusText),done(0,statusText),this}};function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2)return;state=2,timeoutTimer&&clearTimeout(timeoutTimer),transport=undefined,responseHeadersString=headers||"",jqXHR.readyState=status>0?4:0,responses&&(response=ajaxHandleResponses(s,jqXHR,responses));if(status>=200&&status<300||status===304)s.ifModified&&(modified=jqXHR.getResponseHeader("Last-Modified"),modified&&(jQuery.lastModified[ifModifiedKey]=modified),modified=jqXHR.getResponseHeader("Etag"),modified&&(jQuery.etag[ifModifiedKey]=modified)),status===304?(statusText="notmodified",isSuccess=!0):(isSuccess=ajaxConvert(s,response),statusText=isSuccess.state,success=isSuccess.data,error=isSuccess.error,isSuccess=!error);else{error=statusText;if(!statusText||status)statusText="error",status<0&&(status=0)}jqXHR.status=status,jqXHR.statusText=(nativeStatusText||statusText)+"",isSuccess?deferred.resolveWith(callbackContext,[success,statusText,jqXHR]):deferred.rejectWith(callbackContext,[jqXHR,statusText,error]),jqXHR.statusCode(statusCode),statusCode=undefined,fireGlobals&&globalEventContext.trigger("ajax"+(isSuccess?"Success":"Error"),[jqXHR,s,isSuccess?success:error]),completeDeferred.fireWith(callbackContext,[jqXHR,statusText]),fireGlobals&&(globalEventContext.trigger("ajaxComplete",[jqXHR,s]),--jQuery.active||jQuery.event.trigger("ajaxStop"))}deferred.promise(jqXHR),jqXHR.success=jqXHR.done,jqXHR.error=jqXHR.fail,jqXHR.complete=completeDeferred.add,jqXHR.statusCode=function(map){if(map){var tmp;if(state<2)for(tmp in map)statusCode[tmp]=[statusCode[tmp],map[tmp]];else tmp=map[jqXHR.status],jqXHR.always(tmp)}return this},s.url=((url||s.url)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//"),s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().split(core_rspace),s.crossDomain==null&&(parts=rurl.exec(s.url.toLowerCase())||!1,s.crossDomain=parts&&parts.join(":")+(parts[3]?"":parts[1]==="http:"?80:443)!==ajaxLocParts.join(":")+(ajaxLocParts[3]?"":ajaxLocParts[1]==="http:"?80:443)),s.data&&s.processData&&typeof s.data!="string"&&(s.data=jQuery.param(s.data,s.traditional)),inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2)return jqXHR;fireGlobals=s.global,s.type=s.type.toUpperCase(),s.hasContent=!rnoContent.test(s.type),fireGlobals&&jQuery.active++===0&&jQuery.event.trigger("ajaxStart");if(!s.hasContent){s.data&&(s.url+=(rquery.test(s.url)?"&":"?")+s.data,delete s.data),ifModifiedKey=s.url;if(s.cache===!1){var ts=jQuery.now(),ret=s.url.replace(rts,"$1_="+ts);s.url=ret+(ret===s.url?(rquery.test(s.url)?"&":"?")+"_="+ts:"")}}(s.data&&s.hasContent&&s.contentType!==!1||options.contentType)&&jqXHR.setRequestHeader("Content-Type",s.contentType),s.ifModified&&(ifModifiedKey=ifModifiedKey||s.url,jQuery.lastModified[ifModifiedKey]&&jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[ifModifiedKey]),jQuery.etag[ifModifiedKey]&&jqXHR.setRequestHeader("If-None-Match",jQuery.etag[ifModifiedKey])),jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers)jqXHR.setRequestHeader(i,s.headers[i]);if(!s.beforeSend||s.beforeSend.call(callbackContext,jqXHR,s)!==!1&&state!==2){strAbort="abort";for(i in{success:1,error:1,complete:1})jqXHR[i](s[i]);transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport)done(-1,"No Transport");else{jqXHR.readyState=1,fireGlobals&&globalEventContext.trigger("ajaxSend",[jqXHR,s]),s.async&&s.timeout>0&&(timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout));try{state=1,transport.send(requestHeaders,done)}catch(e){if(!(state<2))throw e;done(-1,e)}}return jqXHR}return jqXHR.abort()},active:0,lastModified:{},etag:{}});function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes,responseFields=s.responseFields;for(type in responseFields)type in responses&&(jqXHR[responseFields[type]]=responses[type]);while(dataTypes[0]==="*")dataTypes.shift(),ct===undefined&&(ct=s.mimeType||jqXHR.getResponseHeader("content-type"));if(ct)for(type in contents)if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}if(dataTypes[0]in responses)finalDataType=dataTypes[0];else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}firstDataType||(firstDataType=type)}finalDataType=finalDataType||firstDataType}if(finalDataType)return finalDataType!==dataTypes[0]&&dataTypes.unshift(finalDataType),responses[finalDataType]}function ajaxConvert(s,response){var conv,conv2,current,tmp,dataTypes=s.dataTypes.slice(),prev=dataTypes[0],converters={},i=0;s.dataFilter&&(response=s.dataFilter(response,s.dataType));if(dataTypes[1])for(conv in s.converters)converters[conv.toLowerCase()]=s.converters[conv];for(;current=dataTypes[++i];)if(current!=="*"){if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv)for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){conv===!0?conv=converters[conv2]:converters[conv2]!==!0&&(current=tmp[0],dataTypes.splice(i--,0,current));break}}}if(conv!==!0)if(conv&&s["throws"])response=conv(response);else try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}prev=current}return{state:"success",data:response}}var oldCallbacks=[],rquestion=/\?/,rjsonp=/(=)\?(?=&|$)|\?\?/,nonce=jQuery.now();jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;return this[callback]=!0,callback}}),jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,data=s.data,url=s.url,hasCallback=s.jsonp!==!1,replaceInUrl=hasCallback&&rjsonp.test(url),replaceInData=hasCallback&&!replaceInUrl&&typeof data=="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(data);if(s.dataTypes[0]==="jsonp"||replaceInUrl||replaceInData)return callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,overwritten=window[callbackName],replaceInUrl?s.url=url.replace(rjsonp,"$1"+callbackName):replaceInData?s.data=data.replace(rjsonp,"$1"+callbackName):hasCallback&&(s.url+=(rquestion.test(url)?"&":"?")+s.jsonp+"="+callbackName),s.converters["script json"]=function(){return responseContainer||jQuery.error(callbackName+" was not called"),responseContainer[0]},s.dataTypes[0]="json",window[callbackName]=function(){responseContainer=arguments},jqXHR.always(function(){window[callbackName]=overwritten,s[callbackName]&&(s.jsonpCallback=originalSettings.jsonpCallback,oldCallbacks.push(callbackName)),responseContainer&&jQuery.isFunction(overwritten)&&overwritten(responseContainer[0]),responseContainer=overwritten=undefined}),"script"}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(text){return jQuery.globalEval(text),text}}}),jQuery.ajaxPrefilter("script",function(s){s.cache===undefined&&(s.cache=!1),s.crossDomain&&(s.type="GET",s.global=!1)}),jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script"),script.async="async",s.scriptCharset&&(script.charset=s.scriptCharset),script.src=s.url,script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState))script.onload=script.onreadystatechange=null,head&&script.parentNode&&head.removeChild(script),script=undefined,isAbort||callback(200,"success")},head.insertBefore(script,head.firstChild)},abort:function(){script&&script.onload(0,1)}}}});var xhrCallbacks,xhrOnUnloadAbort=window.ActiveXObject?function(){for(var key in xhrCallbacks)xhrCallbacks[key](0,1)}:!1,xhrId=0;function createStandardXHR(){try{return new window.XMLHttpRequest}catch(e){}}function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}jQuery.ajaxSettings.xhr=window.ActiveXObject?function(){return!this.isLocal&&createStandardXHR()||createActiveXHR()}:createStandardXHR,function(xhr){jQuery.extend(jQuery.support,{ajax:!!xhr,cors:!!xhr&&"withCredentials"in xhr})}(jQuery.ajaxSettings.xhr()),jQuery.support.ajax&&jQuery.ajaxTransport(function(s){if(!s.crossDomain||jQuery.support.cors){var callback;return{send:function(headers,complete){var handle,i,xhr=s.xhr();s.username?xhr.open(s.type,s.url,s.async,s.username,s.password):xhr.open(s.type,s.url,s.async);if(s.xhrFields)for(i in s.xhrFields)xhr[i]=s.xhrFields[i];s.mimeType&&xhr.overrideMimeType&&xhr.overrideMimeType(s.mimeType),!s.crossDomain&&!headers["X-Requested-With"]&&(headers["X-Requested-With"]="XMLHttpRequest");try{for(i in headers)xhr.setRequestHeader(i,headers[i])}catch(_){}xhr.send(s.hasContent&&s.data||null),callback=function(_,isAbort){var status,statusText,responseHeaders,responses,xml;try{if(callback&&(isAbort||xhr.readyState===4)){callback=undefined,handle&&(xhr.onreadystatechange=jQuery.noop,xhrOnUnloadAbort&&delete xhrCallbacks[handle]);if(isAbort)xhr.readyState!==4&&xhr.abort();else{status=xhr.status,responseHeaders=xhr.getAllResponseHeaders(),responses={},xml=xhr.responseXML,xml&&xml.documentElement&&(responses.xml=xml);try{responses.text=xhr.responseText}catch(_){}try{statusText=xhr.statusText}catch(e){statusText=""}!status&&s.isLocal&&!s.crossDomain?status=responses.text?200:404:status===1223&&(status=204)}}}catch(firefoxAccessException){isAbort||complete(-1,firefoxAccessException)}responses&&complete(status,statusText,responses,responseHeaders)},s.async?xhr.readyState===4?setTimeout(callback,0):(handle=++xhrId,xhrOnUnloadAbort&&(xhrCallbacks||(xhrCallbacks={},jQuery(window).unload(xhrOnUnloadAbort)),xhrCallbacks[handle]=callback),xhr.onreadystatechange=callback):callback()},abort:function(){callback&&callback(0,1)}}}});var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([-+])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var end,unit,tween=this.createTween(prop,value),parts=rfxnum.exec(value),target=tween.cur(),start=+target||0,scale=1,maxIterations=20;if(parts){end=+parts[2],unit=parts[3]||(jQuery.cssNumber[prop]?"":"px");if(unit!=="px"&&start){start=jQuery.css(tween.elem,prop,!0)||end||1;do scale=scale||".5",start/=scale,jQuery.style(tween.elem,prop,start+unit);while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations)}tween.unit=unit,tween.start=start,tween.end=parts[1]?start+(parts[1]+1)*end:end}return tween}]};function createFxNow(){return setTimeout(function(){fxNow=undefined},0),fxNow=jQuery.now()}function createTweens(animation,props){jQuery.each(props,function(prop,value){var collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++)if(collection[index].call(animation,prop,value))return})}function Animation(elem,properties,options){var result,index=0,tweenerIndex=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),percent=1-(remaining/animation.duration||0),index=0,length=animation.tweens.length;for(;index<length;index++)animation.tweens[index].run(percent);return deferred.notifyWith(elem,[animation,percent,remaining]),percent<1&&length?remaining:(deferred.resolveWith(elem,[animation]),!1)},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(!0,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end,easing){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);return animation.tweens.push(tween),tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;for(;index<length;index++)animation.tweens[index].run(1);return gotoEnd?deferred.resolveWith(elem,[animation,gotoEnd]):deferred.rejectWith(elem,[animation,gotoEnd]),this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result)return result}return createTweens(animation,props),jQuery.isFunction(animation.opts.start)&&animation.opts.start.call(elem,animation),jQuery.fx.timer(jQuery.extend(tick,{anim:animation,queue:animation.opts.queue,elem:elem})),animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index),easing=specialEasing[name],value=props[index],jQuery.isArray(value)&&(easing=value[1],value=props[index]=value[0]),index!==name&&(props[name]=value,delete props[index]),hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value),delete props[name];for(index in value)index in props||(props[index]=value[index],specialEasing[index]=easing)}else specialEasing[name]=easing}}jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){jQuery.isFunction(props)?(callback=props,props=["*"]):props=props.split(" ");var prop,index=0,length=props.length;for(;index<length;index++)prop=props[index],tweeners[prop]=tweeners[prop]||[],tweeners[prop].unshift(callback)},prefilter:function(callback,prepend){prepend?animationPrefilters.unshift(callback):animationPrefilters.push(callback)}});function defaultPrefilter(elem,props,opts){var index,prop,value,length,dataShow,tween,hooks,oldfire,anim=this,style=elem.style,orig={},handled=[],hidden=elem.nodeType&&isHidden(elem);opts.queue||(hooks=jQuery._queueHooks(elem,"fx"),hooks.unqueued==null&&(hooks.unqueued=0,oldfire=hooks.empty.fire,hooks.empty.fire=function(){hooks.unqueued||oldfire()}),hooks.unqueued++,anim.always(function(){anim.always(function(){hooks.unqueued--,jQuery.queue(elem,"fx").length||hooks.empty.fire()})})),elem.nodeType===1&&("height"in props||"width"in props)&&(opts.overflow=[style.overflow,style.overflowX,style.overflowY],jQuery.css(elem,"display")==="inline"&&jQuery.css(elem,"float")==="none"&&(!jQuery.support.inlineBlockNeedsLayout||css_defaultDisplay(elem.nodeName)==="inline"?style.display="inline-block":style.zoom=1)),opts.overflow&&(style.overflow="hidden",jQuery.support.shrinkWrapBlocks||anim.done(function(){style.overflow=opts.overflow[0],style.overflowX=opts.overflow[1],style.overflowY=opts.overflow[2]}));for(index in props){value=props[index];if(rfxtypes.exec(value)){delete props[index];if(value===(hidden?"hide":"show"))continue;handled.push(index)}}length=handled.length;if(length){dataShow=jQuery._data(elem,"fxshow")||jQuery._data(elem,"fxshow",{}),hidden?jQuery(elem).show():anim.done(function(){jQuery(elem).hide()}),anim.done(function(){var prop;jQuery.removeData(elem,"fxshow",!0);for(prop in orig)jQuery.style(elem,prop,orig[prop])});for(index=0;index<length;index++)prop=handled[index],tween=anim.createTween(prop,hidden?dataShow[prop]:0),orig[prop]=dataShow[prop]||jQuery.style(elem,prop),prop in dataShow||(dataShow[prop]=tween.start,hidden&&(tween.end=tween.start,tween.start=prop==="width"||prop==="height"?1:0))}}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem,this.prop=prop,this.easing=easing||"swing",this.options=options,this.start=this.now=this.cur(),this.end=end,this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];return this.options.duration?this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration):this.pos=eased=percent,this.now=(this.end-this.start)*eased+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),hooks&&hooks.set?hooks.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(tween){var result;return tween.elem[tween.prop]==null||!!tween.elem.style&&tween.elem.style[tween.prop]!=null?(result=jQuery.css(tween.elem,tween.prop,!1,""),!result||result==="auto"?0:result):tween.elem[tween.prop]},set:function(tween){jQuery.fx.step[tween.prop]?jQuery.fx.step[tween.prop](tween):tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])?jQuery.style(tween.elem,tween.prop,tween.now+tween.unit):tween.elem[tween.prop]=tween.now}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){tween.elem.nodeType&&tween.elem.parentNode&&(tween.elem[tween.prop]=tween.now)}},jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed=="boolean"||!i&&jQuery.isFunction(speed)&&jQuery.isFunction(easing)?cssFn.apply(this,arguments):this.animate(genFx(name,!0),speed,easing,callback)}}),jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);empty&&anim.stop(!0)};return empty||optall.queue===!1?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop,stop(gotoEnd)};return typeof type!="string"&&(gotoEnd=clearQueue,clearQueue=type,type=undefined),clearQueue&&type!==!1&&this.queue(type||"fx",[]),this.each(function(){var dequeue=!0,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=jQuery._data(this);if(index)data[index]&&data[index].stop&&stopQueue(data[index]);else for(index in data)data[index]&&data[index].stop&&rrun.test(index)&&stopQueue(data[index]);for(index=timers.length;index--;)timers[index].elem===this&&(type==null||timers[index].queue===type)&&(timers[index].anim.stop(gotoEnd),dequeue=!1,timers.splice(index,1));(dequeue||!gotoEnd)&&jQuery.dequeue(this,type)})}});function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth)which=cssExpand[i],attrs["margin"+which]=attrs["padding"+which]=type;return includeWidth&&(attrs.opacity=attrs.width=type),attrs}jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}}),jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed=="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration=="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===!0)opt.queue="fx";return opt.old=opt.complete,opt.complete=function(){jQuery.isFunction(opt.old)&&opt.old.call(this),opt.queue&&jQuery.dequeue(this,opt.queue)},opt},jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}},jQuery.timers=[],jQuery.fx=Tween.prototype.init,jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;for(;i<timers.length;i++)timer=timers[i],!timer()&&timers[i]===timer&&timers.splice(i--,1);timers.length||jQuery.fx.stop()},jQuery.fx.timer=function(timer){timer()&&jQuery.timers.push(timer)&&!timerId&&(timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval))},jQuery.fx.interval=13,jQuery.fx.stop=function(){clearInterval(timerId),timerId=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fx.step={},jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length});var rroot=/^(?:body|html)$/i;jQuery.fn.offset=function(options){if(arguments.length)return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)});var docElem,body,win,clientTop,clientLeft,scrollTop,scrollLeft,box={top:0,left:0},elem=this[0],doc=elem&&elem.ownerDocument;if(!doc)return;return(body=doc.body)===elem?jQuery.offset.bodyOffset(elem):(docElem=doc.documentElement,jQuery.contains(docElem,elem)?(typeof elem.getBoundingClientRect!="undefined"&&(box=elem.getBoundingClientRect()),win=getWindow(doc),clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,scrollTop=win.pageYOffset||docElem.scrollTop,scrollLeft=win.pageXOffset||docElem.scrollLeft,{top:box.top+scrollTop-clientTop,left:box.left+scrollLeft-clientLeft}):box)},jQuery.offset={bodyOffset:function(body){var top=body.offsetTop,left=body.offsetLeft;return jQuery.support.doesNotIncludeMarginInBodyOffset&&(top+=parseFloat(jQuery.css(body,"marginTop"))||0,left+=parseFloat(jQuery.css(body,"marginLeft"))||0),{top:top,left:left}},setOffset:function(elem,options,i){var position=jQuery.css(elem,"position");position==="static"&&(elem.style.position="relative");var curElem=jQuery(elem),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=(position==="absolute"||position==="fixed")&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1,props={},curPosition={},curTop,curLeft;calculatePosition?(curPosition=curElem.position(),curTop=curPosition.top,curLeft=curPosition.left):(curTop=parseFloat(curCSSTop)||0,curLeft=parseFloat(curCSSLeft)||0),jQuery.isFunction(options)&&(options=options.call(elem,i,curOffset)),options.top!=null&&(props.top=options.top-curOffset.top+curTop),options.left!=null&&(props.left=options.left-curOffset.left+curLeft),"using"in options?options.using.call(elem,props):curElem.css(props)}},jQuery.fn.extend({position:function(){if(!this[0])return;var elem=this[0],offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=rroot.test(offsetParent[0].nodeName)?{top:0,left:0}:offsetParent.offset();return offset.top-=parseFloat(jQuery.css(elem,"marginTop"))||0,offset.left-=parseFloat(jQuery.css(elem,"marginLeft"))||0,parentOffset.top+=parseFloat(jQuery.css(offsetParent[0],"borderTopWidth"))||0,parentOffset.left+=parseFloat(jQuery.css(offsetParent[0],"borderLeftWidth"))||0,{top:offset.top-parentOffset.top,left:offset.left-parentOffset.left}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||document.body;while(offsetParent&&!rroot.test(offsetParent.nodeName)&&jQuery.css(offsetParent,"position")==="static")offsetParent=offsetParent.offsetParent;return offsetParent||document.body})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top=/Y/.test(prop);jQuery.fn[method]=function(val){return jQuery.access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined)return win?prop in win?win[prop]:win.document.documentElement[method]:elem[method];win?win.scrollTo(top?jQuery(win).scrollLeft():val,top?val:jQuery(win).scrollTop()):elem[method]=val},method,val,arguments.length,null)}});function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:!1}jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!="boolean"),extra=defaultExtra||(margin===!0||value===!0?"margin":"border");return jQuery.access(this,function(elem,type,value){var doc;return jQuery.isWindow(elem)?elem.document.documentElement["client"+name]:elem.nodeType===9?(doc=elem.documentElement,Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])):value===undefined?jQuery.css(elem,type,value,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})}),window.jQuery=window.$=jQuery,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return jQuery})}(window);var jQuery=window.jQuery;(function($,undefined){$.ui=$.ui||{};if($.ui.version)return;$.extend($.ui,{version:"1.8.23",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),$.fn.extend({propAttr:$.fn.prop||$.fn.attr,_focus:$.fn.focus,focus:function(delay,fn){return typeof delay=="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus(),fn&&fn.call(elem)},delay)}):this._focus.apply(this,arguments)},scrollParent:function(){var scrollParent;return $.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?scrollParent=this.parents().filter(function(){return/(relative|absolute|fixed)/.test($.curCSS(this,"position",1))&&/(auto|scroll)/.test($.curCSS(this,"overflow",1)+$.curCSS(this,"overflow-y",1)+$.curCSS(this,"overflow-x",1))}).eq(0):scrollParent=this.parents().filter(function(){return/(auto|scroll)/.test($.curCSS(this,"overflow",1)+$.curCSS(this,"overflow-y",1)+$.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!scrollParent.length?$(document):scrollParent},zIndex:function(zIndex){if(zIndex!==undefined)return this.css("zIndex",zIndex);if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0)return value}elem=elem.parent()}}return 0},disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),$("<a>").outerWidth(1).jquery||$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){return $.each(side,function(){size-=parseFloat($.curCSS(elem,"padding"+this,!0))||0,border&&(size-=parseFloat($.curCSS(elem,"border"+this+"Width",!0))||0),margin&&(size-=parseFloat($.curCSS(elem,"margin"+this,!0))||0)}),size}$.fn["inner"+name]=function(size){return size===undefined?orig["inner"+name].call(this):this.each(function(){$(this).css(type,reduce(this,size)+"px")})},$.fn["outer"+name]=function(size,margin){return typeof size!="number"?orig["outer"+name].call(this,size):this.each(function(){$(this).css(type,reduce(this,size,!0,margin)+"px")})}});function focusable(element,isTabIndexNotNaN){var nodeName=element.nodeName.toLowerCase();if("area"===nodeName){var map=element.parentNode,mapName=map.name,img;return!element.href||!mapName||map.nodeName.toLowerCase()!=="map"?!1:(img=$("img[usemap=#"+mapName+"]")[0],!!img&&visible(img))}return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"==nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element)}function visible(element){return!$(element).parents().andSelf().filter(function(){return $.curCSS(this,"visibility")==="hidden"||$.expr.filters.hidden(this)}).length}$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName)}}):function(elem,i,match){return!!$.data(elem,match[3])},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")))},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN)}}),$(function(){var body=document.body,div=body.appendChild(div=document.createElement("div"));div.offsetHeight,$.extend(div.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),$.support.minHeight=div.offsetHeight===100,$.support.selectstart="onselectstart"in div,body.removeChild(div).style.display="none"}),$.curCSS||($.curCSS=$.css),$.extend($.ui,{plugin:{add:function(module,option,set){var proto=$.ui[module].prototype;for(var i in set)proto.plugins[i]=proto.plugins[i]||[],proto.plugins[i].push([option,set[i]])},call:function(instance,name,args){var set=instance.plugins[name];if(!set||!instance.element[0].parentNode)return;for(var i=0;i<set.length;i++)instance.options[set[i][0]]&&set[i][1].apply(instance.element,args)}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(el,a){if($(el).css("overflow")==="hidden")return!1;var scroll=a&&a==="left"?"scrollLeft":"scrollTop",has=!1;return el[scroll]>0?!0:(el[scroll]=1,has=el[scroll]>0,el[scroll]=0,has)},isOverAxis:function(x,reference,size){return x>reference&&x<reference+size},isOver:function(y,x,top,left,height,width){return $.ui.isOverAxis(y,top,height)&&$.ui.isOverAxis(x,left,width)}})})(jQuery),function($,undefined){if($.cleanData){var _cleanData=$.cleanData;$.cleanData=function(elems){for(var i=0,elem;(elem=elems[i])!=null;i++)try{$(elem).triggerHandler("remove")}catch(e){}_cleanData(elems)}}else{var _remove=$.fn.remove;$.fn.remove=function(selector,keepData){return this.each(function(){return keepData||(!selector||$.filter(selector,[this]).length)&&$("*",this).add([this]).each(function(){try{$(this).triggerHandler("remove")}catch(e){}}),_remove.call($(this),selector,keepData)})}}$.widget=function(name,base,prototype){var namespace=name.split(".")[0],fullName;name=name.split(".")[1],fullName=namespace+"-"+name,prototype||(prototype=base,base=$.Widget),$.expr[":"][fullName]=function(elem){return!!$.data(elem,name)},$[namespace]=$[namespace]||{},$[namespace][name]=function(options,element){arguments.length&&this._createWidget(options,element)};var basePrototype=new base;basePrototype.options=$.extend(!0,{},basePrototype.options),$[namespace][name].prototype=$.extend(!0,basePrototype,{namespace:namespace,widgetName:name,widgetEventPrefix:$[namespace][name].prototype.widgetEventPrefix||name,widgetBaseClass:fullName},prototype),$.widget.bridge(name,$[namespace][name])},$.widget.bridge=function(name,object){$.fn[name]=function(options){var isMethodCall=typeof options=="string",args=Array.prototype.slice.call(arguments,1),returnValue=this;return options=!isMethodCall&&args.length?$.extend.apply(null,[!0,options].concat(args)):options,isMethodCall&&options.charAt(0)==="_"?returnValue:(isMethodCall?this.each(function(){var instance=$.data(this,name),methodValue=instance&&$.isFunction(instance[options])?instance[options].apply(instance,args):instance;if(methodValue!==instance&&methodValue!==undefined)return returnValue=methodValue,!1}):this.each(function(){var instance=$.data(this,name);instance?instance.option(options||{})._init():$.data(this,name,new object(options,this))}),returnValue)}},$.Widget=function(options,element){arguments.length&&this._createWidget(options,element)},$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(options,element){$.data(element,this.widgetName,this),this.element=$(element),this.options=$.extend(!0,{},this.options,this._getCreateOptions(),options);var self=this;this.element.bind("remove."+this.widgetName,function(){self.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return $.metadata&&$.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(key,value){var options=key;if(arguments.length===0)return $.extend({},this.options);if(typeof key=="string"){if(value===undefined)return this.options[key];options={},options[key]=value}return this._setOptions(options),this},_setOptions:function(options){var self=this;return $.each(options,function(key,value){self._setOption(key,value)}),this},_setOption:function(key,value){return this.options[key]=value,key==="disabled"&&this.widget()[value?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",value),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];data=data||{},event=$.Event(event),event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase(),event.target=this.element[0],orig=event.originalEvent;if(orig)for(prop in orig)prop in event||(event[prop]=orig[prop]);return this.element.trigger(event,data),!($.isFunction(callback)&&callback.call(this.element[0],event,data)===!1||event.isDefaultPrevented())}}}(jQuery),function($,undefined){var mouseHandled=!1;$(document).mouseup(function(e){mouseHandled=!1}),$.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var self=this;this.element.bind("mousedown."+this.widgetName,function(event){return self._mouseDown(event)}).bind("click."+this.widgetName,function(event){if(!0===$.data(event.target,self.widgetName+".preventClickEvent"))return $.removeData(event.target,self.widgetName+".preventClickEvent"),event.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(event){if(mouseHandled)return;this._mouseStarted&&this._mouseUp(event),this._mouseDownEvent=event;var self=this,btnIsLeft=event.which==1,elIsCancel=typeof this.options.cancel=="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:!1;if(!btnIsLeft||elIsCancel||!this._mouseCapture(event))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){self.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=this._mouseStart(event)!==!1;if(!this._mouseStarted)return event.preventDefault(),!0}return!0===$.data(event.target,this.widgetName+".preventClickEvent")&&$.removeData(event.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(event){return self._mouseMove(event)},this._mouseUpDelegate=function(event){return self._mouseUp(event)},$(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),event.preventDefault(),mouseHandled=!0,!0},_mouseMove:function(event){return!$.browser.msie||document.documentMode>=9||!!event.button?this._mouseStarted?(this._mouseDrag(event),event.preventDefault()):(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,event)!==!1,this._mouseStarted?this._mouseDrag(event):this._mouseUp(event)),!this._mouseStarted):this._mouseUp(event)},_mouseUp:function(event){return $(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,event.target==this._mouseDownEvent.target&&$.data(event.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(event)),!1},_mouseDistanceMet:function(event){return Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance},_mouseDelayMet:function(event){return this.mouseDelayMet},_mouseStart:function(event){},_mouseDrag:function(event){},_mouseStop:function(event){},_mouseCapture:function(event){return!0}})}(jQuery),function($,undefined){$.ui=$.ui||{};var horizontalPositions=/left|center|right/,verticalPositions=/top|center|bottom/,center="center",support={},_position=$.fn.position,_offset=$.fn.offset;$.fn.position=function(options){if(!options||!options.of)return _position.apply(this,arguments);options=$.extend({},options);var target=$(options.of),targetElem=target[0],collision=(options.collision||"flip").split(" "),offset=options.offset?options.offset.split(" "):[0,0],targetWidth,targetHeight,basePosition;return targetElem.nodeType===9?(targetWidth=target.width(),targetHeight=target.height(),basePosition={top:0,left:0}):targetElem.setTimeout?(targetWidth=target.width(),targetHeight=target.height(),basePosition={top:target.scrollTop(),left:target.scrollLeft()}):targetElem.preventDefault?(options.at="left top",targetWidth=targetHeight=0,basePosition={top:options.of.pageY,left:options.of.pageX}):(targetWidth=target.outerWidth(),targetHeight=target.outerHeight(),basePosition=target.offset()),$.each(["my","at"],function(){var pos=(options[this]||"").split(" ");pos.length===1&&(pos=horizontalPositions.test(pos[0])?pos.concat([center]):verticalPositions.test(pos[0])?[center].concat(pos):[center,center]),pos[0]=horizontalPositions.test(pos[0])?pos[0]:center,pos[1]=verticalPositions.test(pos[1])?pos[1]:center,options[this]=pos}),collision.length===1&&(collision[1]=collision[0]),offset[0]=parseInt(offset[0],10)||0,offset.length===1&&(offset[1]=offset[0]),offset[1]=parseInt(offset[1],10)||0,options.at[0]==="right"?basePosition.left+=targetWidth:options.at[0]===center&&(basePosition.left+=targetWidth/2),options.at[1]==="bottom"?basePosition.top+=targetHeight:options.at[1]===center&&(basePosition.top+=targetHeight/2),basePosition.left+=offset[0],basePosition.top+=offset[1],this.each(function(){var elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseInt($.curCSS(this,"marginLeft",!0))||0,marginTop=parseInt($.curCSS(this,"marginTop",!0))||0,collisionWidth=elemWidth+marginLeft+(parseInt($.curCSS(this,"marginRight",!0))||0),collisionHeight=elemHeight+marginTop+(parseInt($.curCSS(this,"marginBottom",!0))||0),position=$.extend({},basePosition),collisionPosition;options.my[0]==="right"?position.left-=elemWidth:options.my[0]===center&&(position.left-=elemWidth/2),options.my[1]==="bottom"?position.top-=elemHeight:options.my[1]===center&&(position.top-=elemHeight/2),support.fractions||(position.left=Math.round(position.left),position.top=Math.round(position.top)),collisionPosition={left:position.left-marginLeft,top:position.top-marginTop},$.each(["left","top"],function(i,dir){$.ui.position[collision[i]]&&$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:offset,my:options.my,at:options.at})}),$.fn.bgiframe&&elem.bgiframe(),elem.offset($.extend(position,{using:options.using}))})},$.ui.position={fit:{left:function(position,data){var win=$(window),over=data.collisionPosition.left+data.collisionWidth-win.width()-win.scrollLeft();position.left=over>0?position.left-over:Math.max(position.left-data.collisionPosition.left,position.left)},top:function(position,data){var win=$(window),over=data.collisionPosition.top+data.collisionHeight-win.height()-win.scrollTop();position.top=over>0?position.top-over:Math.max(position.top-data.collisionPosition.top,position.top)}},flip:{left:function(position,data){if(data.at[0]===center)return;var win=$(window),over=data.collisionPosition.left+data.collisionWidth-win.width()-win.scrollLeft(),myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:-data.targetWidth,offset=-2*data.offset[0];position.left+=data.collisionPosition.left<0?myOffset+atOffset+offset:over>0?myOffset+atOffset+offset:0},top:function(position,data){if(data.at[1]===center)return;var win=$(window),over=data.collisionPosition.top+data.collisionHeight-win.height()-win.scrollTop(),myOffset=data.my[1]==="top"?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:-data.targetHeight,offset=-2*data.offset[1];position.top+=data.collisionPosition.top<0?myOffset+atOffset+offset:over>0?myOffset+atOffset+offset:0}}},$.offset.setOffset||($.offset.setOffset=function(elem,options){/static/.test($.curCSS(elem,"position"))&&(elem.style.position="relative");var curElem=$(elem),curOffset=curElem.offset(),curTop=parseInt($.curCSS(elem,"top",!0),10)||0,curLeft=parseInt($.curCSS(elem,"left",!0),10)||0,props={top:options.top-curOffset.top+curTop,left:options.left-curOffset.left+curLeft};"using"in options?options.using.call(elem,props):curElem.css(props)},$.fn.offset=function(options){var elem=this[0];return!elem||!elem.ownerDocument?null:options?$.isFunction(options)?this.each(function(i){$(this).offset(options.call(this,i,$(this).offset()))}):this.each(function(){$.offset.setOffset(this,options)}):_offset.call(this)}),$.curCSS||($.curCSS=$.css),function(){var body=document.getElementsByTagName("body")[0],div=document.createElement("div"),testElement,testElementParent,testElementStyle,offset,offsetTotal;testElement=document.createElement(body?"div":"body"),testElementStyle={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},body&&$.extend(testElementStyle,{position:"absolute",left:"-1000px",top:"-1000px"});for(var i in testElementStyle)testElement.style[i]=testElementStyle[i];testElement.appendChild(div),testElementParent=body||document.documentElement,testElementParent.insertBefore(testElement,testElementParent.firstChild),div.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;",offset=$(div).offset(function(_,offset){return offset}).offset(),testElement.innerHTML="",testElementParent.removeChild(testElement),offsetTotal=offset.top+offset.left+(body?2e3:0),support.fractions=offsetTotal>21&&offsetTotal<22}()}(jQuery),function($,undefined){$.widget("ui.draggable",$.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){if(!this.element.data("draggable"))return;return this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),this},_mouseCapture:function(event){var o=this.options;return this.helper||o.disabled||$(event.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(event),this.handle?(o.iframeFix&&$(o.iframeFix===!0?"iframe":o.iframeFix).each(function(){$('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css($(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(event){var o=this.options;return this.helper=this._createHelper(event),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),$.ui.ddmanager&&($.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(event),this.originalPageX=event.pageX,this.originalPageY=event.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),o.containment&&this._setContainment(),this._trigger("start",event)===!1?(this._clear(),!1):(this._cacheHelperProportions(),$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,event),this._mouseDrag(event,!0),$.ui.ddmanager&&$.ui.ddmanager.dragStart(this,event),!0)},_mouseDrag:function(event,noPropagation){this.position=this._generatePosition(event),this.positionAbs=this._convertPositionTo("absolute");if(!noPropagation){var ui=this._uiHash();if(this._trigger("drag",event,ui)===!1)return this._mouseUp({}),!1;this.position=ui.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";return $.ui.ddmanager&&$.ui.ddmanager.drag(this,event),!1},_mouseStop:function(event){var dropped=!1;$.ui.ddmanager&&!this.options.dropBehaviour&&(dropped=$.ui.ddmanager.drop(this,event)),this.dropped&&(dropped=this.dropped,this.dropped=!1);var element=this.element[0],elementInDom=!1;while(element&&(element=element.parentNode))element==document&&(elementInDom=!0);if(!elementInDom&&this.options.helper==="original")return!1;if(this.options.revert=="invalid"&&!dropped||this.options.revert=="valid"&&dropped||this.options.revert===!0||$.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped)){var self=this;$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){self._trigger("stop",event)!==!1&&self._clear()})}else this._trigger("stop",event)!==!1&&this._clear();return!1},_mouseUp:function(event){return this.options.iframeFix===!0&&$("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),$.ui.ddmanager&&$.ui.ddmanager.dragStop(this,event),$.ui.mouse.prototype._mouseUp.call(this,event)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(event){var handle=!this.options.handle||!$(this.options.handle,this.element).length?!0:!1;return $(this.options.handle,this.element).find("*").andSelf().each(function(){this==event.target&&(handle=!0)}),handle},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event])):o.helper=="clone"?this.element.clone().removeAttr("id"):this.element;return helper.parents("body").length||helper.appendTo(o.appendTo=="parent"?this.element[0].parentNode:o.appendTo),helper[0]!=this.element[0]&&!/(fixed|absolute)/.test(helper.css("position"))&&helper.css("position","absolute"),helper},_adjustOffsetFromHelper:function(obj){typeof obj=="string"&&(obj=obj.split(" ")),$.isArray(obj)&&(obj={left:+obj[0],top:+obj[1]||0}),"left"in obj&&(this.offset.click.left=obj.left+this.margins.left),"right"in obj&&(this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left),"top"in obj&&(this.offset.click.top=obj.top+this.margins.top),"bottom"in obj&&(this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(po.left+=this.scrollParent.scrollLeft(),po.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&$.browser.msie)po={top:0,left:0};return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var p=this.element.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var o=this.options;o.containment=="parent"&&(o.containment=this.helper[0].parentNode);if(o.containment=="document"||o.containment=="window")this.containment=[o.containment=="document"?0:$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,o.containment=="document"?0:$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(o.containment=="document"?0:$(window).scrollLeft())+$(o.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(o.containment=="document"?0:$(window).scrollTop())+($(o.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(o.containment)&&o.containment.constructor!=Array){var c=$(o.containment),ce=c[0];if(!ce)return;var co=c.offset(),over=$(ce).css("overflow")!="hidden";this.containment=[(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0),(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0),(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c}else o.containment.constructor==Array&&(this.containment=o.containment)},_convertPositionTo:function(d,pos){pos||(pos=this.position);var mod=d=="absolute"?1:-1,o=this.options,scroll=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!$.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);return{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-($.browser.safari&&$.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop())*mod),left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-($.browser.safari&&$.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod)}},_generatePosition:function(event){var o=this.options,scroll=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!$.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName),pageX=event.pageX,pageY=event.pageY;if(this.originalPosition){var containment;if(this.containment){if(this.relative_container){var co=this.relative_container.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top]}else containment=this.containment;event.pageX-this.offset.click.left<containment[0]&&(pageX=containment[0]+this.offset.click.left),event.pageY-this.offset.click.top<containment[1]&&(pageY=containment[1]+this.offset.click.top),event.pageX-this.offset.click.left>containment[2]&&(pageX=containment[2]+this.offset.click.left),event.pageY-this.offset.click.top>containment[3]&&(pageY=containment[3]+this.offset.click.top)}if(o.grid){var top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?top-this.offset.click.top<containment[1]||top-this.offset.click.top>containment[3]?top-this.offset.click.top<containment[1]?top+o.grid[1]:top-o.grid[1]:top:top;var left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?left-this.offset.click.left<containment[0]||left-this.offset.click.left>containment[2]?left-this.offset.click.left<containment[0]?left+o.grid[0]:left-o.grid[0]:left:left}}return{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+($.browser.safari&&$.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop()),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+($.browser.safari&&$.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(type,event,ui){return ui=ui||this._uiHash(),$.ui.plugin.call(this,type,[event,ui]),type=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),$.Widget.prototype._trigger.call(this,type,event,ui)},plugins:{},_uiHash:function(event){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),$.extend($.ui.draggable,{version:"1.8.23"}),$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui){var inst=$(this).data("draggable"),o=inst.options,uiSortable=$.extend({},ui,{item:inst.element});inst.sortables=[],$(o.connectToSortable).each(function(){var sortable=$.data(this,"sortable");sortable&&!sortable.options.disabled&&(inst.sortables.push({instance:sortable,shouldRevert:sortable.options.revert}),sortable.refreshPositions(),sortable._trigger("activate",event,uiSortable))})},stop:function(event,ui){var inst=$(this).data("draggable"),uiSortable=$.extend({},ui,{item:inst.element});$.each(inst.sortables,function(){this.instance.isOver?(this.instance.isOver=0,inst.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(event),this.instance.options.helper=this.instance.options._helper,inst.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",event,uiSortable))})},drag:function(event,ui){var inst=$(this).data("draggable"),self=this,checkPos=function(o){var dyClick=this.offset.click.top,dxClick=this.offset.click.left,helperTop=this.positionAbs.top,helperLeft=this.positionAbs.left,itemHeight=o.height,itemWidth=o.width,itemTop=o.top,itemLeft=o.left;return $.ui.isOver(helperTop+dyClick,helperLeft+dxClick,itemTop,itemLeft,itemHeight,itemWidth)};$.each(inst.sortables,function(i){this.instance.positionAbs=inst.positionAbs,this.instance.helperProportions=inst.helperProportions,this.instance.offset.click=inst.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=$(self).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return ui.helper[0]},event.target=this.instance.currentItem[0],this.instance._mouseCapture(event,!0),this.instance._mouseStart(event,!0,!0),this.instance.offset.click.top=inst.offset.click.top,this.instance.offset.click.left=inst.offset.click.left,this.instance.offset.parent.left-=inst.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=inst.offset.parent.top-this.instance.offset.parent.top,inst._trigger("toSortable",event),inst.dropped=this.instance.element,inst.currentItem=inst.element,this.instance.fromOutside=inst),this.instance.currentItem&&this.instance._mouseDrag(event)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",event,this.instance._uiHash(this.instance)),this.instance._mouseStop(event,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),inst._trigger("fromSortable",event),inst.dropped=!1)})}}),$.ui.plugin.add("draggable","cursor",{start:function(event,ui){var t=$("body"),o=$(this).data("draggable").options;t.css("cursor")&&(o._cursor=t.css("cursor")),t.css("cursor",o.cursor)},stop:function(event,ui){var o=$(this).data("draggable").options;o._cursor&&$("body").css("cursor",o._cursor)}}),$.ui.plugin.add("draggable","opacity",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("draggable").options;t.css("opacity")&&(o._opacity=t.css("opacity")),t.css("opacity",o.opacity)},stop:function(event,ui){var o=$(this).data("draggable").options;o._opacity&&$(ui.helper).css("opacity",o._opacity)}}),$.ui.plugin.add("draggable","scroll",{start:function(event,ui){var i=$(this).data("draggable");i.scrollParent[0]!=document&&i.scrollParent[0].tagName!="HTML"&&(i.overflowOffset=i.scrollParent.offset())},drag:function(event,ui){var i=$(this).data("draggable"),o=i.options,scrolled=!1;if(i.scrollParent[0]!=document&&i.scrollParent[0].tagName!="HTML"){if(!o.axis||o.axis!="x")i.overflowOffset.top+i.scrollParent[0].offsetHeight-event.pageY<o.scrollSensitivity?i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop+o.scrollSpeed:event.pageY-i.overflowOffset.top<o.scrollSensitivity&&(i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop-o.scrollSpeed);if(!o.axis||o.axis!="y")i.overflowOffset.left+i.scrollParent[0].offsetWidth-event.pageX<o.scrollSensitivity?i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft+o.scrollSpeed:event.pageX-i.overflowOffset.left<o.scrollSensitivity&&(i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft-o.scrollSpeed)}else{if(!o.axis||o.axis!="x")event.pageY-$(document).scrollTop()<o.scrollSensitivity?scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed):$(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity&&(scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed));if(!o.axis||o.axis!="y")event.pageX-$(document).scrollLeft()<o.scrollSensitivity?scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed):$(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity&&(scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed))}scrolled!==!1&&$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(i,event)}}),$.ui.plugin.add("draggable","snap",{start:function(event,ui){var i=$(this).data("draggable"),o=i.options;i.snapElements=[],$(o.snap.constructor!=String?o.snap.items||":data(draggable)":o.snap).each(function(){var $t=$(this),$o=$t.offset();this!=i.element[0]&&i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left})})},drag:function(event,ui){var inst=$(this).data("draggable"),o=inst.options,d=o.snapTolerance,x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(var i=inst.snapElements.length-1;i>=0;i--){var l=inst.snapElements[i].left,r=l+inst.snapElements[i].width,t=inst.snapElements[i].top,b=t+inst.snapElements[i].height;if(!(l-d<x1&&x1<r+d&&t-d<y1&&y1<b+d||l-d<x1&&x1<r+d&&t-d<y2&&y2<b+d||l-d<x2&&x2<r+d&&t-d<y1&&y1<b+d||l-d<x2&&x2<r+d&&t-d<y2&&y2<b+d)){inst.snapElements[i].snapping&&inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})),inst.snapElements[i].snapping=!1;continue}if(o.snapMode!="inner"){var ts=Math.abs(t-y2)<=d,bs=Math.abs(b-y1)<=d,ls=Math.abs(l-x2)<=d,rs=Math.abs(r-x1)<=d;ts&&(ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top-inst.margins.top),bs&&(ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top-inst.margins.top),ls&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left-inst.margins.left),rs&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left-inst.margins.left)}var first=ts||bs||ls||rs;if(o.snapMode!="outer"){var ts=Math.abs(t-y1)<=d,bs=Math.abs(b-y2)<=d,ls=Math.abs(l-x1)<=d,rs=Math.abs(r-x2)<=d;ts&&(ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top-inst.margins.top),bs&&(ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top-inst.margins.top),ls&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left-inst.margins.left),rs&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left-inst.margins.left)}!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first)&&inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})),inst.snapElements[i].snapping=ts||bs||ls||rs||first}}}),$.ui.plugin.add("draggable","stack",{start:function(event,ui){var o=$(this).data("draggable").options,group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0)});if(!group.length)return;var min=parseInt(group[0].style.zIndex)||0;$(group).each(function(i){this.style.zIndex=min+i}),this[0].style.zIndex=min+group.length}}),$.ui.plugin.add("draggable","zIndex",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("draggable").options;t.css("zIndex")&&(o._zIndex=t.css("zIndex")),t.css("zIndex",o.zIndex)},stop:function(event,ui){var o=$(this).data("draggable").options;o._zIndex&&$(ui.helper).css("zIndex",o._zIndex)}})}(jQuery);var hexcase=0;function hex_md5(a){return rstr2hex(rstr_md5(str2rstr_utf8(a)))}function hex_hmac_md5(a,b){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(a),str2rstr_utf8(b)))}function md5_vm_test(){return hex_md5("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"}function rstr_md5(a){return binl2rstr(binl_md5(rstr2binl(a),a.length*8))}function rstr_hmac_md5(c,f){var e=rstr2binl(c);e.length>16&&(e=binl_md5(e,c.length*8));var a=Array(16),d=Array(16);for(var b=0;b<16;b++)a[b]=e[b]^909522486,d[b]=e[b]^1549556828;var g=binl_md5(a.concat(rstr2binl(f)),512+f.length*8);return binl2rstr(binl_md5(d.concat(g),640))}function rstr2hex(c){try{hexcase}catch(g){hexcase=0}var f=hexcase?"0123456789ABCDEF":"0123456789abcdef",b="",a;for(var d=0;d<c.length;d++)a=c.charCodeAt(d),b+=f.charAt(a>>>4&15)+f.charAt(a&15);return b}function str2rstr_utf8(c){var b="",d=-1,a,e;while(++d<c.length)a=c.charCodeAt(d),e=d+1<c.length?c.charCodeAt(d+1):0,55296<=a&&a<=56319&&56320<=e&&e<=57343&&(a=65536+((a&1023)<<10)+(e&1023),d++),a<=127?b+=String.fromCharCode(a):a<=2047?b+=String.fromCharCode(192|a>>>6&31,128|a&63):a<=65535?b+=String.fromCharCode(224|a>>>12&15,128|a>>>6&63,128|a&63):a<=2097151&&(b+=String.fromCharCode(240|a>>>18&7,128|a>>>12&63,128|a>>>6&63,128|a&63));return b}function rstr2binl(b){var a=Array(b.length>>2);for(var c=0;c<a.length;c++)a[c]=0;for(var c=0;c<b.length*8;c+=8)a[c>>5]|=(b.charCodeAt(c/8)&255)<<c%32;return a}function binl2rstr(b){var a="";for(var c=0;c<b.length*32;c+=8)a+=String.fromCharCode(b[c>>5]>>>c%32&255);return a}function binl_md5(p,k){p[k>>5]|=128<<k%32,p[(k+64>>>9<<4)+14]=k;var o=1732584193,n=-271733879,m=-1732584194,l=271733878;for(var g=0;g<p.length;g+=16){var j=o,h=n,f=m,e=l;o=md5_ff(o,n,m,l,p[g+0],7,-680876936),l=md5_ff(l,o,n,m,p[g+1],12,-389564586),m=md5_ff(m,l,o,n,p[g+2],17,606105819),n=md5_ff(n,m,l,o,p[g+3],22,-1044525330),o=md5_ff(o,n,m,l,p[g+4],7,-176418897),l=md5_ff(l,o,n,m,p[g+5],12,1200080426),m=md5_ff(m,l,o,n,p[g+6],17,-1473231341),n=md5_ff(n,m,l,o,p[g+7],22,-45705983),o=md5_ff(o,n,m,l,p[g+8],7,1770035416),l=md5_ff(l,o,n,m,p[g+9],12,-1958414417),m=md5_ff(m,l,o,n,p[g+10],17,-42063),n=md5_ff(n,m,l,o,p[g+11],22,-1990404162),o=md5_ff(o,n,m,l,p[g+12],7,1804603682),l=md5_ff(l,o,n,m,p[g+13],12,-40341101),m=md5_ff(m,l,o,n,p[g+14],17,-1502002290),n=md5_ff(n,m,l,o,p[g+15],22,1236535329),o=md5_gg(o,n,m,l,p[g+1],5,-165796510),l=md5_gg(l,o,n,m,p[g+6],9,-1069501632),m=md5_gg(m,l,o,n,p[g+11],14,643717713),n=md5_gg(n,m,l,o,p[g+0],20,-373897302),o=md5_gg(o,n,m,l,p[g+5],5,-701558691),l=md5_gg(l,o,n,m,p[g+10],9,38016083),m=md5_gg(m,l,o,n,p[g+15],14,-660478335),n=md5_gg(n,m,l,o,p[g+4],20,-405537848),o=md5_gg(o,n,m,l,p[g+9],5,568446438),l=md5_gg(l,o,n,m,p[g+14],9,-1019803690),m=md5_gg(m,l,o,n,p[g+3],14,-187363961),n=md5_gg(n,m,l,o,p[g+8],20,1163531501),o=md5_gg(o,n,m,l,p[g+13],5,-1444681467),l=md5_gg(l,o,n,m,p[g+2],9,-51403784),m=md5_gg(m,l,o,n,p[g+7],14,1735328473),n=md5_gg(n,m,l,o,p[g+12],20,-1926607734),o=md5_hh(o,n,m,l,p[g+5],4,-378558),l=md5_hh(l,o,n,m,p[g+8],11,-2022574463),m=md5_hh(m,l,o,n,p[g+11],16,1839030562),n=md5_hh(n,m,l,o,p[g+14],23,-35309556),o=md5_hh(o,n,m,l,p[g+1],4,-1530992060),l=md5_hh(l,o,n,m,p[g+4],11,1272893353),m=md5_hh(m,l,o,n,p[g+7],16,-155497632),n=md5_hh(n,m,l,o,p[g+10],23,-1094730640),o=md5_hh(o,n,m,l,p[g+13],4,681279174),l=md5_hh(l,o,n,m,p[g+0],11,-358537222),m=md5_hh(m,l,o,n,p[g+3],16,-722521979),n=md5_hh(n,m,l,o,p[g+6],23,76029189),o=md5_hh(o,n,m,l,p[g+9],4,-640364487),l=md5_hh(l,o,n,m,p[g+12],11,-421815835),m=md5_hh(m,l,o,n,p[g+15],16,530742520),n=md5_hh(n,m,l,o,p[g+2],23,-995338651),o=md5_ii(o,n,m,l,p[g+0],6,-198630844),l=md5_ii(l,o,n,m,p[g+7],10,1126891415),m=md5_ii(m,l,o,n,p[g+14],15,-1416354905),n=md5_ii(n,m,l,o,p[g+5],21,-57434055),o=md5_ii(o,n,m,l,p[g+12],6,1700485571),l=md5_ii(l,o,n,m,p[g+3],10,-1894986606),m=md5_ii(m,l,o,n,p[g+10],15,-1051523),n=md5_ii(n,m,l,o,p[g+1],21,-2054922799),o=md5_ii(o,n,m,l,p[g+8],6,1873313359),l=md5_ii(l,o,n,m,p[g+15],10,-30611744),m=md5_ii(m,l,o,n,p[g+6],15,-1560198380),n=md5_ii(n,m,l,o,p[g+13],21,1309151649),o=md5_ii(o,n,m,l,p[g+4],6,-145523070),l=md5_ii(l,o,n,m,p[g+11],10,-1120210379),m=md5_ii(m,l,o,n,p[g+2],15,718787259),n=md5_ii(n,m,l,o,p[g+9],21,-343485551),o=safe_add(o,j),n=safe_add(n,h),m=safe_add(m,f),l=safe_add(l,e)}return Array(o,n,m,l)}function md5_cmn(h,e,d,c,g,f){return safe_add(bit_rol(safe_add(safe_add(e,h),safe_add(c,f)),g),d)}function md5_ff(g,f,k,j,e,i,h){return md5_cmn(f&k|~f&j,g,f,e,i,h)}function md5_gg(g,f,k,j,e,i,h){return md5_cmn(f&j|k&~j,g,f,e,i,h)}function md5_hh(g,f,k,j,e,i,h){return md5_cmn(f^k^j,g,f,e,i,h)}function md5_ii(g,f,k,j,e,i,h){return md5_cmn(k^(f|~j),g,f,e,i,h)}function safe_add(a,d){var c=(a&65535)+(d&65535),b=(a>>16)+(d>>16)+(c>>16);return b<<16|c&65535}function bit_rol(a,b){return a<<b|a>>>32-b}var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var output="",chr1,chr2,chr3,enc1,enc2,enc3,enc4,i=0;input=Base64._utf8_encode(input);while(i<input.length)chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(chr1&3)<<4|chr2>>4,enc3=(chr2&15)<<2|chr3>>6,enc4=chr3&63,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4);return output},decode:function(input){var output="",chr1,chr2,chr3,enc1,enc2,enc3,enc4,i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length)enc1=this._keyStr.indexOf(input.charAt(i++)),enc2=this._keyStr.indexOf(input.charAt(i++)),enc3=this._keyStr.indexOf(input.charAt(i++)),enc4=this._keyStr.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(enc2&15)<<4|enc3>>2,chr3=(enc3&3)<<6|enc4,output+=String.fromCharCode(chr1),enc3!=64&&(output+=String.fromCharCode(chr2)),enc4!=64&&(output+=String.fromCharCode(chr3));return output=Base64._utf8_decode(output),output},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);c<128?utftext+=String.fromCharCode(c):c>127&&c<2048?(utftext+=String.fromCharCode(c>>6|192),utftext+=String.fromCharCode(c&63|128)):(utftext+=String.fromCharCode(c>>12|224),utftext+=String.fromCharCode(c>>6&63|128),utftext+=String.fromCharCode(c&63|128))}return utftext},_utf8_decode:function(utftext){var string="",i=0,c,c1,c2,c3;c=c1=c2=0;while(i<utftext.length)c=utftext.charCodeAt(i),c<128?(string+=String.fromCharCode(c),i++):c>191&&c<224?(c2=utftext.charCodeAt(i+1),string+=String.fromCharCode((c&31)<<6|c2&63),i+=2):(c2=utftext.charCodeAt(i+1),c3=utftext.charCodeAt(i+2),string+=String.fromCharCode((c&15)<<12|(c2&63)<<6|c3&63),i+=3);return string}};window.rondavu=window.rondavu||{},rondavu._=rondavu._||{},rondavu._.module_initializers=[],rondavu._.registerScript=function(script){rondavu._.module_initializers.push(script)};var R={};rondavu._.R=R,R.start_time=(new Date).getTime();var r$=jQuery.noConflict(!0);r$.noop(),R.Logger=function(){var DEBUG="debug",INFO="info",WARN="warn",ERROR="error",_={logDiv:null,logQueue:[],log_to_console:!1,createLogDiv:function(){_.logDiv=document.createElement("div"),_.logDiv.style.backgroundColor="#ffffff",_.logDiv.style.color="#000000",_.logDiv.style.textAlign="left",document.body.appendChild(_.logDiv)},createLogMsgDiv:function(msgStr){var msgDiv=document.createElement("div");msgDiv.style.borderBottom="1px solid #ddd",msgDiv.innerText=msgDiv.textContent=msgStr,_.logDiv.appendChild(msgDiv)},pretty:function(data){var functionTypeString="[function]",retval="";if(!data)return"";if(typeof data=="function")return functionTypeString;if(typeof data.callee!="undefined"&&data.length)try{data=Array.prototype.slice.call(data)}catch(ex){var d=[];for(var i=0,j=data.length;i<j;i++)d[i]=data[i];data=d}if(typeof data=="object")try{var d2={};for(var key in data)if(data.hasOwnProperty(key)){var theData=data[key];d2[key]=typeof theData=="function"?functionTypeString:theData,typeof data[key]=="object"&&data[key].toString()!=={}.toString()&&(d2[key]=data[key].toString())}retval=JSON.stringify(d2)}catch(jsonEx){}return retval},noDebugLog:function(level,message,data){var use_rt=Math.floor(Math.random()*100)==1;if(level===WARN||level===ERROR){var ga_data=data&&data.message?" - "+data.message:"",ga_success=!1;try{ga_success=R.Tracker&&R.Tracker.trackDiagEvent(level[0],message+ga_data)}catch(ex){}if(use_rt||!ga_success){var i=document.createElement("img");try{document.body.appendChild(i)}catch(ex){}var realtimeUrl=R.Core.getRealtimeUrl(),referer=window.location.toString(),src=realtimeUrl.replace("http:",window.location.protocol)+"rondavu/js_log?level="+encodeURIComponent(level)+"&message="+encodeURIComponent(message)+"&referer="+encodeURIComponent(referer);try{R.PageDataManager.getUrl()!=referer&&(src+=encodeURIComponent("#cur_path="+R.PageDataManager.getPath()))}catch(err){}try{src+="&customer="+rondavu._.customer_config.customer_name}catch(no_customer){}if(data){var dataStr=_.pretty(data);dataStr=encodeURIComponent(dataStr),src+="&data=",src.length+dataStr.length>2048&&(dataStr=dataStr.substr(0,2048-src.length),dataStr=dataStr.substr(0,dataStr.lastIndexOf("%"))),src+=dataStr}i.src=src.replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}}},page:typeof rondavu_init_as_remote!="undefined"?"REMOTE: ":window.location.toString().indexOf("fb_xd_fragment")!==-1?"FB IFRAME":"",throttleCount:0,throttleTimeout:3,throttleLimit:15,decrementThrottleCount:function(){_.throttleCount--}};return{_:_,init:function(){_.log_to_console=typeof console!="undefined"&&typeof console.log!="undefined",R.Util.checkOverride("rdv_html_log")&&(_.log_to_console=!1),_.log_to_console||r$(document).ready(function(){_.createLogDiv();while(_.logQueue.length)_.createLogMsgDiv(_.logQueue.shift())})},validator:{_consoleLog:function(level,msg){R.Core.shouldValidate()&&window.console&&window.console.log&&console.log(level,msg)},_consoleError:function(level,msg){R.Core.shouldValidate()&&window.console&&window.console.error&&console.error(level,msg)},info:function(msg){this._consoleLog("[INFO]",msg)},warn:function(msg){this._consoleLog("[WARN]",msg)},error:function(msg){this._consoleError("[ERROR]",msg),this.errorCount++}},debug:function(){this.applyWithParams(DEBUG,arguments)},info:function(){this.applyWithParams(INFO,arguments)},warn:function(){this.applyWithParams(WARN,arguments)},error:function(){this.applyWithParams(ERROR,arguments)},applyWithParams:function(level,args){var params=Array.prototype.slice.call(args);params.unshift(level),typeof params[params.length-1]=="undefined"&&params.pop(),this.log.apply(this,params)},log:function(level,message,data){if(level==WARN||level==ERROR){_.throttleCount++,setTimeout(_.decrementThrottleCount,_.throttleLimit*1e3);if(_.throttleCount>_.throttleLimit)throw"More than "+_.throttleLimit+" errors logged within "+_.throttleLimit+" seconds - this may indicate an endless loop."}if(!R.Util.isDebug()){_.noDebugLog(level,message,data);return}if(_.log_to_console){typeof message=="string"&&data&&(message+=" - ");var seconds=((new Date).getTime()-R.start_time)/1e3,desc=_.page+"+"+seconds+"s "+level+": ";console[level]||(level="log"),data&&data.message&&data.lineNumber?(data.message=message+data.message,console[level](data)):data&&data.message&&data.stack?console[level](message+data.stack+"\n",data):console[level](desc,message,r$.browser.msie?_.pretty(data):data);if(data&&data.message&&data.number&&r$.browser.msie&&r$.browser.version>=9)throw data}else{var msgStr=level+": "+message+" - "+_.pretty(data);R.Core.DOMReady&&_.logDiv!==null?_.createLogMsgDiv(msgStr):_.logQueue.push(msgStr)}}}}(),R.Event=function(){var _={listeners:{},addListener:function(key,callback){_.listeners[key]||(_.listeners[key]=[]),_.listeners[key].push(callback)},invokeEventCallback:function(callback,payload){if(typeof callback!="function"){R.Logger.info("When invoking event callback, type was not a function - was "+typeof callback);return}callback(payload),callback.fired=!0},rememberedEvents:{},checkSet:function(eventKeys){for(var i=0;i<eventKeys.length;i++)if(!_.rememberedEvents[eventKeys[i]])return!1;return!0}};return{_:_,listen:function(eventKey,callbackFunction,options){R.Logger.debug("Adding listener for event "+eventKey),callbackFunction.fired=!1,options&&options.once&&(callbackFunction.once=!0),_.addListener(eventKey,callbackFunction),_.rememberedEvents[eventKey]&&callbackFunction(_.rememberedEvents[eventKey].payload)},fire:function(eventKey,payload){R.Logger.debug("Firing event "+eventKey);var theListeners=_.listeners[eventKey];if(!theListeners){R.Logger.debug("For event "+eventKey+" listeners not found");return}for(var i in theListeners)if(theListeners.hasOwnProperty(i)){if(theListeners[i].once&&theListeners[i].fired)continue;R.Logger.debug("executing callback #"+i+" for event "+eventKey),_.invokeEventCallback(theListeners[i],payload)}},fireAndRemember:function(eventKey,payload){_.rememberedEvents[eventKey]={payload:payload},R.Event.fire(eventKey,payload)},listenMultiple:function(eventKeys,callback){function _test_and_fire(){if(_.checkSet(eventKeys)){var payloads={};return R.Util.each(eventKeys,function(eventKey){payloads[eventKey]=_.rememberedEvents[eventKey].payload}),callback(payloads),!0}return!1}if(_test_and_fire())return;for(var i=0;i<eventKeys.length;i++)R.Event.listen(eventKeys[i],_test_and_fire)},clearRememberedEvents:function(eventKeys){R.Util.each(eventKeys,function(key){delete _.rememberedEvents[key]})},hasFired:function(eventKey){return!!_.rememberedEvents[eventKey]},reset:function(){_.listeners={},_.rememberedEvents={}}}}(),R.Util={getQSParam:function(param){if(!R.Util._qs){R.Util._qs={};var queries=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");R.Util.each(queries,function(query){var pair=query.split("=");try{R.Util._qs[pair.shift()]=decodeURIComponent(pair.join("="))}catch(ex){R.Logger.error("Error reading querystring: "+query,ex)}})}return typeof R.Util._qs[param]!="undefined"?R.Util._qs[param]:null},checkOverride:function(name){return(document.cookie+window.location.search).indexOf(name+"=1")!==-1?!0:(document.cookie+window.location.search).indexOf(name+"=0")!==-1?!1:undefined},isQa:function(){return R.Util.checkOverride("rondavu_qa")},isDebug:function(){return R.Util.checkOverride("rondavu_debug")},isValidate:function(){return R.Util.checkOverride("sl_validate")},fixUrl:function(server,path){var server_slash=server.charAt(server.length-1)=="/",path_slash=path.charAt(0)=="/";return server_slash&&path_slash?server+path.substring(1):!server_slash&&!path_slash?server+"/"+path:server+path},bind:function(func,context){if(!context)throw"Context not supplied for r.bind()";return function(){if(!R.Core.config.enabled)return;try{return func.apply(context,arguments)}catch(ex){R.Logger.error("Error in bound function",ex)}}},listToArray:function(list){var listAsArray;return list&&list.length?(listAsArray=list.split(","),R.Util.each(listAsArray,function(key,index){listAsArray[index]=r$.trim(key)})):listAsArray=[],listAsArray},getKeys:function(obj){var keys=[];return R.Util.each(obj,function(val,key){keys.push(key)}),keys},each:function(list,callback,context){context=context||R,typeof list=="string"&&(list=R.Util.listToArray(String(list)));var i,key,res;if(r$.isArray(list))for(i=0;i<list.length;i++){res=callback.call(context,list[i],i,list);if(res===!1)break}else if(R.Util.isObject(list))for(key in list)if(list.hasOwnProperty(key)){res=callback.call(context,list[key],key,list);if(res===!1)break}},filter:function(obj,fn,context){var results=[];if(obj===null)return results;var nativeFilter=Array.prototype.filter;return nativeFilter&&obj.filter===nativeFilter?obj.filter(fn,context):(R.Util.each(obj,function(value,index,list){fn.call(context,value,index,list)&&(results[results.length]=value)}),results)},filterWithObject:function(arr,filterObj){return R.Util.filter(arr,function(testObj){return R.Util._traversingFilter(testObj,filterObj)},this)},_traversingFilter:function(testObj,filterObj){if(r$.isArray(filterObj)){var orResult=!1;return R.Util.each(filterObj,function(filterVal){orResult=orResult||R.Util._traversingFilter(testObj,filterVal)}),orResult}if(R.Util.isObject(filterObj)){if(typeof testObj=="object"){var filterResult=!0;return R.Util.each(filterObj,function(value,property){filterResult=R.Util._traversingFilter(testObj[property],value);if(!filterResult)return!1}),filterResult}return!1}return testObj==filterObj},asyncEach:function(list,callback,context,finalCallback){context=context||R,callback=R.Util.bind(callback,context),typeof list=="string"&&(list=R.Util.listToArray(String(list)));function end(){finalCallback&&finalCallback.call(context)}var limit=0,keys=!1,i=-1;r$.isArray(list)?limit=list.length:typeof list=="object"&&(keys=R.Util.getKeys(list),limit=keys.length);if(!limit)return end();function next(){if(++i>=limit)return end();var key=keys?keys[i]:i,res=callback(next,list[key],key,list);if(res===!1)return end()}next()},shuffle:function(array){var i=array.length;if(i===0)return!1;while(--i){var j=Math.floor(Math.random()*(i+1)),tempi=array[i];array[i]=array[j],array[j]=tempi}},indexOf:function(array,searchElement){if(array.indexOf)return array.indexOf(searchElement);for(var i=0;i<array.length;i++)if(i in array&&array[i]===searchElement)return i;return-1},checkSecure:function(url,warn){var secure=window.location.protocol==="http:"||url.substr(0,5)==="https"||url.substr(0,2)==="//";return!secure&&warn&&R.Logger.warn('Loading non-https content in https window; try replacing "http://" with just "//"',url),secure},makeSecure:function(url){return R.Util.checkSecure(url)||(url.indexOf(R.Core.config.cdn)===0?url=url.replace(R.Core.config.cdn,R.Core.config.cdn_secure):url="https"+url.substr(4)),url},stripSignature:function(id){return id?id.split("&")[0]:id},loadStyleSheet:function(href){R.Util.checkSecure(href,!0);for(var i=0;i<document.styleSheets.length;i++)if(document.styleSheets[i].href==href)return;var ss=document.createElement("link");ss.rel="stylesheet",ss.type="text/css",ss.href=href,document.getElementsByTagName("head")[0].appendChild(ss)},isSecure:function(){return window.location.protocol==="https:"},loadScript:function(src,test,success,failure,contextObj,errorsOK){R.Logger.debug("loading script",src),R.Util.checkSecure(src,!0);var context=contextObj||R,failure_handler=function(){var msg="script failed to load: "+src;errorsOK?R.Logger.debug(msg):R.Logger.error(msg),failure&&R.Util.bind(failure,context)()},load_handler=function(){!test||R.Util.bind(test,context)()?success&&R.Util.bind(success,context)():failure_handler()},s=document.createElement("script");return s.async=!0,s.attachEvent?s.attachEvent("onreadystatechange",R.Util.bind(function(){if(this.readyState=="loading")return;load_handler()},s)):(s.addEventListener("load",load_handler,!1),s.addEventListener("error",failure_handler,!1)),s.src=src,document.getElementsByTagName("head")[0].appendChild(s),s},registerScript:function(callback){rondavu._.module_initializers.push(callback),R.Core.loaded=!0;var context=R.Core;try{callback.call(context,R)}catch(ex){R.Logger.error("Error firing registerScript() callback",ex)}},handleEarlyScripts:function(){if(rondavu._.module_initializers){R.Logger.debug("Handling early scripts... "+rondavu._.module_initializers.length+" initializers to run");for(var i=0,lim=rondavu._.module_initializers.length;i<lim;i++)try{rondavu._.module_initializers[i].call(R.Core,R)}catch(ex){R.Logger.error("Error firing registerScript() callback",ex)}}},isRondavuDomain:function(){return window.location.hostname.indexOf("rondavu.com")!=-1},isWeekendStatusDomain:function(){return window.location.hostname.indexOf("weekendstatus.com")!=-1},makeRegExp:function(string,flags,allowWildCard){return flags=flags||"ig",string=allowWildCard?string.replace(/([\\\/()\[\]$\^{}.?+])/g,"\\$1").replace("*",".*"):string.replace(/([\\\/()\[\]$\^{}.*?+])/g,"\\$1"),new RegExp(string,flags)},xor:function(a,b){return a?!b:b},isObject:function(obj){return typeof obj=="object"},scrollTo:function(container,object){object.position()&&container.scrollTop(object.position().top+object.height()/2)},getCurrentTime:function(in_seconds){var milliseconds=(new Date).getTime();return in_seconds?Math.floor(milliseconds/1e3):milliseconds},positionShowPopupInScreen:function($popup,relative_el,option){var options=option||{},adjust_horizontal=parseInt(options.adjust_horizontal,10)||0,adjust_vertical=parseInt(options.adjust_vertical,0)||0,default_below=options.default_below,default_above=options.default_above,default_right=options.default_right,default_left=options.default_left,pos_x=0,pos_y=0,vertical_class="below",horizontal_class="right",rel_top=r$(relative_el).offset().top,rel_left=r$(relative_el).offset().left,rel_win_top=r$(relative_el).offset().top-r$(window).scrollTop(),rel_win_left=r$(relative_el).offset().left-r$(window).scrollLeft(),popup_width=adjust_horizontal+r$($popup).show().outerWidth(),popup_height=adjust_vertical+r$($popup).show().outerHeight(),window_height=r$(window).height(),window_width=r$(window).width();window_height-rel_win_top>rel_win_top?(vertical_class="below",pos_y=rel_top+adjust_vertical):(vertical_class="above",pos_y=rel_top-popup_height),window_width-rel_win_left>rel_win_left?(horizontal_class="right",pos_x=rel_left+adjust_horizontal):(horizontal_class="left",pos_x=rel_left-popup_width),default_below&&rel_win_top+popup_height<window_height?(vertical_class="below",pos_y=rel_top+adjust_vertical):default_above&&rel_win_top>popup_height&&(vertical_class="above",pos_y=rel_top-popup_height),default_right&&rel_win_left+popup_width<window_width?(horizontal_class="right",pos_x=rel_left+adjust_horizontal):default_left&&rel_win_left>popup_width&&(horizontal_class="left",pos_x=rel_left-popup_width),$popup.removeClass("sl_above sl_below sl_left sl_right"),$popup.addClass("sl_"+vertical_class),$popup.addClass("sl_"+horizontal_class),$popup.css("top",pos_y),$popup.css("left",pos_x),$popup.show()}},R.Throttle=function(){function Throttle(config,StorageManager,Tracker){this.config=config,this.StorageManager=StorageManager,this.Tracker=Tracker}var GROUP_KEY="sl_throttle_group",REFERER_OVERRIDE_KEY="sl_referred_throttle_override",REFERRED="referred",CONECTED_KEY="sl_connected_throttle_override";return Throttle.prototype={isThrottlingEnabled:function(){return this.config.user_load_percentage_end!=100||this.config.user_load_percentage_start!==0},isUserEnabled:function(){return this.isThrottlingEnabled()?this.isUserEnabledByGroup()||this.isUserEnabledByReferrer()||this.isUserEnabledByFBStatus():!0},isUserInControlGroup:function(){if(this.isUserEnabled())return!1;var user_load_percentage_end=this.config.user_load_percentage_end,user_load_percentage_size=user_load_percentage_end-this.config.user_load_percentage_start,throttle_group=this.getThrottleGroup(),throttle_control_start=user_load_percentage_end<=50?100-user_load_percentage_end+1:user_load_percentage_end+1,throttle_control_end=throttle_control_start+user_load_percentage_size;return throttle_group>=throttle_control_start&&throttle_group<throttle_control_end},trackControlGroup:function(){if(!this.isThrottlingEnabled()||!this.config.track_throttle_control_group)return;if(this.isUserInControlGroup()){var params={action:"throttle-control-group-browse"};this.addTrackingParams(params),this.Tracker.addMosIds(params),this.Tracker.s3Log(params,!0)}},addTrackingParams:function(params){params.throttle_group=this.getThrottleGroup(),params.is_throttle_referer_override=this.isRefererOverride(window,document),params.is_throttle_connected_override=this.isUserConnected()},isUserEnabledByGroup:function(){var group=this.getThrottleGroup();return group<=this.config.user_load_percentage_end&&group>this.config.user_load_percentage_start},isUserEnabledByReferrer:function(){return this.isRefererOverride(window,document)&&this.config.always_load_referred_users},isUserEnabledByFBStatus:function(){return this.config.always_load_connected_users&&this.isUserConnected()},isRefererOverride:function(win,doc){return(win.location.search.toLowerCase().indexOf("sref")>-1||(doc.referrer||doc.referer||"").indexOf("facebook.com")>-1)&&this.StorageManager.setLocal(REFERER_OVERRIDE_KEY,REFERRED),this.StorageManager.getLocal(REFERER_OVERRIDE_KEY)===REFERRED},isUserConnected:function(){var cachedResponse=R.FB.getLoginStatusFromStorage();return cachedResponse&&cachedResponse.status=="connected"&&this.StorageManager.setLocal(CONECTED_KEY,"1"),!!this.StorageManager.getLocal(CONECTED_KEY)||!!this.StorageManager.getLocal("rdv_cookie")},getThrottleGroup:function(){var throttle_group=this.StorageManager.getLocal(GROUP_KEY);return throttle_group||(throttle_group=Math.floor(Math.random()*100)+1,this.StorageManager.setLocal(GROUP_KEY,throttle_group)),parseInt(throttle_group,10)}},Throttle}(),R.ajax=function(url,options){R.ajax.sendRequest(url,options)},R.ajax.sendRequest=function(url,options){options=options||{},options.data=options.data||{},options._url=url,options.url=R.Util.fixUrl(R.Core.getRealtimeUrl(),url),options.async=options.async===!1?!1:!0,options.data.build_version=R.Core.config.build_version,options.data.customer=R.Core.config.customer_name,options.skip_page_data||(options.signed=!0,options.data.page_data=R.PageDataManager.getPageData(options)),R.ModuleManager.isAbTestingEnabled()&&(options.data.test_group_id=R.ModuleManager.getTestGroupId()),options.data.url=R.PageDataManager.getUrl();var req_id=R.Util.getQSParam("rondavu_request_id");req_id&&(R.Logger.debug("rondavu_request_id found ... "+req_id),options.data.request_id=req_id);var rdv_id=R.StorageManager.getBrowserId();rdv_id&&(R.Logger.debug("rdv_cookie found ... "+rdv_id),options.data.rdv_cookie=rdv_id),R.Util.isQa()&&(R.Logger.debug("We are in qa"),options.data.qa=1),R.FB.getLoginStatusFromStorageOrFacebook(function(fb){options.data.fb=fb,R.Logger.debug("FB response received, finishing ajaxRT",fb),R.Logger.debug("about to call the rt server",options.url),options.start_time=(new Date).getTime(),R.ajax.ajaxProper(options)})},R.ajax.ajaxSuccess=function(data,success,options){options=options||{};var time=(new Date).getTime()-options.start_time;R.Logger.debug("ajax success",data.substr(0,50)+(data.length>50?"...":""));try{data=R.JSON.parse(data)}catch(ex){if(options.content_type&&options.content_type.toUpperCase()==="JSON"){R.Logger.error("Failed to parse ajax data as JSON",data),R.ajax.ajaxFailure(options);return}}data=R.ajax.unwrapData(data),data.send_mos=data.send_mos||!1;if(data&&data.send_mos){R.Tracker.trackDiagEvent("ajax",options._url+" - send_mos",time);if(!options.primary_mo){options.primary_mo=!0,options.mos=options.mos||options.mos_etags,R.ajax.sendRequest(options._url,options);return}R.Logger.error("Server requested full mos after full mos were already sent",options.url),R.ajax.ajaxFailure(options);return}R.Tracker.trackDiagEvent("ajax",options._url,time);if(success)try{success.call(options.context,data)}catch(ex2){R.Logger.error("Exception firing ajax callback",ex2)}},R.ajax.unwrapData=function(data){if(data&&data.original_data&&data.extra_data){var extra_data=data.extra_data;extra_data.fb_publish_info&&(R.ModuleManager.notifyAllModules(new R.Module.Message.SUCreated({fb_publish_info:extra_data.fb_publish_info})),R.Logger.debug("Event fbPublish fired with data",extra_data.fb_publish_info));var original_data=data.original_data;try{data=R.JSON.parse(original_data)}catch(ex){data=original_data}R.Logger.debug("Original data has been restored as",data)}return data},R.ajax.ajaxFailure=function(options){R.Logger.error("ajax failure",options.url),R.ModuleManager.notifyAllModules(new R.Module.Message.AjaxFailure(options));if(options.failure)try{options.failure.call(options.context)}catch(ex){R.Logger.error("error firing ajax failure callback",ex)}R.Tracker.trackDiagEvent("ajax-failure",options._url)},R.ajax.ajaxProper=function(o){var Ajax=R.ajax,postData=R.ajax._serializeData(o.data),request=new XMLHttpRequest;typeof request.withCredentials=="undefined"&&XDomainRequest?(request=new XDomainRequest,request.open("POST",o.url),request.onload=R.Util.bind(function(){Ajax.ajaxSuccess(request.responseText,o.success,o)},Ajax),request.onerror=request.ontimeout=R.Util.bind(function(){Ajax.ajaxFailure(o)},Ajax),request.onprogress=function(){},request.timeout=5e3,request.send(postData)):(o.async=typeof o.async=="undefined"?!0:o.async,request.open("POST",o.url,o.async),request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),request.withCredentials=!0,o.async!==!1&&(request.onreadystatechange=R.Util.bind(function(){request.readyState==4&&(request.status>199&&request.status<300?Ajax.ajaxSuccess(request.responseText,o.success,o):Ajax.ajaxFailure(o))},Ajax)),request.send(postData),o.async===!1&&(request.status==200?Ajax.ajaxSuccess(request.responseText,o.success,o):Ajax.ajaxFailure(o)))},R.ajax._serializeData=function(data){var encData=[];for(var key in data)if(data.hasOwnProperty(key)){var value=data[key],str=typeof value=="object"?R.JSON.stringify(value):value;encData.push(key+"="+encodeURIComponent(str))}return encData.join("&")},R.Tracker=function(){var self=this,js_init_time=(new Date).getTime(),_={};return{max_height_for_visible:400,_:_,init:function(){this.collectReferralInformation()},doTracking:function(){this.trackPurchases(_.sref,_.ssfeat)},collectReferralInformation:function(){R.Logger.info("Collecting referral information..."),_.sref=R.Util.getQSParam("SREF")||R.Util.getQSParam("sref"),_.ssfeat=R.Util.getQSParam("SSFEAT")||R.Util.getQSParam("ssfeat"),R.Logger.info("Recording referral information..."),this.saveSREF(_.sref,_.ssfeat)},trackEventProper:function(category,action,label,value,logOptions){var self=this;R.Logger.debug("Called trackEventProper"),logOptions=logOptions||{},logOptions.muteS3||(R.Logger.debug("logging event to s3"),self.s3Log({type:"GA",category:category,action:action,label:label,value:value,time_since_load:(new Date).getTime()-js_init_time})),value=value===undefined?(new Date).getTime()-js_init_time:value,R.Logger.debug("tracked event: "+category+", "+action+", "+label+", "+value)},trackEvent:function(category,action,label,value){var self=this;self.trackEventProper(category,action,label,value)},saveSREF:function(sref,ssfeat){if(sref||ssfeat)R.StorageManager.deleteLocal("sref"),R.StorageManager.deleteLocal("ssfeat"),R.StorageManager.setLocal("sref_date",new Date);sref&&R.StorageManager.setLocal("sref",sref),ssfeat&&R.StorageManager.setLocal("ssfeat",ssfeat)},trackPurchases:function(sref,ssfeat){var self=this,page_data=R.PageDataManager.getPageData(),trackingPurchases1_1=page_data.config.version=="1.1"&&page_data.page&&page_data.page.shopping_cart&&page_data.page.shopping_cart.is_shopping_cart&&!page_data.page.shopping_cart.pre_purchase,trackingPurchases1_2=page_data.config.version=="1.2"&&page_data.page&&page_data.page.actions&&page_data.page.actions.purchase;if(trackingPurchases1_1||trackingPurchases1_2){R.Logger.debug("Tracking Purchase");var category="Purchase Tracking",item_action="Line Item",order_action="Order Total",now=new Date,sref_date;sref||ssfeat?sref_date=now:(sref=R.StorageManager.getLocal("sref"),ssfeat=R.StorageManager.getLocal("ssfeat"),sref_date=R.StorageManager.getLocal("sref_date"));if(sref_date){sref_date=new Date(sref_date);if(sref_date.getTime()+2592e6>now.getTime()){var sref_addon=" - "+(sref||"")+" "+(ssfeat||"");item_action+=sref_addon,order_action+=sref_addon}}if(trackingPurchases1_1){self.trackEvent(category,order_action,R.PageDataManager.getMoName(),parseFloat(page_data.page.shopping_cart.total)*100);var mos=R.PageDataManager.getMosFromPageData(),mo;for(var i=0;i<mos.length;i++)mo=mos[i],self.trackEvent(category,item_action,R.PageDataManager.getMoName(mo),parseFloat(mo.price.actual_paid)*100)}if(trackingPurchases1_2){self.trackEvent(category,order_action,R.PageDataManager.getMoName(),page_data.page.actions.purchase.total*100);var items=page_data.page.actions.purchase.items;items&&items.length&&R.Util.each(items,function(item){self.trackEvent(category,item_action,item.id.id+"-"+item.id.type,item.price.actual_paid*100)},this)}}},trackDiagEvent:function(label,detail,value,logOptions){var self=this;return typeof self.trackEventProper!="undefined"?(self.trackEventProper("_diag",label,detail,value,logOptions),!0):!1},s3Log:function(params,skip_fb){var self=this;params=params||{};function doTrack(){params.browser_id=R.Util.stripSignature(R.StorageManager.getBrowserId());try{R.FB.getAuthResponse()&&(params.fb_uid=R.FB.getAuthResponse().userID)}catch(ex){R.Logger.debug("failed to add FB uid to s3Log",params)}params.visitor_id=R.Core.config.visitor_id,params.is_sharing=R.Core.isUserSharing();if(typeof R.FB.perms=="object"){var perms=[];r$.each(R.FB.perms,function(perm){perms.push(perm)}),params.fb_perms=perms.join(",")}else params.fb_perms="none";var params_a=[];R.Util.each(params,function(value,key){params_a.push(key+"="+encodeURIComponent(value))},self),params=params_a.join("&");var server,path;R.Core.config.build_version!="dev_local"?(server=R.Core.getS3Url(),path="/C/"+R.Core.config.customer_name+"/log.gif?"+params+"&timestamp="+(new Date).getTime()):(server=R.Core.getCDNUrl(),path="/customer/"+R.Core.config.customer_name+"/images/log.gif?"+params+"&timestamp="+(new Date).getTime());var i=document.createElement("img");i.src=R.Util.fixUrl(server,path);var log_params="?customer_name="+R.Core.config.customer_name+"&"+params+"&timestamp="+(new Date).getTime();self.logToSociableLabsLogger(log_params)}if(skip_fb){doTrack();return}params.fbloginstatus="failed_to_load_in_time";try{FB.getLoginStatus(function(response){params.fbloginstatus=response.status})}catch(ex){}setTimeout(R.Util.bind(doTrack,this),0)},logToSociableLabsLogger:function(log_params){if(typeof log_params=="object"){var params=[];R.Util.each(log_params,function(value,key){params.push(key+"="+encodeURIComponent(value))},self),params="?"+params.join("&"),log_params=params}var log_server=R.Core.getLoggerUrl(),logger_img=document.createElement("img");logger_img.src=log_server+log_params},addMosIds:function(params){var pmid=R.PageDataManager.getPrimaryMoId(),pd=R.PageDataManager.getPageData(),ids=[];pd.mos&&R.Util.each(pd.mos,function(mo){ids.push(mo.id[0].type+":"+mo.id[0].id)}),params.primary_mo_type=pmid.type,params.primary_mo_id=pmid.id,params.mos_ids=ids.join(",")},reportBrowse:function(){var self=this,params={action:"browse"};self.addMosIds(params);var featureids=[],fpis=[],features_visibility=[],initially_not_visible=[];R.Util.each(R.ModuleManager.getModules(),function(module,feature_id){featureids.push(feature_id);var div_id=R.Module.prototype._cleanId(feature_id);fpis.push(R.Util.stripSignature(module.config.feature_page_id));var is_visible=this._isVisibleOnScreen(document.getElementById(div_id));features_visibility.push(is_visible),is_visible||initially_not_visible.push(module)},self),initially_not_visible.length>0&&(setTimeout(function(){self._reportBrowseForInitiallyNotVisible(self,initially_not_visible)},1e3),r$(window).on("scroll",{initially_not_visible:initially_not_visible,self:this},self._reportBrowseForInitiallyNotVisibleOnScroll)),params.features=featureids.join(","),params.feature_page_ids=fpis.join(","),params.features_visibility=features_visibility.join(","),R.Event.fire("report_browse",params),self.s3Log(params)},_reportBrowseForInitiallyNotVisibleOnScroll:function(event){var self_obj=event.data.self,initially_not_visible_obj=event.data.initially_not_visible;self_obj._reportBrowseForInitiallyNotVisible(self_obj,initially_not_visible_obj)},_reportBrowseForInitiallyNotVisible:function(self,initially_not_visible){var null_counter=0;for(var index=0;index<initially_not_visible.length;index++){var module=initially_not_visible[index];if(module){var div_id=R.Module.prototype._cleanId(R.Util.stripSignature(module.config.feature_id));if(self._isVisibleOnScreen(document.getElementById(div_id))){var params={action:"browse"};self.addMosIds(params),params.features=R.Util.stripSignature(module.config.feature_id),params.feature_page_ids=R.Util.stripSignature(module.config.feature_page_id),params.features_visibility=!0,self.s3Log(params),initially_not_visible[index]=null}}else null_counter++,null_counter==initially_not_visible.length&&r$(window).off("scroll",self._reportBrowseForInitiallyNotVisibleOnScroll)}},_isVisibleOnScreen:function(elem){var $elem=r$(elem);return this._isVisible($elem)&&this._isAboveFold($elem)},_isVisible:function($elem){return $elem.is(":visible")&&$elem.css("opacity")!=="0"&&$elem.css("visibility")!=="hidden"},_isAboveFold:function($elem){var doc_view_top=r$(window).scrollTop(),doc_view_bottom=doc_view_top+r$(window).height(),elem_top=$elem.offset().top,elem_height=$elem.height();this.max_height_for_visible<elem_height&&(elem_height=this.max_height_for_visible);var elem_half=elem_top+elem_height/2,elem_half_is_below_screen_top=elem_half>=doc_view_top,elem_half_is_above_screen_bottom=elem_half<=doc_view_bottom;return elem_half_is_below_screen_top&&elem_half_is_above_screen_bottom},addTrackingToMo:function(mo,feature){mo.mo_url=this.appendTrackingToURL(mo.mo_url,feature)},appendTrackingToURL:function(mo_url,feature){if(feature.getBooleanParameter("Common.Analytics.CustomerSiteTinyUrlWrapping.Enable"))return mo_url;var omniture_url="",ssfeat=feature.config.feature_id;ssfeat=ssfeat.substring(0,ssfeat.indexOf("&"));var sfbstate="FBUnknown";return feature.FB.userIsConnected()&&(sfbstate="FBConnected"),mo_url&&mo_url.indexOf("?")!=-1?omniture_url+=mo_url+"&":omniture_url+=mo_url+"?",omniture_url+="SSFEAT="+ssfeat,omniture_url+="&SFBSTATE="+sfbstate,omniture_url}}}(),R.Timer=function(){var self=this,_={startTime:-1,totalTime:-1};self.start=function(){return _.startTime>-1?!1:(_.startTime=(new Date).getTime(),!0)},self.stop=function(){return self.isActive()?(_.totalTime=(new Date).getTime()-_.startTime,_.totalTime):!1},self.isActive=function(){return _.startTime>-1&&_.totalTime<0},self.getElapsedTime=function(){return _.startTime<0?!1:_.totalTime>-1?_.totalTime:(new Date).getTime()-_.startTime},self.toString=function(){return self.isActive()?"Timing...":self.getElapsedTime()+"ms"}},R.Timers=function(){var _={timers:{},timers_reported:!1};return{_:_,startTimer:function(timerName){if(!_.timers[timerName]||!!_.timers[timerName]&&_.timers[timerName].isActive())!_.timers[timerName]||delete _.timers[timerName],_.timers[timerName]=new R.Timer;return _.timers[timerName].start()},stopTimer:function(timerName){if(!_.timers[timerName])return!1;var elapsed=_.timers[timerName].stop();return _.timers_reported&&elapsed&&R.Tracker.trackDiagEvent("timer",timerName,elapsed),elapsed},renameTimer:function(timerName,newName){!_.timers[timerName]||(_.timers[newName]=_.timers[timerName],delete _.timers[timerName])},getTime:function(timerName){return _.timers[timerName]?_.timers[timerName].getElapsedTime():!1},reportTimes:function(){var t,s3Report="";R.Logger.debug("Timers",_.timers);for(var timer_name in _.timers)_.timers.hasOwnProperty(timer_name)&&(t=_.timers[timer_name],t&&!t.isActive()?(s3Report+=timer_name+":"+t.getElapsedTime()+";",R.Tracker.trackDiagEvent("timer",timer_name,t.getElapsedTime(),{muteS3:!0})):R.Logger.debug("Tried to report unstopped timer: "+timer_name));s3Report&&s3Report.length&&R.Tracker.trackDiagEvent("timer","timer report",s3Report,{muteGA:!0}),_.timers_reported=!0},recordLoadingTime:function(start_time){var miliseconds=(new Date).getTime()-start_time.getTime();_.timers.start_time={isActive:function(){return!1},getElapsedTime:function(){return miliseconds}}}}}(),R.StorageManager=function(){var BROWSER_ID_KEY="rdv_cookie",VISIT_OBJ_EXPIRY=72e5,self={setBrowserId:function(value){var cookie=R.JSON.stringify({value:value,timestamp:Math.round((new Date).getTime()/1e3),version:2});R.StorageManager.setLocal(BROWSER_ID_KEY,cookie)},getBrowserId:function(){var local=R.StorageManager.getLocal(BROWSER_ID_KEY);try{local=R.JSON.parse(local)}catch(ex){}return local&&typeof local.value!="undefined"?local.value:local},getVisitorKey:function(){return"SL-VISITOR-"+R.Core.config.customer_name},getVisitKey:function(){return"SL-SITE-VISIT-"+R.Core.config.customer_name},getUserKey:function(){return"SL-USER-"+R.Core.config.customer_name},getFBUserKey:function(){return"SL-USER-"+R.Core.config.customer_name+"-"+R.FB._.current_fb_uid},getPublishedActionsKey:function(){return"SL-PUBLISHED-ACTIONS"+R.Core.config.customer_name},getFbLoginStatusKey:function(){return"SL-FB-LOGIN-STATUS-"+R.Core.config.customer_name},checkForNewVisit:function(){var visitKey=this.getVisitKey(),visitObj=this.getLocalObject(visitKey);return!visitObj||(new Date).getTime()-visitObj.timestamp>VISIT_OBJ_EXPIRY?(this.deleteLocal(visitKey),!0):!1},storeVisitIfNew:function(){return this.checkForNewVisit()?(this.setLocalObject(this.getVisitKey(),{guid:R.Core.generateVisitId(),timestamp:(new Date).getTime()}),!0):!1},storeVisitorId:function(visitor_id){this.setLocal(this.getVisitorKey(),visitor_id)},getVisitorId:function(){return this.getLocal(this.getVisitorKey())},syncCookies:function(remoteJson){var local=R.StorageManager.getLocal(BROWSER_ID_KEY);try{local=R.JSON.parse(local)}catch(ex){local=undefined}var remote;try{remote=R.JSON.parse(remoteJson)}catch(ex2){remote=undefined}var value,oldValue;local&&!remote?(R.Logger.debug("no remote BID, using local",local),value=local.value):!local&&remote?(R.Logger.debug("no local BID, using remote",remote),value=remote.value):local&&remote?local.timestamp>remote.timestamp?(R.Logger.debug("local BID newer, using local",local),value=local.value):(R.Logger.debug("remote BID newer or equal to local, using remote",remote),value=remote.value,oldValue=local.value):(R.Logger.debug("no BID found anywhere"),value=undefined),value&&R.StorageManager.setBrowserId(value)},setLocalObject:function(key,value){window.localStorage.setItem(key,R.JSON.stringify(value))},getLocalObject:function(key){var value=window.localStorage.getItem(key);if(value)try{value=R.JSON.parse(value)}catch(e){R.Logger.warn(value+" is not a valid JSON string."),value=null}return value},createOrUpdateLocalObject:function(key,value){var old_value=this.getLocalObject(key)||{};this.setLocalObject(key,r$.extend(!0,old_value,value))},setLocal:function(key,value){window.localStorage.setItem(key,value)},getLocal:function(key){return window.localStorage.getItem(key)},deleteLocal:function(key){if(window.localStorage.getItem(key))return window.localStorage.removeItem(key)},setLocalSession:function(key,value){window.sessionStorage[key]=value},getLocalSession:function(key){return window.sessionStorage[key]},deleteLocalSession:function(key){if(window.sessionStorage.getItem(key))return window.sessionStorage.removeItem(key)},setLocalSessionObject:function(key,value,options){options=options||{},options.expires&&typeof value.__expires__=="undefined"&&(value.__expires__=options.expires),this.setLocalSession(key,R.JSON.stringify(value))},getLocalSessionObject:function(key){var value=this.getLocalSession(key);if(value){try{value=R.JSON.parse(value)}catch(e){R.Logger.warn(value+" is not a valid JSON string."),value=null}value.__expires__&&value.__expires__<R.Util.getCurrentTime()&&(this.deleteLocalSession(key),value=null)}return value}};return self}(),R.PageDataManager=function(){var l=window.location,_={signed_page_data:null,pageData:null,getPageData:function(){if(!_.pageData){if(R.Core.config.page_data===null)throw"PageData not found, has R.Core finished initializing?";var pd=r$.extend(!0,{},R.Core.config.page_data);_.pageData=R.PageDataManager.decodePageData(pd)}return _.pageData},path:l.pathname},self={_:_,tagMap:{mo_id:"sl:id",mo_type:"og:type",mo_name:"og:title",description:"og:description",mo_url:"og:url",pic:"og:image",pic_secure:"sl:image-secure",primary_tag:"sl:primary-tag",tags:"sl:tags",retail_price:"sl:price-retail",sale_price:"sl:price-sale",currency:"sl:price-currency",marketing_area:"sl:marketing-areas",fb_event_id:"sl:facebook-event-id",create_fb_event:"sl:facebook-event-create",do_promote:"sl:promote",location_name:"sl:location-name",location_id:"sl:location-id",location_url:"sl:location-url",location_address_line1:"sl:location-address-line-1",location_address_line2:"sl:location-address-line-2",location_city:"sl:location-city",location_state:"sl:location-state",location_country:"sl:location-country",location_postal_code:"sl:location-postal-code",location_latitude:"sl:location-latitude",location_longitude:"sl:location-longitude",start_timezone:"sl:event-date-start-timezone",start_date:"sl:event-date-start-date",start_time:"sl:event-date-start-time",end_timezone:"sl:event-date-end-timezone",end_date:"sl:event-date-end-date",end_time:"sl:event-date-end-time"},getMosFromPageData:function(){var page_data=_.getPageData();return typeof page_data.mos!="undefined"?page_data.mos:[]},getPrimaryMo:function(){var page_data=_.getPageData();if(typeof page_data.primary_mo!="undefined")return page_data.primary_mo;var mos=self.getMosFromPageData();return mos.length>0?mos[0]:null},getPrimaryMoId:function(){var mo=self.getPrimaryMo();return mo&&mo.id&&mo.id[0]?mo.id[0]:null},calculateMoEtag:function(mo){var thismo=r$.extend(!0,{},mo);return thismo.customer_name=R.Core.config.customer_name,self.etag(thismo)},getMoName:function(mo){return mo=mo||self.getPrimaryMo(),mo.name&&mo.name[0]?mo.name[0].name:""},getMoDetailUrl:function(mo){return mo=mo||self.getPrimaryMo(),mo.url&&mo.url.detail?mo.url.detail:""},etag:function(target){return hex_md5(R.JSON.stringify(target))},decodePageData:function(pd){if(!pd)return R.Logger.warn("Page data not found"),pd;_.pageData=pd;if(!_.signed_page_data&&pd.signature){_.signed_page_data=pd;var decoded={};R.Util.each("config,page,user,primary_mo,mos",function(key){if(pd[key+"_base64"])try{decoded[key]=R.JSON.parse(Base64.decode(pd[key+"_base64"]))}catch(e){throw new Error("Syntax error in Base64-encoded page data: RondavuData."+key+"_base64. "+e.message)}else pd[key]&&(decoded[key]=pd[key])}),_.pageData=decoded}return _.pageData},getPageData:function(options){var pd=_.getPageData();if(!pd)return R.Logger.error("RondavuData is missing or invalid."),null;if(!options)return pd;var v1=pd.config.version==="1.0";pd.primary_mo_etag=pd.primary_mo_etag||self.calculateMoEtag(self.getPrimaryMo());if(options.mos_etags||options.mos||v1){pd.mos=pd.mos||[];if(!pd.mos_etags&&options.mos_etags!==!1){pd.mos_etags=[];for(var i=0,j=pd.mos.length;i<j;i++)pd.mos_etags[i]=self.calculateMoEtag(pd.mos[i])}}var n=r$.extend(!0,{},pd);return options.primary_mo||delete n.primary_mo,!options.mos&&!v1&&delete n.mos,!options.mos_etags&&!options.mos&&!v1&&delete n.mos_etags,v1&&delete n.primary_mo_etag,n.page_etag&&delete n.page_etag,options.signed&&_.signed_page_data&&(n.signature={},R.Util.each(n,function(value,key){_.signed_page_data[key+"_base64"]&&(delete n[key],n[key+"_base64"]=_.signed_page_data[key+"_base64"],n.signature[key]=_.signed_page_data.signature[key])}),R.Util.each(n,function(value,key){n.signature[key]=_.signed_page_data.signature[key]})),options.custom_data||delete n.custom_data,n},getMinitEtag:function(test_group_id){var pd=_.getPageData();pd.page_etag=pd.page_etag||(pd.page?this.etag(pd.page):""),pd.primary_mo_etag=pd.primary_mo_etag||self.calculateMoEtag(self.getPrimaryMo());var hex_part="page_etag="+pd.page_etag+"&primary_mo_etag="+pd.primary_mo_etag+"&url="+l.host+_.path;return R.Util.isQa()&&(hex_part+="&qa=1"),test_group_id&&(hex_part+="&test_group_id="+test_group_id),_.minit_etag=_.minit_etag||"C/"+R.Core.config.customer_name+"/data/minit_"+R.Core.config.customer_timestamp+"_"+self.etag(hex_part)+".js",_.minit_etag},getMetaProperty:function(prop){return r$('meta[property="'+prop+'"]').attr("content")},getOpenGraphPrimaryMo:function(){var primary_mo_map={};R.Util.each(self.tagMap,function(name,index){primary_mo_map[index]=self.getMetaProperty(name)},self);var primary_mo={id:[{id:primary_mo_map.mo_id,type:primary_mo_map.mo_type}],name:[{name:primary_mo_map.mo_name}],description:[{description:primary_mo_map.description?primary_mo_map.description:""}],url:{detail:primary_mo_map.mo_url,picture:primary_mo_map.pic||primary_mo_map.pic_secure?{primary:primary_mo_map.pic,primary_secure:primary_mo_map.pic_secure}:undefined},primary_tag:primary_mo_map.primary_tag,tags:primary_mo_map.tags&&primary_mo_map.tags.length>0?primary_mo_map.tags.split("|"):undefined,price:primary_mo_map.retail_price||primary_mo_map.sale_price?{retail_price:primary_mo_map.retail_price,sale_price:primary_mo_map.sale_price,currency:primary_mo_map.currency}:undefined,marketing_area:primary_mo_map.marketing_area,facebook:primary_mo_map.fb_event_id||primary_mo_map.create_fb_event?{event_id:primary_mo_map.fb_event_id,create_event:primary_mo_map.create_fb_event}:undefined,do_promote:primary_mo_map.do_promote,location:primary_mo_map.location_id?{name:primary_mo_map.location_name,id:primary_mo_map.location_id,url:primary_mo_map.location_url,address_line1:primary_mo_map.location_address_line1,address_line2:primary_mo_map.location_address_line2,city:primary_mo_map.location_city,state:primary_mo_map.location_state,country:primary_mo_map.location_country,postal_code:primary_mo_map.location_postal_code,latitude:primary_mo_map.location_latitude,longitude:primary_mo_map.location_longitude}:undefined,product_date:primary_mo_map.start_date?[{start:{time:primary_mo_map.start_time,date:primary_mo_map.start_date,timezone:primary_mo_map.start_timezone},end:primary_mo_map.start_date&&primary_mo_map.end_date?{time:primary_mo_map.end_time,date:primary_mo_map.end_date,timezone:primary_mo_map.end_timezone}:undefined}]:undefined};return primary_mo},setPageData:function(data){_.minit_etag=null,_.pageData=null,_.signed_page_data=null,R.Core.config.page_data=data,data&&!data.primary_mo&&R.Core.config.og_primary_mo_enable&&(R.Core.config.page_data.primary_mo=self.getOpenGraphPrimaryMo())},setPath:function(path){_.minit_etag=null;if(path.substr(0,1)!="/"||path.substr(0,2)=="//")throw'URL must be relative to the site root. For example, http://site.com/category/product would be "/category/product"';_.path=path},getPath:function(){return _.path},getUrl:function(){return l.protocol+"//"+l.host+_.path+l.search+l.hash},isPurchase:function(){var pd=this.getPageData(),p_v1_1=!1;pd.page&&pd.page.shopping_cart&&(pd.page.shopping_cart.pre_purchase=="false"||pd.page.shopping_cart.pre_purchase===!1)&&(p_v1_1=!0);var p_v1_2=pd.page&&pd.page.actions&&pd.page.actions.purchase;return p_v1_1||p_v1_2},hasActions:function(){var pageData=this.getPageData(),newRegV1_1=pageData.page&&pageData.page.is_new_registration,purchaseV1_1=pageData.page&&pageData.page.shopping_cart&&(pageData.page.shopping_cart.pre_purchase=="false"||pageData.page.shopping_cart.pre_purchase===!1),actionsV1_2=pageData.page&&pageData.page.actions;return!!(newRegV1_1||purchaseV1_1||actionsV1_2)}};return self}(),R.ModuleManager=function(){var TEST_GROUP_COOKIE_NAME="rdv_test_group",base_timer_name="module_init_ajax",self=this,_internal={modules:{},delayedModules:{},sparseModuleLoaded:!1,m_init_timer_name:base_timer_name,notifyModules:function(skip_module,message){var self=this;R.Event.listen("modules_loaded",function(){message.type=message.type||"unknown";for(var feature_id in self.modules)if(self.modules.hasOwnProperty(feature_id)){var module=self.modules[feature_id];if(module!=skip_module)try{module.handleMessage(message)}catch(ex){R.Logger.error("Error firing .handleMessage for module with feature_id "+feature_id,ex)}}})},init_from_cdn:!0,fb_event_handlers_registered:!1,registerFBEventHandlers:function(){if(_internal.fb_event_handlers_registered)return;_internal.fb_event_handlers_registered=!0,R.Event.listen("fb.login",function(response){R.ModuleManager.notifyAllModules(new R.Module.Message.FB.Login(response))}),R.Event.listen("fb.logout",function(response){R.ModuleManager.notifyAllModules(new R.Module.Message.FB.Logout(response))}),R.Event.listen("fb.new.connect",function(response){R.ModuleManager.notifyAllModules(new R.Module.Message.FB.NewConnect(response))}),R.Event.listen("fb.deauthorize",function(response){R.FB._internal.userDeauthorized=!0,R.ModuleManager.notifyAllModules(new R.Module.Message.FB.Logout(response))})},isFirstCallSent:!1,waitingOnUpdatePage:!1};return{_internal:_internal,modules:_internal.modules,delayedModules:_internal.delayedModules,sparseModuleLoaded:_internal.sparseModuleLoaded,isAbTestingEnabled:function(){return R.Core.config.ab_testing_enabled},getTestGroupId:function(){var test_group_id=parseInt(R.StorageManager.getLocalSession(TEST_GROUP_COOKIE_NAME),10);if(!test_group_id){var num_test_groups=2;test_group_id=Math.floor(Math.random()*num_test_groups+1),R.StorageManager.setLocalSession(TEST_GROUP_COOKIE_NAME,test_group_id)}return test_group_id},moduleInitServerCall:function(force_rt){var self=this;R.Logger.debug("moduleInitServerCall started...");var data={},_finishMInit=function(fb_response){R.Logger.debug("starting finishMInit"),data.fb=fb_response||{status:"unknown"};var bypass_cdn=R.Util.checkOverride("rondavu_bypass_cdn");_internal.init_from_cdn=!(bypass_cdn||data.fb.status=="connected"||R.PageDataManager.hasActions()||force_rt),R.Timers.startTimer(_internal.m_init_timer_name);var test_group_id=self.isAbTestingEnabled()?self.getTestGroupId():0;if(!_internal.init_from_cdn){R.Logger.debug("Set to go to realtime server for AJAX"),data.minit_etag=R.PageDataManager.getMinitEtag(test_group_id),R.Logger.debug("Got Minit Etag: "+data.minit_etag),data.visitor_id=R.Core.config.visitor_id;var ajax_options={data:data,success:R.Util.bind(self.handleMInitResponse,self),mos_etags:!0,content_type:"JSON"};R.PageDataManager.isPurchase()&&(ajax_options.mos=!0,ajax_options.mos_etags=!1),self._internal.isFirstCallSent=!0,R.Logger.debug("About to send AJAX request to rondavu/m/init/ ..."),R.ajax("rondavu/m/init/",ajax_options)}else{R.Logger.debug("Set to go to CDN"),R.Timers.startTimer("cdn_response");var url=R.PageDataManager.getMinitEtag(test_group_id);R.Logger.debug("Got Minit Etag/Url: "+url+" calling loadScript..."),R.Util.loadScript(R.Util.fixUrl(R.Core.getCDNUrl(),url),function(){var cdn_init=R.ModuleManager.CDN_init_recieved;return R.Logger.debug("CDN_init_recieved: "+cdn_init),cdn_init},function(){self._internal.isFirstCallSent=!0,self._internal.cdn_success_response_time=R.Timers.stopTimer("cdn_response"),R.Logger.debug("Successful load from CDN")},function(){return R.Logger.debug("Failed to load data from CDN, calling Realtime server",url),this.moduleInitServerCall(!0)},self,!0),self._internal.waitingOnUpdatePage=!1}};if(R.Core.config.preload_m_init){var fb_login_status=R.FB.getLoginStatusFromStorage();if(fb_login_status){R.Logger.debug("Preload m/init with FB login status cached in session storage"),_finishMInit(fb_login_status);return}}R.Core.config.skip_FB?(R.Logger.debug("skip_FB explicitly set... skipping..."),_finishMInit()):(R.Logger.debug("Getting facebook login status"),FB.getLoginStatus(function(fb_response){R.Logger.debug("facebook login status returned, finishing /m/init",fb_response),_finishMInit(fb_response)}))},initFromCDN:function(response){R.ModuleManager.CDN_init_recieved=!0,typeof response.rdv_cookie!="undefined"&&delete response.rdv_cookie;var current_timestamp=Math.round((new Date).getTime()/1e3);response.timestamp?R.Logger.debug("Comparing CDN response's timestamp ("+response.timestamp+")  + cdn_data_ttl ("+R.Core.config.cdn_data_ttl+") with current time in UTC ("+current_timestamp+")"):R.Logger.error("No timestamp in CDN response",R.PageDataManager.getMinitEtag());if(response.timestamp+R.Core.config.cdn_data_ttl<current_timestamp)return R.Logger.debug("CDN data is expired, reloading from RT server"),R.ModuleManager.moduleInitServerCall(!0);response.from_cdn=!0,R.ModuleManager.handleMInitResponse(response)},usingCDN:function(){return _internal.init_from_cdn},handleMInitResponse:function(response){var self=this;R.Logger.debug("MInit response callback...");if(!R.Core.config.enabled){R.Logger.debug("Rondavu is disabled! (R.Core.config.enabled returned false) ... Returning from callback");return}self._internal.m_init_response_time=R.Timers.stopTimer(self._internal.m_init_timer_name)||self._internal.m_init_response_time;if(R.Core.config.skip_FB){R.Logger.debug("skip_FB found - making sure FB is sorted out first");if(!R.Event.hasFired("FB_ready")){R.Logger.debug("m/init finished, waiting on facebook before rendering"),R.Event.listen("FB_ready",function(){R.Logger.debug("FB is now ready - handling the MInit response"),self.handleMInitResponse(response)});return}if(R.FB.getAuthResponse()){R.Logger.debug("FB getAuthResponse returned true"),R.Core.config.skip_FB=!1,R.Logger.info("Facebook login status changed during /m/init, reloading features"),_internal.m_init_timer_name=_internal.m_init_timer_name+"2",R.Timers.startTimer(_internal.m_init_timer_name),R.Logger.debug("Making server side module init call"),self.moduleInitServerCall();return}}self._internal.feature_page_ids=[],r$.each(response.modules,function(index,val){var feature_page_id=val.feature_page_id.split("&")[0];self._internal.feature_page_ids.push(feature_page_id)}),self._internal.module_names=[],r$.each(response.modules,function(index,val){val.module_config&&self._internal.module_names.push(val.module_config.id)}),self._internal.time_log_params={customer_name:R.Core.config.customer_name,m_init_response_time:self._internal.m_init_response_time,feature_page_ids:self._internal.feature_page_ids,module_names:self._internal.module_names};if(self._internal.cdn_success_response_time)self._internal.time_log_params.cdn_success_response_time=self._internal.cdn_success_response_time;else{var cdn_miss_time=R.Timers.stopTimer("cdn_response");cdn_miss_time&&(self._internal.time_log_params.cdn_miss_response_time=cdn_miss_time)}response.rdv_cookie&&(R.Logger.debug("setting rdv_cookie from /m/init response",response.rdv_cookie),R.StorageManager.setBrowserId(response.rdv_cookie)),response.modules&&typeof response.modules.length=="number"?(R.Logger.debug(""+response.modules.length+" Modules found to initalize!"),response.modules.length===0?(R.Logger.validator.error("No Modules for "+R.Core.getCustomerName()+" are configured to show on current url and path: "+window.location.host+window.location.pathname),R.Logger.info("No modules to load"),clearTimeout(R.Core._watchdog_timeout)):(R.Logger.debug("Initializing modules (calling initModules)"),self.initModules(response.modules))):(R.Logger.error("No modules array found in /m/init response",response),response.from_cdn&&self.moduleInitServerCall(!0),R.ModuleManager.destroyAllModules()),self._internal.waitingOnUpdatePage=!1},initModules:function(modules){this.deleteOldAndRemoveUnchanged(modules);var self=this;_internal.num_waiting_modules=modules.length;function _initModules_after_DOMReady(){self.initModules(modules)}while(modules.length){var mod=modules.shift();R.Logger.debug("found module config for "+mod.module_config.js_class+" with feature_id "+mod.feature_id);try{self.initModule(mod.module_config.js_class,mod)}catch(ex){if(ex==R.Module.ERR_NO_EL){if(!R.Core.DOMReady){modules.unshift(mod),R.Logger.debug("Waiting on DOMReady before initializing modules."),r$(document).ready(_initModules_after_DOMReady);return}R.Logger.error("Element #"+(mod.div.name||mod.div.primary)+" not found for module "+mod.js_class)}else R.Logger.error("Module "+mod.js_class+" in div "+mod.div+" failed to load",ex);this.decrementModuleInitializedCount()}}R.Util.each(R.ModuleManager.modules,function(module){module.getParameter("Common.RenderMode")!=="hidden"&&(R.ModuleManager.sparseModuleLoaded?(module.sparseHideBehavior===R.Module.HIDE_IF_NOT_SPARSE||module.sparseHideBehavior===R.Module.DONT_HIDE)&&module.trackLoad():(module.sparseHideBehavior===R.Module.HIDE_IF_SPARSE||module.sparseHideBehavior===R.Module.DONT_HIDE)&&module.trackLoad())}),_internal.registerFBEventHandlers()},decrementModuleInitializedCount:function(){typeof _internal.num_waiting_modules!="undefined"&&--_internal.num_waiting_modules===0&&R.Event.fireAndRemember("modules_initialized")},initModule:function(js_class,config){try{if(typeof R.Module=="undefined"||typeof R.Module[js_class]=="undefined"){R.Logger.error("Module "+js_class+" does not exist",config);return}var feature_id_short=R.Util.stripSignature(config.feature_id);if(config.div.location!="primary"&&typeof _internal.modules[config.div.primary]=="undefined"){_internal.delayedModules[config.div.primary]=_internal.delayedModules[config.div.primary]||[],_internal.delayedModules[config.div.primary].push({js_class:js_class,config:config});return}var thisMod=new R.Module[js_class](config);_internal.modules[feature_id_short]=thisMod;if(typeof _internal.delayedModules[feature_id_short]!="undefined")while(_internal.delayedModules[feature_id_short].length){var mod=_internal.delayedModules[feature_id_short].shift();self.initModule(mod.js_class,mod.config)}}catch(ex){if(ex==R.Module.ERR_NO_EL)throw ex;R.Logger.error("Module "+js_class+" failed to initialize",ex)}this.decrementModuleInitializedCount()},deleteOldAndRemoveUnchanged:function(new_module_configs){var new_confs_by_fid;R.Util.each(_internal.modules,function(old_mod,feature_id){new_confs_by_fid||(new_confs_by_fid={},R.Util.each(new_module_configs,function(new_mod_conf){new_mod_conf.hash=hex_md5(JSON.stringify(new_mod_conf)),new_confs_by_fid[R.Util.stripSignature(new_mod_conf.feature_id)]=new_mod_conf})),old_mod.config.hash=old_mod.config.hash||hex_md5(JSON.stringify(old_mod.config));if(!new_confs_by_fid[feature_id]||new_confs_by_fid[feature_id].hash!=old_mod.config.hash||new_confs_by_fid[feature_id].div.primary!==null&&r$("#r_"+new_confs_by_fid[feature_id].div.primary).size()===0||new_confs_by_fid[feature_id].div.primary===null&&r$("#r_"+new_confs_by_fid[feature_id].div.name).size()===0){old_mod.destroy(),delete _internal.modules[feature_id];return}var position=R.Util.indexOf(new_module_configs,new_confs_by_fid[feature_id]);new_module_configs.splice(position,1)})},notifyAllModules:function(message){R.Logger.debug("Notifying all modules",message),_internal.notifyModules(!1,message)},notifyAllModulesExcept:function(module,message){R.Logger.debug("Notifying all modules except "+R.Util.stripSignature(module.config.feature_id),message),_internal.notifyModules(module,message)},destroyAllModules:function(){for(var feature_id in _internal.modules)if(_internal.modules.hasOwnProperty(feature_id)){var module=_internal.modules[feature_id];module.destroy(),delete _internal.modules[feature_id]}},getModules:function(){return _internal.modules},resetTimer:function(){_internal.m_init_timer_name=base_timer_name},isFirstCallSent:function(){return _internal.isFirstCallSent},setWaitingOnUpdatePage:function(){_internal.waitingOnUpdatePage=!0},isWaitingOnUpdatePage:function(){return _internal.waitingOnUpdatePage},disable:function(){R.Core.config.enabled=!1}}}(),R.FB={constants:{perm:{EMAIL:"email",FRIENDS_ACTIVITIES:"friends_activities",FRIENDS_BIRTHDAY:"friends_birthday",FRIENDS_EDUCATION_HISTORY:"friends_education_history",FRIENDS_INTERESTS:"friends_interests",FRIENDS_LIKES:"friends_likes",FRIENDS_PHOTOS:"friends_photos",FRIENDS_WORK_HISTORY:"friends_work_history",PUBLISH_ACTIONS:"publish_actions",PUBLISH_STREAM:"publish_stream",READ_STREAM:"read_stream",RSVP_EVENT:"rsvp_event",USER_EDUCATION_HISTORY:"user_education_history",USER_PHOTOS:"user_photos",USER_WORK_HISTORY:"user_work_history"},ref_params:{WALL:"FBShare",LIKE:"FBLike",OPEN_GRAPH:"FBOpenGraph",INVITE:"FBInvite",SEND:"FBSend"},connectedStates:{CONNECTED:"connected",NOT_AUTHORIZED:"not_authorized",UNKNOWN:"unknown"}},_:{getChannelUrl:function(){var channelUrl=R.Core.config.facebook_xd_channel,w=window,l=w.location,h=l.hostname,base=l.protocol+"//"+h;return channelUrl?(channelUrl.substring(0,4)!="http"&&(channelUrl=R.Util.fixUrl(base,channelUrl)),R.Util.makeSecure(channelUrl)):(h.indexOf("evenue.net")!==-1&&typeof w.linkID!="undefined"&&w.linkID!==""?channelUrl=base+"/evenue/linkID="+w.linkID+"/facebook/fb_xd_channel.html":R.Util.each("sfstation.com,biletix.com,cheggnet.com,chegg.com,aeglive.com",function(hostname){if(h.indexOf(hostname)!==-1)return channelUrl=base+"/facebook/fb_xd_channel.html",!1}),channelUrl)},appId:null,doc:document,getAppId:function(){if(R.FB._.appId)return R.FB._.appId;var app_ids=R.Core.config.app_ids,app_id,domain=R.FB._.doc.domain;if(domain in app_ids)app_id=app_ids[domain];else{var bits=window.location.hostname.split("."),bits_length=bits.length;for(var i=2;i<=bits_length;i++){domain=bits.slice(-1*i).join(".");if(domain in app_ids){app_id=app_ids[domain];break}}}return app_id?(R.Logger.debug("using Facebook app id for domain "+domain,app_id),R.FB._.appId=app_id,app_id):(R.Logger.error("No appid found after trying all subdomains for "+document.domain+", disabling."),R.ModuleManager.disable(),!1)},fbloaded:!1,current_fb_uid:0,userDeauthorized:!1},oldFbAsyncInit:null,_loadJsSdk:function(callback){callback=callback||r$.noop;var beta=R.Util.checkOverride("rdv_fb_beta");if(!window.FB||beta&&!R.FB._.fbloaded){R.Logger.debug("loading facebook");var fb_root=document.createElement("div");fb_root.id="fb-root",document.body.appendChild(fb_root),R.FB.oldFbAsyncInit=window.fbAsyncInit,window.fbAsyncInit=function(){if(R.FB.oldFbAsyncInit)try{R.FB.oldFbAsyncInit()}catch(ex){R.Logger.error("Non-SL window.fbAsyncInit threw an error",ex);try{R.Logger.error(ex)}catch(ex2){}}R.FB._.fbloaded=!0,callback()};var fb_lang="en_US";try{var lang=R.PageDataManager.getPageData().page.language,fb_languages="en_US,es_LA,af_ZA,ar_AR,az_AZ,be_BY,bg_BG,bn_IN,bs_BA,ca_ES,cs_CZ,cy_GB,da_DK,de_DE,el_GR,en_GB,en_PI,en_UD,eo_EO,es_ES,et_EE,eu_ES,fa_IR,fb_LT,fi_FI,fo_FO,fr_CA,fr_FR,fy_NL,ga_IE,gl_ES,he_IL,hi_IN,hr_HR,hu_HU,hy_AM,id_ID,is_IS,it_IT,ja_JP,ka_GE,km_KH,ko_KR,ku_TR,la_VA,lt_LT,lv_LV,mk_MK,ml_IN,ms_MY,nb_NO,ne_NP,nl_NL,nn_NO,pa_IN,pl_PL,ps_AF,pt_BR,pt_PT,ro_RO,ru_RU,sk_SK,sl_SI,sq_AL,sr_RS,sv_SE,sw_KE,ta_IN,te_IN,th_TH,tl_PH,tr_TR,uk_UA,vi_VN,zh_CN,zh_HK,zh_TW";lang=lang.toLowerCase(),lang.length==5&&(lang=lang.substr(0,2)+"_"+lang.substr(3,2).toUpperCase()),fb_languages.indexOf(lang)>-1&&(fb_lang=fb_languages.substr(fb_languages.indexOf(lang),5))}catch(ex){}beta&&R.Logger.info("Loading FB beta JS SDK"),R.Util.loadScript(window.location.protocol+"//connect."+(beta?"beta.":"")+"facebook.net/"+fb_lang+"/all.js",function(){return typeof window.FB!="undefined"},function(){setTimeout(function(){R.FB._.fbloaded||(R.Logger.warn("Our window.fbAsyncInit appears to not have fired, (perhaps it was overwritten?) Recovering."),R.FB._.fbloaded=!0,callback())},100)},function(){R.Logger.error("Failed to load Facebook JS SDK")})}else R.FB._.fbloaded=!0,callback()},init:function(iframe_mode){iframe_mode?(R.Logger.debug("FB loaded in iframe mode, exiting without initializing."),R.FB._loadJsSdk()):(R.Timers.startTimer("fb"),R.FB._loadJsSdk(R.FB._initJsSdk))},_initJsSdk:function(){var app_id=R.FB._.getAppId();if(!app_id)return;var channelUrl=R.FB._.getChannelUrl();FB.init({appId:app_id,status:!0,cookie:!0,xfbml:R.Core.config.facebook_parse_xfbml,logging:R.Util.isDebug(),channelUrl:channelUrl}),R.Event.hasFired("FB_init")||R.Event.fireAndRemember("FB_init"),R.Logger.info("Facebook initialized. APP_ID = "+app_id+", Cross-Domain Channel = "+channelUrl);var fb_timeout,done=!1;function _FBReallyFinished(response){if(done)return;done=!0,clearTimeout(fb_timeout),R.Timers.stopTimer("fb"),R.Logger.debug("FB login response loaded",response),response.status=="connected"?(R.FB.initPermsCache(response.authResponse.userID),R.FB._.current_fb_uid=response.authResponse.userID):R.FB.initPermsCache(),R.Event.fireAndRemember("FB_ready")}fb_timeout=setTimeout(function(){R.Logger.warn("Facebook failed to load within 5 seconds, retrying."),fb_timeout=setTimeout(function(){R.Core.shouldValidate()&&R.Logger.validator.error("Facebook failed to load. Please make sure the facebook app id matches the configured facebook app id "+R.FB._.getAppId()),R.Logger.error("Facebook failed to load within 5 seconds after second attempt.")},5e3),FB.getLoginStatus(_FBReallyFinished,!0)},5e3),FB.getLoginStatus(_FBReallyFinished),FB.Event.subscribe("edge.create",R.FB._handleFbEdgeCreate),FB.Event.subscribe("message.send",R.FB._handleFbMessageSend),FB.Event.subscribe("auth.authResponseChange",R.FB._handleFbAuthResponseChange)},_handleFbEdgeCreate:function(response){R.Logger.debug("fb like clicked",response),R.FB.recordLike(response,function(){R.ModuleManager.notifyAllModules(new R.Module.Message.FB.Like({url:response}))})},_handleFbMessageSend:function(response){R.Logger.debug("fb send clicked",response),R.FB.recordSend(response),R.ModuleManager.notifyAllModules(new R.Module.Message.FB.Send({url:response}))},_handleFbAuthResponseChange:function(response){R.Logger.debug("fb authResponse changed",response),R.FB.storeLoginStatus(response);if(response.authResponse)response.authResponse.userID!=R.FB._.current_fb_uid?(R.FB._.current_fb_uid=response.authResponse.userID,setTimeout(function(){R.FB.getPermsFromFacebook(response.authResponse.userID),R.Event.fire("fb.login",response)},0)):R.Logger.info("FB auth.authResponseChange message received but UID has not changed. No internal event fired.");else{var prev=R.FB._.current_fb_uid;R.FB._.current_fb_uid=0,prev!==0&&R.Event.fire("fb.logout")}},hasCookie:function(){return document.cookie.indexOf("fbsr_"+R.FB._.getAppId())!=-1},addExtraPerms:function(perms,parent){perms=perms||[],r$.isArray(perms)||(perms=perms.split(",")),R.Core.config.evershare_enabled&&perms.push(R.FB.constants.perm.PUBLISH_ACTIONS),R.Core.config.fblogin_enabled&&perms.push(R.FB.constants.perm.EMAIL);var extra_perms=parent&&parent.getParameter("Common.FB.ExtendedPermissions");extra_perms&&(perms=perms.concat(extra_perms.split(",")));var finalPerms=[];return r$.each(perms,function(i,perm){perm=r$.trim(perm),perm&&r$.inArray(perm,finalPerms)==-1&&finalPerms.push(perm)}),finalPerms.join(",")},perms:{},initPermsCache:function(uid){var self=this;R.Event.listen("fb.logout",function(){R.FB.perms_uid=0,R.FB.perms={}});if(!uid){R.FB.perms={};return}var perms=R.StorageManager.getLocalSession("rdv_fb_perms_"+uid+"_"+self._.getAppId());if(perms)try{R.FB.perms=R.JSON.parse(perms)}catch(ex){perms=null}perms||self.getPermsFromFacebook(uid),R.FB.perms_uid=uid},userIsConnected:function(){return!R.FB._.userDeauthorized&&!!FB.getAuthResponse()},getPermsFromFacebook:function(uid,cb,scope){var self=this;if(!uid)return;R.FB._loading_perms=!0;var old_perms=r$.extend({},R.FB.perms);FB.api("/me/permissions",R.Util.bind(function(response){R.FB._loading_perms=!1;if(!response.data||!response.data.length)return R.Logger.error("Invalid FB api response for /me/permissions",response),!1;R.FB.perms=response.data[0],R.StorageManager.setLocalSession("rdv_fb_perms_"+uid+"_"+self._.getAppId(),JSON.stringify(R.FB.perms)),self.initPermsCache(uid),cb&&self.bind(cb,scope)(),R.Event.fire("fb_perms_loaded");var new_perms=!1,perms=[];R.Util.each(R.FB.perms,function(val,perm){perms.push(perm),old_perms[perm]?delete old_perms[perm]:new_perms=!0}),R.Util.each(old_perms,function(){new_perms=!0}),new_perms&&(self.parent||R).ajax("/rondavu/fbperms/refresh/",{data:{fb_perms:perms.join(",")},success:function(response){response.new_connect&&R.Event.fire("fb.new.connect",response)}})},self))},hasPerms:function(perms){var hasPerms=!0;return R.Util.each(perms,function(perm){if(!R.FB.perms[perm])return hasPerms=!1}),hasPerms},hasPermAsync:function(perms,cb){R.FB._loading_perms?R.Event.listen("fb_perms_loaded",function(){cb(R.FB.hasPerms(perms))},{once:!0}):cb(R.FB.hasPerms(perms))},fb_like_service_url:"rondavu/service/fblike/",registeredLikeUrls:{},registeredSendUrls:{},registerLikeUrls:function(likeData){R.Util.each(likeData,function(like){this.registeredLikeUrls[like.tiny_url]=like},this)},registerSendUrls:function(sendData){R.Util.each(sendData,function(send){this.registeredSendUrls[send.tiny_url]=send},this)},recordLike:function(url,callback){var likeData=this.registeredLikeUrls[url],ajax_opts={success:function(){typeof callback=="function"&&callback()}};if(!likeData){likeData=this.registeredLikeUrls.DEFAULT;if(!likeData){R.Logger.debug("We are not attempting to create a like SU because we don't have a default like button configured and we don't have any info for the url: "+url);return}likeData.url_to_like=url,ajax_opts.data=likeData,ajax_opts.content_type="none",R.ajax(this.fb_like_service_url+"register_like_for_url",ajax_opts)}else ajax_opts.data=likeData,R.ajax(this.fb_like_service_url+"register_like",ajax_opts)},recordSend:function(url){var sendData=this.registeredSendUrls[url];if(!sendData)R.ajax(this.fb_like_service_url+"register_send_for_url",{data:{url_to_like:url},content_type:"none"});else{var ajax_options={data:sendData};R.ajax(this.fb_like_service_url+"register_send",ajax_options)}},_waitingGCUCallbacks:[],getCurrentUser:function(callback,context){var self=this;callback=callback?self.bind(callback,context):function(){};if(!self.userIsConnected())throw new Error("getCurrentUser called when the user was not connected.  This function should only be called when FB.getAuthResponse().userID has a value.");if(self.currentUser)return R.Logger.debug("Current user already set - returning..."),callback(self.currentUser),self.currentUser;R.FB._waitingGCUCallbacks.push(callback);if(!self.fetchingCurrentUser){self.currentUser=null,self.fetchingCurrentUser=!0;try{R.Logger.debug("Calling for current facebook user..."),FB.api("/me?fields=name,picture,first_name",function(response){R.Logger.debug("Response from request for current facebook user returned");if(response.name){R.Logger.debug("Current user response valid: "+R.JSON.stringify(response)+"."),self.currentUser=response,self.currentUser.isCurrentUser=!0;while(R.FB._waitingGCUCallbacks.length){var thisCb=R.FB._waitingGCUCallbacks.pop();thisCb(self.currentUser)}}else R.Logger.error("Response from FB.api(/me) was not a user object.  Got: "+R.JSON.stringify(response));self.fetchingCurrentUser=!1})}catch(e){R.Logger.error("Exception thrown while trying to grab current user from FB.api: "+e.message),self.fetchingCurrentUser=!1}}return self.currentUser},getCurrentUserId:function(){return R.FB._.userDeauthorized?0:R.FB._.current_fb_uid},mixin:function(target){target.FB=r$.extend(!0,{},this),target.FB.parent=target},bind:function(callback,context){var self=this;return callback?(context=context||self.parent||R,R.Util.bind(callback,context)):function(){}},parseMultiQueryResults:function(response,query_list){if(response&&(response.error||typeof response.error_code!="undefined")){var msg="FQL Error: "+R.JSON.stringify(response)+" \n\n Queries: "+R.JSON.stringify(query_list);throw R.Logger.error(msg),new R.FB.FqlError(msg)}if(!response||!response.data||!response.data[0]||!response.data[0].fql_result_set)throw new Error("response does not appear to be a FQL multi-query result set");var results={};return R.Util.each(response.data,function(result_set){if(!query_list[result_set.name])throw new Error("Unexpected FQL Result Set: "+result_set.name+"\n"+R.JSON.stringify(result_set));results[result_set.name]=result_set.fql_result_set}),R.Util.each(query_list,function(query,name){if(!results[name])throw new Error("Query missing from FQL results: "+name+"\nQuery: "+query)}),results},getPicUrl:function(uid){return"//graph.facebook.com/"+uid+"/picture"+(R.Util.isSecure()?"?return_ssl_resources=1":"")},deleteAction:function(su_id){var url="rondavu/activitystream/hide_item";R.ajax(url,{data:{id:su_id},success:function(response){if(response.fb_graph_object_id){var graph_object_id=response.fb_graph_object_id;R.FB.api("/"+graph_object_id,function(response){response===!0?R.Logger.debug("Open graph action with ID "+graph_object_id+" has been deleted successfully."):R.Logger.warn("Failed to delete open graph action with ID "+graph_object_id+".")},"delete")}else R.Logger.debug("Su with ID "+su_id+" has become hidden successfully but no open graph ID was returned from the server.");if(response.fb_post_id){var fb_post_id=response.fb_post_id;R.FB.api("/"+fb_post_id,function(response){response===!0?R.Logger.debug("Wall post with ID "+fb_post_id+" has been deleted successfully."):R.Logger.warn("Failed to delete the wall post with ID "+fb_post_id+".")},"delete")}R.ModuleManager.notifyAllModules(new R.Module.Message.SUDeleted({id:su_id}))},failure:function(){R.Logger.debug("Failed to hide action with ID "+su_id+".")}})},isRedirectFromFacebook:function(){var sref=R.Util.getQSParam("SREF"),isRedirect=!1;return R.Util.each(this.constants.ref_params,function(item){sref==item&&(isRedirect=!0)},this),isRedirect}},R.FB.FqlError=function(msg){this.name="FQL Error",this.message=msg},R.FB.FqlError.prototype=new Error,r$.extend(R.FB,{parent:null,XFBML:{parse:function(el){return FB.XFBML.parse(el)}},getAuthResponse:function(){try{return FB.getAuthResponse()}catch(noFb){return R.Logger.info("R.FB.getAuthResponse() called before FB loaded, returning null"),null}},login:function(callback,details,context,skip_perms){var self=this;details=details||{},callback=self.bind(callback,context),details.scope=R.FB.addExtraPerms(details.scope,self.parent);var mo_id=R.PageDataManager.getPrimaryMoId(),params={action:"fb.loginrequest",module:self.parent?self.parent.name:"core",feature_id:self.parent?self.parent.config.feature_id:"core_"+R.Core.config.customer_name,feature_page_id:self.parent?self.parent.config.feature_page_id:"core_"+R.Core.config.customer_name,primary_mo_type:mo_id.type,primary_mo_id:mo_id.id,rdv_cookie:R.StorageManager.getBrowserId()};R.Tracker.s3Log(params);var _handle_FB_response=function(response){response.authResponse&&(R.FB._.userDeauthorized=!1,self.parent&&self.parent.trackEventForPrimaryMo("authorized connect",undefined,{muteS3:!0}),params.action="fb.login",R.Tracker.s3Log(params),skip_perms||self.getPermsFromFacebook(response.authResponse.userID),R.Logger.debug("Loading the current facebook user..."),self.getCurrentUser(),R.Event.fire("fbAuthorized",response.authResponse)),callback(response)};if(!FB.getAuthResponse())return FB.login(_handle_FB_response,details);if(!self.hasPerms(details.scope))return FB.login(_handle_FB_response,details);callback({authResponse:FB.getAuthResponse()})},requestPerms:function(callback,details,context){var self=this;callback=self.bind(callback,context),self.login(function(response){response&&response.authResponse&&(!details||!details.scope?callback():self.getPermsFromFacebook(response.authResponse.userID,function(){self.hasPerms(details.scope)&&callback()}))},details,null,!0)},api:function(path,callback,method,params){var self=this;callback=self.bind(callback,null),R.Logger.debug("Going to the graph for this path: "+path),method?FB.api(path,method,params,callback):FB.api(path,callback)},ui:function(config,callback,context){var self=this,templateAttachment=function(attachment){R.Util.each("name,caption,description",function(section){attachment[section]&&(attachment[section]=this.applyTemplateData(attachment[section]))},self.parent);if(attachment.properties){var new_props={};R.Util.each(attachment.properties,function(val,prop){typeof attachment.properties[prop]=="string"?new_props[this.applyTemplateData(prop)]=this.applyTemplateData(attachment.properties[prop]):typeof attachment.properties[prop]=="object"&&attachment.properties[prop].text?(attachment.properties[prop].text=this.applyTemplateData(attachment.properties[prop].text),new_props[this.applyTemplateData(prop)]=attachment.properties[prop]):new_props[this.applyTemplateData(prop)]=attachment.properties[prop]},self.parent),attachment.properties=new_props}};config.method=="stream.publish"&&(config.attachment&&templateAttachment(config.attachment),config.action_links&&R.Util.each(config.action_links,function(link){link.text=this.applyTemplateData(link.text)},self.parent)),config.method=="feed"&&(templateAttachment(config),config.actions&&R.Util.each(config.actions,function(action){action.name=this.applyTemplateData(action.name)},self.parent)),FB.ui(config,self.bind(callback,context))},getLoginStatus:function(callback,context){var self=this;callback=self.bind(callback,context),R.Event.listen("FB_ready",function(){FB.getLoginStatus(callback)})},storeLoginStatus:function(login_status){login_status=r$.extend(!0,{},login_status);var expires_in=6e5;if(login_status.authResponse){var auth_response=login_status.authResponse;expires_in=auth_response.expiresIn*1e3-1e4}var storage=R.StorageManager;storage.setLocalSessionObject(storage.getFbLoginStatusKey(),login_status,{expires:R.Util.getCurrentTime()+expires_in})},getLoginStatusFromStorage:function(){var storage=R.StorageManager;return storage.getLocalSessionObject(storage.getFbLoginStatusKey())},getLoginStatusFromStorageOrFacebook:function(callback){var self=this,fb_login_status=self.getLoginStatusFromStorage();fb_login_status?(callback(fb_login_status),self.getLoginStatus(function(fb_login_status){self.storeLoginStatus(fb_login_status)})):(R.Logger.debug("FB login status not found in session storage, fetching it from facebook."),self.getLoginStatus(function(fb_login_status){self.storeLoginStatus(fb_login_status),callback(fb_login_status)}))}}),R.Core={DOMReady:!1,privacy_url:"rondavu/privacy/",privacy_loading:!1,pageDataValidatorScriptUrl:"scripts/validator/sociable_validator.min.js",config:{og_primary_mo_enable:!1,default_rondavudata_version:1.2,enabled:!0,customer_name:"",disable_browsers:{},user_load_percentage_start:0,user_load_percentage_end:100,always_load_referred_users:!1,always_load_connected_users:!1,track_throttle_control_group:!1,cdn_data_ttl:43200,cdn:"",cdn_secure:"",realtime:"",easyXDM_url:"",google_analytics_id:null,app_ids:[],customer_timestamp:null,page_data:null,forceNativeJSON:!1,facebook_xd_channel:null,facebook_parse_xfbml:!1,rondavu_js_url:null,rondavu_css_url:null,ab_testing_enabled:!1,evershare_enabled:!1,fblogin_enabled:!1,build_version:"unknown",visitor_id:"unknown",logger_url:""},init:function(config){r$.extend(R.Core.config,config||{}),R.Core.shouldValidate()&&R.Util.loadScript(R.Util.fixUrl(R.Core.getRealtimeUrl(),R.Core.pageDataValidatorScriptUrl),function(){return R.Util.isObject(window.sociable_validator)},function(){R.Base64=Base64,window.sociable_validator.validateRondavuData(RondavuData)},function(){try{R.Logger.error("RondavuData validator failed to load.")}catch(noConsole){}},this,!0);var self=this;self.IS_SHARING_KEY="SL-IS-SHARING-"+self.config.customer_name,r$(document).ready(function(){R.Core.DOMReady=!0}),r$.fn.appendChild=r$.fn.append,self.initPrivateApi(),R.Event.listen("beforeAjax",function(payload){R.Logger.debug("preparing ajax options"),self.prepareAjaxOptions(payload)});var fbiframe=window.location.toString().indexOf("fb_xd_fragment")!==-1;if(fbiframe)return R.FB.init(!0);var watchdog=self._watchdog_timeout=setTimeout(function(){R.Logger.error("r Failed to initialize and load modules within 30 seconds")},3e4),ua=navigator.userAgent.toLowerCase(),mobile=!1,mobile_disabled=!1;(function(a){if(/android.+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))mobile=!0})(navigator.userAgent||navigator.vendor||window.opera);var page_data=R.PageDataManager.getPageData(),page=page_data.page;page&&page.hasOwnProperty("mobile_disabled")&&(mobile_disabled=page_data.page.mobile_disabled),mobile_disabled=mobile&&mobile_disabled;var disable_browsers=R.Core.config.disable_browsers,disable_on_this_browser=!1,browser_map={ff:"mozilla",safari:"webkit",ie:"msie",chrome:"webkit"},chrome=ua.indexOf("Chrome")!=-1;R.Util.each("ie,ff,webkit,chrome",function(key){if(!R.Util.xor(key=="safari",chrome))return;var jq_key=browser_map[key]||key,d=disable_browsers[key],version=r$.browser[jq_key];version&&d&&(d=="all"||R.Util.indexOf(d,version)!=-1)&&(disable_on_this_browser=!0)});var no_cors=typeof (new XMLHttpRequest).withCredentials=="undefined"&&typeof XDomainRequest=="undefined",noDomStorage=!window.localStorage||!window.sessionStorage;if(disable_on_this_browser||!R.Core.config.enabled||no_cors||mobile_disabled||noDomStorage){clearTimeout(watchdog);var old_enabled=R.Core.config.enabled;R.Core.config.enabled=!1;var yes_no=function(flag){return flag?"yes":"no"};R.Logger.debug("Rondavu disabled."),R.Logger.debug("Reason: , browser? "+yes_no(disable_on_this_browser)+", internal property? "+yes_no(!old_enabled)+", no cross-domain AJAX? "+yes_no(no_cors)+", mobile_disabled? "+yes_no(mobile_disabled)+", DOM Storage? "+yes_no(noDomStorage));return}var visitor_id=R.StorageManager.getVisitorId();visitor_id||(visitor_id=R.Core.generateVisitorId(),R.StorageManager.storeVisitorId(visitor_id)),R.Core.config.visitor_id=visitor_id;var throttle=new R.Throttle(R.Core.config,R.StorageManager,R.Tracker,R.Logger);throttle.trackControlGroup(),R.Event.listen("report_browse",function(params){throttle.isThrottlingEnabled()&&throttle.addTrackingParams(params)});if(!throttle.isUserEnabled()){clearTimeout(watchdog),R.Core.config.enabled=!1,R.Logger.debug("Disabled by throttle.");return}R.Tracker.init(),R.Timers.startTimer("overall");if(R.Core.config.build_version!="dev_local"&&R.Core.config.build_version!="dev_mocked"){var cssUrl=R.Core.config.rondavu_css_url;cssUrl&&cssUrl.substring(0,4)!="http"&&cssUrl.substring(0,2)!="//"&&(cssUrl=R.Util.fixUrl(R.Core.getCDNUrl(),cssUrl)),cssUrl&&R.Util.loadStyleSheet(cssUrl)}R.Event.listen("modules_initialized",function(){clearTimeout(watchdog),R.ModuleManager._internal.time_log_params.overall_response_time=R.Timers.stopTimer("overall"),R.Tracker.logToSociableLabsLogger(R.ModuleManager._internal.time_log_params),R.Logger.debug("All Modules initialized"),R.Timers.renameTimer("overall","overall - "+(R.FB.getAuthResponse()?"FB":"Anonymous")),R.Event.fireAndRemember("modules_loaded"),R.Timers.reportTimes(),R.Tracker.reportBrowse(),self.warm_cache()},{once:!0});var skip_FB=R.Core.config.skip_FB=!R.FB.hasCookie();skip_FB&&R.Logger.info("No facebook cookie found, loading logged out view"),R.Core.initApi();var required_for_init=[];!skip_FB&&!R.Core.config.preload_m_init?required_for_init.push("FB_ready"):R.Core.config.preload_m_init&&required_for_init.push("FB_init"),R.Event.listenMultiple(required_for_init,function(){R.ModuleManager.moduleInitServerCall()}),rondavu._.r$=r$,R.FB.init(),R.Event.listen("FB_ready",function(){R.Core.isUserSharing()}),R.Util.handleEarlyScripts(),R.Logger.info("Rondavu initialized"),R.Event.fire("init")},setLocalSharing:function(should_share){var self=this;if(!R.FB.getAuthResponse||!R.FB.getAuthResponse())return;R.StorageManager.deleteLocal("IS-SHARING-"+self.config.customer_name+R.FB.getAuthResponse().userID),R.StorageManager.setLocal(self.IS_SHARING_KEY+R.FB.getAuthResponse().userID,should_share?"1":"0")},getLocalSharing:function(){var self=this;if(!R.FB.getAuthResponse||!R.FB.getAuthResponse())return undefined;var local_sharing_str=R.StorageManager.getLocal(self.IS_SHARING_KEY+R.FB.getAuthResponse().userID);return local_sharing_str===null?undefined:local_sharing_str=="1"},updateUserSharing:function(should_share){var self=this;if(!R.FB.getAuthResponse||!R.FB.getAuthResponse())return;self.setLocalSharing(should_share),R.ajax(self.privacy_url+"update_sharing/",{data:{share_activity:should_share},success:function(){R.Logger.debug("Response received from update_sharing call")}})},isUserSharing:function(callback){var self=this,results_callback=function(data){typeof callback=="function"&&callback(data)},is_sharing=self.getLocalSharing();return typeof is_sharing!="undefined"?(results_callback(is_sharing),is_sharing):!R.FB.getAuthResponse||!R.FB.getAuthResponse()?(results_callback(!1),!1):(self.privacy_loading?R.Event.listen("privacy.loaded",function(data){results_callback(data.is_sharing)}):(self.privacy_loading=!0,R.FB.getLoginStatus(function(res){res.status=="connected"?R.FB.hasPermAsync([R.FB.constants.perm.PUBLISH_ACTIONS],function(hasPerm){if(!hasPerm){self.setLocalSharing(!1),R.Event.fire("privacy.loaded",{is_sharing:!1}),results_callback(!1),self.privacy_loading=!1;return}setTimeout(function(){R.ajax(self.privacy_url+"is_sharing/",{data:{},success:function(response){self.setLocalSharing(response.is_sharing),R.Event.fire("privacy.loaded",response),results_callback(response.is_sharing),self.privacy_loading=!1}})},0)}):(R.Event.fire("privacy.loaded",{is_sharing:!1}),results_callback(!1),self.privacy_loading=!1)})),self.getLocalSharing())},initPrivateApi:function(){var self=this;rondavu._.registerScript=R.Util.bind(R.Util.registerScript,self),rondavu._.initFromCDN=R.Util.bind(R.ModuleManager.initFromCDN,R.ModuleManager),rondavu.disable=R.Util.bind(R.ModuleManager.disable,self)},initApi:function(){var self=this;window.SL={defined:!0,old:window.SL||[],push:function(args){var self=this;if(!args||!args.length)throw new Error("SL.push(['functionName', args...]) called with empty or non-array args");var fn=args.shift();if(!SL[fn]){R.Event.listen("modules_initialized",function(){if(!SL[fn])throw new Error("Function "+fn+" not defined in public API.  Possible configuration error?");SL[fn].apply(self,args)});return}SL[fn].apply(self,args)},onFacebookLogin:function(callback){R.Event.listen("fb.login",function(){R.ajax("/rondavu/fblogin/validate/",{success:function(signed_response){callback(signed_response.data,signed_response.signature)}})})},getFacebookLoginStatus:function(callback){R.FB.userIsConnected()?R.ajax("/rondavu/fblogin/validate/",{success:function(signed_response){callback(signed_response.data,signed_response.signature)}}):callback()},onFacebookLogout:function(callback){R.Event.listen("fb.logout",function(){callback()})},onFacebookStatusChange:function(callback){SL.onFacebookLogin(callback),SL.onFacebookLogout(callback)},onLoad:function(callback){R.Event.listen("modules_initialized",callback)},setStartTime:function(start_time){R.Timers.recordLoadingTime(start_time)},updatePage:function(path,RondavuData){R.Logger.info("SL.updatePage called for path "+path,RondavuData),R.PageDataManager.setPageData(RondavuData),R.PageDataManager.setPath(path);if(!R.ModuleManager.isFirstCallSent()){R.Logger.info("Skipping extra /m/init from updatePage and rolling changes into first /m/init call");return}if(R.ModuleManager.isWaitingOnUpdatePage()&&R.PageDataManager.hasActions()){R.Logger.info("updatePage subsequently called before previous request finished: aborting");return}R.ModuleManager.setWaitingOnUpdatePage(),R.Core.config.skip_FB=!1,R.ModuleManager.resetTimer(),R.ModuleManager.moduleInitServerCall(),R.Tracker.reportBrowse(),R.Tracker.doTracking(),self.warm_cache()}};var call=SL.old.shift();while(call)SL.push(call),call=SL.old.shift();R.Event.fire("api_initialized")},generateVisitorId:function(){return"visitor-"+this.generateRandomToken()},generateVisitId:function(){return"visit-"+this.generateRandomToken()},generateRandomToken:function(){return Math.floor(Math.random()*1e10+1)+"-"+(new Date).getTime()},warm_cache:function(){if(R.ModuleManager.usingCDN()){var rand=Math.floor(Math.random()*101);rand===1?(R.Logger.debug("warming the cache - rand was 1"),R.ajax("rondavu/m/init/cache_warm",{mos_etags:!0})):R.Logger.debug("not warming the cache - rand was "+rand+", warms on 1")}},loading:function(target,alt,image,display_text){alt=alt||"Loading...",display_text=display_text?"<p>"+display_text+"</p>":"",target.innerHTML='<div class="rondavu_loading"><img src="'+R.Util.fixUrl(R.Core.getCDNUrl(),image||"images/loading.gif")+'" title="'+alt+'" alt="'+alt+'" />'+display_text+"</div>"},getCustomerName:function(){return R.Core.config.customer_name.replace(/\W/g,"_")},getCDNUrl:function(){var cdn=R.Core.config.cdn;return R.Util.checkSecure(cdn)?cdn:R.Core.config.cdn_secure},getS3Url:function(){return R.Core.config.cdn_secure.replace("https:","")},getLoggerUrl:function(){return R.Core.config.logger_url},getRealtimeUrl:function(){return R.Util.makeSecure(R.Core.config.realtime)},isQaEnvironment:function(){return R.Core.getRealtimeUrl().indexOf("qa-web.rondavu.com")!==-1},shouldValidate:function(){var override=R.Util.checkOverride("sl_validate"),isQa=R.Core.isQaEnvironment(),isDevLocal=R.Core.config.build_version=="dev_local";return isQa&&override!==!1||isDevLocal&&override!==!1||!isQa&&!isDevLocal&&override}},R.JSON=function(){return typeof Prototype!="undefined"&&typeof Object.toJSON!="undefined"&&!rondavu._.customer_config.forceNativeJSON?{parse:function(st){return st.evalJSON()},stringify:function(obj){return Object.toJSON(obj)}}:window.JSON}(),R.Module=function(){},function(){R.Module.ERR_NO_EL="Target Element Not Found",R.Module.HIDE_IF_SPARSE=0,R.Module.HIDE_IF_NOT_SPARSE=1,R.Module.DONT_HIDE=2,R.Module.SPARSE_CLASS="sl_sparse",R.Module.NOT_SPARSE_CLASS="sl_not_sparse",R.Module.PROFANITY_WARNING_HTML='<div class="sl_profanity_warning">Your comment has been deemed inappropriate and won\'t be published.</div>',R.Module.PROFANITY_WARNING_TEXT="Your comment has been deemed inappropriate and won't be published.",R.Module.prototype={el:undefined,hiddenModeLoaded:!1,api:{},defineApi:function(){},initApi:function(){var self=this;self.defineApi(),!window.SL||!window.SL.defined?R.Event.listen("api_initialized",function(){r$.extend(window.SL,self.api)}):r$.extend(window.SL,self.api)},initializer:function(config){var self=this;R.Logger.info("Initializing module "+this.name),this.config=r$.extend({div:{id:"",location:"",parent:""},html:"",init_data:{stream:{},fb_like_data:[],fb_send_data:[]},id:"",feature_id:"",feature_page_id:"",module_config:{parameters:{}}},config),self.sparseHideBehavior=R.Module.DONT_HIDE,this.config.init_data||(this.config.init_data={stream:{},fb_like_data:[],fb_send_data:[]}),R.FB.mixin(self),R.FB.registerLikeUrls(this.config.init_data.fb_like_data),R.FB.registerSendUrls(this.config.init_data.fb_send_data),self.handleAutopop(function(moduleExists){moduleExists&&(self.getEl(),self.initHtml(),self.initHtmlEvents(),self.notifyOtherModules(new R.Module.Message.Init({js_class:self.name,div:self.config.div.name,module:self})),self.updateSparseClasses(self.config.init_data.is_sparse),self.getBooleanParameter("SparseView.Hiding.Enable")&&(self.getBooleanParameter("SparseView.Hiding.HideIfSparse")?(self.sparseHideBehavior=R.Module.HIDE_IF_SPARSE,self.getEl().addClass("sl_hide_if_sparse")):(self.sparseHideBehavior=R.Module.HIDE_IF_NOT_SPARSE,self.getEl().addClass("sl_hide_if_not_sparse"))),self.trackAttemptedLoad())}),self.initApi()},updateSparseClasses:function(isSparse){if(this.getBooleanParameter("SparseView.Counting.CountActions")){var container=this.getEl().parent(),classToAdd,classToRemove;isSparse?(classToAdd=R.Module.SPARSE_CLASS,classToRemove=R.Module.NOT_SPARSE_CLASS,R.ModuleManager.sparseModuleLoaded=!0):(classToAdd=R.Module.NOT_SPARSE_CLASS,classToRemove=R.Module.SPARSE_CLASS),container.addClass(classToAdd).removeClass(classToRemove)}},initHtml:function(){var el=this.getEl(),div=this.config.div;div.id=el[0].id,R.Logger.debug("setting module html",(""+this.config.html).substr(0,20)+"...");var html=this.applyTemplateData(this.config.html);el.html(html),this.beforeXfbmlParse(),R.FB.XFBML.parse(el[0])},beforeXfbmlParse:function(){var userTracking="",user=R.PageDataManager.getPageData().user;if(user&&user.tracking){R.Util.each(user.tracking,function(userParam){userParam.name&&userParam.value&&(userTracking+="/"+userParam.name+"="+userParam.value)});if(userTracking!==""){var likeParent=this.getEl().find("div.rdv_fblike_wrapper"),fbLike=likeParent.children();fbLike.attr("ref",fbLike.attr("ref")+userTracking)}}},applyTemplateData:function(template){if(!template)return template;var re_find_custom_data_vars=new RegExp("%?{custom_data.([^}]*)}","g"),re_find_primary_mo_vars=new RegExp("%?{primary_mo.([^}]*)}","g"),custom_data_vars=template.match(re_find_custom_data_vars),primary_mo_vars=template.match(re_find_primary_mo_vars);if(!custom_data_vars&&!primary_mo_vars)return template;var pd=R.PageDataManager.getPageData(),custom_data=pd.custom_data||{};return R.Util.each(primary_mo_vars,function(variable){var pieces=variable.replace(re_find_primary_mo_vars,"$1").split("="),key=pieces.shift(),val="";if(key==="name"){var primary_mo=R.PageDataManager.getPrimaryMo();val=R.PageDataManager.getMoName(primary_mo)||pieces.join("=")}else val=pieces.join("=");template=template.replace(R.Util.makeRegExp(variable),val)},this),R.Util.each(custom_data_vars,function(variable){var pieces=variable.replace(re_find_custom_data_vars,"$1").split("="),key=pieces.shift(),val=custom_data[key]||pieces.join("=");template=template.replace(R.Util.makeRegExp(variable),val)},this),template},initHtmlEvents:function(){},dialog_events:null,delegate:function(event_type,callback,selector,options){var optionsDefaults={dialog:!1,logging:!0,is_cta:!1,action:event_type};options=r$.extend({},optionsDefaults,options);if(typeof selector=="undefined")throw"Selector undefined in delegate!";return options.dialog&&(delete options.dialog,this.dialog_events=this.dialog_events||[],this.dialog_events.push(arguments)),this._delegate(this.getEl(),event_type,callback,selector,options)},_delegate:function(target,event_type,callback,selector,options){var self=this;try{return r$(target).on(event_type,selector,function(event){R.Util.bind(function(){try{callback.call(this,event)}catch(innerEx){R.Logger.error("Error firing delegated callback in module "+this.name+" for selector "+selector,innerEx)}if(options.logging){var params={type:"delegate",action:options.action,selector:selector,module:this.name,primary_mo_url:R.PageDataManager.getMoDetailUrl()};R.Tracker.addMosIds(params),options.is_cta&&(params.cta=1,params.href=r$(event.currentTarget).attr("href"),params.text=r$.trim(r$(event.currentTarget).text()),this.trackEvent("CTA Click",params.href||params.text,null,{muteS3:!0})),self.s3Log(params)}},self)()})}catch(ex){R.Logger.error("Error in delegating callback function in module "+this.name+" - selector: "+selector,ex)}},_cleanId:function(id){return"r_"+id.replace(new RegExp("/[^0-9a-z_]/ig"),"_")},handleAutopop:function(cb){var popupBlock=R.StorageManager.getLocal(R.Util.stripSignature(this.config.feature_id)+"_noPop")=="true",unknown=this.getBooleanParameter("Common.RenderMode.Autopop.FBUnknown.Enable"),notConnected=this.getBooleanParameter("Common.RenderMode.Autopop.FBNotConnected.Enable"),connected=this.getBooleanParameter("Common.RenderMode.Autopop.FBConnected.Enable");if(popupBlock||!unknown&&!notConnected&&!connected||this.getParameter("Common.RenderMode")=="inline"){cb.call(this,!0);return}if(this.getParameter("Common.RenderMode")==="hidden"){cb.call(this,!1);return}if(unknown&&notConnected&&connected){this.renderAutopop(),cb.call(this,!0);return}this.FB.getLoginStatus(function(response){response&&(unknown&&response.status=="unknown"||notConnected&&response.status=="not_authorized"||connected&&response.status=="connected")&&this.renderAutopop(),cb.call(this,!0)})},renderAutopop:function(){var container_info=this.config.div,container_id=container_info.name;if(container_info.location=="primary"){var renderMode=this.getParameter("Common.RenderMode");if(renderMode=="popup"||renderMode=="both"){var shadow_el;renderMode=="both"&&(shadow_el=this.getEl(),shadow_el.html(this.config.html),shadow_el.attr("id",shadow_el.attr("id")+"_shadow"));var dialogButtons=this.getBooleanParameter("Common.RenderMode.Autopop.SkipButton.Enable")?[{text:this.getParameter("Common.RenderMode.Autopop.SkipButton.Label")}]:[],dialog=this.dialog({header:this.getParameter("Common.RenderMode.Autopop.Title"),body:"",width:parseInt(this.getContainerWidth(),10)+45,buttons:dialogButtons,import_style:!1,css_class:"rondavu_autopop_container",onClose:function(){renderMode=="both"&&(shadow_el.replaceWith(this.container.children()),this.container=r$("#"+container_id))}});this.container=r$(dialog.get("body")),this.setUpContainerCss(),this.container.append(this.getPop()),setTimeout(R.Util.bind(function(){var popupContainer=this.el.parent();if(renderMode=="both"){shadow_el.html(this.el.html());while(popupContainer[0].children.length>1)shadow_el.parent().append(r$(popupContainer[0].children[1]).remove())}if(this.getBooleanParameter("Common.RenderMode.Autopop.HideMeCheckbox.Enable")){var checkBox=document.createElement("div");checkBox.setAttribute("class","rondavu_disable_checkbox"),checkBox.setAttribute("id","rondavu_disable_checkbox"),checkBox.innerHTML='<input type="checkbox" class="rondavu_checkbox" /><label class="rondavu_label">'+this.getParameter("Common.RenderMode.Autopop.HideMeCheckbox.Label")+"</label>",popupContainer.append(checkBox),popupContainer.delegate("click",R.Util.bind(this.changePopBlock,this),"#rondavu_disable_checkbox .rondavu_checkbox")}dialog.center()},this),0)}}},changePopBlock:function(event){if(event!==null&&event.target!==null){var prefix=R.Util.stripSignature(this.config.feature_id),checkBox=event.target;checkBox[0].checked?R.StorageManager.setLocal(prefix+"_noPop",!0):R.StorageManager.setLocal(prefix+"_noPop",!1)}},getPop:function(){var id=R.Util.stripSignature(this.config.feature_id),el=document.createElement("div");return el.id=this._cleanId(id),this.el=r$(el),this.el.addClass("rondavu_module").addClass("rondavu_"+this.name).addClass(this.getParameter("Common.Layout.CSS")),el},renderHiddenPopup:function(bodyHtml,closeHandler){var dialogButtons=this.getBooleanParameter("Common.RenderMode.Autopop.SkipButton.Enable")?[{text:this.getParameter("Common.RenderMode.Autopop.SkipButton.Label")}]:[],popup=this.dialog({header:this.getParameter("Common.RenderMode.Autopop.Title"),body:bodyHtml,buttons:dialogButtons,import_style:!1,onClose:closeHandler});this.el=r$(popup.get("body")).parent().parent(),this.el.addClass("rondavu_module").addClass("rondavu_"+this.name).addClass(this.getParameter("Common.Layout.CSS")),this.initHtmlEvents(),this.hiddenModeLoaded||(this.notifyOtherModules(new R.Module.Message.Init({js_class:this.name,div:this.config.div.name,module:this})),this.trackLoad(),this.hiddenModeLoaded=!0)},getContainerWidth:function(){return this.getParameter("Common.Layout.Width")},getContainerCssClass:function(){return this.getParameter("Common.Layout.ContainerCSS")},getEl:function(){try{return this.el||this.createEl(),this.el}catch(ex){if(ex==R.Module.ERR_NO_EL)throw ex;R.Logger.error("Error in getting or creating the DIV for "+this.name,ex)}},createEl:function(){var container_info=this.config.div,container_id=container_info&&container_info.name,id=R.Util.stripSignature(this.config.feature_id),el=document.createElement("div");el.id=this._cleanId(id),this.el=r$(el),this.el.addClass("rondavu_module").addClass("rondavu_"+this.name).addClass(this.getParameter("Common.Layout.CSS"));if(container_info.location=="primary"){this.container=r$("#"+container_id);if(!this.container.length&&R.Module.name!=R.Module.Connector.name&&R.Module.name!=R.Module.ConnectDialog.name)throw R.Logger.validator.error("The div id: "+container_id+" expected for feature id: "+this.config.feature_id+" does not exist."),R.Module.ERR_NO_EL;var action=container_info.existing_content.toUpperCase()||"REPLACE";(action!=="REPLACE-UNLESS-NEW-EMPTY"||this.config.html!=="")&&this.setUpContainerCss(),(action=="REPLACE"||action=="REPLACE-UNLESS-NEW-EMPTY"&&this.config.html!=="")&&this.container.html(""),this.container.append(el)}else{var primary=r$("#"+this._cleanId(container_info.primary));if(!primary.length&&R.Module.name!=R.Module.Connector.name&&R.Module.name!=R.Module.ConnectDialog.name)throw R.Logger.validator.error("The div id: "+container_id+" expected for feature id: "+this.config.feature_id+" does not exist."),R.Module.ERR_NO_EL;this.container=primary.parent(),container_info.location=="above"?this.el.insertBefore(primary):container_info.location=="below"?this.el.insertAfter(primary):(this.el.css("float",container_info.location),this.el.css("width","50%"),primary.css("width","49%"),this.el.insertBefore(this.container.find(":first-child")),this.container[0].barrier=document.createElement("div"),this.container.append(this.container[0].barrier),r$(this.container[0].barrier).css("clear","both"))}return this.el},setUpContainerCss:function(){var updateFbCssClasses=R.Util.bind(function(){this.FB.getLoginStatus(function(response){if(response!==null&&response.status){this.container.removeClass("rondavu_fb_connected rondavu_fb_not_authorized rondavu_fb_unknown rondavu_fb_disconnected");var fbStatus="rondavu_fb_"+response.status;this.container.addClass(fbStatus),response.status!="connected"&&this.container.addClass("rondavu_fb_disconnected")}})},this);FB.Event.subscribe("auth.authResponseChange",updateFbCssClasses),updateFbCssClasses(),this.container.addClass("rondavu_container").addClass(this.getContainerCssClass()).addClass("rondavu_"+this.name+"_container"),this.container.css("width",this.getContainerWidth()+"px"),this.container.css("display","block"),r$.browser.msie?this.container.addClass("rondavu_ie"+parseInt(r$.browser.version,10)):r$.browser.mozilla?this.container.addClass("rondavu_mozilla"):r$.browser.webkit&&this.container.addClass("rondavu_webkit"),window.Touch&&this.container.addClass("rondavu_touch")},getIdFromClick:function(e){var href=e.target.href||"#";return href.substr(href.indexOf("#")+1)||"-1"},handleMessage:function(message){R.Logger.debug("Module "+this.name+" in container "+this.getEl().attr("id")+" received message of type "+message.type,message)},notifyOtherModules:function(message){R.ModuleManager.notifyAllModulesExcept(this,message)},trackEvent:function(action,label,value,options){var feature_string=R.Util.stripSignature(this.config.feature_id)+" - "+this.name;return R.Tracker.trackEventProper(feature_string,action,label,value,options)},trackEventForPrimaryMo:function(action,value,options){var mo_string=this.formatMoForTracking(R.PageDataManager.getPrimaryMo());this.trackEvent(action,mo_string,value,options)},trackEventForMoDetail:function(id,type,name,location_name,action,value){var mo_string=this.formatMoStrings(id,type,name,location_name);this.trackEvent(action,mo_string,value)},trackClicks:function(selector,options){options=r$.extend(options||{},{is_cta:!0}),this.delegate("click",function(){},selector,options)},trackAttemptedLoad:function(){this.trackEventForPrimaryMo("load_attempt")},trackLoad:function(){return this.trackEventForPrimaryMo("load")},formatMoForTracking:function(mo){if(!mo)return"";var location_name="";return mo.location&&(location_name=mo.location.name),this.formatMoStrings(mo.id[0].id,mo.id[0].type,R.PageDataManager.getMoName(mo),location_name)},formatMoStrings:function(id,type,name,location_name){var mo_string=id+"-"+type+" "+name;return location_name!==""&&(mo_string+=" "+location_name),mo_string},s3Log:function(params){params=params||{},params.module=this.name,params.feature_id=R.Util.stripSignature(this.config.feature_id),params.feature_page_id=R.Util.stripSignature(this.config.feature_page_id),R.Tracker.s3Log(params)},getParameter:function(param){var params=this.config.module_config.parameters;if(!params.length)return null;for(var i=0,j=params.length;i<j;i++)if(params[i].name===param)return params[i].value;return null},getBooleanParameter:function(param){var val=this.getParameter(param);return val===!0||val===!1?val:val=="true"},getParameterMap:function(){if(this.parameterMap)return this.parameterMap;this.parameterMap={};var params=this.config.module_config.parameters;return R.Util.each(params,function(param){this.parameterMap[param.name]=param.value},this),this.parameterMap},dialog:function(config){var module=this;try{R._opened_dialog&&R._opened_dialog.destroy();var defaults={centered:!0,header:"",body:"",width:480,maxHeight:400,template:this.modalTemplate,zIndex:1e5,scrolling:!0,import_style:!0};config=r$.extend(!0,defaults,config),typeof config.buttons=="undefined"&&(config.buttons=[{text:"Close"}]),config.header||(config.header="");var outer_container=document.createElement("div"),scrim=document.createElement("div");r$(scrim).addClass("rondavu_"+this.name+"_scrim"),R.Util.each(this.getContainerCssClass().split(" "),function(item){item&&r$(scrim).addClass(item+"_scrim")},this),scrim.setAttribute("id","rondavu_scrim"),outer_container.innerHTML=config.template,scrim.appendChild(outer_container),document.body.appendChild(scrim);var container=document.getElementById("rondavu_dialog"),table=document.getElementById("rdv_dialog_table"),header=document.getElementById("rdv_dialog_header"),inner_container=document.getElementById("rondavu_dialog_inner"),body=document.getElementById("rdv_dialog_body"),close=document.getElementById("rdv_dialog_cancel_button");config.height&&(body.style.height=config.height+"px",config.maxHeight=config.height,delete config.height),body.style.maxHeight=config.maxHeight+"px",body.style.overflow=config.scrolling?"auto":"hidden",table.style.width=config.width+"px",config.import_style?r$(container).addClass(this.container.attr("class")):r$(container).addClass("rondavu_container"),config.css_class&&r$(container).addClass(config.css_class),r$(container).addClass("rondavu_"+this.name+"_popup"),config.import_style&&r$(inner_container).addClass(this.getEl().attr("class")),config.no_padding&&(body.style.margin=body.style.padding=0),header.innerHTML=config.header,body.innerHTML=config.body,R.FB.XFBML.parse(body);var overlay={div:outer_container};outer_container.style.position="absolute",R.Util.each("zIndex,width,height",function(key){config[key]&&(outer_container.style[key]=config[key])}),config.onClose&&(config.onClose=R.Util.bind(config.onClose,this)),overlay.destroy=function(source){config.onClose&&config.onClose(overlay,source),R._opened_dialog=module._opened_dialog=null,r$(scrim).remove()},overlay.addClass=function(newClass){r$(container).addClass(newClass)},overlay.removeClass=function(newClass){r$(container).removeClass(newClass)},overlay.center=function(){var viewport=r$(window),o=r$(outer_container),top=(viewport.height()-o.height())/2,left=(viewport.width()-o.width())/2;o.parent().css("position")!="fixed"&&(top+=viewport.scrollTop(),left+=+viewport.scrollLeft()),left<0&&(left=0),top<0&&(top=0),o.css("top",top+"px"),o.css("left",left+"px")},overlay.get=function(key){if(key=="body")return body;if(key==="buttons")return buttons},overlay.set=function(key,val){key=="body"?(typeof val!="string"&&(val=val.innerHTML),body.innerHTML=val):key=="centered"&&this.center()},overlay.owner=this,overlay.delegate=function(event,callback,selector,options){return options&&options.dialog&&delete options.dialog,this.owner._delegate(body,event,callback,selector,options)},R.Util.each(this.dialog_events,function(args){overlay.delegate.apply(overlay,args)},this),close.onclick=R.Util.bind(function(){return overlay.destroy("x"),!1},this);var buttons=document.getElementById("rdv_dialog_buttons");if(config.buttons.length===0)buttons.parentNode.parentNode.removeChild(buttons.parentNode);else for(var i=0;i<config.buttons.length;i++){var btnConf=config.buttons[i];this._addBtn(overlay,buttons,btnConf)}return overlay.center(),R._opened_dialog=module._opened_dialog=overlay,overlay}catch(ex){R.Logger.error("Error rendering dialog for module "+this.name,ex)}},_addBtn:function(overlay,container,btnConf){var btn=document.createElement("input");return btn.type="submit",btn.className="inputbutton "+(btnConf.cssClass||""),btnConf.primary||(btn.className+=" inputaux"),btn.name=btnConf.text,btn.value=btnConf.text,btn.overlay=overlay,btn.module=this,r$(btn).click(function(){var close;if(btnConf.handler)try{close=btnConf.handler.call(btn.module,overlay)}catch(ex){R.Logger.error("Error in "+this.name+" dialog "+btnConf.text+" button handler function",ex)}close!==!1&&overlay.destroy(btn.name)}),r$(container).append(btn),btn},modalTemplate:'<div class="rondavu_resetstyles rondavu_popupContainer" id="rondavu_dialog"><table class="rondavu_pop_dialog_table" id="rdv_dialog_table"><tbody><tr> <td class="rondavu_pop_topleft"></td> <td class="rondavu_pop_border"></td> <td class="rondavu_pop_topright"></td></tr><tr> <td class="rondavu_pop_border"></td> <td id="pop_content" class="rondavu_pop_content">   <div id="rondavu_dialog_inner" class="rondavu_pop_content_container">      <h2 class="rondavu_resetstyles">        <div class="rondavu_dialog_icon"></div>        <span id="rdv_dialog_header" class="rondavu_dialog_header"></span>        <a onclick="return false;" href="#" class="rondavu_dialog_cancel_button" id="rdv_dialog_cancel_button">&nbsp;</a>      </h2>      <div class="rondavu_dialog_content interaction_form pop_content">        <div id="rdv_dialog_body" class="rdv_dialog_content"></div>        <div class="dialog_buttons clearfix"><div class="button_container" id="rdv_dialog_buttons"></div></div>      </div>   </div> </td> <td class="rondavu_pop_border"></td></tr><tr> <td class="rondavu_pop_bottomleft"></td> <td class="rondavu_pop_border"></td> <td class="rondavu_pop_bottomright"></td></tr></tbody></table></div>',closeDialog:function(source){R._opened_dialog&&R._opened_dialog.destroy(source)},tabview:function(c,is_dialog,containers_exist,explicitBodyEl){var self=this;try{var module_el=is_dialog?r$(R._opened_dialog.div):self.getEl(),selector=is_dialog?"dialog":"module",body_el=explicitBodyEl||module_el.find("div.rondavu_"+selector+"_content");self._selected_tab=null,self._tabs={};function _tab_iterator(node){var jqnode=r$(node),id=self.getTabId(node),tab=c[id]||{};delete c[id],tab.tab_el=node,tab.cached=!1,tab.cache=typeof tab.cache!="undefined"?tab.cache:!0;if(containers_exist)tab.content_el=module_el.find(".rondavu_"+id+"_friends_tab_content.rondavu_box")[0],jqnode.hasClass("selected")?(tab.cached=!0,self._selected_tab=id):tab.content_el.style.display="none";else if(jqnode.hasClass("selected")){var box_ynodes=module_el.find("div.rondavu_su_box, div.rondavu_box");tab.content_el=box_ynodes[0],tab.cached=!0,self._selected_tab=id}else tab.content_el=document.createElement("div"),tab.content_el.className="rondavu_su_box",tab.content_el.style.display="none",body_el.appendChild(tab.content_el);tab.content_el.id=self._getTabContentId(id),self._tabs[id]=tab}module_el.find("a.tab").each(function(){var el=this;_tab_iterator.call(self,el)});var target=is_dialog?R._opened_dialog:self;target.delegate("click",self.handleTabClick,"a.tab"),R.Util.each(c,function _config_iterator(val,key){R.Logger.warn('Tab "'+key+'" specified but not found.',val)}),R.Logger.debug("tabview created",self.name)}catch(ex){R.Logger.error("Error creating tabview in module "+this.name,ex)}},handleTabClick:function(event){var id=this.getTabId(event.currentTarget);this.switchTab(id),event.preventDefault()},dialogTabview:function(config){this.tabview(config,!0,!0)},getTabId:function(node){return node?node.id.split("rondavu_tab_").pop():this._selected_tab},_getTabContentId:function(tabId){return"rondavu_tab_"+R.Util.stripSignature(this.config.feature_id)+"_"+tabId},getTab:function(id){return id=id||this._selected_tab,this._tabs[id]},getTabBody:function(id){return this.getTab(id).content_el},switchTab:function(id,skipClickHandler){if(id===this._selected_tab)return;var ctab=this.getTab();ctab.content_el.style.display="none",ctab.cache?ctab.cached=!0:(ctab.content_el.innerHTML="",ctab.cached=!1),r$(ctab.tab_el).removeClass("selected"),this._selected_tab=id;var tab=this.getTab();R.Logger.debug("tab clicked: "+id),r$(tab.tab_el).addClass("selected"),tab.content_el.style.display="";if(typeof tab.click=="function"&&!skipClickHandler)try{tab.click.call(this,tab.content_el,id)}catch(ex){R.Logger.error("Error in tab "+id+" click callback",ex)}this.fire("switchTab",tab)},invalidateTabCache:function(id){id||R.Util.each(this._tabs,function _invalidate_cache_iterator(val,key){key!=this._selected_tab&&this.invalidateTabCache(key)},this);var tab=this._tabs[id];tab.content_el.innerHTML="",tab.content_el.cached=!1},_eventListeners:{},on:function(eventKey,callbackFunction){R.Logger.debug("Adding listener for event "+eventKey+" on module "+this.name),this._eventListeners[eventKey]=this._eventListeners[eventKey]||[],this._eventListeners[eventKey].push(callbackFunction)},fire:function(eventKey,payload){R.Logger.debug("Firing event "+eventKey+" on module "+this.name);var theListeners=this._eventListeners[eventKey];for(var i in theListeners)if(theListeners.hasOwnProperty(i))try{theListeners[i].call(this,payload)}catch(ex){R.Logger.error("Error fireing callback #"+i+" of "+theListeners.length+" for event "+eventKey+" on module "+this.name,ex)}},destroyTabs:function(){this._tabs=null,this._selected_tab=null,this.getEl().off("click","a.tab")},destroy:function(){R.Logger.info("Destroying module "+this.name),this._opened_dialog&&this._opened_dialog.destroy(),this.destroyTabs(),this.el.off(),this.el.remove(),this.config.div.location=="primary"&&this.container.removeClass("rondavu_container"),this.destructor&&this.destructor()},user:{},onFacebookConnect:function(){var self=this;self.initializeSharingStatus()},onFacebookDisconnect:function(){this.user.is_sharing=!1,R.ModuleManager.notifyAllModules(new R.Module.Message.User.SharingStatusChanged)},clearAndDisconnect:function(){this.ajax("rondavu/privacy/disconnect",{success:function(){R.Event.fire("fb.deauthorize")}})},initializeSharingStatus:function(){var self=this;if(R.Core.suppress_social_check)return;R.Core.isUserSharing(function(is_sharing){self.user.is_sharing=is_sharing,self.setSharingClass(),R.ModuleManager.notifyAllModules(new R.Module.Message.User.SharingStatusChanged)})},handleSharingToggleClick:function(e){var self=this;e.preventDefault(),R.Core.suppress_social_check=!0,this.FB.login(function(res){res.authResponse?(self.user.is_sharing=!self.user.is_sharing,self.setSharingClass(),R.ModuleManager.notifyAllModules(new R.Module.Message.User.SharingStatusChanged),R.Core.updateUserSharing(self.user.is_sharing),setTimeout(function(){R.Core.suppress_social_check=!1},0)):R.Core.suppress_social_check=!1},{scope:R.FB.constants.perm.PUBLISH_ACTIONS})},setSharingClass:function(){this.el.toggleClass("sl_sharing_on",this.user.is_sharing),this.el.toggleClass("sl_sharing_off",!this.user.is_sharing)},updateConnectedStatus:function(){var self=this;self.FB.getLoginStatus(function(response){response.status==="connected"?self.onFacebookConnect():self.onFacebookDisconnect()})},ajax:function(url,options){var self=this;options=options||{},options.data=options.data||{},options.data.rdv_feature_id=self.config.feature_id,options.data.feature_page_id=self.config.feature_page_id,options.data.visitor_id=R.Core.config.visitor_id,options.context=this;var success=options.success;options.success=function(response){try{options.content_type=="HTML"&&(response=self.applyTemplateData(response)),success&&success.call(self,response)}catch(ex){R.Logger.error("Error in ajax callback for "+url+" in module "+this.name+" : "+this.feature_id,ex)}},R.ajax(url,options)},load:function(url,target,options){options=options||{},options._success=options.success,options.content_type=options.content_type||"HTML",typeof target=="string"&&(target=document.getElementById(target)),options.loading_animation&&R.Core.loading(target),options.success=function(html){if(html.indexOf("Jetty")!=-1){R.Logger.error("Data returned from RT server looks bad",html),R.ajax.ajaxFailure(options);return}target.innerHTML=html,R.FB.XFBML.parse(target),options._success&&options._success.call(options.context,html)},this.ajax(url,options)}}}(),function(){R.Module.Message=function(config,required_configs){this.type=this.type||"message",config=config||{},required_configs=required_configs||[];for(var i=0;i<required_configs.length;i++){var c=required_configs[i];if(!(c in config))throw"Missing required configuration attribute "+c+' in message type "'+this.type+'"'}for(var p in config)config.hasOwnProperty(p)&&(this[p]=config[p]);this.hasOwnProperty("toString")||(this.toString=function(){var str="Message: "+this.type;if(config)try{str+=" config: "+R.JSON.stringify(config)}catch(JSONFail){}return str})},R.Logger.debug("<<<<<<<<     defined module message    >>>>>>>>>>"),R.Module.Message.FB={},R.Module.Message.FB.Login=function(config){this.type="fb.login",R.Module.Message.call(this,config,["status","authResponse"])},R.Module.Message.FB.Logout=function(config){this.type="fb.logout",R.Module.Message.call(this,config)},R.Module.Message.FB.Like=function(config){this.type="fb.like",R.Module.Message.call(this,config)},R.Module.Message.FB.Send=function(config){this.type="fb.send",R.Module.Message.call(this,config)},R.Module.Message.FB.NewConnect=function(config){this.type="fb.new.connect",R.Module.Message.call(this,config)},R.Module.Message.SUCreated=function(config){this.type="su.created",R.Module.Message.call(this,config)},R.Module.Message.SUUpdated=function(config){this.type="su.updated",R.Module.Message.call(this,config)},R.Module.Message.SUDeleted=function(config){this.type="su.deleted",R.Module.Message.call(this,config)},R.Module.Message.SUCreationComplete=function(config){this.type="su.creation.complete",R.Module.Message.call(this,config)},R.Module.Message.OGActionCreated=function(config){this.type="og.action.created",R.Module.Message.call(this,config)},R.Module.Message.Init=function(config){this.type="module.init",R.Module.Message.call(this,config,["js_class","div","module"])},R.Module.Message.AjaxFailure=function(config){config.server=config.server||"realtime",this.type="failure."+config.server,R.Module.Message.call(this,config,["server","url"])},R.Module.Message.RequestInviteDialog=function(config){this.type="module.requestInviteDialog",R.Module.Message.call(this,config)},R.Module.Message.ShowModuleStreamPublish=function(config){this.type="module.streamPublish",R.Module.Message.call(this,config,["feedStory","actionText"])},R.Module.Message.StreamPublishCompleted=function(config){this.type="module.streamPublish.completed",R.Module.Message.call(this,config,["shared"])},R.Module.Message.User={},R.Module.Message.User.SharingStatusChanged=function(config){this.type="user.sharingStatusChanged",R.Module.Message.call(this,config)},R.Module.Message.User.DismissEverShareWarningSettingChanged=function(config){this.type="user.dismissEverShareWarningSettingChanged",R.Module.Message.call(this,config)}}(),R.Module.ConnectDialog=function(config){R.Module.prototype.initializer.call(this,config),this.initializer(config)},function(){R.Module.ConnectDialog.prototype=new R.Module,r$.extend(R.Module.ConnectDialog.prototype,{name:"ConnectDialog",prompt_to_connect_postfix:"prompt_to_connect",defineApi:function(){var self=this;self.api={showSocialUpsellDialog:function(options){options=options||{};var modal="modal",new_visit="new_visit",dialog_param_prefix="ConnectDialog";options.mode==new_visit&&(dialog_param_prefix="ConnectDialog.NewVisit");var dialog_opts={header:self.getParameter(dialog_param_prefix+".Header"),prompt:self.getParameter(dialog_param_prefix+".Prompt"),ok_text:self.getParameter(dialog_param_prefix+".OkText"),cancel_text:self.getParameter(dialog_param_prefix+".CancelText"),on_connect:options.on_connect||function(){},on_cancel:options.on_cancel||function(){},mode:options.mode||"",position_selector:options.position_selector||""},dialog_mask="<div id='sl_dlg_mask'></div>",dialog_html='<div id="sl_dlg" class="'+dialog_opts.mode+'">'+'<div class="up_arrow_container">'+'<span class="up_arrow"></span>'+'<span class="up_arrow inner"></span>'+"</div>"+'<div class="sl_dlg_body">'+'<div class="sl_dlg_close_link sl_dlg_close">close[x]</div>'+'<div class="sl_dlg_header">'+'<h1 class="sl_dlg_header_text">'+dialog_opts.header+"</h1>"+"</div>"+'<div class="sl_dlg_prompt">'+'<span class="sl_dlg_prompt_text">'+dialog_opts.prompt+"</span>"+"</div>"+'<div class="sl_dlg_buttongroup">'+'<a class="sl_dlg_button sl_dlg_ok_button" href="#">'+dialog_opts.ok_text+"</a>"+'<a class="sl_dlg_button sl_dlg_cancel_button sl_dlg_close" href="#">'+dialog_opts.cancel_text+"</a>"+"</div>"+"</div>"+"</div>",$dialog=r$(dialog_html),$dialog_mask=r$(dialog_mask);r$(".sl_dlg_ok_button",$dialog).click(function(event){event.preventDefault(),self.FB.requestPerms(function(response){dialog_opts.on_connect(response)}),R.Tracker.s3Log({click:"connect"}),$dialog.remove(),$dialog_mask.remove()}),r$(".sl_dlg_close",$dialog).click(function(event){event.preventDefault(),R.Tracker.s3Log({click:"cancel"}),$dialog.remove(),$dialog_mask.remove(),dialog_opts.on_cancel(),dialog_opts.mode==new_visit&&self.setNextNewVisitConnectDialog({dismissed:!0})}),dialog_opts.mode==modal&&$dialog_mask.appendTo("body"),$dialog.appendTo("body"),dialog_opts.mode==new_visit&&self.placeAndShowNewVisitConnectDialog(dialog_opts.position_selector)}}},initializer:function(){window.rondavu.connectDialog=this,this.FB.getLoginStatus(function(res){res.status!="connected"&&(this.checkToShowFBShareModalDialog()||this.checkToShowNewVisitConnectDialog())})},checkToShowFBShareModalDialog:function(){var always_show_modal_dialog_from_FB_redirect=this.getBooleanParameter("ConnectDialog.AlwaysShowModalDialogFromFBRedirect"),is_redirect_from_fb=R.FB.isRedirectFromFacebook();return is_redirect_from_fb&&always_show_modal_dialog_from_FB_redirect?(window.rondavu.connectDialog.api.showSocialUpsellDialog({mode:"modal"}),!0):!1},initHtmlEvents:function(){},handleMessage:function(message){message.type==="fb.login"&&this.removeNewVisitConnectDialog()},_getNewVisitConnectDialog:function(){return r$("#sl_dlg.new_visit")},placeAndShowNewVisitConnectDialog:function(position_selector){var $new_visit_dialog=this._getNewVisitConnectDialog();if($new_visit_dialog.size()){if(position_selector){var position_element=r$(position_selector);if(position_element.size()){var left=position_element.offset().left,top=position_element.offset().top+20;$new_visit_dialog.css("position","absolute"),$new_visit_dialog.css("left",left),$new_visit_dialog.css("top",top),$new_visit_dialog.find(".up_arrow_container").show(),$new_visit_dialog.addClass("positioned")}}$new_visit_dialog.show(),this.setNextNewVisitConnectDialog({dismissed:!1})}},removeNewVisitConnectDialog:function(){this._getNewVisitConnectDialog().remove()},handleHTML:function(){},checkToShowNewVisitConnectDialog:function(){var new_visit_connect_dialog_enabled=this.getBooleanParameter("ConnectDialog.NewVisit.DialogEnabled"),position_selector=this.getParameter("ConnectDialog.NewVisit.PositionSelector"),current_date=(new Date).getTime(),next_new_visit_connect_dialog_date=this.getNextNewVisitConnectDialogDate();return new_visit_connect_dialog_enabled&&current_date>next_new_visit_connect_dialog_date?(window.rondavu.connectDialog.api.showSocialUpsellDialog({mode:"new_visit",position_selector:position_selector}),!0):!1},setNextNewVisitConnectDialog:function(options){var current_date=(new Date).getTime(),delay_to_next_prompt=parseFloat(this.getParameter("ConnectDialog.NewVisit.DialogNotDismissedExpiration"))*36e5;options&&options.dismissed&&(delay_to_next_prompt=parseFloat(this.getParameter("ConnectDialog.NewVisit.DialogDismissedExpiration"))*864e5);var next_prompt_date=current_date+delay_to_next_prompt,visit_key=R.StorageManager.getVisitKey(),prompt_to_connect_key=visit_key+this.prompt_to_connect_postfix;R.StorageManager.setLocalObject(prompt_to_connect_key,next_prompt_date)},getNextNewVisitConnectDialogDate:function(){var visit_key=R.StorageManager.getVisitKey(),prompt_to_connect_key=visit_key+this.prompt_to_connect_postfix;return R.StorageManager.getLocalObject(prompt_to_connect_key)}})}(),R.Module.TargetedInvite=function(config){R.Module.prototype.initializer.call(this,config),this.initializer(config)},function(){function Friend(friend_info,render_options){this.uid=null,this.divs={},this.jqdivs={},this.matches=[],this.update(friend_info,render_options)}R.Module.TargetedInvite.Friend=Friend;var fp=Friend.prototype;Friend.states={ACTIVE:"rondavu_active",NOT_INVITED:"rondavu_not_invited",INVITED_TODAY:"rondavu_invited",INVITED_BEFORE_TODAY:"rondavu_invited_before_today"},fp.setRenderOptions=function(opts){opts.blacklist_everything=opts.blacklist_terms=="*",opts.blacklist_regex=null,opts.blacklist_terms&&!opts.blacklist_everything&&(opts.blacklist_terms=opts.blacklist_terms.replace(/\\\/\(\)\[\]\$\^\{\}\.\?\+/g,"\\$1").replace("*",".*"),opts.blacklist_regex=new RegExp(R.Util.listToArray(opts.blacklist_terms).join("|"),"i")),this.render_options=opts},fp.invited_state=Friend.states.NOT_INVITED,fp.is_active=!1,fp.name="",fp.pic_square="",fp.score=0,fp.best_score=0,fp.display_invited_at="",fp.update=function(friend_data,render_options){R.Util.each(friend_data,function(value,prop){value&&(this[prop]=value)},this),this.setRenderOptions(render_options)},fp.getDiv=function(section){return r$.browser.msie&&this.divs[section]&&(delete this.divs[section],delete this.jqdivs[section]),this.divs[section]||this._render(section)},fp._render=function(section){var is_secure=window.location.protocol=="https:",pic_url;is_secure&&this.pic_square.substr(0,5)!="https"?pic_url="https://graph.facebook.com/"+this.uid+"/picture?return_ssl_resources=1":pic_url=this.pic_square;var div=document.createElement("div");return div.className="rondavu_friend "+this.invited_state+" rondavu_score_"+this.score,div.id="rondavu_friend_"+section+"_"+this.uid,div.setAttribute("data-fbuid",this.uid),div.innerHTML='<span class="rondavu_corner rondavu_corner_tl"></span><span class="rondavu_corner rondavu_corner_tr"></span><img alt="'+this.name+'" src="'+pic_url+'" />'+'<div class="rondavu_matches"></div>'+'<div class="rondavu_action"></div>'+'<span class="rondavu_corner rondavu_corner_bl"></span><span class="rondavu_corner rondavu_corner_br"></span>',this.divs[section]=div,this.jqdivs[section]=r$(div),this._renderUserAction(this.jqdivs[section],this.computeUserActionHtml()),this._renderMatch(this.jqdivs[section],this._getBestMatch()),this.setIsActive(this.is_active),div},fp._renderMatch=function(jqdiv,match){var template,info_string;if(this.invited_state!==Friend.states.NOT_INVITED&&this.render_options.show_invited_time){template=this.render_options.invited_template,info_string=template.replace("{name}",'<span class="rondavu_friend_name">'+this.name+"</span>").replace("{messaged_time}",this.display_invited_at),r$(".rondavu_matches",jqdiv).html(info_string);return}var opts=this.render_options,fieldActionTextMap={Work_History:opts.work_action,Education:opts.education_action};template=match.text?opts.match_template:opts.non_match_template;var action=match.text?fieldActionTextMap[match.field_name]||opts.like_action:"";info_string=template.replace("{name}",'<span class="rondavu_friend_name">'+this.name+"</span>").replace("{action}",action).replace("{item}",match.text),r$(".rondavu_matches",jqdiv).html(info_string),jqdiv.data("match",match.text)},fp._updateScores=function(){R.Util.each(this.divs,function(div){div.className=div.className.replace(/rondavu_score_\d+/g,"")+" rondavu_score_"+this.score},this)},fp._getBestMatch=function(){var opts=this.render_options,display_matches=[];R.Util.each(this.matches,function(match){opts.blacklist_everything?opts.blacklist_replace&&display_matches.push({text:opts.blacklist_replace,field_name:match.field_name,blacklisted:!0}):(opts.blacklist_regex&&(opts.blacklist_regex.lastIndex=0),opts.blacklist_terms&&opts.blacklist_regex.test(match.text)?opts.blacklist_replace&&display_matches.push({text:opts.blacklist_replace,field_name:match.field_name,blacklisted:!0}):display_matches.push(match))},this);var item=display_matches.length?display_matches[0]:null;return item&&item.blacklisted&&R.Util.each(display_matches,function(match){if(!match.blacklisted)return item=match,!1}),item?item:{text:"",field_name:""}},fp._updateMatches=function(){if(this.invited_state!==Friend.states.NOT_INVITED&&this.render_options.show_invited_time){R.Util.each(this.jqdivs,function(jqdiv){this._renderMatch(jqdiv)},this);return}var match=this._getBestMatch();R.Util.each(this.jqdivs,function(jqdiv){jqdiv.data("match")!=match.text&&this._renderMatch(jqdiv,match)},this)},fp._renderUserAction=function(jqdiv,user_action_html){jqdiv.find(".rondavu_action").html(user_action_html)},fp._updateUserActions=function(){var user_action_html=this.computeUserActionHtml();R.Util.each(this.jqdivs,function(jqdiv){this._renderUserAction(jqdiv,user_action_html)},this)},fp.computeUserActionHtml=function(){var show_invited_time=this.render_options.show_invited_time,treat_invited_before_today_as_not_invited=!show_invited_time,user_action_html;return this.invited_state===Friend.states.NOT_INVITED||this.invited_state===Friend.states.INVITED_BEFORE_TODAY&&treat_invited_before_today_as_not_invited?user_action_html=this.render_options.invite_button_html:this.invited_state===Friend.states.INVITED_BEFORE_TODAY&&!treat_invited_before_today_as_not_invited?user_action_html=this.render_options.invite_again_button_html:user_action_html=this.render_options.already_invited_text,user_action_html},fp.setInvitedState=function(state){R.Util.each(this.jqdivs,function(div){var invited_states=[Friend.states.INVITED_TODAY,Friend.states.INVITED_BEFORE_TODAY,Friend.states.NOT_INVITED];div.removeClass(invited_states.join(" ")).addClass(state)},this),this.invited_state=state,state!=Friend.states.NOT_INVITED&&this.setIsActive(!1)},fp.setIsActive=function(is_active){R.Util.each(this.jqdivs,function(div){div.toggleClass(Friend.states.ACTIVE,is_active)},this),this.is_active=is_active},fp.addScore=function(score){this.score+=score},fp.addMatch=function(text,score,field_name,keyword){this.score+=score,this.matches.push({field_name:field_name,keyword:keyword,text:text}),this._updateMatches(),this._updateScores()},fp.addBestScore=function(score){this.best_score+=score},fp.show=function(){R.Util.each(this.jqdivs,function(ydiv){ydiv.removeClass("rondavu_hideme")},this)},fp.hide=function(){R.Util.each(this.jqdivs,function(ydiv){ydiv.addClass("rondavu_hideme")},this)}}(),function(){var MATCH_PARAM_PREFIX="TargetedInvite.Match.Parameters.";R.Module.TargetedInvite.prototype=new R.Module;var Friend=R.Module.TargetedInvite.Friend,templates;r$.extend(R.Module.TargetedInvite.prototype,{Friend:Friend,name:"targetedinvite",base_url:"rondavu/targetedinvite/",action:"",get_new_html:"get_new_html",DEFAULT_FRIEND_CRITERIA:"uid IN (SELECT uid2 FROM friend WHERE uid1 = me())",tabNames:{all:"all",best:"best",recommended:"recommended"},tab_configuration:{},best_friends_scope:R.FB.constants.perm.USER_PHOTOS+","+R.FB.constants.perm.FRIENDS_PHOTOS+","+R.FB.constants.perm.READ_STREAM,multiSelectLimit:0,defineTabs:function(){var self=this;self.showAllTab&&(self.tab_configuration.all={cache:!0,click:function(){self.selectedTab=self.tabNames.all,R.Core.loading(self.all_friends_container,null,self.getParameter("TargetedInvite.List.Loading.Image"),self.getParameter("TargetedInvite.List.Loading.Text")),self.all_friends?self.listFriends(self.all_friends,self.all_friends_container):self.loadAllFriends()}}),this.showBestTab&&(this.tab_configuration.best={cache:!0,click:function(){self.selectedTab=self.tabNames.best,R.Core.loading(self.best_friends_container,null,self.getParameter("TargetedInvite.List.Loading.Image"),self.getParameter("TargetedInvite.List.Loading.Text")),self.FB.requestPerms(function(){self.displayBestFriends()},{scope:self.best_friends_scope})}}),this.showRecommendedTab&&(this.tab_configuration.recommended={cache:!0,click:function(){self.selectedTab=self.tabNames.recommended,R.Core.loading(self.recommended_friends_container,null,self.getParameter("TargetedInvite.List.Loading.Image"),self.getParameter("TargetedInvite.List.Loading.Text")),self.recommended_friends_to_display.length?(self.listFriends(self.recommended_friends_to_display,self.recommended_friends_container),self.recommendedLoaded=!0):self.loadRecommendedFriends()}})},displayBestFriends:function(){this.best_friends_to_display.length?(this.listFriends(this.best_friends_to_display,this.best_friends_container),this.bestLoaded=!0):this.loadBestFriends()},FB_perms:null,initializer:function(){var self=this;templates=R.Module.TargetedInvite.templates,this.filter_min_age=parseInt(this.getParameter("TargetedInvite.Match.Parameters.MinRequiredAgeFilter"),10),this.filter_max_age=parseInt(this.getParameter("TargetedInvite.Match.Parameters.MaxRequiredAgeFilter"),10),this.recommendedLoaded=!1,this.allLoaded=!1,this.bestLoaded=!1,this.photosLoaded=!1,this.streamLoaded=!1,this.isMultiSelect=this.getBooleanParameter("TargetedInvite.MultiSelect.Enable")||this.friendTaggingMode,this.msLimitText=this.getParameter("TargetedInvite.MultiSelect.Limit.Text"),this.enableProgressBar=this.getBooleanParameter("TargetedInvite.MultiSelect.Limit.ProgressBar.Enable");if(this.friendTaggingMode)this.clientSideRender(self.config.init_data),this.multiSelectLimit=this.MULTI_SELECT_LIMIT_TAG,this.FB_perms="";else{this.multiSelectLimit=this.MULTI_SELECT_LIMIT_POST;var perms=[];(this.getParameter(MATCH_PARAM_PREFIX+"Likes.PageIds")||this.getBooleanParameter(MATCH_PARAM_PREFIX+"Likes.UsePrimaryMoName"))&&perms.push(R.FB.constants.perm.FRIENDS_LIKES),(this.filter_min_age||this.filter_max_age)&&perms.push(R.FB.constants.perm.FRIENDS_BIRTHDAY),R.Util.each(this.getTargetedUserFields(),function(options,field_name){options.perms&&this.getParameter(MATCH_PARAM_PREFIX+field_name+".Keywords")&&(perms=perms.concat(options.perms))},this);var userMatchScoringStr=this.getParameter("TargetedInvite.UserMatch.Fields");R.Logger.debug("Retrieved parameter value for TargetedInvite.UserMatch.Fields... got: "+userMatchScoringStr),this.userMatchScoring=null,this.fb_perm_map={education:[R.FB.constants.perm.USER_EDUCATION_HISTORY,R.FB.constants.perm.FRIENDS_EDUCATION_HISTORY],work:[R.FB.constants.perm.USER_WORK_HISTORY,R.FB.constants.perm.FRIENDS_WORK_HISTORY]};if(userMatchScoringStr)try{this.userMatchScoring=R.JSON.parse(userMatchScoringStr),R.Logger.debug("Successfully set user match scoring");for(var field in this.userMatchScoring)if(this.userMatchScoring.hasOwnProperty(field)){var these_perms=this.fb_perm_map[field];these_perms&&r$.isArray(these_perms)&&(perms=perms.concat(these_perms),R.Logger.debug("Because of user match scoring, FB perms are now: "+this.FB_perms))}}catch(e){R.Logger.error("Unable to parse user field matches: "+userMatchScoringStr+".  Possible configuration error!  Error was: "+e.message)}this.defaultTab==this.tabNames.best&&perms.push(this.best_friends_scope),this.FB_perms=perms.join(","),this.defineTabs(),this.FB.getLoginStatus(function(res){var cta,facepile;res.status=="unknown"?(this.getBooleanParameter("TargetedInvite.FacePile.Show.Unknown")&&(facepile=this.el.find(".rondavu_face_pile")),cta=this.el.find(".rondavu_cta_unknown")):res.status=="not_authorized"?(this.getBooleanParameter("TargetedInvite.FacePile.Show.FBNotConnected")&&(facepile=this.el.find(".rondavu_face_pile")),cta=this.el.find(".rondavu_cta_fb_not_connected")):res.status=="connected"&&(this.FB.hasPerms(this.FB_perms)&&!this.isPopup?this.setupFriendsContainer():this.el.find(".rondavu_inviters_list").removeClass("rondavu_hideme"),this.FB.hasPerms(this.FB_perms)&&this.getBooleanParameter("TargetedInvite.AutoClick.FBConnected.Enable")===!0&&this.isPopup&&(this.setupFriendsContainer(),this.trackEventForPrimaryMo("connected auto-click"))),cta&&cta.length&&cta.removeClass("rondavu_hideme"),facepile&&facepile.length&&facepile.removeClass("rondavu_hideme")})}var tim="TargetedInvite.Match.";this.render_options={match_template:this.getParameter(tim+"Text"),non_match_template:this.getParameter("TargetedInvite.NonMatch.Text"),invited_template:this.getParameter("TargetedInvite.Messaged.Text"),like_action:this.getParameter(tim+"Action.Like.Text"),work_action:this.getParameter(tim+"Action.Work.Text"),education_action:this.getParameter(tim+"Action.Education.Text"),blacklist_terms:this.getParameter(tim+"Blacklist.Terms"),blacklist_replace:this.getParameter(tim+"Blacklist.ReplacementText"),already_invited_text:this.getParameter(tim+"Messaged.Text")||"",invite_button_html:this.button("TargetedInvite.Match.MessageButton"),invite_again_button_html:this.button("TargetedInvite.Messaged.MessageButton"),show_invited_time:this.getBooleanParameter("TargetedInvite.Messaged.ShowMessagedTime")},this.on("allFriendsLoaded",function(){var search=r$(".rondavu_search",r$(this.all_friends_container).parent().parent());search&&(search.removeAttr("disabled"),search.removeClass("rondavu_disabled"))}),this.on("switchTab",this.clearSearch),this.on("friendInvited",this.clearSearch),this.on("friendsInvited",this.clearSearch)},MULTI_SELECT_LIMIT_POST:25,MULTI_SELECT_LIMIT_TAG:10,initHtmlEvents:function(){var self=this;this.friendTaggingMode=this.getBooleanParameter("TargetedInvite.FriendTagging.Enable"),this.isPopup=this.friendTaggingMode||this.getBooleanParameter("TargetedInvite.ShowFriendsListInPopup"),this.showRecommendedTab=this.getBooleanParameter("TargetedInvite.Tab.Recommended.Enable")&&!this.friendTaggingMode,this.showBestTab=this.getBooleanParameter("TargetedInvite.Tab.Best.Enable")&&!this.friendTaggingMode,this.showAllTab=this.getBooleanParameter("TargetedInvite.Tab.All.Enable")||this.friendTaggingMode,this.showTabButtons=!this.friendTaggingMode&&this.showAllTab&&this.showRecommendedTab||this.showAllTab&&this.showBestTab||this.showBestTab&&this.showRecommendedTab,!this.isPopup&&this.showTabButtons&&(this.defineTabs(),this.tabview(this.tab_configuration,!1,!0)),this.defaultTab=this.getParameter("TargetedInvite.Tab.All.DefaultTab").toLowerCase(),this.defaultTab||(this.showAllTab?this.defaultTab=this.tabNames.all:this.defaultTab=this.tabNames.recommended),this.friendTaggingMode&&(this.defaultTab=this.tabNames.all),this.delegate("click",this.handleConnectClick,".rondavu_connect",{is_cta:!0});var css_selector="."+self.Friend.states.NOT_INVITED+", ."+self.Friend.states.INVITED_BEFORE_TODAY;this.delegate("click",this.handleFriendClick,css_selector,{dialog:!0}),this.delegate("keyup",this.searchFriends,".rondavu_search",{dialog:!0,logging:!1}),this.delegate("focus",function(e){r$(e.currentTarget).removeClass("rondavu_default_text"),r$(e.currentTarget).val()==this.getParameter("TargetedInvite.Search.DefaultText")&&r$(e.currentTarget).val("")},".rondavu_search",{dialog:!0}),this.delegate("click",this.handleMultiInviteClick,".rdv_multi_select_invite",{dialog:!0}),this.friendTaggingMode&&this.delegate("click",function(e){var taggedNameElement=r$(e.currentTarget).parent(),uid=taggedNameElement.data("fb-uid");this.all_friends_by_id[uid].setIsActive(!1),this.all_friends_by_id[uid].setInvitedState(self.Friend.states.NOT_INVITED),this.getFriendStateCount([self.Friend.states.ACTIVE])===0&&taggedNameElement.closest(".rondavu_multi_share").find("input").first().addClass("rondavu_disabled").attr("disabled","disabled"),taggedNameElement.remove()},".sl_untag",{dialog:!0})},handleConnectClick:function(){var self=this;self.trackEventForPrimaryMo("clicked connect button"),self.FB.login(function(response){if(response.authResponse){var uid=response.authResponse.userID;(self.filter_min_age||self.filter_max_age)&&!self.FB.hasPerms(R.FB.constants.perm.FRIENDS_BIRTHDAY)?self.FB.getPermsFromFacebook(uid,function(){self.FB.hasPerms(R.FB.constants.perm.FRIENDS_BIRTHDAY)&&(self.setupFriendsContainer(),self.trackEventForPrimaryMo("authorized FB"))}):(self.setupFriendsContainer(),self.trackEventForPrimaryMo("authorized FB"))}},{scope:self.FB_perms},null,!0)},setupFriendsContainer:function(){var tabToLoad=this.defaultTab;this.selectedTab?tabToLoad=this.selectedTab:this.selectedTab=this.defaultTab,this.popup=null,this.recommended_friends_container=null,this.all_friends_container=null,this.best_friends_container=null,this.stage=null;if(this.isPopup){this.popup=this.dialog({header:this.applyTemplateData(this.getParameter("TargetedInvite.List.Title.Text")),body:"",width:760,zIndex:1e3,onClose:function(){this.timeout&&clearTimeout(this.timeout),this.multiselect_button_rendered=!1}});var popupBody=this.popup.get("body"),bodyHTML="";this.stage=popupBody,this.showAllTab&&this.getBooleanParameter("TargetedInvite.Search.Enable")&&(bodyHTML+='<div class="rondavu_search_container'+(this.showTabButtons?" rondavu_with_tabs":"")+'">'+'<input type="text" class="rondavu_search rondavu_default_text '+(this.allLoaded?' "':' rondavu_disabled" disabled="disabled"')+' value="'+this.getParameter("TargetedInvite.Search.DefaultText")+'"'+' placeholder="'+this.getParameter("TargetedInvite.Search.DefaultText")+'"'+" /></div>");if(this.showTabButtons){var friendTabIcon=this.getParameter("TargetedInvite.Tab.Recommended.Icon"),allFriendsTabIcon=this.getParameter("TargetedInvite.Tab.All.Icon"),bestFriendsTabIcon=this.getParameter("TargetedInvite.Tab.Best.Icon"),friendsTabImg=friendTabIcon!==""?'<img src="'+R.Util.fixUrl(R.Core.getCDNUrl(),"SFS"+friendTabIcon)+'" class="rondavu_icon" /> ':"",allFriendsTabImg=allFriendsTabIcon!==""?'<img src="'+R.Util.fixUrl(R.Core.getCDNUrl(),"SFS"+allFriendsTabIcon)+'" class="rondavu_icon" /> ':"",bestFriendsTabImg=bestFriendsTabIcon!==""?'<img src="'+R.Util.fixUrl(R.Core.getCDNUrl(),"SFS"+bestFriendsTabIcon)+'" class="rondavu_icon" /> ':"",allSelected=tabToLoad==this.tabNames.all?" selected":"",recommendedSelected=tabToLoad==this.tabNames.recommended?" selected":"",bestSelected=tabToLoad==this.tabNames.best?" selected":"";bodyHTML+='<div class="rondavu_tabs">',this.showAllTab&&(bodyHTML+='<a class="tab'+allSelected+'" id="rondavu_tab_all" href="#" >'+allFriendsTabImg+this.getParameter("TargetedInvite.Tab.All.Text")+"</a>"),this.showBestTab&&(bodyHTML+='<a class="tab'+bestSelected+'" id="rondavu_tab_best" href="#" >'+bestFriendsTabImg+this.getParameter("TargetedInvite.Tab.Best.Text")+"</a>"),this.showRecommendedTab&&(bodyHTML+='<a class="tab'+recommendedSelected+'" id="rondavu_tab_recommended" href="#" >'+friendsTabImg+this.getParameter("TargetedInvite.Tab.Recommended.Text")+"</a>"),bodyHTML+='<div class="rondavu_clearfix"></div></div><div class="rondavu_clearfix"></div>'}this.showRecommendedTab&&(bodyHTML+='<div class="rondavu_recommended_friends_tab_content rondavu_box"><div class="rondavu_people_list"></div></div>'),this.showBestTab&&(bodyHTML+='<div class="rondavu_best_friends_tab_content rondavu_box"><div class="rondavu_people_list"></div></div>'),this.showAllTab&&(bodyHTML+='<div class="rondavu_all_friends_tab_content rondavu_box"> <div class="rondavu_people_list"></div></div>'),popupBody.innerHTML+=bodyHTML,this.showAllTab&&(this.all_friends_container=r$(".rondavu_all_friends_tab_content .rondavu_people_list",popupBody)[0]),this.showRecommendedTab&&(this.recommended_friends_container=r$(".rondavu_recommended_friends_tab_content .rondavu_people_list",popupBody)[0]),this.showBestTab&&(this.best_friends_container=r$(".rondavu_best_friends_tab_content .rondavu_people_list",popupBody)[0]),this.showTabButtons&&(this.defineTabs(),this.dialogTabview(this.tab_configuration))}else this.stage=this.getEl(),this.container&&!this.container.hasClass("rondavu_fb_connected")&&this.FB.getLoginStatus(function(response){response.status=="connected"&&this.getEl().find(".rondavu_cta").each(function(){this.hasClass("rondavu_cta_fb_connected")?this.removeClass("rondavu_hideme"):this.hasClass("rondavu_hideme")||this.addClass("rondavu_hideme")})}),this.showRecommendedTab&&(this.recommended_friends_container=this.getEl().find(".rondavu_recommended_friends_tab_content .rondavu_people_list")[0]),this.showAllTab&&(this.all_friends_container=this.getEl().find(".rondavu_all_friends_tab_content .rondavu_people_list")[0]),this.showBestTab&&(this.best_friends_container=this.getEl().find(".rondavu_best_friends_tab_content .rondavu_people_list")[0]);var containerToLoad=tabToLoad==this.tabNames.all?this.all_friends_container:tabToLoad==this.tabNames.best?this.best_friends_container:this.recommended_friends_container;R.Core.loading(containerToLoad,null,this.getParameter("TargetedInvite.List.Loading.Image"),this.getParameter("TargetedInvite.List.Loading.Text"));var btn,facepile;try{btn=this.el.find(".rondavu_connect"),facepile=this.el.find(".rondavu_face_pile"),this.isPopup||(btn.addClass("rondavu_hideme"),facepile&&facepile.addClass("rondavu_hideme"))}catch(ex){}this.timed_out=!1;var time_limit=this.getParameter("TargetedInvite.List.Loading.Timeout.Seconds");time_limit&&(this.timeout=setTimeout(R.Util.bind(function(){this.timed_out=!0;var msg=this.getParameter("TargetedInvite.List.Loading.Timeout.Text");msg?containerToLoad.innerHTML=msg:this.isPopup?this.popup.destroy():containerToLoad.innerHTML=msg,this.isPopup||(btn&&btn.removeClass("rondavu_hideme"),facepile&&facepile.removeClass("rondavu_hideme")),R.Logger.warn("TargetedInvite timeout reached during FQL queries ("+time_limit+" seconds)")},this),time_limit*1e3)),this.showRecommendedTab&&tabToLoad==this.tabNames.recommended&&(this.recommended_friends_to_display.length?(this.listFriends(this.recommended_friends_to_display,this.recommended_friends_container),this.scrollToFirstInvitedFriend(),this.recommendedLoaded=!0):this.loadRecommendedFriends(R.Util.bind(this.scrollToFirstInvitedFriend,this))),this.showBestTab&&tabToLoad==this.tabNames.best&&(this.best_friends_to_display.length?(this.listFriends(this.best_friends_to_display,this.best_friends_container),this.scrollToFirstInvitedFriend(),this.bestLoaded=!0):this.loadBestFriends(R.Util.bind(this.scrollToFirstInvitedFriend,this))),this.showAllTab&&(this.allLoaded?tabToLoad==this.tabNames.all&&(this.listFriends(this.all_friends,this.all_friends_container),this.scrollToFirstInvitedFriend()):tabToLoad==this.tabNames.all?this.loadAllFriends(this.scrollToFirstInvitedFriend):this.callWithTimeout(function(){this.loadAllFriends(),this.scrollToFirstInvitedFriend()},10)),this.popup&&this.popup.center(),this.updateStage()},getTemplateData:function(initData,status){var data=r$.extend(!0,{},initData);return data.showFacePile=data.facePileIds.length>0,data.featureConfig=this.getParameterMap(),data.showAsDropdown=this.getBooleanParameter("TargetedInvite.ShowAsDropdown.Enable"),data.teaserHtml=this.getParameter("TargetedInvite.ShowAsDropdown.Teaser.Html"),status===R.FB.constants.connectedStates.CONNECTED?data.fbConnected=!0:status===R.FB.constants.connectedStates.NOT_AUTHORIZED?data.fbNotAuthorized=!0:status===R.FB.constants.connectedStates.UNKNOWN&&(data.fbUnknown=!0),data},clientSideRender:function(initData){var self=this;R.FacebookUserMap.addUsersById(initData.facePileIds,function(){self.FB.getLoginStatus(function(response){self.getEl().html(templates.inline(self.getTemplateData(initData,response.status)))})})},all_friends:[],recommended_friends_to_display:[],best_friends_to_display:[],all_friends_by_id:{},getFriend:function(id){return this.all_friends_by_id[id]},getFriendFromData:function(friend_data){var friend=this.getFriend(friend_data.uid);return friend?friend.update(friend_data,this.render_options):(friend=new Friend(friend_data,this.render_options),this.all_friends.push(friend),this.all_friends_by_id[friend_data.uid]=friend),friend},addFriendToDisplayArray:function(friend_data,to_display_array){if(!friend_data.uid)return R.Logger.error("This friend is missing uid data!",friend_data),null;var friend=this.getFriendFromData(friend_data);return R.Util.indexOf(to_display_array,friend)<0&&to_display_array.push(friend),friend},addBestFriend:function(friend_data){return this.addFriendToDisplayArray(friend_data,this.best_friends_to_display)},addRecommendedFriend:function(friend_data){return this.addFriendToDisplayArray(friend_data,this.recommended_friends_to_display)},loadRecommendedFriends:function(callback){var self=this,num_batches_str=self.getParameter("TargetedInvite.List.Loading.NumberOfBatches")||"1",num_batches=Math.max(parseInt(num_batches_str,10),1),splits=num_batches-1,section=0,batches_complete=0,previous_friends_list_size=0,errors=!1;function batchLoadedCallback(error){errors=errors||error,previous_friends_list_size<self.recommended_friends_to_display.length&&self.renderCurrentRecommendedFriends(),previous_friends_list_size=self.recommended_friends_to_display.length,batches_complete++;if(batches_complete==num_batches){var max=parseInt(self.getParameter("TargetedInvite.Match.Parameters.MaximumNumberOfFriends"),10);self.backfillFriendList(self.recommended_friends_to_display,max,function(){self.recommended_friends_to_display.length?self.renderCurrentRecommendedFriends():r$(self.recommended_friends_container).html(self.getParameter(errors?"TargetedInvite.List.Loading.Timeout.Text":"TargetedInvite.List.NoFriends.Text")),callback&&callback.call(self)})}}var time_limit=parseInt(this.getParameter("TargetedInvite.List.Loading.Timeout.Seconds"),10)||30,getLoadNextSectionFunction=function(section){return function(){var timeout=setTimeout(function(){R.Logger.error("TI Recommended Friends Batch #"+(section+1)+" failed to load within "+time_limit+" seconds, continuing without it."),batchLoadedCallback(!0)},time_limit*1e3);self.loadRecommendedFriendsBatch(function(){clearTimeout(timeout),batchLoadedCallback()},section,splits)}};do this.callWithTimeout(getLoadNextSectionFunction(section),section*100),section++;while(section<=splits)},callWithTimeout:function(fn,timeout){setTimeout(R.Util.bind(fn,this),timeout)},getTargetedUserFields:function(){return{Activities:{perms:[R.FB.constants.perm.FRIENDS_ACTIVITIES]},Interests:{perms:[R.FB.constants.perm.FRIENDS_INTERESTS]},Work_History:{perms:[R.FB.constants.perm.FRIENDS_WORK_HISTORY],is_array:!0,seperator:"|",sub_field:"company_name"}}},executeOnEachKeywordAndScore:function(matchKeywords){var user_fields=this.getTargetedUserFields();R.Util.each(user_fields,function(options,field_name){var keywords=this.getParameter(MATCH_PARAM_PREFIX+field_name+".Keywords"),score=this.getParameter(MATCH_PARAM_PREFIX+field_name+".Score");keywords&&score&&(options.seperator&&(keywords=keywords.split(options.seperator)),R.Util.each(keywords,function(keyword){matchKeywords.call(this,field_name,keyword,score,options)},this))},this)},getSelectClauseForUserMatchFields:function(){if(!this.userMatchScoring||!R.Util.isObject(this.userMatchScoring))return"";var select_fields=[];for(var field in this.userMatchScoring)this.userMatchScoring.hasOwnProperty(field)&&select_fields.push(field);return select_fields.join()},getFqlForKeywordFields:function(){var field_criteria=[],select_fields=[];return this.executeOnEachKeywordAndScore(function(field_name,keyword,score,options){field_name=field_name.toLowerCase(),keyword=keyword.replace("'","\\'"),R.Util.indexOf(select_fields,field_name)<0&&select_fields.push(field_name),options.is_array?field_criteria.push("'"+keyword+"' IN "+field_name):field_criteria.push("strpos(lower("+field_name+'), "'+keyword.toLowerCase()+'") >= 0')}),{criteria_clauses:field_criteria,select_clause:select_fields.join(",")}},renderCurrentRecommendedFriends:function(){this.recommended_friends_to_display=this.recommendedFriendsFilter(this.recommended_friends_to_display),this.listFriends(this.recommended_friends_to_display,this.recommended_friends_container),this.recommendedLoaded=!0},loadRecommendedFriendsBatch:function(callback,section,splits){var self=this;R.Logger.debug("Looking up friend batch "+(section+1)+" of "+(splits+1));var use_primary_mo_name=this.getBooleanParameter(MATCH_PARAM_PREFIX+"Likes.UsePrimaryMoName");if(use_primary_mo_name&&!R.PageDataManager.getMoName())throw"UsePrimaryMoName is true, but the primary mo does not appear to have a name.";var keyword_query_fql_clauses=this.getFqlForKeywordFields(),user_matching_select_fields_fql=this.getSelectClauseForUserMatchFields(),keyword_select_fields_fql=keyword_query_fql_clauses.select_clause,select_fields_fql=!user_matching_select_fields_fql||!keyword_select_fields_fql?keyword_select_fields_fql?keyword_select_fields_fql:user_matching_select_fields_fql:keyword_select_fields_fql+","+user_matching_select_fields_fql,search_criteria=keyword_query_fql_clauses.criteria_clauses,page_ids=this.getParameter(MATCH_PARAM_PREFIX+"Likes.PageIds"),querying_pages=!!use_primary_mo_name||!!page_ids,filter_criteria=[],age_criteria_fql=this.getAgeFilterFql(this.filter_min_age,this.filter_max_age);age_criteria_fql&&filter_criteria.push(age_criteria_fql);var batch_criteria_fql=this.getFriendsFilterFqlForBatch(section,splits);batch_criteria_fql&&filter_criteria.push(batch_criteria_fql),filter_criteria.length||filter_criteria.push(this.DEFAULT_FRIEND_CRITERIA);var friend_criteria_fql=" ("+filter_criteria.join(" AND ")+") ",query_list={};query_list.friends_query="SELECT uid, name, pic_square, birthday_date";if(querying_pages){var page_id_criteria=[],page_id_subset_queries=[];use_primary_mo_name&&page_id_subset_queries.push("SELECT page_id FROM page WHERE name = '"+R.PageDataManager.getMoName().replace(/'/g,"\\'")+"' ORDER BY fan_count LIMIT 10"),page_ids&&page_id_subset_queries.push(R.Util.listToArray(page_ids).join(","));for(var index in page_id_subset_queries)page_id_subset_queries.hasOwnProperty(index)&&page_id_criteria.push("page_id IN ("+page_id_subset_queries[index]+")");query_list.keyword_page_friends="SELECT uid, page_id FROM page_fan WHERE "+friend_criteria_fql+" AND ( "+page_id_criteria.join(" OR ")+")",query_list.keyword_pages="SELECT page_id, name FROM page WHERE page_id IN (SELECT page_id FROM #keyword_page_friends)",search_criteria.push("uid IN (SELECT uid FROM #keyword_page_friends)")}select_fields_fql&&(query_list.friends_query+=", "+select_fields_fql),query_list.friends_query+=" FROM user WHERE ",search_criteria.length==1&&querying_pages?query_list.friends_query+=search_criteria[0]:search_criteria.length?query_list.friends_query+="("+search_criteria.join(" OR ")+")"+" AND "+friend_criteria_fql:query_list.friends_query+=friend_criteria_fql,this.getBooleanParameter("TargetedInvite.Match.FilterOutAppUsersInRecommendedFriends")&&(query_list.friends_query+=" AND NOT is_app_user"),R.Timers.startTimer("targetedinvite fql query"),this.FB.api("/fql?q="+encodeURIComponent(R.JSON.stringify(query_list)),function(response){self.handleRecommendedFriendBatch(response,query_list,querying_pages,section,splits,callback)})},findPropertiesToScore:function(scoreObject,friendObject,onFindScore,originalFriendObject){if(!scoreObject||!friendObject)return;originalFriendObject||(originalFriendObject=friendObject);if(r$.isArray(scoreObject)){if(!r$.isArray(friendObject)){var mismatch_msg="FATAL: Can no longer match user values - array found on score object but not on user.  User value is "+R.JSON.stringify(friendObject);throw R.Logger.error(mismatch_msg),mismatch_msg}var scoreObjectForArrayContents=scoreObject[0];friendObject=this.filterObjectsBeforeScoring(friendObject,scoreObjectForArrayContents),R.Util.each(friendObject,function(friendItem){this.findPropertiesToScore(scoreObjectForArrayContents,friendItem,onFindScore,originalFriendObject)},this)}else if(R.Util.isObject(scoreObject)&&!scoreObject.rscore&&!scoreObject.rscore_friends)R.Util.each(scoreObject,function(subScoreObject,subScoreProperty){this.findPropertiesToScore(subScoreObject,friendObject[subScoreProperty],onFindScore,originalFriendObject)},this);else{if(!(R.Util.isObject(scoreObject)&&scoreObject.rscore&&!R.Util.isObject(friendObject))){var msg="FATAL: Can no longer match user values - mismatch between score object and friend.  Score object is "+R.JSON.stringify(scoreObject)+",  User value is "+R.JSON.stringify(friendObject);throw R.Logger.error(msg),msg}onFindScore(scoreObject,friendObject,originalFriendObject)}},filterObjectsBeforeScoring:function(friendObjectArray,scoreObject){R.Logger.debug("filtering...");if(!scoreObject)return friendObjectArray;R.Logger.debug("score object found....");var filterObj=scoreObject.rfilter;if(!filterObj)return friendObjectArray;R.Logger.debug("filter object found! It is: "+R.JSON.stringify(filterObj)),R.Logger.debug("before filter, got: "+R.JSON.stringify(friendObjectArray));var retval=R.Util.filterWithObject(friendObjectArray,filterObj);return R.Logger.debug("after filter, returning: "+R.JSON.stringify(retval)),retval},indexFriendForScoring:function(scoreObject,value,friend){if(!scoreObject||typeof value=="undefined"||!friend)return;scoreObject.rscore_friends=scoreObject.rscore_friends||{},scoreObject.rscore_friends[value]=scoreObject.rscore_friends[value]||[],scoreObject.rscore_friends[value].push(friend)},scoreFriendsWithValue:function(scoreObject,value){!!scoreObject&&typeof value!="undefined"&&!!scoreObject.rscore&&!!scoreObject.rscore_friends&&r$.isArray(scoreObject.rscore_friends[value])&&R.Util.each(scoreObject.rscore_friends[value],function(friend){friend.addScore(scoreObject.rscore)})},indexFriendForCurrentUserMatchScoring:function(friend_to_score){if(!this.userMatchScoring)return;if(!R.FB.userIsConnected()){R.Logger.warn("Attempted to do friend indexing based on user matches, but current user was null.  There could have been a temporary FB connectivity issue.  Investigate if this problem persists.");return}try{this.findPropertiesToScore(this.userMatchScoring,friend_to_score,this.indexFriendForScoring)}catch(e){R.Logger.error("We tried to index friends based on their values for score-eligible properties, but were unable to because an exception was thrown from findPropertiesToScore: "+e)}},scoreFriendsMatchingUserProperties:function(){if(!this.userMatchScoring)return;if(!R.FB.userIsConnected()){R.Logger.warn("Attempted to do friend scoring based on user matches, but current user was null.  There could have been a temporary FB connectivity issue.  Investigate if this problem persists.");return}try{this.findPropertiesToScore(this.userMatchScoring,R.FB.getCurrentUser(),this.scoreFriendsWithValue)}catch(e){R.Logger.error("We tried to score based on friend matches with the current user, but were unable to because an exception was thrown from findPropertiesToScore: "+e)}},handleRecommendedFriendBatch:function(response,query_list,querying_pages,section,splits,callback){var results;R.Timers.stopTimer("targetedinvite fql query");try{results=this.FB.parseMultiQueryResults(response,query_list)}catch(ex){callback&&callback.call(this,!0);if(ex instanceof R.FB.FqlError)return;throw ex}R.Logger.debug("Recommended friends Batch #"+(section+1)+" complete; matched friends: ",results.friends_query.length);var friend_pages={};if(querying_pages){var liked_pages={};R.Util.each(results.keyword_pages,function(page){liked_pages[page.page_id]=page.name},this),R.Util.each(results.keyword_page_friends,function(page){var u=page.uid;friend_pages[u]=friend_pages[u]||[],friend_pages[u].push(liked_pages[page.page_id])},this)}var like_score=parseInt(this.getParameter(MATCH_PARAM_PREFIX+"Likes.Score"),10)||0;R.Util.each(results.friends_query,function(friend_data){var friend=this.addRecommendedFriend(friend_data);this.executeOnEachKeywordAndScore(function(field_name,keyword,score,options){var re=new RegExp(keyword,"ig"),field_value=friend[field_name.toLowerCase()];if(field_value)if(options.is_array)R.Util.each(field_value,function(sub_row){if(!sub_row)return;var sub_field_value=sub_row[options.sub_field];sub_field_value==keyword&&friend.addMatch(sub_field_value,score,field_name,keyword)},this);else{var matches=field_value.match(re);matches&&R.Util.each(matches,function(text){friend.addMatch(text,score,field_name,keyword)},this)}});if(querying_pages){var pages=friend_pages[friend.uid];pages&&R.Util.each(pages,function(page){friend.addMatch(page,like_score,"Likes",page)},this)}this.indexFriendForCurrentUserMatchScoring(friend)},this),this.scoreFriendsMatchingUserProperties(),callback&&callback.call(this)},backfillFriendList:function(friends,max,callback){if(max&&friends.length<max)if(this.allLoaded){var all_friends_copy=this.all_friends.slice();if(this.filter_min_age||this.filter_max_age)all_friends_copy=this.filterFriendsByBirthday(all_friends_copy);this.getBooleanParameter("TargetedInvite.NonMatch.SortByName")||R.Util.shuffle(all_friends_copy),all_friends_copy=all_friends_copy.slice(0,max-1),R.Util.each(all_friends_copy,R.Util.bind(function(friend){R.Util.indexOf(friends,friend)==-1&&friends.push(friend)},this)),callback&&typeof callback=="function"&&callback.call(this)}else{var current_friend_ids=[];R.Util.each(friends,function(friend){current_friend_ids.push(friend.uid)},this);var friends_filter_fql=this.getAgeFilterFql(this.filter_min_age,this.filter_max_age)||this.DEFAULT_FRIEND_CRITERIA,query="SELECT uid, name, pic_square FROM user WHERE "+friends_filter_fql;this.getBooleanParameter("TargetedInvite.Match.FilterOutAppUsersInRecommendedFriends")&&(query+=" AND NOT is_app_user"),query+=" LIMIT "+max,this.FB.api("/fql?q="+encodeURIComponent(query),function(res){res.error?R.Logger.error("FQL response error: "+R.JSON.stringify(res)+"\nQuery: "+query):(this.getBooleanParameter("TargetedInvite.NonMatch.SortByName")||R.Util.shuffle(res.data),R.Util.each(res.data,R.Util.bind(function(friend){if(current_friend_ids[friend.uid])return;this.addRecommendedFriend(friend);if(friends.length>=max)return!1},this))),callback&&typeof callback=="function"&&callback.call(this)})}else callback&&typeof callback=="function"&&callback.call(this)},recommendedFriendsFilter:function(friends){var alphabetize=this.getBooleanParameter("TargetedInvite.NonMatch.SortByName"),sortMethod=alphabetize?this.sortWithAlphaBackfill:this.sortScoresOnly;friends.sort(sortMethod);var max=parseInt(this.getParameter("TargetedInvite.Match.Parameters.MaximumNumberOfFriends"),10);return max&&friends.length>max&&(friends.length=max),friends},bestFriendsFilter:function(friends){var alphabetize=this.getBooleanParameter("TargetedInvite.NonMatch.SortByName"),sortMethod=alphabetize?this.sortBestAlphaBackfill:this.sortBestScores;friends.sort(sortMethod);var max=parseInt(this.getParameter("TargetedInvite.Match.Parameters.MaximumNumberOfFriends"),10);return max&&friends.length>max&&(friends.length=max),friends},sortWithAlphaBackfill:function(a,b){return a.score||b.score?b.score-a.score:a.name<b.name?-1:a.name>b.name?1:0},sortScoresOnly:function(a,b){return a.score||b.score?b.score-a.score:0},sortBestAlphaBackfill:function(a,b){return a.best_score||b.best_score?b.best_score-a.best_score:a.name<b.name?-1:a.name>b.name?1:0},sortBestScores:function(a,b){return a.best_score||b.best_score?b.best_score-a.best_score:0},loadAllFriends:function(callback){var self=this;R.Timers.startTimer("targetedinvite fql query for all friends");var allFriendsFql="SELECT uid, name, pic_square, birthday_date FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = me())";this.getBooleanParameter("TargetedInvite.Match.FilterOutAppUsersInAllFriends")&&(allFriendsFql+=" AND NOT is_app_user"),self.FB.api("/fql?q="+encodeURIComponent(allFriendsFql),function(response){R.Timers.stopTimer("targetedinvite fql query for all friends"),response.error?R.Logger.error("FQL Error: "+R.JSON.stringify(response)+" \nQuery: "+allFriendsFql):(R.Util.each(response.data,function(friend_data){this.getFriendFromData(friend_data)},self),self.sortByName(self.all_friends),self.getInvitedFriends(function(){self.listFriends(self.all_friends,self.all_friends_container),callback&&callback.call(self),this.fire("allFriendsLoaded")}))})},getInvitedFriends:function(callback){var self=this;self.ajax(self.base_url+"get_invited_friends",{success:function(invited_friends){r$.each(self.all_friends,function(i,friend){if(invited_friends[friend.uid]){friend.display_invited_at=invited_friends[friend.uid].display_invited_at;var within_24_hours=(new Date).getTime()-invited_friends[friend.uid].invited_at<864e5;within_24_hours?friend.setInvitedState(self.Friend.states.INVITED_TODAY):friend.setInvitedState(self.Friend.states.INVITED_BEFORE_TODAY)}friend._updateMatches(),friend._updateUserActions()}),self.updateStage(),typeof callback=="function"&&callback.call(self)}})},filterFriendsByBirthday:function(friends){var results=friends;if(this.filter_max_age){var maxAgeCutoff=new Date;maxAgeCutoff.setFullYear(maxAgeCutoff.getFullYear()-this.filter_max_age);var minAgeCutoff=new Date;minAgeCutoff.setFullYear(minAgeCutoff.getFullYear()-this.filter_min_age),R.Util.filter(results,function(friend){if(!friend.birthday_date||friend.birthday_date.length<10)return!1;var date=new Date(friend.birthday_date);return date>maxAgeCutoff?!1:date<minAgeCutoff?!1:!0})}return results},sortByName:function(list){return list.sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0}),list},listFriends:function(friends,container){R.Logger.debug("Displaying "+friends.length+" friends");if(this.timed_out)return;clearTimeout(this.timeout),container.innerHTML="";var tabName=this.getTabId(container.parentNode);R.Util.each(friends,function(friend){container.appendChild(friend.getDiv(tabName))},this);var clearfix=document.createElement("div");clearfix.className="rondavu_clearfix",clearfix.innerHTML="&nbsp;",container.appendChild(clearfix);var jq_container=r$(container);jq_container.addClass("rondavu_friends_loaded");if(this.isMultiSelect&&!this.multiselect_button_rendered){var btn_container=document.createElement("div");btn_container.className="rondavu_button_container",btn_container.innerHTML=this.button("TargetedInvite.MultiSelect.Button",null,"rdv_multi_select_invite rondavu_disabled");var parent_container=this.isPopup?this.popup.get("body"):this.getEl();parent_container.appendChild(btn_container),this.multiselect_button_rendered=!0;if(this.isMultiSelect){this.msLimitEl=document.createElement("div"),this.msLimitEl.className="rondavu_limit_text",r$(parent_container).prepend(this.msLimitEl);var counter_container=document.createElement("span");counter_container.className="rondavu_counter",this.selected_count_el=document.createElement("span"),this.selected_count_el.innerHTML="0",counter_container.appendChild(this.selected_count_el);var out_of=document.createTextNode("/");counter_container.appendChild(out_of),this.remainingCountEl=document.createElement("span"),this.remainingCountEl.innerHTML=this.friendTaggingMode?this.multiSelectLimit:this.multiSelectLimit-this.getFriendStateCount([this.Friend.states.INVITED_TODAY]),counter_container.appendChild(this.remainingCountEl),btn_container.appendChild(counter_container)}}this.isPopup&&(this.popup.addClass("rondavu_popup_loaded"),this.popup.set("centered",!0)),this.updateStage()},button:function(name,id,CSSClass){var text=this.getParameter(name+".Text"),icon=this.getParameter(name+".Icon");return id=id?'id="'+id+'"':"",icon=icon?'<img src="'+R.Util.fixUrl(R.Core.getCDNUrl(),"SFS"+icon)+'" class="rondavu_icon" /> ':"",!text&&!icon?"":'<span class="rondavu_button '+(CSSClass||"")+'"'+id+">"+icon+text+'<span class="rondavu_button_end"></span></span>'},handleFriendClick:function(event){this.updateFriendsState(event),this.updateStage()},getFriendStateCount:function(states){var self=this,count=0;return R.Util.each(this.all_friends,function(friend){r$.each(states,function(i,state){state===self.Friend.states.ACTIVE&&friend.is_active?count++:state===friend.invited_state&&count++})},this),count},updateFriendsState:function(event){this.current_friend_div=r$(event.currentTarget);var friend_id=this.current_friend_div.attr("data-fbuid"),friend=this.getFriend(friend_id);if(this.isMultiSelect&&friend.is_active){friend.setIsActive(!1);return}if(this.isMultiSelect&&!this.friendTaggingMode&&friend.invited_state==Friend.states.INVITED_TODAY)return;if(this.isMultiSelect){var numSelected;this.friendTaggingMode?numSelected=this.getFriendStateCount([this.Friend.states.ACTIVE]):numSelected=this.getFriendStateCount([this.Friend.states.ACTIVE,this.Friend.states.INVITED_TODAY]);if(numSelected>=this.multiSelectLimit)return}friend.setIsActive(!0),this.isMultiSelect||this.ajax(this.base_url+"message_friend/",{mos_etags:!0,success:function(data){data.to=friend.uid,this.story_preview=data,this.promptFeedStory(data,friend)},failure:function(){this.current_friend_div.removeClass("rondavu_active")}})},updateStage:function(){if(this.isMultiSelect&&this.stage){var button=r$(".rondavu_button.rdv_multi_select_invite",this.stage),numActive=this.getFriendStateCount([this.Friend.states.ACTIVE]);button&&numActive?button.removeClass("rondavu_disabled"):button&&button.addClass("rondavu_disabled");if(this.selected_count_el){var numInvited=this.getFriendStateCount([this.Friend.states.INVITED_TODAY]);this.selected_count_el.innerHTML=numActive,this.remainingCountEl.innerHTML=this.friendTaggingMode?this.multiSelectLimit:this.multiSelectLimit-numInvited,numActive>=this.multiSelectLimit-(this.friendTaggingMode?0:numInvited)?r$(this.selected_count_el.parentNode).addClass("rondavu_max"):r$(this.selected_count_el.parentNode).removeClass("rondavu_max");if(this.msLimitEl){var selected=this.friendTaggingMode?numActive:numActive+numInvited,selectable=this.multiSelectLimit-selected,percentage=selectable?Math.round(100*(selected/this.multiSelectLimit)):100,progressBarHtml=this.enableProgressBar?templates.progress_bar({percentage:percentage,limit:this.multiSelectLimit}):"";this.msLimitEl.innerHTML=this.msLimitText.replace(/\{limit\}/ig,this.multiSelectLimit).replace(/\{selected\}/ig,selected).replace(/\{selectable\}/ig,selectable).replace(/\{percentage\}/ig,percentage).replace(/\{remaining_percentage\}/ig,100-percentage)+progressBarHtml,percentage===100?r$(this.msLimitEl).addClass("rondavu_max"):r$(this.msLimitEl).removeClass("rondavu_max")}}}},promptFeedStory:function(data,friend){var fbui={method:"feed",name:data.name,link:data.href,to:data.to,caption:data.caption,description:data.description,message:data.user_message},prop,props={};for(var i=0;i<data.properties.length;i++)prop=data.properties[i],props[prop.name]=prop.value;fbui.properties=props,data.pic_url&&(fbui.picture=data.pic_url);var action,action_links=[];for(var k=0;k<data.action_links.length;k++)action=data.action_links[k],action_links.push({name:action.text,link:action.href});fbui.actions=action_links,R.Logger.debug(fbui),this.FB.ui(fbui,function(response){this.feedDialogCallback(response,friend)})},feedDialogCallback:function(response,friend){R.Logger.debug("in feed dialog callback",response);var post_id=response&&response.post_id?response.post_id:"";post_id!==""?(this.trackEventForMoDetail(this.story_preview.customer_mo_id,this.story_preview.customer_mo_type,this.story_preview.mo_name,this.story_preview.mo_location,"mo feed story posted to friends wall"),this.trackEventForPrimaryMo("feed story posted to friends wall"),friend.setInvitedState(this.Friend.states.INVITED_TODAY),this.fire("friendInvited",friend)):(this.trackEventForMoDetail(this.story_preview.customer_mo_id,this.story_preview.customer_mo_type,this.story_preview.mo_name,this.story_preview.mo_location,"mo feed story skipped"),this.trackEventForPrimaryMo("feed story skipped"),friend.setInvitedState(this.Friend.states.NOT_INVITED));var user_message=response&&response.user_message?response.user_message:"";this.ajax(this.base_url+"update_feed_story/",{data:{story_id:this.story_preview.story_id,mo_id:this.story_preview.mo_id,post_id:post_id,user_message:user_message},mos_etags:!0});var message=new R.Module.Message.SUCreated({});this.notifyOtherModules(message)},handleMultiInviteClick:function(event){var self=this;if(r$(event.currentTarget).hasClass("rondavu_disabled"))return;var selected_friends=[];R.Util.each(this.all_friends,function(friend){friend.is_active&&selected_friends.push(friend)},this),self.ajax(self.base_url+"message_friend/",{mos_etags:!0,success:function(data){if(self.friendTaggingMode){var taggedFriendIds=r$.map(selected_friends,function(friend){return friend.uid});R.FacebookUserMap.addUsersById(taggedFriendIds,function(){self.showFriendTaggingPostDialog(data,selected_friends)})}else self.promptMultiFeedStory(data,selected_friends)}})},promptMultiFeedStory:function(data,selected_friends){var self=this,html=[];html.push('<div class="rondavu_cta sl_multishare_cta"></div>');var selected_friend_ids=[],selected_friend_names=[];R.Util.each(selected_friends,function(friend){selected_friend_ids.push(friend.uid),selected_friend_names.push(friend.name.replace(/ /g,"&nbsp;"))},this),html.push('<div class="rondavu_to_line"><strong>To:</strong> <span class="rondavu_to_name">'+selected_friend_names.join('</span>, <span class="rondavu_to_name">')+"</span></div>"),html.push('<div class="rondavu_fb_profile_pic"><img src="//graph.facebook.com/'+R.FB.getCurrentUserId()+"/picture"+(window.location.protocol=="https"?"?return_ssl_resources=1":"")+'" /></div>'),html.push('<div class="rondavu_customer_input">','<textarea id="rondavu_multishare_message" rows="1" cols="50" placeholder="'+this.getParameter("TargetedInvite.MultiSelect.Dialog.Placeholder.Text")+'">'+(data.user_message||"")+"</textarea>","</div>"),html.push('<div class="rondavu_story">'),data.pic_url&&html.push('<img class="rondavu_product_image"  src="'+data.pic_url+'" />'),html.push('<div class="rondavu_story_title"><a href="'+(data.href||"#")+'">'+(data.name||"")+"</a></div>"),data.caption&&html.push("<p>"+data.caption+"</p>"),data.description&&html.push("<p>"+data.description+"</p>"),html.push("</div>");var postsOrRequestsSent=!1,popup,profanityWarning=r$(R.Module.PROFANITY_WARNING_HTML),repopFriendsContainer=R.Util.bind(function(){this.isPopup?setTimeout(R.Util.bind(this.setupFriendsContainer,this),0):popup.destroy()},this),wallPost=function(){return this.FB.requestPerms(function(){this.ajax(this.base_url+"post_feed_stories",{mos_etags:!0,data:{user_message:document.getElementById("rondavu_multishare_message").value,to:selected_friend_ids,story_id:data.story_id},success:function(response){response.is_profane?(profanityWarning.fadeIn("fast"),setTimeout(function(){profanityWarning.fadeOut("fast")},5e3),r$("#rondavu_multishare_message").val(""),r$("input:submit",popup.get("buttons")).removeClass("rondavu_disabled").attr("disabled",!1),R.Util.each(selected_friends,function(friend){friend.setInvitedState(self.Friend.states.NOT_INVITED)})):(this.multiFeedDialogCallback(selected_friends,data),repopFriendsContainer())}}),R.Util.each(selected_friends,function(friend){friend.setInvitedState(self.Friend.states.INVITED_TODAY),friend.setIsActive(!1)},this),this.fire("friendsInvited",selected_friends),postsOrRequestsSent=!0,r$("input:submit",popup.get("buttons")).addClass("rondavu_disabled").attr("disabled",!0)},{scope:R.FB.constants.perm.PUBLISH_STREAM}),!1};popup=this.dialog({header:this.getParameter("TargetedInvite.MultiSelect.Dialog.Title"),body:html.join(""),width:575,buttons:[{text:this.getParameter("TargetedInvite.MultiSelect.Dialog.Confirm.Text"),primary:!0,handler:wallPost},{text:this.getParameter("TargetedInvite.MultiSelect.Dialog.Cancel.Text"),handler:repopFriendsContainer}],onClose:function(){R.Logger.debug("multi-friend onclose handler"),postsOrRequestsSent||(this.trackEventForMoDetail(data.customer_mo_id,data.customer_mo_type,data.mo_name,data.mo_location,"mo feed story skipped"),this.trackEventForPrimaryMo("feed story skipped"))},css_class:"rondavu_multi_share"}),r$(popup.get("buttons")).append(profanityWarning),this.ajax("rondavu/freemarker/interpret",{data:{paramName:"TargetedInvite.MultiSelect.Dialog.CTA"},success:function(interpretedParam){r$(".sl_multishare_cta",".rondavu_targetedinvite").html(interpretedParam?interpretedParam.toString():"")}})},showFriendTaggingPostDialog:function(feedStory,taggedFriends){var self=this,doTagDialogRender=function(data){var html=templates.friend_tagging_dialog(data),posted=!1,popup,profanityWarning=r$(R.Module.PROFANITY_WARNING_HTML),repopFriendsContainer=R.Util.bind(function(){self.isPopup?setTimeout(R.Util.bind(self.setupFriendsContainer,self),0):popup.destroy()},self),streamPublishAndTagFriends=function(){return this.FB.requestPerms(function(){var userMessage=r$("#sl_tagged_post_message").val(),taggedFriendIds=[];R.Util.each(self.all_friends,function(friend){friend.is_active&&taggedFriendIds.push(friend.uid)});var tagString=" @["+taggedFriendIds.join("], @[")+"]";self.ajax(self.base_url+"recommend_and_tag",{mos_etags:!0,data:{user_message:userMessage+tagString},success:function(response){response.is_profane?(profanityWarning.fadeIn("fast"),setTimeout(function(){profanityWarning.fadeOut("fast")},5e3),r$("#sl_tagged_post_message").val(""),r$("input:submit",popup.get("buttons")).removeClass("rondavu_disabled").attr("disabled",!1),R.Util.each(taggedFriends,function(friend){friend.setInvitedState(self.Friend.states.NOT_INVITED)})):(response.success&&self.multiFeedDialogCallback(taggedFriends,feedStory),repopFriendsContainer())}}),R.Util.each(taggedFriendIds,function(uid){self.all_friends_by_id[uid].setInvitedState(self.Friend.states.INVITED_TODAY),self.all_friends_by_id[uid].setIsActive(!1)}),self.fire("friendsInvited",taggedFriends),posted=!0,r$("input:submit",popup.get("buttons")).addClass("rondavu_disabled").attr("disabled",!0)},{scope:R.FB.constants.perm.PUBLISH_ACTIONS}),!1};popup=self.dialog({header:self.getParameter("TargetedInvite.MultiSelect.Dialog.Title"),body:html,width:575,buttons:[{text:self.getParameter("TargetedInvite.MultiSelect.Dialog.Confirm.Text"),primary:!0,handler:streamPublishAndTagFriends},{text:self.getParameter("TargetedInvite.MultiSelect.Dialog.Cancel.Text"),handler:repopFriendsContainer}],onClose:function(){R.Logger.debug("multi-friend onclose handler"),posted||(self.trackEventForMoDetail(feedStory.customer_mo_id,feedStory.customer_mo_type,feedStory.mo_name,feedStory.mo_location,"mo feed story skipped"),self.trackEventForPrimaryMo("feed story skipped"))},css_class:"rondavu_multi_share sl_friend_tagging_dialog"}),r$(popup.get("buttons")).append(profanityWarning)},templateData={cta:this.getParameter("TargetedInvite.MultiSelect.Dialog.CTA"),placeholder:this.getParameter("TargetedInvite.MultiSelect.Dialog.Placeholder.Text"),showFeedStoryPreview:this.getBooleanParameter("FBStreamPost.RenderPreview"),feedStory:feedStory,taggedFriendIds:r$.map(taggedFriends,function(friend){return friend.uid}),myId:R.FB.getCurrentUserId(),tagsLabel:this.getParameter("TargetedInvite.FriendTagging.Dialog.TagsLabel")};this.ajax("rondavu/freemarker/interpret",{data:{paramName:"TargetedInvite.MultiSelect.Dialog.CTA"},success:function(interpretedParam){templateData.cta=interpretedParam?interpretedParam.toString():"",doTagDialogRender(templateData)}})},multiFeedDialogCallback:function(selected_friends,data){this.trackEventForMoDetail(data.customer_mo_id,data.customer_mo_type,data.mo_name,data.mo_location,this.friendTaggingMode?"feed story posted to user's own wall with friend tags":"mo feed story posted to friends walls",selected_friends.length),this.trackEventForPrimaryMo(this.friendTaggingMode?"feed story posted to user's own wall with friend tags":"feed story posted to friends walls",selected_friends.length);var message=new R.Module.Message.SUCreated({});this.notifyOtherModules(message),this.updateStage()},scrollToFirstInvitedFriend:function(){var dialog=r$(R._opened_dialog);if(!dialog||!dialog.find(".rondavu_invited"))return;var friend=dialog.find(".rondavu_invited").first();R.Util.scrollTo(dialog,friend)},handleMessage:function(message){if(message.type==="module.requestInviteDialog"&&this.getBooleanParameter("TargetedInvite.ListenToRequestsFromOtherModules"))this.handleConnectClick();else if(message.type==="fb.login"||message.type==="fb.logout")this.friendTaggingMode?this.ajax(this.base_url+"get_new_data",{success:this.clientSideRender}):this.ajax(this.base_url+this.get_new_html,{success:function(response){response&&(this.getEl().html(response),this.getBooleanParameter("TargetedInvite.FacePile.Show.Unknown")&&this.getEl().find(".rondavu_face_pile").removeClass("rondavu_hideme"))}})},searchFriends:function(e){this.selectedTab!=this.tabNames.all&&(this.no_clear_search=!0,this.switchTab(this.tabNames.all),this.no_clear_search=!1);var re=R.Util.makeRegExp(r$(e.currentTarget).val(),"i");R.Util.each(this.all_friends,function(friend){friend.name.match(re)?friend.show():friend.hide()},this)},clearSearch:function(){if(this.no_clear_search)return;var search=r$(".rondavu_search",this.stage);search.val(this.getParameter("TargetedInvite.Search.DefaultText")),search.addClass("rondavu_default_text"),R.Util.each(this.all_friends,function(friend){friend.show()},this)},addBestFriendDataFromStream:function(){var self=this,stream_score=1,num_batches_str=this.getParameter("TargetedInvite.List.Loading.NumberOfBatches")||"1",num_batches=Math.max(parseInt(num_batches_str,10),1),time_diff=12096e5,curr_time=Math.ceil((new Date).getTime()/1e3),slice=Math.ceil(time_diff/num_batches/1e3),completed_calls=0;function handleFeedBatch(stream){R.Util.each(stream.data,function(post){this.addBestFriendsResult(post,stream_score),post.comments&&post.comments.count>0&&post.comments.data&&R.Util.each(post.comments.data,function(comment){this.addBestFriendsResult(comment,stream_score)},this)},self),completed_calls++,completed_calls==num_batches&&(self.streamLoaded=!0,self.photosLoaded&&self.finishBestFriends())}for(var i=0;i<num_batches;i++){var latest_time=curr_time;curr_time-=slice,this.FB.api("/me/feed?fields=comments,from&until="+latest_time+"&since="+curr_time,handleFeedBatch)}},addBestFriendDataFromPhotos:function(){var self=this,photo_score=10,photo_queries={photo_tag_query:"select subject from photo_tag where pid in (select pid from photo where aid in ( select aid from album where owner = me()))",photo_map_query:"select uid, name, pic_square from user where uid in (select subject from photo_tag where pid in (select pid from photo where aid in ( select aid from album where owner = me())))"},photo_map={};this.FB.api("/fql?q="+encodeURIComponent(R.JSON.stringify(photo_queries)),function(response){var results=self.FB.parseMultiQueryResults(response,photo_queries);R.Util.each(results.photo_map_query,function(friend){photo_map[friend.uid]=friend},self),R.Util.each(results.photo_tag_query,function(tag){if(tag.subject&&tag.subject!=R.FB.getCurrentUserId()){var currentFriend=this.addBestFriend(photo_map[tag.subject]);currentFriend&&currentFriend.addBestScore(photo_score)}},self),self.photosLoaded=!0,self.streamLoaded&&self.finishBestFriends()})},loadBestFriends:function(callback){this.addBestFriendDataFromStream(),this.addBestFriendDataFromPhotos(),typeof callback=="function"&&callback.call(this)},addBestFriendsResult:function(post,value){if(post.from.id==R.FB.getCurrentUserId())return;var friend={uid:post.from.id,name:post.from.name,pic_square:this.FB.getPicUrl(post.from.id)},currentFriend=this.addBestFriend(friend);currentFriend&&currentFriend.addBestScore(value)},finishBestFriends:function(){var max_num_friends=parseInt(this.getParameter("TargetedInvite.Match.Parameters.MaximumNumberOfFriends"),10);this.best_friends_to_display=this.bestFriendsFilter(this.best_friends_to_display),this.backfillFriendList(this.best_friends_to_display,max_num_friends),this.listFriends(this.best_friends_to_display,this.best_friends_container),this.bestLoaded=!0},getBirthdayCriteriaClause:function(current_date,age,isMax){var month=current_date.getMonth()+1,day=current_date.getDate(),year=current_date.getFullYear()-age;return" AND (   substr(birthday_date,6,4) "+(isMax?">":"<")+" "+year+" OR (  "+" substr(birthday_date,6,4) = "+year+" AND substr(birthday_date,0,2) "+(isMax?">":"<")+" "+month+" ) OR ( "+" substr(birthday_date,6,4) = "+year+" AND substr(birthday_date,0,2) = "+month+" AND substr(birthday_date,3,2) "+(isMax?">=":"<=")+" "+day+" ) "+" ) "},getAgeFilterFql:function(min_age,max_age){if(min_age||max_age){var current_date=new Date,subset_filter_fql="SELECT uid FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = me()) AND strlen(birthday_date) = 10";return min_age&&(subset_filter_fql+=this.getBirthdayCriteriaClause(current_date,min_age,!1)),max_age&&(subset_filter_fql+=this.getBirthdayCriteriaClause(current_date,max_age,!0)),"uid IN ("+subset_filter_fql+")"}return""},getFriendsFilterFqlForBatch:function(section,splits){if(!splits)return"";var alphabet="abcdefghijklmnopqrstuvwxyz",fql_sub_criteria=[];if(section>0){var min_alphabet_index=Math.floor(26/(splits+1)*section),min_letter=alphabet.substr(min_alphabet_index,1);fql_sub_criteria.push('substr(name,0,1) >= "'+min_letter+'"')}if(section<splits){var max_alphabet_index=Math.min(Math.floor(26/(splits+1)*(section+1)),25),max_letter=alphabet.substr(max_alphabet_index,1);fql_sub_criteria.push('substr(name,0,1) < "'+max_letter+'"')}return"uid IN ( SELECT uid FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = me()) AND "+fql_sub_criteria.join(" AND ")+" ) "}})}();var Handlebars={};Handlebars.VERSION="1.0.beta.6",Handlebars.helpers={},Handlebars.partials={},Handlebars.registerHelper=function(name,fn,inverse){inverse&&(fn.not=inverse),this.helpers[name]=fn},Handlebars.registerPartial=function(name,str){this.partials[name]=str},Handlebars.registerHelper("helperMissing",function(arg){if(arguments.length===2)return undefined;throw new Error("Could not find property '"+arg+"'")});var toString=Object.prototype.toString,functionType="[object Function]";Handlebars.registerHelper("blockHelperMissing",function(context,options){var inverse=options.inverse||function(){},fn=options.fn,ret="",type=toString.call(context);type===functionType&&(context=context.call(this));if(context===!0)return fn(this);if(context===!1||context==null)return inverse(this);if(type==="[object Array]"){if(context.length>0)for(var i=0,j=context.length;i<j;i++)ret+=fn(context[i]);else ret=inverse(this);return ret}return fn(context)}),Handlebars.registerHelper("each",function(context,options){var fn=options.fn,inverse=options.inverse,ret="";if(context&&context.length>0)for(var i=0,j=context.length;i<j;i++)ret+=fn(context[i]);else ret=inverse(this);return ret}),Handlebars.registerHelper("if",function(context,options){var type=toString.call(context);return type===functionType&&(context=context.call(this)),!context||Handlebars.Utils.isEmpty(context)?options.inverse(this):options.fn(this)}),Handlebars.registerHelper("unless",function(context,options){var fn=options.fn,inverse=options.inverse;return options.fn=inverse,options.inverse=fn,Handlebars.helpers["if"].call(this,context,options)}),Handlebars.registerHelper("with",function(context,options){return options.fn(context)}),Handlebars.registerHelper("log",function(context){Handlebars.log(context)}),Handlebars.Exception=function(message){var tmp=Error.prototype.constructor.apply(this,arguments);for(var p in tmp)tmp.hasOwnProperty(p)&&(this[p]=tmp[p]);this.message=tmp.message},Handlebars.Exception.prototype=new Error,Handlebars.SafeString=function(string){this.string=string},Handlebars.SafeString.prototype.toString=function(){return this.string.toString()},function(){var escape={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},badChars=/&(?!\w+;)|[<>"'`]/g,possible=/[&<>"'`]/,escapeChar=function(chr){return escape[chr]||"&amp;"};Handlebars.Utils={escapeExpression:function(string){return string instanceof Handlebars.SafeString?string.toString():string==null||string===!1?"":possible.test(string)?string.replace(badChars,escapeChar):string},isEmpty:function(value){return typeof value=="undefined"?!0:value===null?!0:value===!1?!0:Object.prototype.toString.call(value)==="[object Array]"&&value.length===0?!0:!1}}}(),Handlebars.VM={template:function(templateSpec){var container={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(i,fn,data){var programWrapper=this.programs[i];return data?Handlebars.VM.program(fn,data):programWrapper?programWrapper:(programWrapper=this.programs[i]=Handlebars.VM.program(fn),programWrapper)},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};return function(context,options){return options=options||{},templateSpec.call(container,Handlebars,context,options.helpers,options.partials,options.data)}},programWithDepth:function(fn,data,$depth){var args=Array.prototype.slice.call(arguments,2);return function(context,options){return options=options||{},fn.apply(this,[context,options.data||data].concat(args))}},program:function(fn,data){return function(context,options){return options=options||{},fn(context,options.data||data)}},noop:function(){return""},invokePartial:function(partial,name,context,helpers,partials,data){options={helpers:helpers,partials:partials,data:data};if(partial===undefined)throw new Handlebars.Exception("The partial "+name+" could not be found");if(partial instanceof Function)return partial(context,options);if(!Handlebars.compile)throw new Handlebars.Exception("The partial "+name+" could not be compiled when running in runtime-only mode");return partials[name]=Handlebars.compile(partial),partials[name](context,options)}},Handlebars.template=Handlebars.VM.template,function(){function FacebookUserMap(){this.constructor=FacebookUserMap;var _facebookUserMap={};function _getUsersFromFacebook(ids,cb,retries){typeof retries=="undefined"&&(retries=2);var fields=["name","picture","first_name"];ids&&ids.length?R.FB.api("?ids="+encodeURIComponent(ids.join(","))+"&fields="+encodeURIComponent(fields.join(","))+(R.Util.isSecure()?"&return_ssl_resources=1":""),function(response){if(response.error){R.Logger.warn("failed to load users from FB, "+retries+" attempts left"),retries>0?_getUsersFromFacebook(ids,cb,--retries):R.Logger.error("Could not load facebook users from ids after all retries were used");return}R.Util.each(response,function(user,uid){_facebookUserMap[uid]=user}),cb&&cb()}):R.Logger.debug("No ids to load... either no activity, or no ids found.")}this.addUsersById=function(ids,cb){var newIds=[];R.Util.each(ids,function(id){!_facebookUserMap[id]&&R.Util.indexOf(newIds,id)===-1&&newIds.push(id)}),newIds.length?_getUsersFromFacebook(newIds,cb):cb&&cb()},this.addCurrentUser=function(){var currentUserId=R.FB.getCurrentUserId();if(!currentUserId)return;_facebookUserMap[currentUserId]||(_facebookUserMap[currentUserId]=R.FB.getCurrentUser())},this.getUserById=function(uid){return _facebookUserMap[uid]||null},this.getPicUrlById=function(uid){var user=this.getUserById(uid);try{return user.picture.data.url}catch(npe){return R.FB.getPicUrl(uid)}},this.getUserNameById=function(uid,firstNameOnly,forceNameForCurrentUser){if(uid==R.FB.getCurrentUserId()&&!forceNameForCurrentUser)return"You";var user=this.getUserById(uid);return user?firstNameOnly?user.first_name:user.name:""}}R.FacebookUserMap=new FacebookUserMap}(),Handlebars.registerHelper("fb_pic_url",function(uid){if(uid)return R.FacebookUserMap.getPicUrlById(uid)}),Handlebars.registerHelper("fb_user_name",function(uid){if(uid){if(R.FB.getCurrentUserId()==uid)return"You";var userInfo=R.FacebookUserMap.getUserById(uid);return userInfo.name}}),function(){var template=Handlebars.template,templates=Handlebars.templates=Handlebars.templates||{},partials=Handlebars.partials=Handlebars.partials||{};partials["Handlebars.templates.feed_story_preview"]=templates.feed_story_preview=template(function(Handlebars,depth0,helpers,partials,data){helpers=helpers||Handlebars.helpers;var buffer="",stack1,functionType="function",escapeExpression=this.escapeExpression,self=this;function program1(depth0,data){var buffer="",stack1,foundHelper;return buffer+=' <div class="feed_image"> <img src="',foundHelper=helpers.pic_url,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.pic_url,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'" /> </div> ',buffer}function program3(depth0,data){var buffer="",stack1,foundHelper;return buffer+=' <div class="feed_name"> <a href="',foundHelper=helpers.href,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.href,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'" target="_blank">',foundHelper=helpers.name,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.name,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+"</a> </div> ",buffer}function program5(depth0,data){var buffer="",stack1,foundHelper;return buffer+=' <div class="feed_caption">',foundHelper=helpers.caption,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.caption,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+"</div> ",buffer}function program7(depth0,data){var buffer="",stack1,foundHelper;return buffer+=' <div class="feed_caption feed_description">',foundHelper=helpers.description,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.description,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+"</div> ",buffer}buffer+=' <div class="sl_feed_preview"> ',stack1=depth0.pic_url,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(1,program1,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=" ",stack1=depth0.name,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(3,program3,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=" ",stack1=depth0.caption,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(5,program5,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=" ",stack1=depth0.description,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(7,program7,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=" </div> ",buffer})}(),function(){var template=Handlebars.template,templates=R.Module.TargetedInvite.templates={},partials=Handlebars.partials=Handlebars.partials||{};partials["R.Module.TargetedInvite.module_templates.friend_tagging_dialog"]=templates.friend_tagging_dialog=template(function(Handlebars,depth0,helpers,partials,data){helpers=helpers||Handlebars.helpers,partials=partials||Handlebars.partials;var buffer="",stack1,foundHelper,functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this;function program1(depth0,data){var buffer="",stack1,foundHelper;return buffer+=' <span class="sl_tagged_name" data-fb-uid="',depth0=typeof depth0===functionType?depth0():depth0,buffer+=escapeExpression(depth0)+'"> <span class="sl_user_name">',foundHelper=helpers.fb_user_name,stack1=foundHelper?foundHelper.call(depth0,depth0,{hash:{}}):helperMissing.call(depth0,"fb_user_name",depth0,{hash:{}}),buffer+=escapeExpression(stack1)+'</span> <span class="sl_untag"></span> </span> ',buffer}function program3(depth0,data){var buffer="",stack1;buffer+=" ",stack1=depth0.feedStory,stack1=self.invokePartial(partials["Handlebars.templates.feed_story_preview"],"Handlebars.templates.feed_story_preview",stack1,helpers,partials);if(stack1||stack1===0)buffer+=stack1;return buffer+=" ",buffer}buffer+='<div class="rondavu_cta sl_multishare_cta">',foundHelper=helpers.cta,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.cta,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'</div> <div class="rondavu_fb_profile_pic"> <img src="',stack1=depth0.myId,foundHelper=helpers.fb_pic_url,stack1=foundHelper?foundHelper.call(depth0,stack1,{hash:{}}):helperMissing.call(depth0,"fb_pic_url",stack1,{hash:{}}),buffer+=escapeExpression(stack1)+'" /> </div> <div class="sl_user_input"> <textarea id="sl_tagged_post_message" placeholder="',foundHelper=helpers.placeholder,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.placeholder,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'"></textarea> </div> <div class="sl_tag_container"> <div class="sl_tags_label">',foundHelper=helpers.tagsLabel,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.tagsLabel,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'</div> <div class="sl_tagged_friends"> ',stack1=depth0.taggedFriendIds,stack1=helpers.each.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(1,program1,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=" </div> </div> ",stack1=depth0.showFeedStoryPreview,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(3,program3,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=" ",buffer}),partials["R.Module.TargetedInvite.module_templates.inline"]=templates.inline=template(function(Handlebars,depth0,helpers,partials,data){helpers=helpers||Handlebars.helpers,partials=partials||Handlebars.partials;var buffer="",stack1,functionType="function",escapeExpression=this.escapeExpression,self=this;function program1(depth0,data){var buffer="",stack1;buffer+=' <div class="targetedinvite_dropdown_container"> ',stack1=depth0.featureConfig,stack1=stack1==null||stack1===!1?stack1:stack1["TargetedInvite.ShowAsDropdown.Teaser.Html"],stack1=typeof stack1===functionType?stack1():stack1,buffer+=escapeExpression(stack1)+" ",stack1=depth0,stack1=self.invokePartial(partials["R.Module.TargetedInvite.module_templates.inline_content"],"R.Module.TargetedInvite.module_templates.inline_content",stack1,helpers,partials);if(stack1||stack1===0)buffer+=stack1;return buffer+=" </div> ",buffer}function program3(depth0,data){var buffer="",stack1;buffer+=" ",stack1=depth0,stack1=self.invokePartial(partials["R.Module.TargetedInvite.module_templates.inline_content"],"R.Module.TargetedInvite.module_templates.inline_content",stack1,helpers,partials);if(stack1||stack1===0)buffer+=stack1;return buffer+=" ",buffer}stack1=depth0.showAsDropdown,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.program(3,program3,data),fn:self.program(1,program1,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=" ",buffer}),partials["R.Module.TargetedInvite.module_templates.inline_content"]=templates.inline_content=template(function(Handlebars,depth0,helpers,partials,data){helpers=helpers||Handlebars.helpers;var buffer="",stack1,functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this;function program1(depth0,data){var buffer="",stack1;return buffer+=' <div class="rondavu_cta rondavu_cta_fb_connected">',stack1=depth0.featureConfig,stack1=stack1==null||stack1===!1?stack1:stack1["TargetedInvite.CTALine.Text.FBConnected"],stack1=typeof stack1===functionType?stack1():stack1,buffer+=escapeExpression(stack1)+"</div> ",buffer}function program3(depth0,data){var buffer="",stack1;return buffer+=' <div class="rondavu_cta rondavu_cta_fb_not_connected">',stack1=depth0.featureConfig,stack1=stack1==null||stack1===!1?stack1:stack1["TargetedInvite.CTALine.Text.FBNotConnected"],stack1=typeof stack1===functionType?stack1():stack1,buffer+=escapeExpression(stack1)+"</div> ",buffer}function program5(depth0,data){var buffer="",stack1;return buffer+=' <div class="rondavu_cta rondavu_cta_unknown">',stack1=depth0.featureConfig,stack1=stack1==null||stack1===!1?stack1:stack1["TargetedInvite.CTALine.Text.FBUnknown"],stack1=typeof stack1===functionType?stack1():stack1,buffer+=escapeExpression(stack1)+"</div> ",buffer}function program7(depth0,data){var buffer="",stack1;buffer+=" ",buffer+=' <div class="rondavu_face_pile"> ',stack1=depth0.facePileIds,stack1=helpers.each.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(8,program8,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=" </div> ",buffer}function program8(depth0,data){var buffer="",stack1,foundHelper;return buffer+=" ",buffer+=' <span class="sl_picsquare_container"> <img class="sl_picsquare" src="',foundHelper=helpers.fb_pic_url,stack1=foundHelper?foundHelper.call(depth0,depth0,{hash:{}}):helperMissing.call(depth0,"fb_pic_url",depth0,{hash:{}}),buffer+=escapeExpression(stack1)+'"> <span class="rondavu_fbname_alt"> <span class="rondavu_fbname"> ',foundHelper=helpers.fb_user_name,stack1=foundHelper?foundHelper.call(depth0,depth0,{hash:{}}):helperMissing.call(depth0,"fb_user_name",depth0,{hash:{}}),buffer+=escapeExpression(stack1)+" </span> </span> </span> ",buffer}function program10(depth0,data){var buffer="",stack1;return buffer+=' <img src="',stack1=depth0.featureConfig,stack1=stack1==null||stack1===!1?stack1:stack1["TargetedInvite.ConnectButton.Image"],stack1=typeof stack1===functionType?stack1():stack1,buffer+=escapeExpression(stack1)+'"/> ',buffer}buffer+='<div class="rondavu_module_content"> ',stack1=depth0.fbConnected,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(1,program1,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=" ",stack1=depth0.fbNotAuthorized,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(3,program3,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=" ",stack1=depth0.fbUnknown,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(5,program5,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=" ",stack1=depth0.showFacePile,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(7,program7,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=" ",buffer+=' <span class="rondavu_connect rondavu_button"> ',stack1=depth0.featureConfig,stack1=stack1==null||stack1===!1?stack1:stack1["TargetedInvite.ConnectButton.Image"],stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(10,program10,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=" ",stack1=depth0.featureConfig,stack1=stack1==null||stack1===!1?stack1:stack1["TargetedInvite.ConnectButton.Text"],stack1=typeof stack1===functionType?stack1():stack1,buffer+=escapeExpression(stack1)+' <span class="rondavu_button_end"></span> </span> </div> ',buffer}),partials["R.Module.TargetedInvite.module_templates.progress_bar"]=templates.progress_bar=template(function(Handlebars,depth0,helpers,partials,data){helpers=helpers||Handlebars.helpers;var buffer="",stack1,foundHelper,functionType="function",escapeExpression=this.escapeExpression;return buffer+='<span class="rondavu_limit_remaining">0</span> <div class="rondavu_progress_bar_container"> <div class="rondavu_progress_bar" style="width: ',foundHelper=helpers.percentage,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.percentage,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'%;"></div> <div class="rondavu_progress_bar_mask"></div> </div> <span class="rondavu_limit_remaining">',foundHelper=helpers.limit,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.limit,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+"</span> ",buffer})}(),R.Module.FacePack=function(config){R.Module.prototype.initializer.call(this,config),this.initializer(config)},function(){R.Module.FacePack.prototype=new R.Module,r$.extend(R.Module.FacePack.prototype,{name:"facepack",base_url:"rondavu/facepack/",initializer:function(){},initHtmlEvents:function(){this.delegate("click",function(){this.trackEventForPrimaryMo("clicked on call to action button"),this.FB.requestPerms(this.reloadModule)},".facepack_opt_in")},handleMessage:function(message){message.type==="fb.login"||message.type==="fb.logout"?this.reloadModule():message.type==="su.created"&&(R.Logger.debug("received su.created message"),this.reloadModule())},reloadModule:function(){this.load(this.base_url+"reload/",this.config.div.id,{mos_etags:!0})}})}(),R.Module.Connector=function(config){R.Module.prototype.initializer.call(this,config),this.initializer(config)},function(){var NON_PASSIVE_ACTIONS={comment:!0,like:!0};R.Module.Connector.prototype=new R.Module,r$.extend(R.Module.Connector.prototype,{name:"Connector",relative_class:"relative_to_welcome_app",baseUrl:"rondavu/connector/",defineApi:function(){var self=this,fireEverShareActionOptionDefaults={su_id:null,properties:{}};self.api={fireEverShareAction:function(action_name,options){options=_.defaults(options||{},fireEverShareActionOptionDefaults);if(!R.FB.hasPerms(R.FB.constants.perm.PUBLISH_ACTIONS)){R.Logger.debug("Could not publish action because the user did not grant necessary permissions."),typeof options.on_failure=="function"&&options.on_failure();return}var mo_id=null,mo_type=null;if(options&&options.mo_id){var customer_provided_mo_id=options.mo_id;if(!customer_provided_mo_id.id||!customer_provided_mo_id.type){R.Logger.error("Customer passed invalid mo_id object. If mo_id is specified, mo_id.id and mo_id.type are required"),typeof options.on_failure=="function"&&options.on_failure();return}mo_id=customer_provided_mo_id.id,mo_type=customer_provided_mo_id.type}else if(!options||!options.ignore_primary_mo_id){var primary_mo_id=R.PageDataManager.getPrimaryMoId();if(!primary_mo_id){R.Logger.error("Primary mo not found. Cannot log action: "+action_name+" because mo_id was not provided by the customer."),typeof options.on_failure=="function"&&options.on_failure();return}mo_id=primary_mo_id.id,mo_type=primary_mo_id.type}if(action_name==="video_watch_start"&&mo_type.substr(0,5)==="video"){setTimeout(function(){window.SL.push(["fireEverShareAction","watch",options])},1e4);return}if(!self.isGoodTimeToPublishAction(action_name,mo_id,mo_type))return;var data={action_name:action_name,mo_id:mo_id,mo_type:mo_type};options.feature_page_id_override&&(data.feature_page_id_override=options.feature_page_id_override),_.size(options.properties)>0&&(data.properties_json=R.JSON.stringify(options.properties));var publishFailureCb=function(response){R.Logger.error("Error thrown while trying to log publish_action from fireEverShareAction. Action was "+action_name),typeof options.on_failure=="function"&&options.on_failure(response)};options.su_id?self.ajax(self.baseUrl+"get_fb_publish_info",{data:data,success:function(response){var fbPublishInfo=response.fb_publish_info;self.publishAction({publish_on_clientside:!0,object_url:fbPublishInfo.objectUrl,object_type:fbPublishInfo.objectType,publish_namespace:fbPublishInfo.namespace,publish_action_name:fbPublishInfo.publishActionName,ref:fbPublishInfo.ref,su_id:options.su_id,customer_mo_id:fbPublishInfo.customerMoId,customer_mo_type:fbPublishInfo.customerMoType,publish_properties:options.properties},!0),typeof options.on_success=="function"&&options.on_success()},failure:publishFailureCb}):self.ajax("/rondavu/connector/create_su_for_publishing",{data:data,success:function(response){R.ModuleManager.notifyAllModules(new R.Module.Message.OGActionCreated),typeof options.on_success=="function"&&options.on_success(response)},failure:publishFailureCb})}}},initializer:function(){var self=this;R.Event.listen("modules_initialized",function(){R.Logger.debug("checking for a fresh visit"),R.StorageManager.storeVisitIfNew()&&(R.Logger.debug("new visit found - logging"),window.SL.push(["fireEverShareAction","site_visit",{ignore_primary_mo_id:!0}])),self.getPrimaryMoType()==="article"&&setTimeout(function(){window.SL.push(["fireEverShareAction","read"])},1e4);var browse_pdp_product_mo_types=self.getParameter("Connector.ProductMoType").split(",");R.Util.indexOf(browse_pdp_product_mo_types,self.getPrimaryMoType())>=0&&setTimeout(function(){window.SL.push(["fireEverShareAction","browse_pdp"])},1e4)}),self.initEverShareWarningConfig()},getPrimaryMoType:function(){var mo_id=R.PageDataManager.getPrimaryMoId();return mo_id?mo_id.type:null},initHtmlEvents:function(){this.initHtmlEventsForNotification()},handleMessage:function(message){var self=this;if(message.type==="su.created"){var fb_publish_info=message.fb_publish_info;R.Util.each(fb_publish_info,function(i){var publish_info={publish_on_clientside:i.fbPublishDirective.toUpperCase()==="CLIENT_SIDE",object_url:i.objectUrl,object_type:i.objectType,publish_namespace:i.namespace,publish_action_name:i.publishActionName,ref:i.ref,su_id:i.suId,customer_mo_id:i.customerMoId,customer_mo_type:i.customerMoType,publish_properties:i.publishPropertiesJson?R.JSON.parse(i.publishPropertiesJson):undefined};self.publishAction(publish_info),R.Logger.debug("Published to FB with",publish_info)})}},initEverShareWarningConfig:function(){var enabled=this.getBooleanParameter("Connector.EverShareWarning.Enable"),dismissible=this.getBooleanParameter("Connector.EverShareWarning.Dismiss.Enable"),dismissed=!1,dismiss_text="";if(enabled&&dismissible){var user=R.StorageManager.getLocalObject(R.StorageManager.getFBUserKey());dismissed=user!==null?user.dismiss_evershare_warning:!1,dismiss_text=this.getParameter("Connector.EverShareWarning.Dismiss.Text")}R.Event.fireAndRemember("evershare_warning_dismiss_config",{dismissible:dismissible,dismissed:dismissed,dismiss_text:dismiss_text})},publishAction:function(publish_info,messagePrompted){var should_publish=!0,reason="";R.Core.config.evershare_enabled?publish_info.publish_on_clientside?R.FB.hasPerms(R.FB.constants.perm.PUBLISH_ACTIONS)?this.getBooleanParameter("SuAction."+publish_info.publish_action_name+".Enable")||(should_publish=!1,reason=publish_info.publish_action_name+" actions are not enabled in the Connector config."):(should_publish=!1,reason="the app does not have the publish_actions permission for the user."):(should_publish=!1,reason="this action is not configured to be published on client side."):(should_publish=!1,reason="evershare is not enabled for this customer."),should_publish?this.doPublishingAction(publish_info,messagePrompted):R.Logger.debug('The "'+publish_info.publish_action_name+'" action was not published because '+reason)},doPublishingAction:function(publish_info,messagePrompted){var self=this,object_ref_url=publish_info.object_url,object_type=publish_info.object_type,namespace=publish_info.publish_namespace,action_name=publish_info.publish_action_name.toLowerCase(),ref=publish_info.ref,action_properties=publish_info.publish_properties,userTracking=this.getUserTracking();userTracking&&(ref===""&&(ref="p="+this.config.feature_page_id.split("&")[0]),ref+="__"+userTracking);var params={};params[object_type]=object_ref_url,params.ref=ref,action_properties&&typeof action_properties=="object"&&(action_name==="review"&&self.calculateRatingForReviewAction(action_properties),r$.each(action_properties,function(property_name,property_value){params[property_name]=property_value}));var action_path=namespace+":"+action_name,fb_builtin_actions={read:"news.reads",watch:"video.watches"};r$.each(fb_builtin_actions,function(name,path){if(action_name===name)return action_path=path,!1}),R.FB.api("/me/"+action_path,function(response){if(response.id){var fb_graph_object_id=response.id;R.Logger.debug("Action has been published successfully. Its facebook graph object id is "+fb_graph_object_id+"."),self.saveFbGraphObjectIdForSu(publish_info.su_id,fb_graph_object_id,action_name,messagePrompted)}else response.error&&R.Logger.error("Open graph publishing failed:",response.error)},"post",params)},calculateRatingForReviewAction:function(action_properties){var max_rating=action_properties.max_rating||5,rating=action_properties.rating||0;rating=Math.min(rating,max_rating);var normalized_rating=Math.round(rating/max_rating*10)/2,full_star_count=Math.floor(normalized_rating),has_half_star=normalized_rating-full_star_count>=.5,star_rating=(new Array(full_star_count+1)).join("★");star_rating=has_half_star?star_rating+"½":star_rating,action_properties.rating=star_rating,delete action_properties.max_rating},saveFbGraphObjectIdForSu:function(su_id,fb_graph_object_id,action_name,messagePrompted){var self=this;R.Event.fire("connector.fb_action_published",{su_id:su_id,fb_og_id:fb_graph_object_id,action_name:action_name,messagePrompted:messagePrompted}),self.ajax("/rondavu/connector/save_fb_graph_object_id_for_su",{data:{su_id:su_id,fb_graph_object_id:fb_graph_object_id},success:function(response){var enabled=this.getBooleanParameter("Connector.EverShareWarning.Enable"),user=R.StorageManager.getLocalObject(R.StorageManager.getFBUserKey()),dismissed=user!==null?user.dismiss_evershare_warning:!1,is_passive_action=NON_PASSIVE_ACTIONS[action_name.toLowerCase()]!==!0;enabled&&is_passive_action&&!dismissed&&self.showNotification({su_id:su_id,action_name:response.display_action_name,mo_name:response.mo_name})}})},isGoodTimeToPublishAction:function(action_name,mo_id,mo_type){var interval=parseInt(this.getParameter("Connector.PublishActionInterval"),10);if(!interval)return!0;var storage=R.StorageManager,storage_key=storage.getPublishedActionsKey(),published_actions=storage.getLocalObject(storage_key)||{},action_mo_key=action_name+"-"+mo_id+"-"+mo_type,current_time=(new Date).getTime(),should_publish=!published_actions[action_mo_key]||(current_time-published_actions[action_mo_key].timestamp)/6e4>interval;return should_publish?(published_actions[action_mo_key]={timestamp:current_time},storage.setLocalObject(storage_key,published_actions)):R.Logger.debug("This action will not be published. Only "+(current_time-published_actions[action_mo_key].timestamp)/1e3+" seconds has passed since the last time you published a "+action_name+" action for mo {id: "+mo_id+", type: "+mo_type+"}. But publish interval is "+interval+" minute(s)."),should_publish},_notification_overlay:r$('<div class="sl_notification_overlay" style="display: none" />'),showNotification:function(data){var self=this,positioning_class=this.getParameter("Connector.EverShareWarning.NotificationPosition"),message=this.getParameter("Connector.EverShareWarning.Text"),dismiss_text=this.getParameter("Connector.EverShareWarning.Dismiss.Text"),cancel_share=this.getParameter("Connector.EverShareWarning.CancelShare"),share_title=this.getParameter("Connector.EverShareWarning.Title"),template_html='<div class="rondavu_module_content"><div class="close">&times;</div><div class="notification_title"><span>'+share_title+"</span>"+"</div>"+'<div class="message">'+'<span class="text">'+message+"</span>"+'<a class="cancel" title="delete" id="activity_item_%{su_id}">'+cancel_share+"</a>"+"</div>"+'<div class="dismiss_evershare_warning">'+"<label>"+'<input type="checkbox">'+'<span class="text">'+dismiss_text+"</span>"+"</label>"+"</div>"+'<div class="rondavu_clearfix"></div>'+"</div>",overlay=this._notification_overlay;overlay.addClass(positioning_class),overlay.html(this.applyTemplate(template_html,data)).appendTo(r$("body")).fadeIn("fast");if(positioning_class==this.relative_class&&r$(".sl_welcome_message_container").size()){var left=r$(".sl_welcome_message_container").offset().left,top=r$(".sl_welcome_message_container").offset().top+20;overlay.css("position","absolute"),overlay.css("left",left),overlay.css("top",top)}this.getBooleanParameter("Connector.EverShareWarning.Dismiss.Enable")||r$(".dismiss_evershare_warning",overlay).remove();var duration=self.getParameter("Connector.EverShareWarning.Duration")*1e3,setup_timer=function(){return setTimeout(function(){overlay.fadeOut("slow",function(){r$(this).hide()})},duration)};self.timer=setup_timer(),overlay.mouseenter(function(){clearTimeout(self.timer)}),overlay.mouseleave(function(){self.timer=setup_timer()})},initHtmlEventsForNotification:function(){var self=this;r$(self._notification_overlay).delegate(".close","click",function(){return self._notification_overlay.hide(),clearTimeout(self.timer),!1}),r$(self._notification_overlay).delegate(".delete, .cancel","click",function(e){var su_id=e.target.id.replace("activity_item_","");return R.FB.deleteAction(su_id),self._notification_overlay.hide(),clearTimeout(self.timer),!1}),r$(self._notification_overlay).delegate(".dismiss_evershare_warning :checkbox","change",function(e){R.StorageManager.createOrUpdateLocalObject(R.StorageManager.getFBUserKey(),{dismiss_evershare_warning:e.target.checked}),self.notifyOtherModules(new R.Module.Message.User.DismissEverShareWarningSettingChanged)})},applyTemplate:function(template_html,template_data){return template_html.replace(/%\{(.+?)\}/g,function(dummy,match){return template_data[match]})},getUserTracking:function(){var userTracking=[];return R.PageDataManager.getPageData().user!==undefined&&R.PageDataManager.getPageData().user.tracking!==undefined&&R.Util.each(R.PageDataManager.getPageData().user.tracking,function(userParam){userParam.name&&userParam.value&&userTracking.push(userParam.name+"="+userParam.value)}),userTracking.join("/")}})}(),function(){var root=this,previousUnderscore=root._,breaker={},ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,unshift=ArrayProto.unshift,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,_=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.4.2";var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++)if(iterator.call(context,obj[i],i,obj)===breaker)return}else for(var key in obj)if(_.has(obj,key)&&iterator.call(context,obj[key],key,obj)===breaker)return};_.map=_.collect=function(obj,iterator,context){var results=[];return obj==null?results:nativeMap&&obj.map===nativeMap?obj.map(iterator,context):(each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list)}),results)},_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;obj==null&&(obj=[]);if(nativeReduce&&obj.reduce===nativeReduce)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduce(iterator,memo):obj.reduce(iterator);each(obj,function(value,index,list){initial?memo=iterator.call(context,memo,value,index,list):(memo=value,initial=!0)});if(!initial)throw new TypeError("Reduce of empty array with no initial value");return memo},_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;obj==null&&(obj=[]);if(nativeReduceRight&&obj.reduceRight===nativeReduceRight)return context&&(iterator=_.bind(iterator,context)),arguments.length>2?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}each(obj,function(value,index,list){index=keys?keys[--length]:--length,initial?memo=iterator.call(context,memo,obj[index],index,list):(memo=obj[index],initial=!0)});if(!initial)throw new TypeError("Reduce of empty array with no initial value");return memo},_.find=_.detect=function(obj,iterator,context){var result;return any(obj,function(value,index,list){if(iterator.call(context,value,index,list))return result=value,!0}),result},_.filter=_.select=function(obj,iterator,context){var results=[];return obj==null?results:nativeFilter&&obj.filter===nativeFilter?obj.filter(iterator,context):(each(obj,function(value,index,list){iterator.call(context,value,index,list)&&(results[results.length]=value)}),results)},_.reject=function(obj,iterator,context){var results=[];return obj==null?results:(each(obj,function(value,index,list){iterator.call(context,value,index,list)||(results[results.length]=value)}),results)},_.every=_.all=function(obj,iterator,context){iterator||(iterator=_.identity);var result=!0;return obj==null?result:nativeEvery&&obj.every===nativeEvery?obj.every(iterator,context):(each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker}),!!result)};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=!1;return obj==null?result:nativeSome&&obj.some===nativeSome?obj.some(iterator,context):(each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return breaker}),!!result)};_.contains=_.include=function(obj,target){var found=!1;return obj==null?found:nativeIndexOf&&obj.indexOf===nativeIndexOf?obj.indexOf(target)!=-1:(found=any(obj,function(value){return value===target}),found)},_.invoke=function(obj,method){var args=slice.call(arguments,2);return _.map(obj,function(value){return(_.isFunction(method)?method:value[method]).apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,function(value){return value[key]})},_.where=function(obj,attrs){return _.isEmpty(attrs)?[]:_.filter(obj,function(value){for(var key in attrs)if(attrs[key]!==value[key])return!1;return!0})},_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.max.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity};return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed})}),result.value},_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.min.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity};return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed})}),result.value},_.shuffle=function(obj){var rand,index=0,shuffled=[];return each(obj,function(value){rand=_.random(index++),shuffled[index-1]=shuffled[rand],shuffled[rand]=value}),shuffled};var lookupIterator=function(value){return _.isFunction(value)?value:function(obj){return obj[value]}};_.sortBy=function(obj,value,context){var iterator=lookupIterator(value);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index<right.index?-1:1}),"value")};var group=function(obj,value,context,behavior){var result={},iterator=lookupIterator(value);return each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)}),result};_.groupBy=function(obj,value,context){return group(obj,value,context,function(result,key,value){(_.has(result,key)?result[key]:result[key]=[]).push(value)})},_.countBy=function(obj,value,context){return group(obj,value,context,function(result,key,value){_.has(result,key)||(result[key]=0),result[key]++})},_.sortedIndex=function(array,obj,iterator,context){iterator=iterator==null?_.identity:lookupIterator(iterator);var value=iterator.call(context,obj),low=0,high=array.length;while(low<high){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low},_.toArray=function(obj){return obj?obj.length===+obj.length?slice.call(obj):_.values(obj):[]},_.size=function(obj){return obj.length===+obj.length?obj.length:_.keys(obj).length},_.first=_.head=_.take=function(array,n,guard){return n!=null&&!guard?slice.call(array,0,n):array[0]},_.initial=function(array,n,guard){return slice.call(array,0,array.length-(n==null||guard?1:n))},_.last=function(array,n,guard){return n!=null&&!guard?slice.call(array,Math.max(array.length-n,0)):array[array.length-1]},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)},_.compact=function(array){return _.filter(array,function(value){return!!value})};var flatten=function(input,shallow,output){return each(input,function(value){_.isArray(value)?shallow?push.apply(output,value):flatten(value,shallow,output):output.push(value)}),output};_.flatten=function(array,shallow){return flatten(array,shallow,[])},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.uniq=_.unique=function(array,isSorted,iterator,context){var initial=iterator?_.map(array,iterator,context):array,results=[],seen=[];return each(initial,function(value,index){if(isSorted?!index||seen[seen.length-1]!==value:!_.contains(seen,value))seen.push(value),results.push(array[index])}),results},_.union=function(){return _.uniq(concat.apply(ArrayProto,arguments))},_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0})})},_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(){var args=slice.call(arguments),length=_.max(_.pluck(args,"length")),results=new Array(length);for(var i=0;i<length;i++)results[i]=_.pluck(args,""+i);return results},_.object=function(list,values){var result={};for(var i=0,l=list.length;i<l;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,l=array.length;if(isSorted){if(typeof isSorted!="number")return i=_.sortedIndex(array,item),array[i]===item?i:-1;i=isSorted<0?Math.max(0,l+isSorted):isSorted}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;i<l;i++)if(array[i]===item)return i;return-1},_.lastIndexOf=function(array,item,from){if(array==null)return-1;var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item);var i=hasIndex?from:array.length;while(i--)if(array[i]===item)return i;return-1},_.range=function(start,stop,step){arguments.length<=1&&(stop=start||0,start=0),step=arguments[2]||1;var len=Math.max(Math.ceil((stop-start)/step),0),idx=0,range=new Array(len);while(idx<len)range[idx++]=start,start+=step;return range};var ctor=function(){};_.bind=function bind(func,context){var bound,args;if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;return args=slice.call(arguments,2),bound=function(){if(this instanceof bound){ctor.prototype=func.prototype;var self=new ctor,result=func.apply(self,args.concat(slice.call(arguments)));return Object(result)===result?result:self}return func.apply(context,args.concat(slice.call(arguments)))}},_.bindAll=function(obj){var funcs=slice.call(arguments,1);return funcs.length==0&&(funcs=_.functions(obj)),each(funcs,function(f){obj[f]=_.bind(obj[f],obj)}),obj},_.memoize=function(func,hasher){var memo={};return hasher||(hasher=_.identity),function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))},_.throttle=function(func,wait){var context,args,timeout,throttling,more,result,whenDone=_.debounce(function(){more=throttling=!1},wait);return function(){context=this,args=arguments;var later=function(){timeout=null,more&&(result=func.apply(context,args)),whenDone()};return timeout||(timeout=setTimeout(later,wait)),throttling?more=!0:(throttling=!0,result=func.apply(context,args)),whenDone(),result}},_.debounce=function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||(result=func.apply(context,args))},callNow=immediate&&!timeout;return clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&(result=func.apply(context,args)),result}},_.once=function(func){var ran=!1,memo;return function(){return ran?memo:(ran=!0,memo=func.apply(this,arguments),func=null,memo)}},_.wrap=function(func,wrapper){return function(){var args=[func];return push.apply(args,arguments),wrapper.apply(this,args)}},_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--)args=[funcs[i].apply(this,args)];return args[0]}},_.after=function(times,func){return times<=0?func():function(){if(--times<1)return func.apply(this,arguments)}},_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=[];for(var key in obj)_.has(obj,key)&&(keys[keys.length]=key);return keys},_.values=function(obj){var values=[];for(var key in obj)_.has(obj,key)&&values.push(obj[key]);return values},_.pairs=function(obj){var pairs=[];for(var key in obj)_.has(obj,key)&&pairs.push([key,obj[key]]);return pairs},_.invert=function(obj){var result={};for(var key in obj)_.has(obj,key)&&(result[obj[key]]=key);return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=function(obj){return each(slice.call(arguments,1),function(source){for(var prop in source)obj[prop]=source[prop]}),obj},_.pick=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));return each(keys,function(key){key in obj&&(copy[key]=obj[key])}),copy},_.omit=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj)_.contains(keys,key)||(copy[key]=obj[key]);return copy},_.defaults=function(obj){return each(slice.call(arguments,1),function(source){for(var prop in source)obj[prop]==null&&(obj[prop]=source[prop])}),obj},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!=toString.call(b))return!1;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;var length=aStack.length;while(length--)if(aStack[length]==a)return bStack[length]==b;aStack.push(a),bStack.push(b);var size=0,result=!0;if(className=="[object Array]"){size=a.length,result=size==b.length;if(result)while(size--)if(!(result=eq(a[size],b[size],aStack,bStack)))break}else{var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor))return!1;for(var key in a)if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break}if(result){for(key in b)if(_.has(b,key)&&!(size--))break;result=!size}}return aStack.pop(),bStack.pop(),result};_.isEqual=function(a,b){return eq(a,b,[],[])},_.isEmpty=function(obj){if(obj==null)return!0;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return!1;return!0},_.isElement=function(obj){return!!obj&&obj.nodeType===1},_.isArray=nativeIsArray||function(obj){return toString.call(obj)=="[object Array]"},_.isObject=function(obj){return obj===Object(obj)},each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return!!obj&&!!_.has(obj,"callee")}),typeof /./!="function"&&(_.isFunction=function(obj){return typeof obj=="function"}),_.isFinite=function(obj){return _.isNumber(obj)&&isFinite(obj)},_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj},_.isBoolean=function(obj){return obj===!0||obj===!1||toString.call(obj)=="[object Boolean]"},_.isNull=function(obj){return obj===null},_.isUndefined=function(obj){return obj===void 0},_.has=function(obj,key){return hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.times=function(n,iterator,context){for(var i=0;i<n;i++)iterator.call(context,i)},_.random=function(min,max){return max==null&&(max=min,min=0),min+(0|Math.random()*(max-min+1))};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){return string==null?"":(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}}),_.result=function(object,property){if(object==null)return null;var value=object[property];return _.isFunction(value)?value.call(object):value},_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=idCounter++;return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]}),source+=escape?"'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'":interpolate?"'+\n((__t=("+interpolate+"))==null?'':__t)+\n'":evaluate?"';\n"+evaluate+"\n__p+='":"",index=offset+match.length}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};return template.source="function("+(settings.variable||"obj")+"){\n"+source+"}",template},_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_),each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),(name=="shift"||name=="splice")&&obj.length===0&&delete obj[0],result.call(this,obj)}}),each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}}),_.extend(_.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),R.Module.FriendsActivityPack=function(config){R.Module.prototype.initializer.call(this,config),this.initializer(config)},function(){R.Module.FriendsActivityPack.prototype=new R.Module;var FreshnessIndicatorType={BADGE:"badge",TIMESTAMP:"timestamp"};r$.extend(R.Module.FriendsActivityPack.prototype,{name:"friendsactivitypack",base_url:"rondavu/friendsactivitypack/",direction:"horizontal",carousel_enabled:!1,display_grid:"grid",display_row:"row",news_feed:"news_feed",storage_key:"SL-FRIENDS-ACTIVITY-"+R.Core.config.customer_name,freshness_indicator_type:null,initializer:function(config){this.direction=this.getParameter("FriendsActivityPack.Direction"),this.carousel_enabled=this.getBooleanParameter("FriendsActivityPack.Carousel.Enabled"),this.gridConfig={enabled:this.getBooleanParameter("FriendsActivityPack.Grid.Enable"),rows:parseInt(this.getParameter("FriendsActivityPack.Grid.NumRows"),10),cols:parseInt(this.getParameter("FriendsActivityPack.Grid.NumColumns"),10)},this.getEl().addClass("sl_grid_"+(this.gridConfig.enabled?"on":"off")),this.getEl().addClass("sl_display_"+this.getParameter("FriendsActivityPack.Activity.FeedType")),this.carousel_enabled&&r$(this.getEl()).addClass("sl_carousel_on"),r$(this.getEl()).addClass("sl_"+this.direction),this.initFreshnessIndicatorType(),this.setUpTemplates(),config.init_data.should_render&&this.renderFriendsActivityPack(),this.updateSparseClasses(config.init_data.is_sparse)},initFreshnessIndicatorType:function(){this.freshness_indicator_type=this.getParameter("FriendsActivityPack.Activity.FreshnessIndicator.Type")},initHtmlEvents:function(){var self=this;self.delegate("mouseenter",function(e){var $elem=r$(e.currentTarget),uid=$elem.data("friend-facebook-id"),friendActivitiesContainer=$elem.hasClass("friend_activities_container")?$elem:this.getEl().find(".friend_activities_container[data-friend-facebook-id="+uid+"]");clearTimeout(friendActivitiesContainer.data("hide-timeout"));var t=setTimeout(function(){self.showActivityOverlayContainer($elem)},500);friendActivitiesContainer.data("show-timeout",t)},".friend_activities_container, .activities_overlay_container.active",{logging:!1}),self.delegate("mouseleave",function(e){var $elem=r$(e.currentTarget),uid=$elem.data("friend-facebook-id"),friendActivitiesContainer=$elem.hasClass("friend_activities_container")?$elem:this.getEl().find(".friend_activities_container[data-friend-facebook-id="+uid+"]");clearTimeout(friendActivitiesContainer.data("show-timeout"));var t=setTimeout(function(){self.hideActivityOverlayContainer($elem)},500);friendActivitiesContainer.data("hide-timeout",t)},".friend_activities_container, .activities_overlay_container.active",{logging:!1}),self.delegate("click",function(e){var $elem=r$(e.currentTarget);$elem.toggleClass("pressed");var is_following=$elem.hasClass("pressed");$elem.html(is_following?"Following":"Follow");var friend_key=R.StorageManager.getFBUserKey()+"-"+$elem.attr("data-fb-user-id");R.StorageManager.setLocalObject(friend_key,is_following)},".rondavu_button.follow",{is_cta:!0})},getOverlayPosition:function(containerPosition,el){var self=this,result={css_class:"overlay_"},extraSpace=10,userActivities=el.find(".user_activities"),overlayWidth=userActivities.outerWidth(!0),overlayHeight=userActivities.outerHeight(!0),offset={left:el.offset().left-r$(window).scrollLeft(),top:el.offset().top-r$(window).scrollTop()};offset.right=r$(window).innerWidth()-(offset.left+el.outerWidth()),offset.bottom=r$(window).innerHeight()-(offset.top+el.outerHeight());var showOnTheSide=self.direction==="vertical"&&self.carousel_enabled&&!self.gridConfig.enabled,showOnLeft=offset.right<overlayWidth+(showOnTheSide?el.width():0)&&offset.right<offset.left,showAbove=offset.bottom<overlayHeight-(showOnTheSide?el.height():0)&&offset.bottom<offset.top;return self.carousel_enabled?showOnTheSide?(result.top=containerPosition.top+el.position().top,result.left=containerPosition.left+el.position().left,showOnLeft?(result.left-=overlayWidth+extraSpace,result.css_class+="left_"):(result.left+=el.width()+extraSpace,result.css_class+="right_"),showAbove?(result.top-=overlayHeight-el.height()+2*extraSpace,result.css_class+="above"):result.css_class+="below"):(result.top=containerPosition.top+el.position().top+el.height(),result.left=containerPosition.left+el.position().left,self.gridConfig.enabled&&(result.top+=el.parent().position().top,result.left+=el.parent().position().left),showOnLeft?(result.left-=overlayWidth-el.width(),result.css_class+="left_"):result.css_class+="right_",showAbove?(result.top-=overlayHeight+el.height()+2*extraSpace,result.css_class+="above"):result.css_class+="below"):showOnTheSide?(result.top=-el.height(),showOnLeft?(result.left=-(overlayWidth+extraSpace),result.css_class+="left_"):(result.left=el.width()+extraSpace,result.css_class+="right_"),showAbove?(result.top-=overlayHeight-el.height()+2*extraSpace,result.css_class+="above"):result.css_class+="below"):(result.top="auto",showOnLeft?(result.left=el.width()-overlayWidth,result.css_class+="left_"):(result.left="auto",result.css_class+="right_"),showAbove?(result.top=-overlayHeight-el.height()-2*extraSpace,result.css_class+="above"):result.css_class+="below"),result},showActivityOverlayContainer:function($elem){var self=this,activityCont=$elem.find(".activities_overlay_container").show();if(activityCont.size()>0){var containerPosition=this.getEl().find(".friends_activity_pack").position(),overlayPos=self.getOverlayPosition(containerPosition,$elem);activityCont.css({top:overlayPos.top,left:overlayPos.left,width:$elem.find(".user_activities").outerWidth(!0)}),self.carousel_enabled&&(self.getEl().find(".carousel_container").prepend(activityCont),activityCont.addClass("active"),$elem.addClass("active")),activityCont.removeClass(function(index,css){return(css.match(/overlay_(left|right)_(above|below)/g)||[]).join(" ")}),activityCont.addClass(overlayPos.css_class),activityCont.attr("data-friend-facebook-id",$elem.data("friend-facebook-id")),self.resetFreshnessIndicator($elem);var params={type:"delegate",action:"click",selector:".friend_activities_container",module:this.name,primary_mo_url:R.PageDataManager.getMoDetailUrl()};R.Tracker.addMosIds(params),this.s3Log(params)}},hideActivityOverlayContainer:function($elem){var self=this;if(self.carousel_enabled){var activity_cont=this.getEl().find(".activities_overlay_container.active[data-friend-facebook-id="+$elem.data("friend-facebook-id")+"]").removeClass("active").hide();$elem.removeClass("active"),this.getEl().find(".friend_activities_container[data-friend-facebook-id="+$elem.data("friend-facebook-id")+"]").append(activity_cont)}else $elem.find(".activities_overlay_container").hide();var friend_facebook_id=$elem.data("friend-facebook-id");self.updateFriendsActivityDataInStorage(friend_facebook_id,{last_viewed_timestamp:(new Date).getTime()})},renderFriendsActivityPack:function(){var self=this,init_data=self.getTemplateData();if(self.freshness_indicator_type===FreshnessIndicatorType.BADGE)self.calculateUnreadActivityCount(init_data.data);else{if(self.freshness_indicator_type!==FreshnessIndicatorType.TIMESTAMP){R.Logger.error('Activity freshness indicator type "'+self.freshness_indicator_type+'" is not supported. Check the SFS config.');return}self.calculateLatestActivityTimestamp(init_data.data)}R.FacebookUserMap.addUsersById(this.getFacebookIdsForFaces(init_data.data),function(){var module_html=self.getModuleHtml(init_data);self.getEl().html(module_html).addClass("activity_freshness_indicator_"+self.freshness_indicator_type),self.gridConfig.enabled&&self.initGrid(),self.carousel_enabled&&self.initCarousel()})},initGrid:function(){var friendContainer=r$(this.getEl().find("li.friend_activities_container")),calculatedWidth=friendContainer.width()*this.gridConfig.cols,calculatedHeight=friendContainer.height()*this.gridConfig.rows;this.getEl().find(".grid_page").css({width:calculatedWidth,height:calculatedHeight})},initCarousel:function(){var self=this,dispItemsNum,containerWidth=this.getEl().find("li.friend_activities_container").outerWidth(!0),calculatedWidth;self.gridConfig.enabled?(dispItemsNum=1,calculatedWidth=containerWidth*self.gridConfig.cols):(dispItemsNum=parseInt(this.getParameter("FriendsActivityPack.Carousel.MaxVisible"),10),calculatedWidth=containerWidth*dispItemsNum),self.getEl().find(".carousel_container").css("width",calculatedWidth),self.getEl().find("div.carousel_container").carousel({direction:self.direction,dispItems:dispItemsNum,nextBtn:'<div class="arrow next_arrow next"/>',prevBtn:'<div class="arrow prev_arrow prev"/>',prevBtnInsert:"insertAfter"})},getTemplateData:function(){var self=this,data=r$.extend({},self.config.init_data||{});data.super_title_bar=self.getParameter("Common.Layout.SuperTitleBar.Text");if(self.gridConfig.enabled){data.displayFacesInGrid=!0,data.pagesOfFaces=[];var facesPerPage=self.gridConfig.rows*self.gridConfig.cols;for(var partitionStart=0,partitionEnd=0;partitionEnd<data.data.length;partitionStart+=facesPerPage){var potentialEnd=partitionStart+facesPerPage;partitionEnd=potentialEnd>data.data.length?data.data.length:potentialEnd,data.pagesOfFaces.push(data.data.slice(partitionStart,partitionEnd))}}return self.postProcessData(data),data},postProcessData:function(init_data){var self=this,feed_type=self.getParameter("FriendsActivityPack.Activity.FeedType");(feed_type==self.display_grid||feed_type==self.display_row)&&r$.each(init_data.data,function(index,friend_obj){friend_obj.activity_list=_.uniq(friend_obj.activity_list,!1,function(activity){return activity.mo_pic_url}),friend_obj.activity_list=_.first(friend_obj.activity_list,4)}),self.getBooleanParameter("FriendsActivityPack.FollowButton.Enable")&&r$.each(init_data.data,function(index,friend_obj){var friend_key=R.StorageManager.getFBUserKey()+"-"+friend_obj.user_facebook_id;friend_obj.follow_enabled=!0,friend_obj.following_pressed=R.StorageManager.getLocalObject(friend_key)}),self.appendTrackingToUrls(init_data)},appendTrackingToUrls:function(init_data){var self=this,data=init_data.data;r$.each(data,function(index,friend_obj){var friend_activity_list=friend_obj.activity_list;r$.each(friend_activity_list,function(index,activity){R.Tracker.addTrackingToMo(activity,self)})})},handleMessage:function(message){var self=this;(message.type==="fb.login"||message.type==="fb.logout")&&self.ajax(self.base_url+"get_friends_activity_pack_list",{data:{},success:function(response){self.config.init_data.data=response.data,response.should_render?(this.renderFriendsActivityPack(),self.updateSparseClasses(response.is_sparse)):self.getEl().html("")}})},getFacebookIdsForFaces:function(friendObjectList){return r$.map(friendObjectList,function(friend){return friend.user_facebook_id?friend.user_facebook_id:null})},updateFriendsActivityDataInStorage:function(friend_facebook_id,data){var local_object=R.StorageManager.getLocalObject(this.storage_key)||{};local_object[friend_facebook_id]=r$.extend(!0,local_object[friend_facebook_id]||{},data),R.StorageManager.setLocalObject(this.storage_key,local_object)},calculateUnreadActivityCount:function(friends_activity_pack){var local_object=R.StorageManager.getLocalObject(this.storage_key)||{};r$.each(friends_activity_pack,function(i,friend){var friend_facebook_id=friend.user_facebook_id;local_object[friend_facebook_id]?(friend.unread_activity_count=0,r$.each(friend.activity_list,function(j,activity){if(!(activity.timestamp>local_object[friend_facebook_id].last_viewed_timestamp))return!1;friend.unread_activity_count++})):friend.unread_activity_count=friend.activity_list.length})},calculateLatestActivityTimestamp:function(friends_activity_pack){var self=this;r$.each(friends_activity_pack,function(i,friend){friend.latest_activity_timestamp=self.shortFormatTime(friend.activity_list[0].timestamp)})},resetFreshnessIndicator:function($elem){this.freshness_indicator_type===FreshnessIndicatorType.BADGE&&r$(".unread_activity_count",$elem).hide()},shortFormatTime:function(timestamp){var elapsed=((new Date).getTime()-timestamp)/1e3,ONE_MINUTE=60,ONE_HOUR=3600,ONE_DAY=86400;return elapsed<ONE_MINUTE?Math.floor(elapsed)+"s":elapsed<ONE_HOUR?Math.floor(elapsed/ONE_MINUTE)+"m":elapsed<ONE_DAY?Math.floor(elapsed/ONE_HOUR)+"h":Math.floor(elapsed/ONE_DAY)+"d"},setUpTemplates:function(){this.getModuleHtml=R.Module.FriendsActivityPack.templates.friendsactivitypack}})}(),function(g){g.fn.carousel=function(q){var q=g.extend({direction:"horizontal",loop:!1,dispItems:1,pagination:!1,paginationPosition:"inside",nextBtn:'<input type="button" value="Next" />',prevBtn:'<input type="button" value="Previous" />',btnsPosition:"inside",nextBtnInsert:"insertAfter",prevBtnInsert:"insertBefore",nextBtnInsertFn:!1,prevBtnInsertFn:!1,autoSlide:!1,autoSlideInterval:3e3,delayAutoSlide:!1,combinedClasses:!1,effect:"slide",slideEasing:"swing",animSpeed:300,equalWidths:"true",verticalMargin:0,callback:function(){},useAddress:!1,adressIdentifier:"carousel",tabLabel:function(r){return r},showEmptyItems:!0,ajaxMode:!1,ajaxUrl:"",stopSlideBtn:!1,stopSlideTextPause:"Pause",stopSlideTextPlay:"Play"},q);return q.btnsPosition=="outside"&&(q.prevBtnInsert="insertBefore",q.nextBtnInsert="insertAfter"),q.delayAutoSlide=0+q.delayAutoSlide,this.each(function(){var r={$elts:{},params:q,launchOnLoad:[]};r.$elts.carousel=g(this).addClass("js"),r.$elts.content=g(this).children().css({position:"absolute",top:0}),r.$elts.wrap=r.$elts.content.wrap('<div class="carousel-wrap"></div>').parent().css({overflow:"hidden",position:"relative"}),r.steps={first:0,count:r.$elts.content.children().length},r.$elts.loader=g('<div class="loader"></div>').css({position:"absolute"}),r.steps.last=r.steps.count-1,r.params.pagination&&o(r),g.isFunction(r.params.prevBtnInsertFn)?r.$elts.prevBtn=r.params.prevBtnInsertFn(r.$elts):q.btnsPosition=="outside"?r.$elts.prevBtn=g(q.prevBtn)[q.prevBtnInsert](r.$elts.carousel):r.$elts.prevBtn=g(q.prevBtn)[q.prevBtnInsert](r.$elts.wrap),g.isFunction(r.params.nextBtnInsertFn)?r.$elts.nextBtn=r.params.nextBtnInsertFn(r.$elts):q.btnsPosition=="outside"?r.$elts.nextBtn=g(q.nextBtn)[q.nextBtnInsert](r.$elts.carousel):r.$elts.nextBtn=g(q.nextBtn)[q.nextBtnInsert](r.$elts.wrap),r.$elts.nextBtn.addClass("carousel-control next carousel-next"),r.$elts.prevBtn.addClass("carousel-control previous carousel-previous"),r.lastItemsToLoad,d(r),r.$elts.carousel.attr("tabindex",0).add(r.$elts.carousel.children()).bind({focus:function(s){g(document).bind("keypress",function(t){switch(t.keyCode){case 39:r.$elts.nextBtn.click();break;case 37:r.$elts.prevBtn.click()}switch(t.charCode){case 110:r.$elts.nextBtn.click();break;case 112:r.$elts.prevBtn.click()}})},blur:function(){g(document).unbind("keypress")}}),n(r),g(function(){c(r),g.each(r.launchOnLoad,function(s,t){t()}),r.params.autoSlide&&f(r),q.stopSlideBtn==1&&(r.$elts.stopSlideBtn=g('<button type="button" class="slide-control play">'+q.stopSlideTextPause+"</button>"),a(r))})})};function c(s){var t=s.$elts.content.children(),r=0;t.each(function(){$item=g(this),$itemHeight=$item.outerHeight(),$itemHeight>r&&(r=$itemHeight)}),s.params.verticalMargin>0&&(r+=s.params.verticalMargin),t.height(r);var q=s.$elts.content.children(":first");s.itemWidth=q.outerWidth(),s.params.direction=="vertical"?s.contentWidth=s.itemWidth:s.params.equalWidths?s.contentWidth=s.itemWidth*s.steps.count:s.contentWidth=function(){var u=0;return s.$elts.content.children().each(function(){u+=g(this).outerWidth()}),u}(),s.$elts.content.width(s.contentWidth),s.itemHeight=r,s.params.direction=="vertical"?(s.$elts.content.css({height:s.itemHeight*s.steps.count+"px"}),s.$elts.content.parent().css({height:s.itemHeight*s.params.dispItems+"px"})):s.$elts.content.parent().css({height:s.itemHeight+"px"}),i(s)}function d(q){q.$elts.nextBtn.add(q.$elts.prevBtn).bind("enable",function(){var r=g(this).unbind("click").bind("click",function(){q.params.ajaxMode&&r.is(".next")&&b(q)==p(q)-1&&!q.lastItemsToLoad?(h(q),q.$elts.content.ajaxSuccess(function(){})):(e(q,j(q,r.is(".next")?"next":"prev")),q.params.stopSlideBtn==1?q.$elts.stopSlideBtn.trigger("pause"):m(q))}).removeClass("disabled").removeAttr("disabled");q.params.combinedClasses&&r.removeClass("next-disabled previous-disabled").removeAttr("disabled")}).bind("disable",function(){var r=g(this).unbind("click").addClass("disabled").attr("disabled","disabled");q.params.combinedClasses&&(r.is(".next")?r.addClass("next-disabled"):r.is(".previous")&&r.addClass("previous-disabled"))}).hover(function(){g(this).toggleClass("hover")})}function o(q){q.$elts.pagination=g('<div class="center-wrap"><div class="carousel-pagination"><p></p></div></div>')[q.params.paginationPosition=="outside"?"insertAfter":"appendTo"](q.$elts.carousel).find("p"),q.$elts.paginationBtns=g([]),q.$elts.content.find("li").each(function(r){r%q.params.dispItems==0&&k(q,r)})}function k(r,q){r.params.pagination&&(r.$elts.paginationBtns=r.$elts.paginationBtns.add(g('<a role="button"><span>'+r.params.tabLabel(r.$elts.paginationBtns.length+1)+"</span></a>").data("firstStep",q)).appendTo(r.$elts.pagination),r.$elts.paginationBtns.slice(0,1).addClass("active"),r.$elts.paginationBtns.click(function(s){e(r,g(this).data("firstStep")),r.params.stopSlideBtn==1?r.$elts.stopSlideBtn.trigger("pause"):m(r)}))}function n(q){q.params.useAddress&&g.isFunction(g.fn.address)?g.address.init(function(s){var r=g.address.pathNames();r[0]!==q.params.adressIdentifier||!r[1]?g.address.value("/"+q.params.adressIdentifier+"/1"):e(q,r[1]-1)}).change(function(s){var r=g.address.pathNames();r[0]===q.params.adressIdentifier&&!!r[1]&&e(q,r[1]-1)}):q.params.useAddress=!1}function e(q,r){q.params.callback(r),l(q,r),q.steps.first=r,i(q),q.params.useAddress&&g.address.value("/"+q.params.adressIdentifier+"/"+(r+1))}function j(r,q){if(q=="prev")return r.params.showEmptyItems?r.steps.first-r.params.dispItems>=0?r.steps.first-r.params.dispItems:r.params.loop?r.steps.count-r.params.dispItems:!1:r.steps.first==0?r.params.loop?r.steps.count-r.params.dispItems:!1:Math.max(0,r.steps.first-r.params.dispItems);if(q=="next")return r.steps.first+r.params.dispItems<r.steps.count?r.params.showEmptyItems?r.steps.first+r.params.dispItems:Math.min(r.steps.first+r.params.dispItems,r.steps.count-r.params.dispItems):r.params.loop?0:!1}function l(q,r){switch(q.params.effect){case"no":q.params.direction=="vertical"?q.$elts.content.css("top",-(q.itemHeight*r)+"px"):q.$elts.content.css("left",-(q.itemWidth*r)+"px");break;case"fade":q.params.direction=="vertical"?q.$elts.content.hide().css("top",-(q.itemHeight*r)+"px").fadeIn(q.params.animSpeed):q.$elts.content.hide().css("left",-(q.itemWidth*r)+"px").fadeIn(q.params.animSpeed);break;default:q.params.direction=="vertical"?q.$elts.content.stop().animate({top:-(q.itemHeight*r)+"px"},q.params.animSpeed,q.params.slideEasing):q.$elts.content.stop().animate({left:-(q.itemWidth*r)+"px"},q.params.animSpeed,q.params.slideEasing)}}function i(q){j(q,"prev")!==!1?q.$elts.prevBtn.trigger("enable"):q.$elts.prevBtn.trigger("disable"),j(q,"next")!==!1?q.$elts.nextBtn.trigger("enable"):q.$elts.nextBtn.trigger("disable"),q.params.pagination&&q.$elts.paginationBtns.removeClass("active").filter(function(){return g(this).data("firstStep")==q.steps.first}).addClass("active")}function f(q){q.delayAutoSlide=window.setTimeout(function(){q.autoSlideInterval=window.setInterval(function(){e(q,j(q,"next"))},q.params.autoSlideInterval)},q.params.delayAutoSlide)}function m(q){window.clearTimeout(q.delayAutoSlide),window.clearInterval(q.autoSlideInterval),q.params.delayAutoSlide=0}function a(r){var q=r.$elts.stopSlideBtn;q.bind({play:function(){f(r),q.removeClass("pause").addClass("play").html(r.params.stopSlideTextPause)},pause:function(){m(r),q.removeClass("play").addClass("pause").html(r.params.stopSlideTextPlay)}}),q.click(function(s){q.is(".play")?q.trigger("pause"):q.is(".pause")&&q.trigger("play")}),q.prependTo(r.$elts.wrap)}function p(q){return q.$elts.pagination.children().length}function b(q){return q.steps.first/q.params.dispItems}function h(q){q.$elts.carousel.prepend(q.$elts.loader),g.ajax({url:q.params.ajaxUrl,dataType:"json",success:function(r){q.lastItemsToLoad=r.bLastItemsToLoad,g(q.$elts.content).append(r.shtml),q.steps={first:q.steps.first+q.params.dispItems,count:q.$elts.content.children().length},q.steps.last=q.steps.count-1,c(q),k(q,q.steps.first),e(q,q.steps.first),q.params.stopSlideBtn==1?q.$elts.stopSlideBtn.trigger("pause"):m(q),q.$elts.loader.remove()}})}}(r$),function(){var template=Handlebars.template,templates=R.Module.FriendsActivityPack.templates={},partials=Handlebars.partials=Handlebars.partials||{};partials["R.Module.FriendsActivityPack.module_templates.ap_activity"]=templates.ap_activity=template(function(Handlebars,depth0,helpers,partials,data){helpers=helpers||Handlebars.helpers;var buffer="",stack1,foundHelper,functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;function program1(depth0,data){var buffer="",stack1,foundHelper;return buffer+='<a href="',foundHelper=helpers.mo_url,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.mo_url,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'"><img class="mo_pic" src="',foundHelper=helpers.mo_pic_url,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.mo_pic_url,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'" alt="',foundHelper=helpers.mo_name,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.mo_name,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'"></a>',buffer}buffer+='<li class="activity"> ',stack1=depth0.mo_pic_url,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(1,program1,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=' <span class="user_name">',stack1=depth0.user_facebook_id,foundHelper=helpers.fb_user_name,stack1=foundHelper?foundHelper.call(depth0,stack1,{hash:{}}):helperMissing.call(depth0,"fb_user_name",stack1,{hash:{}}),buffer+=escapeExpression(stack1)+'</span> <span class="action_text">',foundHelper=helpers.action_text,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.action_text,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'</span> <a class="activity_mo_name" href="',foundHelper=helpers.mo_url,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.mo_url,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'">',foundHelper=helpers.mo_name,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.mo_name,stack1=typeof stack1===functionType?stack1():stack1);if(stack1||stack1===0)buffer+=stack1;return buffer+='</a> <span class="time_stamp">',foundHelper=helpers.display_timestamp,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.display_timestamp,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'</span> <span class="price">',foundHelper=helpers.mo_price,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.mo_price,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+"</span> </li> ",buffer}),partials["R.Module.FriendsActivityPack.module_templates.ap_friend_activities"]=templates.ap_friend_activities=template(function(Handlebars,depth0,helpers,partials,data){helpers=helpers||Handlebars.helpers,partials=partials||Handlebars.partials;var buffer="",stack1,foundHelper,functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;function program1(depth0,data){return"sl_friend"}function program3(depth0,data){var buffer="",stack1,foundHelper;return buffer+=' <div class="unread_activity_count">',foundHelper=helpers.unread_activity_count,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.unread_activity_count,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+"</div> ",buffer}function program5(depth0,data){var buffer="",stack1,foundHelper;buffer+=' <div class="follow rondavu_button ',stack1=depth0.following_pressed,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(6,program6,data)});if(stack1||stack1===0)buffer+=stack1;buffer+='" data-fb-user-id="',foundHelper=helpers.user_facebook_id,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.user_facebook_id,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'">',stack1=depth0.following_pressed,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.program(10,program10,data),fn:self.program(8,program8,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+="</div> ",buffer}function program6(depth0,data){return"pressed"}function program8(depth0,data){return"Following"}function program10(depth0,data){return"Follow"}function program12(depth0,data){var buffer="",stack1;buffer+=" ",stack1=depth0,stack1=self.invokePartial(partials["R.Module.FriendsActivityPack.module_templates.ap_activity"],"R.Module.FriendsActivityPack.module_templates.ap_activity",stack1,helpers,partials);if(stack1||stack1===0)buffer+=stack1;return buffer+=" ",buffer}buffer+='<li class="friend_activities_container ',stack1=depth0.is_friend,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(1,program1,data)});if(stack1||stack1===0)buffer+=stack1;buffer+='" data-friend-facebook-id="',foundHelper=helpers.user_facebook_id,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.user_facebook_id,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'"> <div class="friend_face"> <img src="',stack1=depth0.user_facebook_id,foundHelper=helpers.fb_pic_url,stack1=foundHelper?foundHelper.call(depth0,stack1,{hash:{}}):helperMissing.call(depth0,"fb_pic_url",stack1,{hash:{}}),buffer+=escapeExpression(stack1)+'"> <div class="latest_activity_timestamp">',foundHelper=helpers.latest_activity_timestamp,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.latest_activity_timestamp,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+"</div> ",stack1=depth0.unread_activity_count,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(3,program3,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=' </div> <div class="activities_overlay_container"> <div class="user_activities"> <div class="user_header_container"> <div class="friend_face"> <img src="',stack1=depth0.user_facebook_id,foundHelper=helpers.fb_pic_url,stack1=foundHelper?foundHelper.call(depth0,stack1,{hash:{}}):helperMissing.call(depth0,"fb_pic_url",stack1,{hash:{}}),buffer+=escapeExpression(stack1)+'"> </div> <div class="user_info"> <div class="user_name"> <span>',stack1=depth0.user_facebook_id,foundHelper=helpers.fb_user_name,stack1=foundHelper?foundHelper.call(depth0,stack1,{hash:{}}):helperMissing.call(depth0,"fb_user_name",stack1,{hash:{}}),buffer+=escapeExpression(stack1)+"</span> </div> ",stack1=depth0.follow_enabled,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(5,program5,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=' </div> <div class="rondavu_clearfix"></div> </div> <ul class="activities_container"> ',stack1=depth0.activity_list,stack1=helpers.each.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(12,program12,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=' </ul> </div> <div class="up_arrow_container arrow_container"> <span class="up_arrow overlay_arrow"></span> <span class="up_arrow overlay_arrow inner"></span> </div> </div> </li> ',buffer}),partials["R.Module.FriendsActivityPack.module_templates.friendsactivitypack"]=templates.friendsactivitypack=template(function(Handlebars,depth0,helpers,partials,data){helpers=helpers||Handlebars.helpers,partials=partials||Handlebars.partials;var buffer="",stack1,functionType="function",escapeExpression=this.escapeExpression,self=this;function program1(depth0,data){var buffer="",stack1,foundHelper;return buffer+='<div class="rondavu_super_title_bar">',foundHelper=helpers.super_title_bar,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.super_title_bar,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+"</div>",buffer}function program3(depth0,data){var buffer="",stack1;buffer+=' <div class="grid_pages_container friends_activity_pack"> ',stack1=depth0.pagesOfFaces,stack1=helpers.each.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(4,program4,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=" </div> ",buffer}function program4(depth0,data){var buffer="",stack1;buffer+=' <ul class="grid_page"> ',stack1=helpers.each.call(depth0,depth0,{hash:{},inverse:self.noop,fn:self.program(5,program5,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=" </ul> ",buffer}function program5(depth0,data){var buffer="",stack1;buffer+=" ",stack1=depth0,stack1=self.invokePartial(partials["R.Module.FriendsActivityPack.module_templates.ap_friend_activities"],"R.Module.FriendsActivityPack.module_templates.ap_friend_activities",stack1,helpers,partials);if(stack1||stack1===0)buffer+=stack1;return buffer+=" ",buffer}function program7(depth0,data){var buffer="",stack1;buffer+=' <ul class="friends_activity_pack"> ',stack1=depth0.data,stack1=helpers.each.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(8,program8,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=" </ul> ",buffer}function program8(depth0,data){var buffer="",stack1;buffer+=" ",stack1=depth0,stack1=self.invokePartial(partials["R.Module.FriendsActivityPack.module_templates.ap_friend_activities"],"R.Module.FriendsActivityPack.module_templates.ap_friend_activities",stack1,helpers,partials);if(stack1||stack1===0)buffer+=stack1;return buffer+=" ",buffer}buffer+='<div class="friends_activity_pack_container"> ',stack1=depth0.super_title_bar,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(1,program1,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=' <div class="carousel_container"> ',stack1=depth0.displayFacesInGrid,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.program(7,program7,data),fn:self.program(3,program3,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=' </div> <div class="rondavu_clearfix"></div> </div> ',buffer})}(),R.Module.SharingControls=function(config){R.Module.prototype.initializer.call(this,config),this.initializer(config)},function(){R.Module.SharingControls.prototype=new R.Module,r$.extend(R.Module.SharingControls.prototype,{name:"SharingControls",initializer:function(){var self=this;R.Event.listen("evershare_warning_dismiss_config",function(config){config.dismissible?(self.getEl().find(".dismiss_evershare_warning :checkbox").attr("checked",config.dismissed),self.getEl().find(".dismiss_evershare_warning .text").html(config.dismiss_text)):self.getEl().find(".dismiss_evershare_warning").remove()})},initHtml:function(){R.Module.prototype.initHtml.call(this);var el=this.getEl();r$(el).html(R.Module.SharingControls.templates.sharingcontrols()),this.initializeSharingStatus(),this.renderSharingOptionItems(),this.FB.userIsConnected()||this.getEl().addClass("sl_logged_out")},initHtmlEvents:function(){this.delegate("click",this.handleSharingToggleClick,".sl_sharing_toggle"),this.delegate("click",this.clearAndDisconnect,".rondavu_kill_share_button"),this.delegate("change",function(e){R.StorageManager.createOrUpdateLocalObject(R.StorageManager.getUserKey(),{dismiss_evershare_warning:e.target.checked}),this.notifyOtherModules(new R.Module.Message.User.DismissEverShareWarningSettingChanged)},".dismiss_evershare_warning :checkbox")},handleMessage:function(message){if(message.type==="fb.login"||message.type==="fb.logout")this.getEl().toggleClass("sl_logged_out",message.type==="fb.logout");else if(message.type==="user.sharingStatusChanged")this.renderSharingStatus();else if(message.type==="module.init"&&message.module.name==="targetedinvite")r$(".sl_sharing_option_invite_friends",this.getEl()).show();else if(message.type==="user.dismissEverShareWarningSettingChanged"){var user=R.StorageManager.getLocalObject(R.StorageManager.getUserKey());this.getEl().find(".dismiss_evershare_warning :checkbox").attr("checked",user.dismiss_evershare_warning)}},renderSharingStatus:function(){var current_text=this.getParameter("Common.Sharing."+(this.user.is_sharing?"On":"Off")+".Text"),toggle_text=this.getParameter("Common.Sharing."+(this.user.is_sharing?"TurnOff":"TurnOn")+".Text");r$(".sl_sharing_toggle",this.getEl()).text(toggle_text),r$(".sl_sharing_current",this.getEl()).text(current_text),r$(".dismiss_evershare_warning",this.getEl()).toggle(this.user.is_sharing)},getSharingOptionItems:function(){var self=this,items=R.JSON.parse(this.getParameter("SharingControls.OptionItems"));return items=r$.extend(!0,{learn_more:{text:"Learn more",click_handler:self.handleLearnMoreLinkClick},invite_friends:{text:"Invite friends",click_handler:self.handleInviteFriendsLinkClick},logout:{text:"Log out of Facebook",click_handler:self.handleLogoutLinkClick},deauthorize:{text:"Remove social interaction",click_handler:self.handleDeauthorizeLinkClick}},items),items},renderSharingOptionItems:function(){var self=this,$items_container=r$(".sl_sharing_option_items",self.getEl()),items=self.getSharingOptionItems();r$.each(items,function(item_name,item_config){if(!!item_config.disabled)return!0;var item_class="sl_sharing_option_"+item_name,$item=r$('<div class="sl_sharing_option_item" />').addClass(item_class).appendTo($items_container),$a=r$('<a class="sl_webkit_css_hack" />').html(item_config.text).appendTo($item);item_config.url?$a.attr({href:item_config.url,target:"_blank"}):item_config.click_handler&&self.delegate("click",item_config.click_handler,"."+item_class+" a"),item_name==="invite_friends"&&$item.hide()})},handleLearnMoreLinkClick:function(){var $sharing_help=r$(".sl_sharing_help",this.getEl()).show(),$sharing_help_text=r$(".sl_sharing_help_text",$sharing_help);$sharing_help_text.html()===""&&($sharing_help_text.html(this.getParameter("Common.Sharing.MoreInfoHTML")),r$(".sl_sharing_help_close",$sharing_help).click(function(){$sharing_help.hide()}))},handleInviteFriendsLinkClick:function(){this.notifyOtherModules(new R.Module.Message.RequestInviteDialog)},handleLogoutLinkClick:function(){FB.logout()},handleDeauthorizeLinkClick:function(){this.clearAndDisconnect()}})}(),function(){var template=Handlebars.template,templates=R.Module.SharingControls.templates={},partials=Handlebars.partials=Handlebars.partials||{};partials["R.Module.SharingControls.module_templates.sharingcontrols"]=templates.sharingcontrols=template(function(Handlebars,depth0,helpers,partials,data){return helpers=helpers||Handlebars.helpers,'<div class="sl_hover_menu_container sl_sharing_status"> <span class="sl_sharing_current"></span> <span class="sl_menu_arrow">&#9662;</span> <div class="sl_hover_menu"> <div class="sl_sharing_toggle_container"> <a class="sl_sharing_toggle"></a> </div> <div class="dismiss_evershare_warning"> <label><input type="checkbox"><span class="text"></span></label> </div> </div> </div> <div class="sl_hover_menu_container sl_sharing_options"> <span>Options</span> <span class="sl_menu_arrow">&#9662;</span> <div class="sl_hover_menu sl_sharing_option_items"></div> <div class="sl_sharing_help" style="display: none"> <div class="sl_sharing_help_text"></div> <a class="sl_sharing_help_close rondavu_button">close</a> </div> </div>'})}(),R.Module.Welcome=function(config){R.Module.prototype.initializer.call(this,config),this.initializer(config)},function(){R.Module.Welcome.prototype=new R.Module,r$.extend(R.Module.Welcome.prototype,{name:"Welcome",base_url:"rondavu/welcome/",initializer:function(){this.userIsLoggedIntoCustomer=!1;try{var ids=R.PageDataManager.getPageData().user.id,fbRegex=/facebook/i;R.Util.each(ids,function(id){if(!fbRegex.test(id.type)&&typeof id.id=="string"&&id.id.length)return this.userIsLoggedIntoCustomer=!0,!1},this)}catch(e){}this.configureDisplay()},renderUserNameFromPageData:function(){var firstName="",lastName="",prefix=this.getParameter("Welcome.Message.BeforeName")||"",suffix=this.getParameter("Welcome.Message.AfterName")||"",userName="",showFullName=this.getBooleanParameter("Welcome.Message.ShowFullName"),greeting,welcomeArrow='<span class="sl_welcome_down_arrow">&#9662;</span>',profileObj,userImgUrl;try{profileObj=R.PageDataManager.getPageData().user.profile,firstName=profileObj.name.first,lastName=profileObj.name.last,userImgUrl=profileObj.profile_pic_url}catch(e){}r$.trim(firstName)!==""||r$.trim(lastName)!==""&&showFullName?(showFullName?userName+=firstName+" "+lastName:this.getBooleanParameter("Welcome.Message.ShowFirstName")&&(userName+=firstName),greeting=prefix+' <span class="rondavu_user_name">'+userName+"</span>"+suffix+welcomeArrow):greeting=' <span class="rondavu_user_name">'+this.getParameter("Welcome.Message.NameSubstitute")+"</span>"+welcomeArrow,!userImgUrl||this.el.find(".sl_welcome_message_container").before('<span class="sl_picsquare_container"><img class="sl_picsquare" src="'+userImgUrl+'" /></span>'),this.el.find(".sl_welcome_message_container").html(greeting)},configureLogoutLink:function(){var linkToFbLogout=this.getBooleanParameter("Common.Sharing.LogoutLink.FBLogout");this.FB.userIsConnected()&&(!this.userIsLoggedIntoCustomer||this.userIsLoggedIntoCustomer&&linkToFbLogout)?this.getEl().find(".sl_logout").addClass("sl_welcome_fb_logout"):this.getEl().find(".sl_logout").removeClass("sl_welcome_fb_logout")},configureDisplay:function(){if(!this.FB.userIsConnected()&&this.userIsLoggedIntoCustomer){this.getEl().find(".sl_welcome_greeting_container").addClass("sl_menu_enabled"),this.renderUserNameFromPageData();var fbLoginMenuItemText=this.getParameter("Welcome.DropDownMenu.FBLogin.Text");this.getEl().find(".sl_welcome_menu").prepend('<li><a class="sl_welcome_menu_link sl_welcome_fb_login" href="#">'+fbLoginMenuItemText+"</a></li>")}this.configureLogoutLink()},initHtmlEvents:function(){var linkToFbLogin=this.getBooleanParameter("Welcome.AnonymousLink.FBLogin"),clickToDropdown=this.getBooleanParameter("Welcome.DropDown.ClickToView");clickToDropdown?this.delegate("click",function(){this.el.find(".sl_welcome_menu_container").toggle()},".sl_menu_enabled"):(this.delegate("mouseenter",function(){this.el.find(".sl_welcome_menu_container").data("is-engaged",!0),this.el.find(".sl_welcome_menu_container").show()},".sl_menu_enabled"),this.delegate("mouseleave",function(){var $menu=this.el.find(".sl_welcome_menu_container");$menu.data("is-engaged",!1),setTimeout(function(){$menu.data("is-engaged")||$menu.hide()},500)},".sl_menu_enabled"),this.delegate("mouseenter",function(){this.el.find(".sl_welcome_menu_container").data("is-engaged",!0)},".sl_welcome_menu_container"),this.delegate("mouseleave",function(){var $menu=this.el.find(".sl_welcome_menu_container");$menu.data("is-engaged",!1),setTimeout(function(){$menu.data("is-engaged")||$menu.hide()},500)},".sl_welcome_menu_container"));function loginToFb(e){this.FB.login(),e.preventDefault()}linkToFbLogin&&this.delegate("click",loginToFb,".sl_welcome_anonlink"),this.delegate("click",loginToFb,".sl_welcome_fb_login"),this.delegate("click",loginToFb,".fb_login_button"),this.delegate("click",function(e){FB.logout(),e.preventDefault()},"a.sl_welcome_fb_logout")},reload:function(){this.load(this.base_url+"reload/",this.el.get(0),{success:function(){this.FB.XFBML.parse(this.el.get(0)),this.configureDisplay()}})},handleMessage:function(message){(message.type=="fb.login"||message.type=="fb.logout")&&this.reload()}})}(),R.Module.PopularMos=function(config){R.Module.prototype.initializer.call(this,config),this.initializer(config)},function(){var templates;R.Module.PopularMos.prototype=new R.Module,r$.extend(R.Module.PopularMos.prototype,{name:"popularmos",base_url:"rondavu/popular_mos/",currentPage:1,numberOfPages:1,marginType:"",carouselDelta:"",autoscroll_on:!1,autoscroll_cutoff:36e5,showActionsOnMos:!1,moActionCacheExpiry:36e5,initializer:function(){templates=R.Module.PopularMos.templates,this.isHorizontal=this.getBooleanParameter("PopularMos.IsHorizontal.Enable"),this.showActionsOnMos=this.getBooleanParameter("PopularMos.MoActions.Enable"),this.showActionsOnMos&&this.getEl().addClass("sl_actions_enabled"),this.afterLoad(),this.getBooleanParameter("PopularMos.SortByRealFbLikes.Enable")&&this.sortMosByRealFbLike()},initHtmlEvents:function(){var self=this;this.delegate("click",function(e){var popup=this.dialog({header:this.getParameter("SeeMore.DialogTitle.Text"),body:"Loading..."});this.load(this.base_url+"see_more",popup.get("body"),{loading_animation:!0,success:function(){popup.center()}}),e.preventDefault()},"a.rondavu_see_more"),this.delegate("click",function(e){var $el=r$(e.currentTarget),mo_id=$el.parents("li.popular_mo_item").attr("data-item-id");self.getEl().find(".comments_overlay_container[data-item-id='"+mo_id+"']").size()?self.showCommentOverlay({mo_id:mo_id}):self.ajax("/rondavu/api/"+mo_id+"/comment",{success:function(response){response.mo_id=mo_id,self.showCommentOverlay(response)}})},".action_counts .Comment.non_zero span"),this.delegate("click",function(e){var $el=r$(e.currentTarget);self.hideCommentOverlay($el)},".comments_overlay_container .close")},showCommentOverlay:function(data){var self=this;self.getEl().find(".comments_overlay_container").hide();var comments_overlay=self.getEl().find(".comments_overlay_container[data-item-id='"+data.mo_id+"']").show(),comment_count_el=self.getEl().find('.popular_mo_item[data-item-id="'+data.mo_id+'"] .Comment .count');if(comments_overlay.size()===0){var new_fb_users_ids_to_add_to_FBMap=_.map(data.comments,function(comment_obj){return comment_obj.user_facebook_id});R.FacebookUserMap.addUsersById(new_fb_users_ids_to_add_to_FBMap,function(){comments_overlay=r$(templates.comments(data)),self.getEl().find(".popular_mo_list_container").append(comments_overlay),R.Util.positionShowPopupInScreen(comments_overlay,comment_count_el,{adjust_vertical:"10",adjust_horizontal:"10",default_above:!0,default_right:!0})})}else R.Util.positionShowPopupInScreen(comments_overlay,comment_count_el,{adjust_vertical:"10",adjust_horizontal:"10",default_above:!0,default_right:!0})},hideCommentOverlay:function($el){$el.parents(".comments_overlay_container").hide()},handleMessage:function(message){message.type==="fb.login"?this.showActionsOnMos&&this.loadLatestActions():message.type==="fb.logout"&&this.showActionsOnMos&&this.getEl().find(".popular_mo_list .popular_mo_action").remove()},getMoCacheKey:function(){return"SL_"+R.Core.config.customer_name+"_"+this.name+"_"+R.FB.getCurrentUserId()},loadLatestActions:function(){var self=this,moActionCache=R.StorageManager.getLocalObject(self.getMoCacheKey())||{},now=(new Date).getTime(),moIds=self.getEl().find(".popular_mo_item").map(function(i,moElement){var moId=r$(moElement).data("item-id");return moActionCache[moId]&&now-moActionCache[moId].queryTime<=self.moActionCacheExpiry?null:moId}).toArray();function getFbDataAndRender(){var ids=r$.map(moActionCache,function(actionRecord){return actionRecord.action!==null?actionRecord.action.facebook_user_id:null});R.FacebookUserMap.addUsersById(ids,function(){self.renderActions(moActionCache)})}moIds.length>0?self.ajax(self.base_url+"get_actions_on_mos",{data:{mo_ids:moIds},success:function(response){R.Util.each(response.actions,function(action,moId){moActionCache[moId]={action:action,queryTime:now}}),R.StorageManager.setLocalObject(self.getMoCacheKey(),moActionCache),getFbDataAndRender()}}):getFbDataAndRender()},renderActions:function(moActionMap){this.getEl().find(".popular_mo_item").each(function(i,moElement){var moId=r$(moElement).data("item-id");moId in moActionMap&&moActionMap[moId].action!==null&&r$(moElement).append(templates.mo_action(moActionMap[moId].action)).find(".popular_mo_action").hide().fadeIn("slow")})},initCarousel:function(){var self=this;self.getEl().addClass(self.isHorizontal?"sl_horizontal":"sl_vertical");var listDimension=0;self.isHorizontal?(self.marginType="margin-left",self.getEl().addClass("sl_horizontal"),self.carouselDelta=self.getEl().find(".popular_mo_list_container").width(),self.getEl().find(".popular_mo_item").each(function(index,elem){listDimension+=r$(elem).outerWidth(!0)})):(self.marginType="margin-top",self.getEl().addClass("sl_vertical"),self.carouselDelta=self.getEl().find(".popular_mo_list_container").height(),self.getEl().find(".popular_mo_item").each(function(index,elem){listDimension+=r$(elem).outerHeight(!0)})),self.numberOfPages=Math.ceil(listDimension/self.carouselDelta);var itemDimension=self.isHorizontal?self.getEl().find(".popular_mo_item").first().outerWidth(!0):self.getEl().find(".popular_mo_item").first().outerHeight(!0),leftoverSpace=listDimension%self.carouselDelta;0<leftoverSpace&&leftoverSpace<itemDimension&&self.numberOfPages--;if(self.numberOfPages==1){self.getEl().find(".carousel_prev_arrow, .carousel_next_arrow").css("visibility","hidden");return}if(this.getBooleanParameter("PopularMos.PageResume.Enable")){var currentTimestamp=(new Date).getTime(),autoData=this.getAutoscrollData(currentTimestamp);if(currentTimestamp-autoData.timestamp<self.autoscroll_cutoff){self.currentPage=autoData.currentPage<=self.numberOfPages?autoData.currentPage:1;var popularMoList=self.getEl().find(".popular_mo_list"),marginCss=popularMoList.css(self.marginType)||"",listMargin=parseInt(marginCss.replace(/(-?[0-9])px/gi,"$1"),10),newMargin=listMargin-(self.currentPage-1)*self.carouselDelta;popularMoList.css(self.marginType,newMargin)}}self.updatePageInfoAndControls();var moveList=function(shiftPrev,callback){var list_margin=parseInt(self.getEl().find(".popular_mo_list").css(self.marginType).replace(/(-?[0-9])px/gi,"$1"),10),marginChange=parseInt(shiftPrev?-self.carouselDelta:self.carouselDelta,10),new_margin=list_margin+marginChange;self.currentPage=shiftPrev?self.currentPage+1:self.currentPage-1,self.getBooleanParameter("PopularMos.PageResume.Enable")&&self.updateAutoscrollData((new Date).getTime(),self.currentPage);var animationParams={};animationParams[self.marginType]=new_margin,self.getEl().find(".popular_mo_list").animate(animationParams,"slow","swing",function(){self.updatePageInfoAndControls(),callback()})},carousel_click=function(arrow,shiftPrev){self.autoscroll_on=!1;if(r$(arrow).data("dead")===!0)return!1;r$(arrow).data("dead",!0),moveList(shiftPrev,function(){r$(arrow).data("dead",!1)})};self.getEl().find(".carousel_next_arrow").click(function(event){event.preventDefault(),carousel_click(this,!0)}),self.getEl().find(".carousel_prev_arrow").click(function(event){event.preventDefault(),carousel_click(this,!1)})},getAutoscrollId:function(){return R.StorageManager.getVisitorId()+"::"+this.config.feature_id},getAutoscrollData:function(currentTimestamp){var autoDataMap=R.StorageManager.getLocalObject(this.getAutoscrollId())||{};return autoDataMap[this.getMoSetId()]||{currentPage:1,timestamp:currentTimestamp}},updateAutoscrollData:function(currentTimestamp,newPageNum){var autoscrollId=this.getAutoscrollId(),autoDataMap=R.StorageManager.getLocalObject(autoscrollId)||{};for(var key in autoDataMap)if(autoDataMap.hasOwnProperty(key)){var autoData=autoDataMap[key],elapsed=currentTimestamp-autoData.timestamp;elapsed>this.autoscroll_cutoff&&delete autoDataMap[key]}autoDataMap[this.getMoSetId()]={currentPage:newPageNum,timestamp:currentTimestamp},R.StorageManager.setLocalObject(autoscrollId,autoDataMap)},getMoSetId:function(){var mo_ids=[];r$(".popular_mo_item",this.getEl()).each(function(i,item){var mo_item=r$(item);mo_ids.push(mo_item.data("item-id"))}),mo_ids.sort();var setId="";return r$.each(mo_ids,function(i,value){i!==0&&(setId+="-"),setId+=value}),setId},updatePageInfoAndControls:function(){var hideNextArrow=this.currentPage==this.numberOfPages,hidePrevArrow=this.currentPage==1;this.getEl().find(".carousel_next_arrow").css("visibility",hideNextArrow?"hidden":"visible"),this.getEl().find(".carousel_prev_arrow").css("visibility",hidePrevArrow?"hidden":"visible"),this.getEl().find(".page_index").html(this.currentPage+" / "+this.numberOfPages)},autoscroll:function(intervalMs){var self=this,interval=intervalMs;if(!self.autoscroll_on)return;self.currentPage==self.numberOfPages?self.getEl().animate({opacity:0},"slow","swing",function(){var thisEl=r$(this);thisEl.find(".popular_mo_list").css(self.marginType,0),self.currentPage=1,self.getBooleanParameter("PopularMos.PageResume.Enable")&&self.updateAutoscrollData((new Date).getTime(),self.currentPage),self.updatePageInfoAndControls(),thisEl.animate({opacity:1},"slow","swing")}):(self.getEl().find(".carousel_next_arrow").click(),self.autoscroll_on=!0),self.autoscroll_timeout=setTimeout(function(){self.autoscroll(interval)},interval)},afterLoad:function(){this.initCarousel(),this.getEl().find(".mo_link.mo_name").ellipsis(),this.trackClicks(".popular_mo_item a"),this.appendCounts(),this.autoscroll_on=this.getBooleanParameter("PopularMos.Autoscroll.Enable");if(this.autoscroll_on)if(this.numberOfPages>1){var intervalSec=parseInt(this.getParameter("PopularMos.Autoscroll.IntervalSec"),10)*1e3,self=this;setTimeout(function(){self.autoscroll(intervalSec)},intervalSec)}else this.autoscroll_on=!1;this.showActionsOnMos&&R.FB.userIsConnected()&&this.loadLatestActions()},appendCounts:function(){var $el=r$(this.getEl()),actionCountsMap=this.config.init_data.action_counts_map;R.Util.each(actionCountsMap,function(val,key){var item=$el.find("[data-item-id='"+key+"']");item.find(".popular_mo_detail").append(templates.counts(val))})},sortMosByRealFbLike:function(){var popular_mo_items=r$(".popular_mo_item",this.getEl());if(popular_mo_items.size()>1){var like_url_to_item_map={},fql="select url, total_count from link_stat where url in (";popular_mo_items.each(function(i,item){var mo_item=r$(item),url=mo_item.data("like-url");like_url_to_item_map[url]=mo_item,i&&(fql+=","),fql+="'"+url+"'"}),fql+=") order by total_count desc",R.Logger.debug(fql),this.FB.api("/fql?q="+encodeURIComponent(fql),function(response){response&&response.data&&this.handleFqlResponse(like_url_to_item_map,response.data),this.displayMosSortedByRealFbLike()})}else this.displayMosSortedByRealFbLike()},displayMosSortedByRealFbLike:function(){r$(".popular_mo_list",this.getEl()).animate({opacity:1})},handleFqlResponse:function(like_url_to_item_map,data){var self=this;r$.each(data,function(i,entry){var mo_item=like_url_to_item_map[entry.url];mo_item&&(mo_item.attr("data-count",entry.total_count),mo_item.find(".action_counts .Like .count").text(entry.total_count),mo_item.children(".ribbon").andSelf().removeClass(self._getPlaceCssClass))});var mo_list=r$(".popular_mo_list",self.getEl());mo_list.children().sort(this.sortFn).appendTo(mo_list),mo_list.children().each(function(i,item){var mo_item=r$(item),cur_place=i+1;mo_item.addClass("place_"+cur_place),mo_item.children(".ribbon").addClass("place_"+cur_place).html("<span>#"+cur_place+"</span>")})},_getPlaceCssClass:function(index,css){return(css.match(/place_\d+/g)||[]).join(" ")},sortFn:function(a,b){var a_value=parseInt(r$(a).data("count")||"0",10),b_value=parseInt(r$(b).data("count")||"0",10);return a_value==b_value?(a_value=parseInt(r$(a).data("orig-order"),10),b_value=parseInt(r$(b).data("orig-order"),10),a_value-b_value):b_value-a_value}})}(),function(){Handlebars.registerHelper("keyed_each",function(collection,options){var buffer=[];return R.Util.each(collection,function(val,key){var item={};item.key=options.hash.start_at_one?key+1:key,item.val=val,buffer.push(options.fn(item))}),buffer.join("")})}(),r$.fn.ellipsis=function(){return this.each(function(){var el=r$(this),start_text=el.text(),text=start_text,t=r$(this.cloneNode(!0)).hide().css("position","absolute").css("overflow","visible").width(el.width()).height("auto");el.after(t);while(text.length>0&&t.height()>el.height())text=text.substr(0,text.length-1),t.text(text+"...");if(text!=start_text){el.text(t.text()),r$(".sl_alt_text",el).remove();var full_text=r$(document.createElement("span"));full_text.text(start_text),full_text.addClass("sl_alt_text"),el.append(full_text)}t.remove()})},function(){var template=Handlebars.template,templates=Handlebars.templates=Handlebars.templates||{},partials=Handlebars.partials=Handlebars.partials||{};partials["Handlebars.templates.fb_linked_user_name"]=templates.fb_linked_user_name=template(function(Handlebars,depth0,helpers,partials,data){helpers=helpers||Handlebars.helpers;var buffer="",stack1,foundHelper,functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+="<!-- ",buffer+=" ",buffer+=' --> <a class="sl_linked_user_name" href="https://facebook.com/',foundHelper=helpers.facebook_user_id,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.facebook_user_id,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'" target="blank">',stack1=depth0.facebook_user_id,foundHelper=helpers.fb_user_name,stack1=foundHelper?foundHelper.call(depth0,stack1,{hash:{}}):helperMissing.call(depth0,"fb_user_name",stack1,{hash:{}}),buffer+=escapeExpression(stack1)+"</a> ",buffer})}(),function(){var template=Handlebars.template,templates=R.Module.PopularMos.templates={},partials=Handlebars.partials=Handlebars.partials||{};partials["R.Module.PopularMos.module_templates.comments"]=templates.comments=template(function(Handlebars,depth0,helpers,partials,data){helpers=helpers||Handlebars.helpers;var buffer="",stack1,foundHelper,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function",self=this;function program1(depth0,data){var buffer="",stack1,foundHelper;return buffer+=' <li class="comments"> <img class="fb_face" src="',stack1=depth0.user_facebook_id,foundHelper=helpers.fb_pic_url,stack1=foundHelper?foundHelper.call(depth0,stack1,{hash:{}}):helperMissing.call(depth0,"fb_pic_url",stack1,{hash:{}}),buffer+=escapeExpression(stack1)+'"> <span class="user_name">',stack1=depth0.user_facebook_id,foundHelper=helpers.fb_user_name,stack1=foundHelper?foundHelper.call(depth0,stack1,{hash:{}}):helperMissing.call(depth0,"fb_user_name",stack1,{hash:{}}),buffer+=escapeExpression(stack1)+'</span> <span class="comment_text">"',foundHelper=helpers.comment_text,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.comment_text,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'"</span> <span class="time_stamp">',foundHelper=helpers.display_timestamp,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.display_timestamp,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+"</span> </li> ",buffer}buffer+='<div class="comments_overlay_container" data-item-id="',foundHelper=helpers.mo_id,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.mo_id,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'"> <div class="comments_overlay"> <span class="close">&times;</span> <div class="comment_title rondavu_super_title_bar">What people are saying</div> <ul class="comments_container"> ',stack1=depth0.comments,stack1=helpers.each.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(1,program1,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=' </ul> </div> <div class="down_arrow_container arrow_container"> <span class="down_arrow overlay_arrow"></span> <span class="down_arrow overlay_arrow inner"></span> </div> </div>',buffer}),partials["R.Module.PopularMos.module_templates.counts"]=templates.counts=template(function(Handlebars,depth0,helpers,partials,data){helpers=helpers||Handlebars.helpers;var buffer="",stack1,foundHelper,functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;function program1(depth0,data){var buffer="",stack1,foundHelper;buffer+=' <span class="count_container ',foundHelper=helpers.key,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.key,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1),stack1=depth0.val,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(2,program2,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+='"><span class="icon"></span><span class="count">',foundHelper=helpers.val,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.val,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'</span><span class="name">',foundHelper=helpers.key,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.key,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+"</span></span> ",buffer}function program2(depth0,data){return" non_zero"}buffer+='<div class="action_counts"> ',foundHelper=helpers.keyed_each,stack1=foundHelper?foundHelper.call(depth0,depth0,{hash:{},inverse:self.noop,fn:self.program(1,program1,data)}):helperMissing.call(depth0,"keyed_each",depth0,{hash:{},inverse:self.noop,fn:self.program(1,program1,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=" </div>",buffer}),partials["R.Module.PopularMos.module_templates.mo_action"]=templates.mo_action=template(function(Handlebars,depth0,helpers,partials,data){helpers=helpers||Handlebars.helpers,partials=partials||Handlebars.partials;var buffer="",stack1,foundHelper,functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this;function program1(depth0,data){var buffer="",stack1,foundHelper;return buffer+=' <span class="action_detail">',foundHelper=helpers.action_detail,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.action_detail,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+"</span> ",buffer}buffer+='<div class="popular_mo_action"> <div class="sl_picsquare_container"> <img class="sl_picsquare" src="',stack1=depth0.facebook_user_id,foundHelper=helpers.fb_pic_url,stack1=foundHelper?foundHelper.call(depth0,stack1,{hash:{}}):helperMissing.call(depth0,"fb_pic_url",stack1,{hash:{}}),buffer+=escapeExpression(stack1)+'" /> </div> <div class="activity_column"> <span class="user_name">',stack1=depth0,stack1=self.invokePartial(partials["Handlebars.templates.fb_linked_user_name"],"Handlebars.templates.fb_linked_user_name",stack1,helpers,partials);if(stack1||stack1===0)buffer+=stack1;buffer+='</span> <span class="user_action">',foundHelper=helpers.action_type,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.action_type,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+"</span> ",stack1=depth0.action_detail,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(1,program1,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=' <span class="action_timestamp">',foundHelper=helpers.timestamp,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.timestamp,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'</span> </div> <div class="rondavu_clearfix"></div> </div> ',buffer})}(),R.Module.StreamPublish=function(config){R.Module.prototype.initializer.call(this,config),this.initializer(config)},function(){R.Module.StreamPublish.prototype=new R.Module;var templates,feedStoryOverride=null;r$.extend(R.Module.StreamPublish.prototype,{name:"streampublish",base_url:"rondavu/streampublish/",action:"",initializer:function(){var self=this;templates=R.Module.StreamPublish.templates,R.FacebookUserMap.addCurrentUser();if(this.getParameter("Common.RenderMode")==="hidden"&&!this.hiddenModeLoaded)return;if(this.getBooleanParameter("MentionTagging.enable")){var textarea=this.el.find("textarea");r$('<div class="rondavu_clearfix"></div>').insertAfter(textarea),this.mentionTagger=new R.Module.Util.MentionTagger(textarea,{cta:{connected:this.getParameter("MentionTagging.TagArea.Cta.FbConnected"),unknown:this.getParameter("MentionTagging.TagArea.Cta.FbUnknown")}}),this.mentionTagger.on("tag",function(friend){self.s3Log({action:"tag",friend:friend.id})})}R.Logger.debug("initializing stream publish - looking up fb login status"),this.FB.getLoginStatus(function(response){var fbs=response.status;if(fbs==="connected"&&this.getParameter("StreamPublish.AutoPrompt.FBConnected")==="true"||fbs==="not_authorized"&&this.getParameter("StreamPublish.AutoPrompt.FBNotConnected")==="true"||fbs==="unknown"&&this.getParameter("StreamPublish.AutoPrompt.FBUnknown")==="true")R.Logger.debug("stream publish - autoprompt should be happening"),r$(".streampublish_opt_in").click()}),this.interactionMode==="S"&&(this.getEl().find("textarea").attr("placeholder",this.getParameter("StreamPublish.Textarea.DefaultText")),this.requireMessage&&this.el.find(".streampublish_opt_in").addClass("rondavu_disabled"),this.profanityWarning=r$(R.Module.PROFANITY_WARNING_HTML),this.getEl().find(".streampublish_opt_in").append(this.profanityWarning)),this.mos=R.PageDataManager.getMosFromPageData(),this.sharingFromMosArray=this.getBooleanParameter("StreamPublish.ProductCarousel.Enable")&&this.getBooleanParameter("FBStreamPost.RenderPreview")&&this.mos.length>0;if(this.sharingFromMosArray){this.nameParam="FBStreamPost.Name.Text",this.captionParam="FBStreamPost.Caption",this.descriptionParam="FBStreamPost.Description",this.confirmationParam="StreamPublish.ProductCarousel.ConfirmationMessage.Text",this.paramsToInterpret=[this.captionParam,this.descriptionParam,this.confirmationParam],this.feedStoryPreviews=[],this.confirmationMessages=[],this.getBooleanParameter("FBStreamPost.Name.DefaultToMoName")||this.paramsToInterpret.push(this.nameParam),this.interpretParameters(),this.selectedMo=0,this.feedPreview=this.el.find(".rdv_feed_preview"),this.confirmation=this.el.find(".rondavu_ephemeral_confirmation"),this.moImage=this.feedPreview.find("img");if(this.moImage.length===0){var img=document.createElement("img");this.moImage=r$(img),this.moImage.prependTo(this.feedPreview)}this.feedStoryName=this.feedPreview.find(".feed_name");var feedStoryCaptions=this.feedPreview.find(".feed_caption");feedStoryCaptions.length===0?(this.feedStoryCaption=r$(null),this.feedStoryDescription=r$(null)):feedStoryCaptions.length===1?this.getParameter(this.captionParam)===""?(this.feedStoryCaption=r$(null),this.feedStoryDescription=r$(feedStoryCaptions[0])):(this.feedStoryCaption=r$(feedStoryCaptions[0]),this.feedStoryDescription=r$(null)):(this.feedStoryCaption=r$(feedStoryCaptions[0]),this.feedStoryDescription=r$(feedStoryCaptions[1])),this.carouselCaption=this.el.find(".rondavu_caption");var i=1;for(;i<this.mos.length;i++){var image=new Image;try{image.src=this.mos[i].url.picture[R.Util.isSecure()?"primary_secure":"primary"]}catch(noImage){}}}this.truncateDescription(),this.fadingConfig={fadeTime:1e3*parseFloat(Math.max(0,this.getParameter("StreamPublish.ProductCarousel.ConfirmationMessage.FadeTime"))),duration:1e3*parseFloat(this.getParameter("StreamPublish.ProductCarousel.ConfirmationMessage.Timeout"))}},initHtmlEvents:function(){this.interactionMode=this.getParameter("FBStreamPost.InteractionMode"),this.serverCalledForStory=!1,this.requireMessage=this.getBooleanParameter("StreamPublish.Textarea.RequireMessage"),this.delegate("click",function(event){var element=r$(event.currentTarget);element&&element.toggleClass("checked")},".rondavu_checkbox"),this.delegate("keyup",function(e){var textareaValue=e.currentTarget.value;textareaValue===""&&this.requireMessage?this.el.find(".streampublish_opt_in").addClass("rondavu_disabled"):this.el.find(".streampublish_opt_in").removeClass("rondavu_disabled")},"textarea",{logging:!1}),this.delegate("click",function(e){if(r$(e.currentTarget).hasClass("rondavu_disabled")){e.preventDefault();return}var postText=this.getUserMessage();if(this.requireMessage&&(!postText||r$.trim(postText)==="")){e.preventDefault();return}this.trackEventForPrimaryMo("clicked on call to action button");if(this.interactionMode==="S"){var checkbox=this.el.find(".rondavu_checkbox"),postToFb=checkbox.length?checkbox.hasClass("checked"):!0,scope={scope:R.FB.constants.perm.PUBLISH_ACTIONS};!this.FB.userIsConnected()||!this.FB.hasPerms(scope)?this.FB.requestPerms(function(){this.serverSideStoryPost(postToFb)},scope):this.serverSideStoryPost(postToFb)}else this.interactionMode==="FDC"?this.FB.requestPerms(function(){this.getStoryData({})}):this.interactionMode==="FD"&&typeof this.story_preview=="object"&&(this.trackEventForPrimaryMo("connect authorization not required"),this.promptFeedStory(this.story_preview))},".streampublish_opt_in",{is_cta:!0}),this.delegate("mouseenter",function(){this.interactionMode==="FD"&&!this.serverCalledForStory&&(R.Logger.debug("getting story data for non-connect version"),this.serverCalledForStory=!0,this.getStoryData())},".rondavu_module_content"),this.delegate("click",function(){this.selectedMo--,this.selectedMo<0&&(this.selectedMo+=this.mos.length),this.updateCarouselView(),this.interactionMode==="FD"&&this.getStoryData({})},".rondavu_prev"),this.delegate("click",function(){this.selectedMo++,this.selectedMo>=this.mos.length&&(this.selectedMo-=this.mos.length),this.updateCarouselView(),this.interactionMode==="FD"&&this.getStoryData({})},".rondavu_next")},interpretParameters:function(){var self=this;R.Util.each(self.mos,function(mo,i){self.ajax("rondavu/freemarker/batch_interpret",{mos:!0,data:{paramNames:self.paramsToInterpret,mo:"mos",mosIndex:i},success:function(interpretedParams){self.feedStoryPreviews[i]={},self.feedStoryPreviews[i].name=self.getBooleanParameter("FBStreamPost.Name.DefaultToMoName")?mo.name[0].name:interpretedParams[R.Util.indexOf(self.paramsToInterpret,self.nameParam)],self.feedStoryPreviews[i].caption=interpretedParams[R.Util.indexOf(self.paramsToInterpret,self.captionParam)],self.feedStoryPreviews[i].description=interpretedParams[R.Util.indexOf(self.paramsToInterpret,self.descriptionParam)],self.confirmationMessages[i]=interpretedParams[R.Util.indexOf(self.paramsToInterpret,self.confirmationParam)]}})})},updateCarouselView:function(){this.mos[this.selectedMo].shared?this.feedPreview.addClass("rondavu_shared"):this.feedPreview.removeClass("rondavu_shared");try{var imgUrl=this.mos[this.selectedMo].url.picture[window.location.protocol=="http:"?"primary":"primary_secure"];this.moImage.attr("src",imgUrl)}catch(noImage){this.moImage.attr("src","")}this.feedStoryName.html(this.feedStoryPreviews[this.selectedMo].name),this.feedStoryCaption.html(this.feedStoryPreviews[this.selectedMo].caption),this.feedStoryDescription.html(this.feedStoryPreviews[this.selectedMo].description);var caption=this.getParameter("StreamPublish.ProductCarousel.Caption.Text").replace(/\{current\}/ig,this.selectedMo+1).replace(/\{total\}/ig,this.mos.length);this.carouselCaption.html(caption),this.truncateDescription()},updateConfirmationMessage:function(){var self=this;self.confirmation.length!==0&&(self.confirmation.css("opacity","0.0"),self.confirmation.html(self.confirmationMessages[self.sharedMo]),self.confirmation.fadeTo(self.fadingConfig.fadeTime,1,function(){self.fadingConfig.duration>=0&&setTimeout(function(){self.confirmation.fadeTo(self.fadingConfig.fadeTime,0)},self.fadingConfig.duration)}))},carouselModeRedraw:function(){this.sharingFromMosArray&&(this.mos[this.sharedMo].shared=!0,this.updateCarouselView(),this.updateConfirmationMessage())},handleMessage:function(message){if(message.type==="fb.login")this.interpretParameters(),R.FacebookUserMap.addCurrentUser(),this.ajax("rondavu/freemarker/interpret",{data:{paramName:"Common.Layout.CTALine.Text"},success:function(interpretedParam){this.el.find(".rondavu_cta").html(interpretedParam)}}),r$("div.rondavu_fb_profile_pic",this.getEl()).removeClass("rondavu_fb_generic_profile_pic").html('<img src="'+this.FB.getPicUrl(message.authResponse.userID)+'" />');else if(message.type==="module.streamPublish"&&this.getParameter("Common.RenderMode")==="hidden"){feedStoryOverride=message.feedStory;var popupCloseHandler=function(overlay,source){var message=new R.Module.Message.StreamPublishCompleted({shared:source==="share"});this.notifyOtherModules(message)};this.ajax("rondavu/freemarker/interpret",{data:{paramName:"Common.Layout.CTALine.Text"},success:function(interpretedParam){var templateData=this.getTemplateData(interpretedParam,message.feedStory,message.actionText),html=templates.sp_single_mo(templateData);this.renderHiddenPopup(html,popupCloseHandler),this.initializer()}})}},getTemplateData:function(commonCta,feedStory,actionText){var showProfilePic=this.getBooleanParameter("StreamPublish.DisplayProfilePic")&&(R.FB.userIsConnected()||this.getBooleanParameter("StreamPublish.DisplayProfilePicIfDefault")),templateData={commonCta:commonCta,showProfilePic:showProfilePic,mentionTagging:this.getParameter("MentionTagging.enable"),showPreview:this.getBooleanParameter("FBStreamPost.RenderPreview"),showFbCheckbox:this.getBooleanParameter("StreamPublish.FacebookCheckbox.Enable"),checkedByDefault:this.getBooleanParameter("StreamPublish.FacebookCheckbox.CheckedByDefault"),feedStory:feedStory,featureConfig:this.getParameterMap(),currentUserId:R.FB.getCurrentUserId()};return templateData.feedStory.uid=R.FB.getCurrentUserId(),templateData.feedStory.actionText=actionText,templateData},getStoryData:function(){var update=function(that,data){that.story_preview=data,that.interactionMode==="FDC"&&that.promptFeedStory(data)},moId=this.sharingFromMosArray?this.mos[this.selectedMo].id[0].id:"";this.ajax(this.base_url+"story_prompt/",{mos_etags:!0,success:function(response){update(this,response)},data:{mo_id:moId}})},promptFeedStory:function(data){var fbui={method:"feed",name:data.name,link:data.href,caption:data.caption,description:data.description,message:data.user_message},prop,props={};for(var i=0;i<data.properties.length;i++)prop=data.properties[i],props[prop.name]=prop.value;fbui.properties=props,this.story_preview.pic_url&&(fbui.picture=data.pic_url);var action,action_links=[];for(var k=0;k<data.action_links.length;k++)action=data.action_links[k],action_links.push({name:action.text,link:action.href});fbui.actions=action_links,R.Logger.debug(fbui),this.trackEventForPrimaryMo("feed story prompted"),this.trackEventForMoDetail(data.customer_mo_id,data.customer_mo_type,data.mo_name,data.mo_location,"mo feed story prompted"),this.sharedMo=this.selectedMo,this.FB.ui(fbui,this.feedDialogCallback)},feedDialogCallback:function(response){R.Logger.debug("in feed dialog callback",response);var post_id=response&&response.post_id?response.post_id:"";if(post_id!==""){this.trackEventForPrimaryMo("feed story posted"),this.trackEventForMoDetail(this.story_preview.customer_mo_id,this.story_preview.customer_mo_type,this.story_preview.mo_name,this.story_preview.mo_location,"mo feed story posted");var userMessage=response&&response.user_message?response.user_message:"";this.sharingFromMosArray?this.carouselModeRedraw():this.load(this.base_url+"update_feed_story/",this.config.div.id,{data:{story_id:this.story_preview.story_id,mo_id:this.story_preview.mo_id,post_id:post_id,user_message:userMessage},mos_etags:!0}),this.notifyOthersSuCreation({})}else this.trackEventForPrimaryMo("feed story skipped"),this.trackEventForMoDetail(this.story_preview.customer_mo_id,this.story_preview.customer_mo_type,this.story_preview.mo_name,this.story_preview.mo_location,"mo feed story skipped")},getUserMessage:function(){return this.getEl().find("textarea").val()},getTaggedUserMessage:function(){return this.mentionTagger?this.mentionTagger.getText():null},resetTextarea:function(){this.getEl().find("textarea").val(""),this.mentionTagger&&this.mentionTagger.resetTagging()},serverSideStoryPost:function(postToFb){var self=this,userMessage=this.getUserMessage(),taggedUserMessage=this.getTaggedUserMessage(),moId=this.sharingFromMosArray?this.mos[this.selectedMo].id[0].id:"",reRender=!this.sharingFromMosArray&&this.getBooleanParameter("StreamPublish.Confirmation.Enable");function callback(response){self.notifyOthersSuCreationComplete({comment:userMessage,comment_id:response.su_id,is_profane:response.is_profane});if(response.is_profane){self.confirmation&&(self.confirmation.css("visibility","hidden"),setTimeout(function(){self.confirmation.css("visibility","visible")},2*self.fadingConfig.fadeTime+self.fadingConfig.duration)),self.profanityWarning.fadeIn("fast"),setTimeout(function(){self.profanityWarning.fadeOut("fast")},5e3);return}reRender&&self.getEl().html(response.legacy_html),self.closeDialog("share")}var options={data:{user_message:userMessage,tagged_user_message:taggedUserMessage,post_to_fb:postToFb,mo_id:moId,re_render:reRender,feed_story_override:feedStoryOverride||""},mos_etags:!0,success:callback};this.sharingFromMosArray&&(this.sharedMo=this.selectedMo),this.ajax(this.base_url+"post_server_side",options),this.carouselModeRedraw(),this.resetTextarea(),postToFb?this.trackEventForPrimaryMo("feed story posted"):this.trackEventForPrimaryMo("comment posted without FB"),this.notifyOthersSuCreation({comment:userMessage})},truncateDescription:function(){var description_div=this.getEl().find(".feed_caption.feed_caption_description");description_div&&description_div.ellipsis&&description_div.ellipsis()},notifyOthersSuCreation:function(config){var message=new R.Module.Message.SUCreated(config);this.notifyOtherModules(message)},notifyOthersSuCreationComplete:function(config){var message=new R.Module.Message.SUCreationComplete(config);this.notifyOtherModules(message)},getTaggedFriends:function(){return this.mentionTagger?this.mentionTagger.getTaggedIDs():[]}})}(),function($){$.fn.highlightTextarea=function(options){var defaults={words:["a","e","i","o","u"],color:"#ffff00",caseSensitive:!0,resizable:!1,id:null,debug:!1};return options=$.extend(defaults,options),options.regParam="g",options.caseSensitive==0&&(options.regParam+="i"),this.each(function(){var $textarea=$(this);$textarea.wrap('<div class="highlightTextarea" />');var $main=$textarea.parent(".highlightTextarea");$main.prepend('<div class="highlighterContainer"><div class="highlighter"></div></div>');var $highlighterContainer=$main.children(".highlighterContainer"),$highlighter=$highlighterContainer.children(".highlighter");options.id!=null&&$main.attr("id",options.id);var topMargin=toPx($textarea.css("margin-top"))+toPx($textarea.css("border-top-width"))+toPx($textarea.css("padding-top")),leftMargin=toPx($textarea.css("margin-left"))+toPx($textarea.css("border-left-width"))+toPx($textarea.css("padding-left"))+1;cloneCss($textarea,$main,["float","vertical-align"]),$main.css({width:$textarea.outerWidth(!0),height:$textarea.outerHeight(!0)}),cloneCss($textarea,$highlighterContainer,["background","background-image","background-color","background-position","background-repeat","background-origin","background-clip","background-size"]),$highlighterContainer.css({top:topMargin+"px",left:leftMargin+"px",width:$textarea.width(),height:$textarea.height()}),cloneCss($textarea,$highlighter,["font-size","font-family","font-style","font-weight","line-height"]),$highlighter.css({width:$textarea.width(),height:$textarea.height()}),$textarea.css({background:"none"}),options.debug&&$highlighter.css({color:"#f00"}),$highlighter.bind("click",function(){$textarea.focus()}),$textarea.bind({keyup:function(){applyText($textarea.val())},scroll:function(){updateSizePosition()},resize:function(){updateSizePosition(!0)}}),options.resizable&&jQuery.ui&&($textarea.resizable({handles:"se",resize:function(){updateSizePosition(!0)}}),$(".highlightTextarea .ui-resizable-se").css({bottom:"13px",right:"1px"})),applyText($textarea.val());function applyText(text){text=replaceAll(text,"\n","<br/>"),text=replaceAll(text,"  ","&nbsp;&nbsp;");if(options.words[0]!=""){replace=options.words[0];for(var i=1;i<options.words.length;i++)replace+="|"+options.words[i];text=replaceAll(text,replace,'<span class="highlight" style="background-color:'+options.color+';">$1</span>')}$highlighter.html(text),updateSizePosition()}function replaceAll(txt,replace,with_this){return txt.replace(new RegExp("("+replace+")",options.regParam),with_this)}function updateSizePosition(forced){forced&&($main.css({width:$textarea.outerWidth(!0),height:$textarea.outerHeight(!0)}),$highlighterContainer.css({width:$textarea.width(),height:$textarea.height()}),$highlighter.css({height:$textarea.height()})),$textarea[0].clientHeight<$textarea[0].scrollHeight&&$textarea.css("overflow")!="hidden"&&$textarea.css("overflow-y")!="hidden"||$textarea.css("overflow")=="scroll"||$textarea.css("overflow-y")=="scroll"?$highlighter.css({width:$textarea.width()-26,"padding-right":"26px"}):$highlighter.css({width:$textarea.width()-9,"padding-right":"9px"}),$highlighter.css({top:"-"+$textarea.scrollTop()+"px",height:$highlighter.height()+$textarea.scrollTop()})}function cloneCss(from,to,what){for(var i=0;i<what.length;i++)to.css(what[i],from.css(what[i]))}function toPx(value){if(value!=value.replace("em","")){var that=parseFloat(value.replace("em","")),scopeTest=jQuery('<div style="display: none; font-size: 1em; margin: 0; padding:0; height: auto; line-height: 1; border:0;">&nbsp;</div>').appendTo("body"),scopeVal=scopeTest.height();return scopeTest.remove(),Math.round(that*scopeVal)}return value!=value.replace("px","")?parseInt(value.replace("px","")):parseInt(value)}}),this}}(r$),function($){var UNDEF="undefined",getSelection,setSelection,deleteSelectedText,deleteText,insertText,replaceSelectedText,surroundSelectedText,extractSelectedText,collapseSelection;function isHostMethod(object,property){var t=typeof object[property];return t==="function"||t=="object"&&!!object[property]||t=="unknown"}function isHostProperty(object,property){return typeof object[property]!=UNDEF}function isHostObject(object,property){return typeof object[property]=="object"&&!!object[property]}function fail(reason){window.console&&window.console.log&&window.console.log("TextInputs module for Rangy not supported in your browser. Reason: "+reason)}function adjustOffsets(el,start,end){return start<0&&(start+=el.value.length),typeof end==UNDEF&&(end=start),end<0&&(end+=el.value.length),{start:start,end:end}}function makeSelection(el,start,end){return{start:start,end:end,length:end-start,text:el.value.slice(start,end)}}function getBody(){return isHostObject(document,"body")?document.body:document.getElementsByTagName("body")[0]}$(document).ready(function(){var testTextArea=document.createElement("textarea");getBody().appendChild(testTextArea);if(isHostProperty(testTextArea,"selectionStart")&&isHostProperty(testTextArea,"selectionEnd"))getSelection=function(el){var start=el.selectionStart,end=el.selectionEnd;return makeSelection(el,start,end)},setSelection=function(el,startOffset,endOffset){var offsets=adjustOffsets(el,startOffset,endOffset);el.selectionStart=offsets.start,el.selectionEnd=offsets.end},collapseSelection=function(el,toStart){toStart?el.selectionEnd=el.selectionStart:el.selectionStart=el.selectionEnd};else{if(!(isHostMethod(testTextArea,"createTextRange")&&isHostObject(document,"selection")&&isHostMethod(document.selection,"createRange"))){getBody().removeChild(testTextArea),fail("No means of finding text input caret position");return}getSelection=function(el){var start=0,end=0,normalizedValue,textInputRange,len,endRange,range=document.selection.createRange();return range&&range.parentElement()==el&&(len=el.value.length,normalizedValue=el.value.replace(/\r\n/g,"\n"),textInputRange=el.createTextRange(),textInputRange.moveToBookmark(range.getBookmark()),endRange=el.createTextRange(),endRange.collapse(!1),textInputRange.compareEndPoints("StartToEnd",endRange)>-1?start=end=len:(start=-textInputRange.moveStart("character",-len),start+=normalizedValue.slice(0,start).split("\n").length-1,textInputRange.compareEndPoints("EndToEnd",endRange)>-1?end=len:(end=-textInputRange.moveEnd("character",-len),end+=normalizedValue.slice(0,end).split("\n").length-1))),makeSelection(el,start,end)};var offsetToRangeCharacterMove=function(el,offset){return offset-(el.value.slice(0,offset).split("\r\n").length-1)};setSelection=function(el,startOffset,endOffset){var offsets=adjustOffsets(el,startOffset,endOffset),range=el.createTextRange(),startCharMove=offsetToRangeCharacterMove(el,offsets.start);range.collapse(!0),offsets.start==offsets.end?range.move("character",startCharMove):(range.moveEnd("character",offsetToRangeCharacterMove(el,offsets.end)),range.moveStart("character",startCharMove)),range.select()},collapseSelection=function(el,toStart){var range=document.selection.createRange();range.collapse(toStart),range.select()}}getBody().removeChild(testTextArea),deleteText=function(el,start,end,moveSelection){var val;start!=end&&(val=el.value,el.value=val.slice(0,start)+val.slice(end)),moveSelection&&setSelection(el,start,start)},deleteSelectedText=function(el){var sel=getSelection(el);deleteText(el,sel.start,sel.end,!0)},extractSelectedText=function(el){var sel=getSelection(el),val;return sel.start!=sel.end&&(val=el.value,el.value=val.slice(0,sel.start)+val.slice(sel.end)),setSelection(el,sel.start,sel.start),sel.text},insertText=function(el,text,index,moveSelection){var val=el.value,caretIndex;el.value=val.slice(0,index)+text+val.slice(index),moveSelection&&(caretIndex=index+text.length,setSelection(el,caretIndex,caretIndex))},replaceSelectedText=function(el,text){var sel=getSelection(el),val=el.value;el.value=val.slice(0,sel.start)+text+val.slice(sel.end);var caretIndex=sel.start+text.length;setSelection(el,caretIndex,caretIndex)},surroundSelectedText=function(el,before,after){var sel=getSelection(el),val=el.value;el.value=val.slice(0,sel.start)+before+sel.text+after+val.slice(sel.end);var startIndex=sel.start+before.length,endIndex=startIndex+sel.length;setSelection(el,startIndex,endIndex)};function jQuerify(func,returnThis){return function(){var el=this.jquery?this[0]:this,nodeName=el.nodeName.toLowerCase();if(el.nodeType==1&&(nodeName=="textarea"||nodeName=="input"&&el.type=="text")){var args=[el].concat(Array.prototype.slice.call(arguments)),result=func.apply(this,args);if(!returnThis)return result}if(returnThis)return this}}$.fn.extend({getSelection:jQuerify(getSelection,!1),setSelection:jQuerify(setSelection,!0),collapseSelection:jQuerify(collapseSelection,!0),deleteSelectedText:jQuerify(deleteSelectedText,!0),deleteText:jQuerify(deleteText,!0),extractSelectedText:jQuerify(extractSelectedText,!1),insertText:jQuerify(insertText,!0),replaceSelectedText:jQuerify(replaceSelectedText,!0),surroundSelectedText:jQuerify(surroundSelectedText,!0)})})}(jQuery),R.Module.Util=R.Module.Util||{},R.Module.Util.MentionTagger=function(){"use strict";var specialKeys={_8:"backspace",_13:"enter",_27:"esc",_37:"left arrow",_38:"up arrow",_39:"right arrow",_40:"down arrow",_46:"delete"},defaults={friendList:[],highlightTaggedNames:!0,highlightColor:"#d8dfea",maxTagListSize:5,showTags:!0,typeInTagList:!0,cta:{connected:"",unknown:""},tagText:"\n"};function MentionTagger(textarea,configOverride){var self=this,config=_.defaults(configOverride||{},defaults);r$.extend(self,config),this.nameTagBuffer="",this.capturingName=!1,this.stealthMode=!0,this.minimumLengthForTagMenu=3,this.indexedNameMap=[],this.taggedFriends=[],this.friendList=[],this.highlightTaggedNames=config.highlightTaggedNames,this.highlightColor=config.highlightColor,this.maxTagListSize=config.maxTagListSize,this.showTags=config.showTags,this.textarea=r$(textarea),this.textarea.wrap('<div class="sl_mention_tagger"></div>'),this.wrapper=this.textarea.parent(),this.tagListInput=null,this.tagMenu=r$('<ul class="sl_tag_menu sl_empty"></ul>').insertAfter(this.textarea);if(this.showTags){var tagWidget=r$('<div class="sl_tag_widget_container"><span class="sl_tagging_avatar"></span><span class="sl_tagging_cta"></span><ul class="sl_tag_list" style="display:none;"></ul><div class="rondavu_clearfix"></div></div>').insertAfter(this.tagMenu);this.tagList=tagWidget.find(".sl_tag_list"),this.taggingCta=tagWidget.find(".sl_tagging_cta"),this.typeInTagList&&(this.tagListInput=r$('<input type="text" class="sl_tag_list_input" />'),this.tagListInputContainer=r$('<li class="sl_add_tag"></li>'),this.tagListInput.appendTo(this.tagListInputContainer),this.tagListInputContainer.appendTo(this.tagList))}this.friendList.length?(self.parseFriendList(),self.taggingCta.html(self.cta.connected)):R.FB.getLoginStatus(function(response){response.status===R.FB.constants.connectedStates.CONNECTED?(self.loadFriends(),self.taggingCta.html(self.cta.connected)):self.taggingCta.html(self.cta.unknown)}),R.Event.listen("fb.login",function(){self.loadFriends(),self.taggingCta.html(self.cta.connected)}),R.Event.listen("fb.logout",function(){self.taggingCta.html(self.cta.unknown),self.resetTagging()}),this.textarea.on("keypress",function(e){e.which>=32&&self.keyHandler(e,String.fromCharCode(e.which))}),this.textarea.on("keydown",function(e){specialKeys["_"+e.which]!==undefined&&self.keyHandler(e,specialKeys["_"+e.which])});function focusTypingArea(){self.typeInTagList?(self.tagList.show(),self.tagListInput.focus()):self.textarea.focus()}this.showTags&&this.typeInTagList&&(this.tagList.on("focus","input",function(){self.handleTagListFocus()}),this.textarea.on("focus",function(){self.handleTagListBlur()}),this.tagList.on("keypress","input",function(e){e.which>=32&&self.capturingKeyHandler(e,String.fromCharCode(e.which))}),this.tagList.on("keydown","input",function(e){specialKeys["_"+e.which]!==undefined&&self.capturingKeyHandler(e,specialKeys["_"+e.which])}),this.tagList.parent().on("click",function(){focusTypingArea()})),this.textarea.on("click",function(){self.closeTagMenu()}),this.tagMenu.on("click","li",function(e){self.insertNameFrom(e.currentTarget)}),this.tagMenu.on("mouseenter","li",function(e){self.selectFriendTagInDropdown(e.currentTarget)}),this.tagList.on("click",".sl_untag",function(e){self.untag(r$(e.currentTarget).data("id")),e.preventDefault()}),self.showTags&&self.typeInTagList&&this.wrapper.on("click",".sl_tag_list, .sl_tag_list li",function(){self.tagListInput.focus()}),this.taggingCta.on("click",function(){R.FB.userIsConnected()?focusTypingArea():R.FB.login(function(response){response.status===R.FB.constants.connectedStates.CONNECTED&&focusTypingArea()})}),mtp.untag=function(id){_.any(self.taggedFriends,function(friend,index){if(friend.id==id)return self.taggedFriends.splice(index,1),!0}),self.render()},this._events={},this.on=function(type,listener){this._events[type]=this._events[type]||[],this._events[type].push(listener)},this.emit=function(type,data){this._events[type]&&_.each(this._events[type],function(listener){listener(data)})}}var mtp=MentionTagger.prototype;mtp.loadFriends=function(){var self=this;R.FB.api("/me/friends/",function(response){response.data&&r$.isArray(response.data)&&(self.friendList=response.data,self.parseFriendList())})},mtp.parseFriendList=function(){var nameMap={};_.each(this.friendList,function(friend,i){var start=0,currentName=friend.name,friendNames=[];do friendNames.push(currentName.substring(start,currentName.length)),start=currentName.indexOf(" ",start)+1;while(start!==0);_.each(friendNames,function(name){name=name.toLowerCase(),typeof nameMap[name]=="undefined"&&(nameMap[name]=[]),nameMap[name].push(i)},this)},this),_.each(nameMap,function(indices,name){this.indexedNameMap.push({name:name,indices:indices})},this),this.indexedNameMap.sort(this.nameObjectComparator)},mtp.closeTagMenu=function(){this.nameTagBuffer="",this.capturingName=!1,this.tagMenu.addClass("sl_empty"),this.tagMenu.empty()},mtp.insertNameFrom=function(element){element=r$(element);var friend=_.find(this.friendList,function(friend){return friend.id==element.data("id")});this.typingInTagList?this.appendTag(friend):this.insertTag(friend),this.taggedFriends.push(friend),this.closeTagMenu(),this.render(),this.emit("tag",friend)},mtp.insertTag=function(friend){var self=this,textVal=this.textarea.val(),cursorPos=this.textarea.getSelection().start,replacementStartIndex=cursorPos-this.nameTagBuffer.length;replacementStartIndex>0&&textVal.charAt(replacementStartIndex-1)==="@"&&replacementStartIndex--;var newText=textVal.substring(0,replacementStartIndex)+friend.name+textVal.substring(cursorPos,textVal.length);this.textarea.val(newText),this.textarea.setSelection(replacementStartIndex+friend.name.length),_.defer(function(){self.textarea.focus()})},mtp.appendTag=function(friend){var self=this,textVal=this.textarea.val();(new RegExp(this.tagText)).test(textVal)?textVal+=" "+friend.name:textVal+=this.tagText+friend.name,this.textarea.val(textVal),_.defer(function(){self.tagListInput.trigger("focus")})},mtp.keyHandler=function(e,character){this.capturingName?this.capturingKeyHandler(e,character):this.nonCapturingKeyHandler(character)};function isUpperCaseLetter(character){return character===character.toUpperCase()&&character!==character.toLowerCase()}return mtp.handleBufferAddition=function(character){this.nameTagBuffer.length>=this.minimumLengthForTagMenu&&(this.stealthMode=!1);var nameMatches=this.nameTagBuffer.length?this.findMatches(this.friendList,this.indexedNameMap,this.nameTagBuffer,this.stealthMode):[];nameMatches.length?this.tagMenu.removeClass("sl_empty"):this.tagMenu.addClass("sl_empty");if(character===" "&&nameMatches.length===0){this.closeTagMenu();return}nameMatches.length>this.maxTagListSize&&(nameMatches.length=this.maxTagListSize),this.tagMenu.empty(),_.each(nameMatches,function(friend){this.tagMenu.append('<li data-id="'+friend.id+'">'+'<div class="picsquare_column">'+'<img class="picsquare" src="'+R.FB.getPicUrl(friend.id)+'" />'+"</div>"+'<div class="sl_name_column">'+'<span class="rondavu_fb_name">'+friend.name+"</span>"+"</div>"+'<div class="rondavu_clearfix"></div>'+"</li>")},this),this.selectFriendTagInDropdown(this.tagMenu.find("li").eq(0))},mtp.nonCapturingKeyHandler=function(character){character==="@"?(this.capturingName=!0,this.stealthMode=!1):isUpperCaseLetter(character)?(this.capturingName=!0,this.stealthMode=!0,this.nameTagBuffer+=character.toLowerCase(),this.handleBufferAddition(character)):this.taggedFriends.length&&(character==="backspace"||character==="delete")&&(this.syncTagsToText(),this.render(),this.textarea.focus())},mtp.capturingKeyHandler=function(e,character){if(character==="esc"||character==="left arrow"||character==="right arrow")this.capturingName=!1,this.nameTagBuffer="",this.closeTagMenu();else if(character==="down arrow"){e.preventDefault();var next=this.tagMenu.find("li.sl_selected").next("li");next.length||(next=this.tagMenu.find("li").eq(-1)),this.selectFriendTagInDropdown(next)}else if(character==="up arrow"){e.preventDefault();var prev=this.tagMenu.find("li.sl_selected").prev("li");prev.length||(prev=this.tagMenu.find("li").eq(0)),this.selectFriendTagInDropdown(prev)}else character==="enter"?(e.preventDefault(),this.insertNameFrom(this.tagMenu.find("li.sl_selected"))):(character==="backspace"?this.nameTagBuffer.length>1?this.nameTagBuffer=this.nameTagBuffer.substring(0,this.nameTagBuffer.length-1):this.closeTagMenu():this.nameTagBuffer+=character.toLowerCase(),this.handleBufferAddition(character))},mtp.handleTagListFocus=function(){this.taggingCta.hide(),this.closeTagMenu(),this.tagListInput.val(""),this.typingInTagList=!0},mtp.handleTagListBlur=function(){this.tagListInput.val(""),this.typingInTagList=!1},mtp.selectFriendTagInDropdown=function(li){this.tagMenu.find("li.sl_selected").removeClass("sl_selected"),r$(li).addClass("sl_selected")},mtp.nameObjectComparator=function(a,b){return a.name===b.name?0:a.name<b.name?-1:1},mtp.findMatches=function(friendList,nameMap,searchTerm,exactOnly){var matchIndices=[],results=[],max=nameMap.length-1,min=0,mid,matchFound=!1,name;while(max>=min){mid=Math.floor((min+max)/2),name=nameMap[mid].name;if(exactOnly?name.split(" ")[0]===searchTerm:name.indexOf(searchTerm)===0){matchFound=!0;break}nameMap[mid].name<searchTerm?min=mid+1:max=mid-1}if(!matchFound)return[];var firstMatchIndex=mid,lastMatchIndex=mid;while(firstMatchIndex>0){name=nameMap[firstMatchIndex-1].name;if(exactOnly?name.split(" ")[0]!==searchTerm:name.indexOf(searchTerm)!==0)break;firstMatchIndex--}while(lastMatchIndex<nameMap.length-1){name=nameMap[lastMatchIndex+1].name;if(exactOnly?name.split(" ")[0]!==searchTerm:name.indexOf(searchTerm)!==0)break;lastMatchIndex++}for(var i=firstMatchIndex;i<=lastMatchIndex;i++)matchIndices=_.union(matchIndices,nameMap[i].indices);return _.each(matchIndices,function(i){results.push(friendList[i])}),results.sort(this.nameObjectComparator),results},mtp.destroyHighlighter=function(){this.textarea.insertBefore(this.tagMenu),r$(".highlightTextarea").remove()},mtp.renderHighlighter=function(){this.destroyHighlighter(),this.textarea.highlightTextarea({words:_.pluck(this.taggedFriends,"name"),color:this.highlightColor,caseSensitive:!1,resizable:!1})},mtp.renderTagList=function(){this.tagListInputContainer&&this.tagListInputContainer.remove();var html=[];_.each(this.taggedFriends,function(friend){html.push('<li class="sl_tag">'+friend.name+'<a href="#" class="sl_untag" data-id="'+friend.id+'">X</a></li>')}),this.tagList.html(html.join("")),this.taggedFriends.length>0&&(this.taggingCta.hide(),this.tagList.show()),this.tagListInputContainer&&this.tagList.append(this.tagListInputContainer)},mtp.render=function(){this.showTags&&this.renderTagList(),this.highlightTaggedNames&&this.renderHighlighter()},mtp.resetTagging=function(){this.taggedFriends=[],this.render()},mtp.getTaggedIDs=function(){return _.pluck(this.taggedFriends,"id")},mtp.syncTagsToText=function(){var text=this.textarea.val(),prev_text,matcher;this.taggedFriends=_.filter(this.taggedFriends,function(friend){return matcher=R.Util.makeRegExp(friend.name,"i"),prev_text=text,text=text.replace(matcher,""),text!=prev_text})},mtp.getText=function(){this.syncTagsToText();var text=this.textarea.val(),matcher;return _.each(this.taggedFriends,function(friend){matcher=R.Util.makeRegExp(friend.name,"i"),text=text.replace(matcher,"@["+friend.id+"]")}),text},MentionTagger}(),function(){var template=Handlebars.template,templates=Handlebars.templates=Handlebars.templates||{},partials=Handlebars.partials=Handlebars.partials||{};partials["Handlebars.templates.og_action_preview"]=templates.og_action_preview=template(function(Handlebars,depth0,helpers,partials,data){helpers=helpers||Handlebars.helpers;var buffer="",stack1,foundHelper,functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this;function program1(depth0,data){var buffer="",stack1,foundHelper;return buffer+=' <div class="sl_image"> <img src="',foundHelper=helpers.pic_url,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.pic_url,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'" /> </div> ',buffer}buffer+=' <div class="sl_og_action_preview"> <div class="sl_og_action"> <span class="rondavu_fbname">',stack1=depth0.uid,foundHelper=helpers.fb_user_name,stack1=foundHelper?foundHelper.call(depth0,stack1,{hash:{}}):helperMissing.call(depth0,"fb_user_name",stack1,{hash:{}}),buffer+=escapeExpression(stack1)+"</span> ",foundHelper=helpers.actionText,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.actionText,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+' <span class="mo_type">',foundHelper=helpers.customer_mo_type,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.customer_mo_type,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+"</span> </div> ",stack1=depth0.pic_url,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(1,program1,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=' <div class="mo_name"><a href="',foundHelper=helpers.href,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.href,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'" target="_blank">',foundHelper=helpers.name,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.name,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+"</a></div> </div> ",buffer})}(),function(){var template=Handlebars.template,templates=R.Module.StreamPublish.templates={},partials=Handlebars.partials=Handlebars.partials||{};partials["R.Module.StreamPublish.module_templates.sp_single_mo"]=templates.sp_single_mo=template(function(Handlebars,depth0,helpers,partials,data){helpers=helpers||Handlebars.helpers,partials=partials||Handlebars.partials;var buffer="",stack1,foundHelper,functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this;function program1(depth0,data){var buffer="",stack1,foundHelper;return buffer+=' <div class="rondavu_fb_profile_pic"> <a href="https://www.facebook.com/profile.php?id=',foundHelper=helpers.currentUserId,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.currentUserId,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'" target="_blank"><span class="sl_picsquare_container"><img class="sl_picsquare" src="',stack1=depth0.currentUserId,foundHelper=helpers.fb_pic_url,stack1=foundHelper?foundHelper.call(depth0,stack1,{hash:{}}):helperMissing.call(depth0,"fb_pic_url",stack1,{hash:{}}),buffer+=escapeExpression(stack1)+'"/><span class="rondavu_fbname_alt"><span class="rondavu_fbname">',stack1=depth0.currentUserId,foundHelper=helpers.fb_user_name,stack1=foundHelper?foundHelper.call(depth0,stack1,{hash:{}}):helperMissing.call(depth0,"fb_user_name",stack1,{hash:{}}),buffer+=escapeExpression(stack1)+"</span></span></span></a> </div> ",buffer}function program3(depth0,data){var buffer="",stack1;buffer+=' <span class="rondavu_checkbox',stack1=depth0.checkedByDefault,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(4,program4,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+='"></span> <label class="rondavu_label">',stack1=depth0.featureConfig,stack1=stack1==null||stack1===!1?stack1:stack1["StreamPublish.FacebookCheckbox.Text"],stack1=typeof stack1===functionType?stack1():stack1,buffer+=escapeExpression(stack1)+"</label> ",buffer}function program4(depth0,data){return" checked"}function program6(depth0,data){var buffer="",stack1;buffer+=" ",stack1=depth0.showPreview,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(7,program7,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=" ",buffer}function program7(depth0,data){var buffer="",stack1;buffer+=" ",stack1=depth0.feedStory,stack1=self.invokePartial(partials["Handlebars.templates.og_action_preview"],"Handlebars.templates.og_action_preview",stack1,helpers,partials);if(stack1||stack1===0)buffer+=stack1;return buffer+=" ",buffer}function program9(depth0,data){var buffer="",stack1;buffer+=" ",stack1=depth0.showPreview,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(10,program10,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=" ",buffer}function program10(depth0,data){var buffer="",stack1;buffer+=" ",stack1=depth0.feedStory,stack1=self.invokePartial(partials["Handlebars.templates.feed_story_preview"],"Handlebars.templates.feed_story_preview",stack1,helpers,partials);if(stack1||stack1===0)buffer+=stack1;return buffer+=" ",buffer}buffer+=' <div class="rondavu_module_content"> <div class="rondavu_cta">',foundHelper=helpers.commonCta,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.commonCta,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+"</div> ",stack1=depth0.showProfilePic,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(1,program1,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=' <div class="rondavu_customer_input"> <div class="rondavu_cta_sub">',stack1=depth0.featureConfig,stack1=stack1==null||stack1===!1?stack1:stack1["StreamPublish.CTA.SubPrompt"],stack1=typeof stack1===functionType?stack1():stack1,buffer+=escapeExpression(stack1)+'</div> <textarea rows="1" cols="50"></textarea> </div> ',stack1=depth0.showFbCheckbox,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(3,program3,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=" ",stack1=depth0.mentionTagging,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.program(9,program9,data),fn:self.program(6,program6,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=' <span class="streampublish_opt_in rondavu_button">',stack1=depth0.featureConfig,stack1=stack1==null||stack1===!1?stack1:stack1["StreamPublish.PostButton.Text"],stack1=typeof stack1===functionType?stack1():stack1,buffer+=escapeExpression(stack1)+'<span class="rondavu_button_end"></span></span> </div> ',buffer})}(),R.Module.ActivityStream=function(config){R.Module.prototype.initializer.call(this,config),this.initializer(config)},function(){R.Module.ActivityStream.prototype=new R.Module;var StreamType={STREAM:"stream",NEWSFEED:"newsfeed",LARGE_PHOTO_FEED:"largephotofeed",DROPDOWN:"dropdown",QUICKVIEW:"quickview"},CLIENT_SIDE_ITEM_CLASS="sl_activity_item_client",ACTIVITY_STREAM_CSS_CLASS="activity_stream",FRIENDS_TAB_INTEREST_KEY="friends_tab_showed_interest",FRIENDS_TAB_INTEREST_EXPIRY=6048e5;r$.extend(R.Module.ActivityStream.prototype,{name:"activitystream",base_url:"rondavu/activitystream/",social_warning_postfix:"social_warning_shown",type:null,activityItemMap:{},is_reloading:!1,suppress_reload:!1,store_items:!1,render_replies_inline:!1,first_names_only:!1,hide_form_on_reply:!1,friends_tab_stream_data:[],reachedMaxHeight:!1,initializer:function(){var self=this;R.FB.userIsConnected()&&R.FB.getCurrentUser(),this.WARNING_KEY="SL-WARNING-"+R.Core.config.customer_name,this.type=this.getParameter("ActivityStream.Type"),this.store_items=this.type==StreamType.QUICKVIEW,this.render_replies_inline=this.type==StreamType.STREAM,this.first_names_only=this.type==StreamType.NEWSFEED,this.hide_form_on_reply=this.type!=StreamType.QUICKVIEW,this.tabbedDisplay=this.type===StreamType.DROPDOWN&&this.getBooleanParameter("ActivityStream.Tab.UseTabs");var default_num_slots=0;this.friends_slots_enabled=parseInt(this.getParameter("ActivityStream.FriendsSlots.NumSlots"),default_num_slots)!==0,this.friends_slots_show_my_activity_enabled=this.getBooleanParameter("ActivityStream.FriendsSlots.ShowMyActivity.Enable"),this.initializeCustomText(),this.initializeSharingStatus(),this.tabbedDisplay&&this.setupTabs(),this.initiateSocialWarning(),this.type===StreamType.DROPDOWN&&(this.delegate("change",function(e){R.StorageManager.createOrUpdateLocalObject(R.StorageManager.getUserKey(),{dismiss_evershare_warning:e.target.checked}),this.notifyOtherModules(new R.Module.Message.User.DismissEverShareWarningSettingChanged)},".dismiss_evershare_warning :checkbox"),R.Event.listen("evershare_warning_dismiss_config",function(config){config.dismissible?(self.getEl().find(".dismiss_evershare_warning :checkbox").attr("checked",config.dismissed),self.getEl().find(".dismiss_evershare_warning .text").html(config.dismiss_text)):self.getEl().find(".dismiss_evershare_warning").remove()}))},initializeCustomText:function(){this.sharing_more_info_html=this.getParameter("Common.Sharing.MoreInfoHTML"),this.title=this.getParameter("Common.Layout.SuperTitleBar.Text"),this.customerName=this.config.init_data.customer_name,this.customerPatronDescription=this.getParameter("ActivityStream.CustomerPatronDescription"),this.socialWarningText=this.getParameter("Common.Sharing.SocialWarning.Text");var dropdownTitle=this.getParameter("ActivityStream.Dropdown.Title"),dropdownActivityTitle=this.getParameter("ActivityStream.Dropdown.StreamTitle"),logoutLinkEnable=this.getBooleanParameter("ActivityStream.Dropdown.LogoutLink.Enable");this.sharing_more_info_html&&r$(".customer_specific_more_info_html",this.getEl()).html(this.sharing_more_info_html),r$(".rondavu_activitystream_title",this.getEl()).html(this.title),r$(".rondavu_customer_name",this.getEl()).html(this.customerName),r$(".rondavu_customer_patron_description",this.getEl()).html(this.customerPatronDescription),this.type==StreamType.DROPDOWN&&(this.getBooleanParameter("Common.Sharing.ShowWhenLoggedOut")&&r$(this.getEl()).addClass("sl_always_show"),this.socialWarningText&&r$(".sl_social_warning_text",this.getEl()).html(this.socialWarningText),dropdownTitle?this.getEl().find(".sl_dropdown_title").html(dropdownTitle):this.getEl().find(".sl_dropdown_title").remove(),logoutLinkEnable?this.getEl().find(".sl_fb_logout_link").html(this.getParameter("ActivityStream.Dropdown.LogoutLink.Text")):this.getEl().find(".sl_fb_logout").remove(),dropdownActivityTitle?this.getEl().find(".sl_dropdown_activity_title").html(dropdownActivityTitle):this.getEl().find(".sl_dropdown_activity_title").remove(),this.initializeSharingHelp())},initHtml:function(){R.Module.prototype.initHtml.call(this);var self=this,el=self.getEl();r$(el).html(self.config.html),self.updateConnectedStatus(),self.config.init_data.stream&&self.renderStream(self.config.init_data.stream),self.renderSharingStatus()},initHtmlEvents:function(){var self=this;this.delegate("click",function(e){window.location.href=e.currentTarget.getAttribute("href")},"span.mo_link"),this.delegate("click",this.handleReplyClick,".activity_reply_link"),this.delegate("mousedown",function(e){var targetEl=r$(e.target);if(targetEl.hasClass("activity_reply_link")){var id=targetEl.data("id");r$(".activity_item_"+id+"_reply_form textarea").attr("data-disableonblur",!0)}},".activity_reply_link"),this.getBooleanParameter("ActivityStream.ItemReport.Enable")&&this.delegate("click",this.handleReportClick,".activity_report_link"),this.delegate("click",this.handlePostReplyClick,".activity_reply_button"),this.delegate("click",this.handleDeleteClick,".activity_delete"),this.delegate("click",function(e){e.preventDefault()},".sl_hover_menu_link"),this.delegate("click",this.handleSharingToggleClick,".sl_sharing_toggle",{is_cta:!0}),this.delegate("click",this.toggleShareHelp,".sl_sharing_help_button, .sl_sharing_help_close"),this.delegate("blur",function(e){var formEl=r$(e.target);formEl.val()||self.hide_form_on_reply&&formEl.attr("data-disableonblur")===undefined&&(r$(e.target).parents(".activity_item_reply_form").hide(),self.updateScrolling(r$(".activity_list",self.getEl()),{isMaxHeight:self.reachedMaxHeight}))},".activity_item_reply_form"),window.Touch&&r$(".sl_hover_menu").toggleClass("sl_touch_hide"),this.delegate("touchend",function(){r$(".sl_hover_menu").toggleClass("sl_touch_hide")},".sl_sharing_current, .sl_menu_arrow"),r$(".sl_hover_menu",this.getEl()).mouseenter(function(){r$(this).removeAttr("style")}),r$(".sl_hover_menu",this.getEl()).mouseleave(function(){var self=this;r$(self).css({display:"block"}),setTimeout(function(){r$(self).removeAttr("style")},1e3)}),this.getBooleanParameter("ActivityStream.Dropdown.LogoutLink.Enable")&&this.delegate("click",function(){FB.logout()},".sl_fb_logout_link"),this.delegate("click",this.clearAndDisconnect,".rondavu_kill_share_button"),this.trackClicks(".mo_link")},initializeSharingHelp:function(){var self=this,sharing_text_properties={"Common.Sharing.Help.Main.Title":"sl_sharing_help_main_title","Common.Sharing.Help.WhatShared.Customer.Title":"sl_sharing_help_whatshared_customer_title","Common.Sharing.Help.WhatShared.Customer.Actions":"sl_sharing_help_whatshared_customer_actions","Common.Sharing.Help.WhatShared.Facebook.Title":"sl_sharing_help_whatshared_facebook_title","Common.Sharing.Help.WhatShared.Facebook.Actions":"sl_sharing_help_whatshared_facebook_actions","Common.Sharing.Help.DontWantSharing.Title":"sl_sharing_help_dontwantsharing_title","Common.Sharing.Help.DontWantSharing.Instruction":"sl_sharing_help_dontwantsharing_instruction","Common.Sharing.ClearData.Title":"sl_sharing_help_cleardata_title","Common.Sharing.ClearData.LinkText":"sl_sharing_help_cleardata_linktext"};R.Util.each(sharing_text_properties,function(css_class,sfs_property){var custom_value=self.getParameter(sfs_property);custom_value&&r$("."+css_class,self.getEl()).html(custom_value)})},updateScrolling:function($container,options){this.type!=StreamType.LARGE_PHOTO_FEED&&$container.slimscroll(options)},renderSharingStatus:function(){var current_text=this.getParameter("Common.Sharing."+(this.user.is_sharing?"On":"Off")+".Text"),toggle_text=this.getParameter("Common.Sharing."+(this.user.is_sharing?"TurnOff":"TurnOn")+".Text"),picContainer=this.getEl().find(".rondavu_fb_profile_pic");if(this.getBooleanParameter("ActivityStream.Dropdown.ProfilePic.Enable")){var uid=R.FB.getCurrentUserId();uid>0?(picContainer.removeClass("rondavu_fb_generic_profile_pic"),picContainer.find("img").attr("src",R.FacebookUserMap.getPicUrlById(uid)).show()):(picContainer.addClass("rondavu_fb_generic_profile_pic"),picContainer.find("img").hide())}else picContainer.remove();r$(".sl_sharing_toggle",this.getEl()).text(toggle_text),r$(".sl_sharing_current",this.getEl()).text(current_text),r$(".dismiss_evershare_warning",this.getEl()).toggle(this.user.is_sharing)},toggleShareHelp:function(e){e.preventDefault(),r$(".sl_sharing_help",this.getEl()).toggle()},getSuIdClassName:function(su_id,is_reply){var id_prefix="sl_activity_item_";return is_reply&&(id_prefix+="reply_"),id_prefix+su_id},addSuIdInfoToStreamItem:function(stream_item,su_id,is_reply,fbUid){var $stream_item=r$(stream_item),last_su_id_class=$stream_item.data("last-su-id-class");last_su_id_class&&$stream_item.removeClass(last_su_id_class);var su_id_class=this.getSuIdClassName(su_id,is_reply);$stream_item.data("su-id",su_id),$stream_item.data("last-su-id-class",su_id_class),$stream_item.data("fb-uid",fbUid),$stream_item.addClass(su_id_class)},fillClientGeneratedActivityOnResponse:function(data){var self=this;if(data.comment&&(data.comment_id||data.is_profane)){var populate_item=function(no_retry){var pending_item=null;r$("."+CLIENT_SIDE_ITEM_CLASS).each(function(){if(r$(this).find(".activity_description").html()==data.comment)return pending_item=this,!1});if(pending_item!==null){if(data.is_profane){r$(pending_item).fadeOut("fast",function(){r$(pending_item).remove()});return}self.addSuIdInfoToStreamItem(pending_item,data.comment_id,data.is_reply,data.user_facebook_id),self.initItemReplyInfo({id:data.comment_id},pending_item),r$(".activity_item_client_side_reply_form",pending_item).removeClass("activity_item_client_side_reply_form"),r$(".activity_report_link, .activity_reply_button, .activity_reply_link, .activity_delete",pending_item).data("id",data.comment_id),r$(".activity_delete, .activity_delete_all",pending_item).show(),r$(".activity_option_list",pending_item).show(),r$(pending_item).removeClass(CLIENT_SIDE_ITEM_CLASS)}else no_retry||R.Event.listen("stream.update.fb.login",function(){populate_item(!0)})};populate_item()}},handleMessage:function(message){var self=this;if(message.type==="fb.login")R.Logger.debug("stream got fb login message"),self.initiateSocialWarning(),self.suppress_reload?R.Logger.debug("stream reload was suppressed"):(R.Logger.debug("stream is updating"),self.updateStream(function(){R.Event.fire("stream.update.fb.login",{})})),R.Logger.debug("updating connected status"),self.updateConnectedStatus(),R.Logger.debug("adding current user to fb map"),R.FacebookUserMap.addCurrentUser();else if(message.type==="su.created")message.comment&&self.type==StreamType.STREAM&&(R.FacebookUserMap.addCurrentUser(),self.is_reloading?self.pending_comment=message.comment:self.addStreamComment(message.comment));else if(message.type==="su.creation.complete")self.type==StreamType.STREAM?self.fillClientGeneratedActivityOnResponse(message):self.updateStream();else if(message.type=="og.action.created")self.updateStream();else if(message.type=="su.deleted")self.updateStream();else if(message.type=="fb.logout")self.currentUser=null,self.currentUserId=null,self.updateStream(function(){self.updateScrolling(r$(".activity_list",self.getEl()),{isMaxHeight:self.reachedMaxHeight})}),self.onFacebookDisconnect();else if(message.type=="fb.new.connect")self.initiateSocialWarning();else if(message.type=="fb.like")self.updateStream();else if(message.type==="user.sharingStatusChanged")this.renderSharingStatus();else if(message.type==="user.dismissEverShareWarningSettingChanged"){var user=R.StorageManager.getLocalObject(R.StorageManager.getUserKey());this.getEl().find(".dismiss_evershare_warning :checkbox").attr("checked",user.dismiss_evershare_warning)}},updateStream:function(callback){var self=this,use_tabs=this.getBooleanParameter("ActivityStream.Tab.UseTabs");use_tabs&&this.switchTab("my_activity",!0),self.is_reloading=!0,self.ajax(this.base_url+"get_stream/",{data:{},success:function(response){self.renderStream(response.stream,function(){self.pending_comment&&(self.addStreamComment(self.pending_comment),self.pending_comment=null),self.is_reloading=!1,self.updateSparseClasses(response.is_sparse),typeof callback=="function"&&callback()})}})},addStreamComment:function(comment_text){var new_item={user_facebook_id:R.FB.getCurrentUserId(),action_name:this.getParameter("SuAction.Comment.You.Text")||this.getParameter("SuAction.Comment.Text"),display_timestamp:"moments ago",action_detail:comment_text,action_type:"Comment",is_friend_slot:this.friends_slots_enabled&&this.friends_slots_show_my_activity_enabled,deletable:!0,client_side:!0},new_item_html=this.getSingleItemHtml(new_item),new_item_el=r$(new_item_html).css({visibility:"visible",opacity:"0"});r$(".activity_list li",this.getEl()).first().removeClass("first"),r$(".activity_item_sparse_view").parents(".activity_item_container").remove();var activity_list_el=r$(".activity_list",this.getEl()),last_friends_slot_el=activity_list_el.find(".activity_is_friends_slot").last();this.friends_slots_enabled&&!this.friends_slots_show_my_activity_enabled&&last_friends_slot_el.size()!==0?new_item_el.insertAfter(last_friends_slot_el):activity_list_el.prepend(new_item_el),this.updateScrolling(activity_list_el,{isMaxHeight:this.reachedMaxHeight}),r$(".activity_list li",this.getEl()).first().addClass("first"),new_item_el.animate({opacity:"1"},"slow")},initiateSocialWarning:function(){var self=this;if(!this.getBooleanParameter("Common.Sharing.SocialWarning.Enable"))return;if(this.type==StreamType.DROPDOWN&&this.FB.userIsConnected()&&this.FB.getAuthResponse().userID){var socialWarningKey=this.WARNING_KEY+"-"+this.social_warning_postfix+"-"+this.FB.getAuthResponse().userID,socialWarningShown=R.StorageManager.getLocalObject(socialWarningKey);socialWarningShown||this.showSocialWarning(function(){r$(".sl_social_warning_dialog",self.getEl()).is(":visible")&&R.StorageManager.setLocalObject(socialWarningKey,!0)})}},showSocialWarning:function(callback){r$(".sl_sharing_toggle",this.getEl()).size()>0&&this.type==StreamType.DROPDOWN&&(R.Logger.debug("new connection detected... triggering social warning"),r$(".sl_social_warning_dialog .sl_social_warning_close").click(function(){r$(this).parents(".sl_social_warning_dialog").hide()}),r$(".sl_social_warning_dialog").fadeIn("fast",function(){typeof callback=="function"&&callback()}),setTimeout(function(){r$(".sl_social_warning_dialog").fadeOut("slow")},1e4))},renderStream:function(items,callback){var self=this,render=function(){self.renderStreamWithData(items),typeof callback=="function"&&callback()};if(items&&items.length){var facebook_ids=self.getFacebookIdsFromItems(items);if(facebook_ids&&facebook_ids.length){R.FacebookUserMap.addUsersById(facebook_ids,function(){render()});return}}render()},renderReply:function(reply,reference_el){var reply_element=this.getSingleItemHtml(reply);reference_el=reference_el||r$("."+this.getSuIdClassName(reply.parent_id,!1),this.getEl()),r$(" .activity_item_comments",reference_el).append(reply_element)},storeItem:function(item){this.activityItemMap[item.id]=item},storeClientGeneratedReply:function(reply){if(!reply.parent_id||!this.activityItemMap[reply.parent_id]){var msg=reply.parent_id?"parent item "+reply.parent_id+" not found in module cache.":"reply has no parent_id.";R.Logger.error("Invalid call to storeClientGeneratedReply - "+msg);return}this.activityItemMap[reply.parent_id].reply_list||(this.activityItemMap[reply.parent_id].reply_list=[]),this.activityItemMap[reply.parent_id].reply_list.push(reply)},updateStoredClientGeneratedReply:function(parent_id,reply_text,reply_su_id){if(!this.activityItemMap[parent_id]||!this.activityItemMap[parent_id].reply_list){var msg=this.activityItemMap[parent_id]?"no reply list found for parent item "+parent_id+".":"parent item "+parent_id+" not found in module cache.";R.Logger.error("Invalid call to updateStoredClientGeneratedReply - "+msg);return}var found=!1;r$.each(this.activityItemMap[parent_id].reply_list,function(index,reply){if(reply.client_side&&reply.action_detail==reply_text)return reply.id=reply_su_id,reply.client_side=!1,found=!0,!1}),found||R.Logger.error("Reply not found for parent: "+parent_id+" and text: "+reply_text+".  Reply SU id was: "+reply_su_id)},deleteClientGeneratedReply:function(parentId,replyId){if(!parentId||!this.activityItemMap[parentId]){var msg=parentId?"parent item "+parentId+" not found in module cache.":"reply has no parent_id.";R.Logger.error("Invalid call to deleteClientGeneratedReply - "+msg);return}var toRemove=-1;R.Util.each(this.activityItemMap[parentId].reply_list,function(replyObj,i){if(replyObj.id===replyId)return toRemove=i,!1}),toRemove===-1&&R.Logger.error("Invalid call to deleteClientGeneratedReply - reply ID not found in parent ID's reply list");var replies=this.activityItemMap[parentId].reply_list;this.activityItemMap[parentId].reply_list=replies.slice(0,toRemove).concat(replies.slice(toRemove+1,replies.length))},renderStoredReplies:function(su_id,ref_element){var self=this,item=self.activityItemMap[su_id];if(!item||!item.reply_list){R.Logger.debug("No su replies found for su_id "+su_id+".  Returning from renderStoredReplies...");return}r$.each(item.reply_list,function(reply_index,reply){reply.parent_id=su_id,self.renderReply(reply,ref_element)})},clearReplyList:function(reference_el){r$(" .activity_item_comments",reference_el).empty()},processReplyListFromRequest:function(reply_list,su_id){var self=this;r$.each(reply_list,function(reply_index,reply){reply.parent_id=su_id,self.renderReply(reply)})},renderStreamWithData:function(items,tabClass){var self=this,maxToShow=parseInt(this.getParameter("ItemCount.MaxVisibleOnLoad"),10),classSelector=this.type==StreamType.DROPDOWN?".activity_list_wrapper"+(tabClass!==undefined&&tabClass.length?"."+tabClass:".my_activity"):"."+ACTIVITY_STREAM_CSS_CLASS,activity_wrapper=r$(classSelector,this.getEl()),activity_list=r$(".activity_list",activity_wrapper);activity_list.empty();var invisible_parent=activity_wrapper.parents().filter(function(){return r$(this).css("display")=="none"}),invisible_parent_style=invisible_parent.attr("style");invisible_parent.removeAttr("style"),invisible_parent.css({visibility:"hidden",display:"block"}),self.type===StreamType.DROPDOWN?activity_wrapper.css({visibility:"visible",opacity:"0"}):activity_wrapper.css({visibility:"visible",display:"block",opacity:"0"});if(items&&items.length)this.reachedMaxHeight=!1,activity_wrapper.css({height:"auto"}),this.sortActivityItems(items),r$.each(items,function(index,item){var item_element=self.getSingleItemHtml(item);index===0&&r$(item_element).addClass("first"),activity_list.append(item_element),self.store_items&&self.storeItem(item),self.render_replies_inline&&item.reply_list&&item.reply_list.length&&self.processReplyListFromRequest(item.reply_list,item.id);if(index==maxToShow-1){if(self.type==StreamType.LARGE_PHOTO_FEED)return!1;activity_wrapper.css("height",activity_wrapper.height()+"px"),self.reachedMaxHeight=!0}}),r$("div.activity_description",activity_list).ellipsis(),this.updateScrolling(activity_list,{isMaxHeight:this.reachedMaxHeight});else if(this.getParameter("ActivityStream.NoActivity.Text")!==""){var item_element=self.getSingleItemHtml();r$(item_element).addClass("first"),activity_list.append(item_element)}this.type==StreamType.QUICKVIEW&&self.initQuickViewHover(),invisible_parent_style?invisible_parent.attr("style",invisible_parent_style):invisible_parent.removeAttr("style"),activity_wrapper.animate({opacity:"1"},"normal")},getFacebookIdsFromItems:function(items){var facebook_ids=[];for(var i in items)if(items.hasOwnProperty(i)){var item=items[i];item.user_facebook_id&&facebook_ids.push(item.user_facebook_id)}return facebook_ids},sortActivityItems:function(items){var self=this;items.sort(function(a,b){return self.friends_slots_enabled&&a.is_friend_slot!=b.is_friend_slot?a.is_friend_slot?-1:1:new Date(b.timestamp)-new Date(a.timestamp)})},getFullNameAltTextEl:function(facebook_id){var full_name=R.FacebookUserMap.getUserNameById(facebook_id,!1);return full_name?r$(document.createElement("span")).addClass("sl_alt_text").text(full_name):""},fillFacebookUserData:function(facebook_id,reference_el){this.fillFacebookUserPic(facebook_id,reference_el),this.fillFacebookUserName(facebook_id,reference_el)},fillFacebookUserPic:function(facebook_id,reference_el){var $picsquare_el=r$(".picsquare",reference_el),picsquare_url=R.FacebookUserMap.getPicUrlById(facebook_id);picsquare_url?($picsquare_el.attr("src",picsquare_url),$picsquare_el.siblings(".sl_alt_text").remove(),$picsquare_el.after(this.getFullNameAltTextEl(facebook_id))):$picsquare_el.remove()},fillFacebookUserName:function(facebook_id,reference_el){var $user_name_el=r$(".activity_user_name",reference_el),user_name=R.FacebookUserMap.getUserNameById(facebook_id,this.first_names_only);if(!user_name){user_name="A User";var field=this.first_names_only?"first_name":"name";this.FB.api(facebook_id+"?fields="+field,function(user){user&&user[field]&&$user_name_el.text(user[field])})}$user_name_el.text(user_name),this.first_names_only&&(r$(".sl_alt_text",$user_name_el).remove(),$user_name_el.append(this.getFullNameAltTextEl(facebook_id)))},populateMoData:function(mo_data_obj,reference_el){if(mo_data_obj.parent_id)return;if(typeof mo_data_obj.mo_pic_url!="undefined"){r$("img.mo_pic",reference_el).attr("src",mo_data_obj.mo_pic_url),r$(".mo_name",reference_el).html(mo_data_obj.mo_name),r$(".mo_description",reference_el).html(mo_data_obj.mo_description);var new_desc_html=r$(".mo_description",reference_el).html();!new_desc_html||r$(".mo_description",reference_el).html(new_desc_html.replace(/(\\r\\n)+/g,"<br/><br/>")),r$(".mo_link",reference_el).attr("href",this.decorateLinkForOmniture(mo_data_obj.mo_url))}if(typeof mo_data_obj.price_retail!="undefined"){var price=r$(".mo_price",reference_el),price_sale=r$(".mo_new_price",reference_el),price_description=r$(".mo_price_description",reference_el);price.text(mo_data_obj.price_retail),mo_data_obj.price_sale?(price_sale.text(mo_data_obj.price_sale),price.addClass("mo_prev_price"),price_sale.addClass("mo_price")):price_sale.remove(),mo_data_obj.price_description?price_description.html(mo_data_obj.price_description):price_description.remove()}},populateSuData:function(su_data_obj,reference_el){this.addSuIdInfoToStreamItem(reference_el,su_data_obj.id,!!su_data_obj.parent_id,su_data_obj.user_facebook_id),r$(".activity_action",reference_el).text(su_data_obj.action_name),su_data_obj.action_detail?r$(".activity_description",reference_el).addClass("activity_description_filled").text(su_data_obj.action_detail):r$(".activity_description",reference_el).removeClass("activity_description_filled").empty(),r$(".activity_timestamp",reference_el).text(su_data_obj.display_timestamp),su_data_obj.is_friend_slot&&reference_el.addClass("activity_is_friends_slot")},updateReplyFormPicsquare:function(reference_el){var currentUserId=R.FB.getCurrentUserId();if(!currentUserId)return;r$(".activity_item_reply_form .rondavu_fb_generic_profile_pic",reference_el).removeClass("rondavu_fb_generic_profile_pic").find("img").attr("src",R.FacebookUserMap.getPicUrlById(currentUserId))},updateActivityItemOptions:function(item_data,reference_el){item_data.deletable||r$(".activity_delete, .activity_delete_all",reference_el).remove(),(!item_data.action_detail||item_data.deletable||!this.getBooleanParameter("ActivityStream.ItemReport.Enable"))&&r$(".activity_report_link",reference_el).remove(),!item_data.id||r$(".activity_report_link, .activity_delete",reference_el).data("id",item_data.id),!item_data.parent_id||r$(".activity_delete",reference_el).data("is_reply",!0),r$(".activity_options_container ul",reference_el).size()>0&&r$(".activity_options_container ul li",reference_el).size()===0&&r$(".activity_options_container",reference_el).remove()},updateClientRenderedItem:function(item_data,reference_el){r$(reference_el).addClass(CLIENT_SIDE_ITEM_CLASS),r$(".activity_option_list",reference_el).hide(),item_data.deletable&&r$(".activity_delete, .activity_delete_all",reference_el).hide()},initItemReplyInfo:function(item_data,reference_el){if(item_data.parent_id)reference_el.addClass("activity_item_sub_comment"),r$(".activity_item_reply_form, .activity_item_comments, .activity_reply_link, .quick_view_overlay",reference_el).remove();else{var $form=r$(".activity_item_reply_form",reference_el);if($form&&$form.size()){var last_form_class=$form.data("last-reply-class");last_form_class&&$form.removeClass(last_form_class);var form_class="activity_item_"+(item_data.id||"client_side")+"_reply_form";$form.addClass(form_class),$form.data("last-reply-class",form_class),this.updateReplyFormPicsquare(reference_el),!item_data.id||r$(".activity_reply_button, .activity_reply_link",reference_el).data("id",item_data.id)}var $comments=r$(".activity_item_comments",reference_el);if($comments&&$comments.size()){var last_comments_class=$comments.data("last-comments-class");last_comments_class&&$comments.removeClass(last_comments_class);var comments_class="activity_item_"+item_data.id+"_comments";$comments.addClass(comments_class),$comments.data("last-comments-class",comments_class)}}},decorateLinkForOmniture:function(item_url){if(this.getBooleanParameter("Common.Analytics.CustomerSiteTinyUrlWrapping.Enable"))return item_url;if(!item_url)return item_url;var ssfeat=this.config.feature_id;ssfeat=ssfeat.substring(0,ssfeat.indexOf("&"));var sfbstate=this.FB.userIsConnected()?"FBConnected":"FBUnknown",query_char=item_url.indexOf("?")!=-1?"&":"?";return item_url+query_char+"SSFEAT="+ssfeat+"&SFBSTATE="+sfbstate},fillItemData:function(item_data,item_element){var reference_el=r$(item_element);if(!item_data){var activity_item_el=reference_el.find(".activity_item").html(this.getParameter("ActivityStream.NoActivity.Text"));activity_item_el.addClass("activity_item_sparse_view");return}var facebook_id=item_data.user_facebook_id;reference_el.addClass("rondavu_action_"+item_data.action_type.toLowerCase());var my_activity_only=this.getBooleanParameter("ActivityStream.MyActivityOnly"),use_tabs=this.getBooleanParameter("ActivityStream.Tab.UseTabs"),show_mo_pic_only=my_activity_only&&!use_tabs||use_tabs&&this.getTabId()!="friends_activity",get_facebook_data=!!facebook_id;show_mo_pic_only?(r$(".picsquare",reference_el).attr("src",item_data.mo_pic_url||"#"),get_facebook_data&&this.fillFacebookUserName(facebook_id,reference_el)):get_facebook_data&&this.fillFacebookUserData(facebook_id,reference_el),this.populateSuData(item_data,reference_el),this.populateMoData(item_data,reference_el),this.initItemReplyInfo(item_data,reference_el),this.updateActivityItemOptions(item_data,reference_el),item_data.client_side&&this.updateClientRenderedItem(item_data,reference_el)},cloneSingleItemTemplate:function(){return r$(".activity_item_template .activity_item_container",this.getEl()).clone()},getSingleItemHtml:function(item){var item_element=this.cloneSingleItemTemplate();return this.fillItemData(item,item_element),item_element},getFormByActivityItemId:function(id){return r$(".activity_item_"+id+"_reply_form",this.getEl())},getActivityItemCommentsById:function(id){return r$(".activity_item_"+id+"_comments",this.getEl())},initReplyForm:function($form,no_focus,disableButton){r$("textarea",$form).css("display","block").autoResize({extraSpace:20}),no_focus||r$("textarea",$form).focus(),disableButton&&$form.find(".rondavu_button").addClass("rondavu_disabled"),R.FacebookUserMap.addCurrentUser()},renderTabs:function(){var $el=this.getEl(),my_icon=this.getParameter("Tab.General.Icon"),friends_icon=this.getParameter("Tab.Friend.Icon"),getIconHtml=function(icon_url){return icon_url?'<img src="'+R.Util.fixUrl(R.Core.getCDNUrl(),"SFS"+icon_url)+'" class="rondavu_icon" />':""},my_icon_html=getIconHtml(my_icon),friends_icon_html=getIconHtml(friends_icon),my_activity_tab_html=my_icon_html+this.getParameter("Tab.General.Text"),friends_activity_tab_html=friends_icon_html+this.getParameter("Tab.Friend.Text");r$(".activity_list_wrapper",$el).before(r$(".rondavu_tabs",$el).show()),r$("#rondavu_tab_my_activity",$el).html(my_activity_tab_html),r$("#rondavu_tab_friends_activity",$el).html(friends_activity_tab_html),r$(".rondavu_tabs",$el).after('<div class="rondavu_clearfix"></div>')},loadFriendsTabStream:function(){var self=this,$el=self.getEl(),$friends_tab=r$("#rondavu_tab_friends_activity",$el);if($friends_tab.data("loading-friends"))return;$friends_tab.data("loading-friends",!0),self.ajax(R.Util.fixUrl(self.base_url,"get_friends_stream"),{mos_etags:!1,success:function(data){self.friends_tab_stream_data=data,self.getTabId()=="friends_activity"&&self.renderFriendsTabStream(),$friends_tab.data("loading-friends",!1),$friends_tab.data("loaded-friends",!0)}})},renderFriendsTabStream:function(){this.renderStreamWithData(this.friends_tab_stream_data,"friends_activity")},setupTabs:function(){var self=this,$el=self.getEl(),$friends_tab=r$("#rondavu_tab_friends_activity",$el),$hover_menu=r$(".dropdown > .sl_hover_menu_container > .sl_hover_menu",$el);self.renderTabs();var timestamp=(new Date).getTime(),friends_tab_interest_timestamp=R.StorageManager.getLocal(FRIENDS_TAB_INTEREST_KEY,timestamp);friends_tab_interest_timestamp&&timestamp-friends_tab_interest_timestamp<FRIENDS_TAB_INTEREST_EXPIRY&&self.loadFriendsTabStream(),this.tabview({my_activity:{click:this.onTabSwitch},friends_activity:{click:function(tabContentDiv,idPart){$friends_tab.data("loaded-friends")?self.renderFriendsTabStream():self.loadFriendsTabStream(),self.onTabSwitch(tabContentDiv,idPart)}}},!1,!1,$hover_menu),$hover_menu.mouseenter(function(){var timestamp=(new Date).getTime();R.StorageManager.setLocal(FRIENDS_TAB_INTEREST_KEY,timestamp),$friends_tab.data("loaded-friends")||self.loadFriendsTabStream()}),r$(".rondavu_su_box",$el).addClass("activity_list_wrapper friends_activity").append('<ul class="activity_list"></ul>')},onTabSwitch:function(tabContentDiv,idPart){this.trackEventForPrimaryMo("switch tab "+idPart)},handleReplyClick:function(e){e.preventDefault();var id=r$(e.target).data("id"),$form=this.getFormByActivityItemId(id),textAreaEl=r$("textarea",$form);$form.css("display")!="block"?(r$(".activity_item_reply_form",this.getEl()).hide(),$form.hide(),$form.fadeIn(),this.initReplyForm($form),this.updateScrolling(r$(".activity_list",this.getEl()),{isMaxHeight:this.reachedMaxHeight})):textAreaEl.focus(),textAreaEl.removeAttr("data-disableonblur")},initQuickViewHover:function(){var self=this,hide_timeout,is_focused,current_id,$el=r$(this.getEl()),left_pos=$el.offset().left,right_pos=r$(window).innerWidth()-left_pos+$el.outerWidth(),is_left=left_pos<=right_pos;$el.on("focus",".quick_view_overlay .activity_item_reply_form textarea",function(){is_focused=!0,clearTimeout(hide_timeout)}),$el.on("blur",".quick_view_overlay .activity_item_reply_form textarea",function(){is_focused=!1}),self.delegate("keyup",function(event){var text=event.currentTarget.value;text===""?r$(event.currentTarget).parent().parent().find(".rondavu_button").addClass("rondavu_disabled"):r$(event.currentTarget).parent().parent().find(".rondavu_button").removeClass("rondavu_disabled")},".quick_view_overlay .activity_item_reply_form textarea",{logging:!1}),self.delegate("mouseenter",function(event){var activity_item_el=event.currentTarget,id=r$(activity_item_el).data("su-id");current_id=id;var activity_data=self.activityItemMap[id],facebook_id=activity_data.user_facebook_id,$overlay=r$(".quick_view_overlay",self.getEl()),$arrow=r$(is_left?".quick_view_overlay_left_arrow":".quick_view_overlay_right_arrow",$el);hide_timeout&&clearTimeout(hide_timeout),setTimeout(function(){if(current_id!=id)return;r$(".activity_item_reply_form textarea",$overlay).val("").blur(),$arrow.hide(),$overlay.fadeOut("fast",function(){self.initReplyForm(r$(".activity_item_reply_form",$overlay),!0,!0),self.fillFacebookUserData(facebook_id,r$(".activity_item_summary",$overlay)),self.populateSuData(activity_data,$overlay),self.populateMoData(activity_data,$overlay),self.initItemReplyInfo(activity_data,$overlay),self.clearReplyList($overlay),self.renderStoredReplies(id,$overlay),$overlay.css({display:"block",visibility:"visible",opacity:"0"}).position({my:is_left?"left":"right",at:is_left?"right":"left",of:activity_item_el}),$arrow.css({display:"block",visibility:"visible",opacity:"0"}).position({my:is_left?"left":"right",at:is_left?"right":"left",of:activity_item_el});var top_offset=$overlay.offset().top,bottom_offset=r$(window).scrollTop()+r$(window).innerHeight()-top_offset-$overlay.outerHeight(),left_offset=$overlay.offset().left+20*(is_left?1:-1);top_offset<0?$overlay.offset({left:left_offset,top:0}):bottom_offset<0?$overlay.offset({left:left_offset,top:top_offset+bottom_offset}):$overlay.offset({left:left_offset,top:top_offset}),$arrow.offset({left:$arrow.offset().left+20*(is_left?1:-1)}),$overlay.animate({opacity:"1"},"fast"),$arrow.animate({opacity:"1"},"fast")})},500)},".activity_stream .activity_item_container",{action:"flyover"}),$el.on("mouseleave",".activity_stream .activity_item_container",function(){current_id=null}),r$(".quick_view_overlay",$el).on("mouseenter",function(){hide_timeout&&clearTimeout(hide_timeout)}),$el.on("mouseleave",function(){var $overlay=r$(".quick_view_overlay",$el),$arrow=r$(is_left?".quick_view_overlay_left_arrow":".quick_view_overlay_right_arrow",$el);if(is_focused||$overlay.data("keep-open"))return;hide_timeout&&clearTimeout(hide_timeout),hide_timeout=setTimeout(function(){$arrow.hide(),$overlay.fadeOut(300,function(){$overlay.css({top:0,left:0}),$arrow.css({top:0,left:0})})},500)}),r$($el).on("click",function(e){e.stopPropagation()}),r$("body").on("click",function(){r$(".quick_view_overlay",$el).hide(),r$(is_left?".quick_view_overlay_left_arrow":".quick_view_overlay_right_arrow",$el).hide()})},handlePostReplyClick:function(e){if(r$(e.currentTarget).hasClass("rondavu_disabled")){e.preventDefault();return}var self=this;self.suppress_reload=!0;var profanityWarning=r$(R.Module.PROFANITY_WARNING_HTML),handlePost=function(){var id=r$(e.target).data("id"),form=self.getFormByActivityItemId(id),text=form.find("textarea").val();form.find(".activity_reply_button").append(profanityWarning),self.ajax(self.base_url+"add_reply",{data:{text:text,parent_id:id},success:function(response){if(!response.is_profane){if(self.type==StreamType.QUICKVIEW){var $overlay=r$(".quick_view_overlay",self.getEl());$overlay.data("keep-open",!1)}self.render_replies_inline||self.updateStoredClientGeneratedReply(id,text,response.reply_su_id),self.fillClientGeneratedActivityOnResponse({comment:text,comment_id:response.reply_su_id,is_reply:!0,is_profane:response.is_profane}),self.hide_form_on_reply&&form.hide()}else profanityWarning.fadeIn("fast"),setTimeout(function(){profanityWarning.fadeOut("fast",function(){profanityWarning.remove()})},5e3),activityItemElement.fadeOut("fast",function(){activityItemElement.remove()}),form.find("textarea").focus(),self.render_replies_inline||self.deleteClientGeneratedReply(item.parent_id,item.id);r$(e.currentTarget).removeClass("rondavu_disabled"),self.updateScrolling(r$(".activity_list",self.getEl()),{isMaxHeight:self.reachedMaxHeight})}});var item={user_facebook_id:R.FB.getCurrentUserId(),action_name:self.getParameter("SuAction.Reply.You.Text")||self.getParameter("SuAction.Reply.Text"),action_detail:text,action_type:"Reply",display_timestamp:"moments ago",deletable:!0,mo_name:"",mo_description:"",mo_pic_url:"",mo_url:"",price_retail:"",price_sale:"",price_detail:"",id:"clientside_"+(new Date).getTime(),parent_id:id,client_side:!0};self.render_replies_inline||self.storeClientGeneratedReply(item);var activityItemElement=self.getSingleItemHtml(item);activityItemElement.css({display:"block",visibility:"visible",opacity:"0"}),activityItemElement.appendTo(self.getActivityItemCommentsById(id)),self.type!=StreamType.QUICKVIEW&&self.updateScrolling(r$(".activity_list",self.getEl()),{isMaxHeight:self.reachedMaxHeight}),activityItemElement.animate({opacity:"1"},"slow"),form.find("textarea").val("").data("AutoResizer").check(),form.find("textarea").focus(),r$(e.currentTarget).addClass("rondavu_disabled")};R.FB.getAuthResponse()?handlePost():(self.type==StreamType.QUICKVIEW&&r$(".quick_view_overlay",self.getEl()).data("keep-open",!0),R.FB.requestPerms(function(){if(self.type==StreamType.QUICKVIEW){var $overlay=r$(".quick_view_overlay",self.getEl());self.updateReplyFormPicsquare($overlay)}handlePost()})),e.preventDefault()},handleReportClick:function(e){var self=this,id=r$(e.currentTarget).data("id"),targetUid=r$(e.currentTarget).closest(".activity_item_container").data("fb-uid");self.FB.login(function(response){var connected=response.status===R.FB.constants.connectedStates.CONNECTED||response.authResponse;connected&&targetUid!=response.authResponse.userID&&self.ajax(self.base_url+"report_reply",{data:{id:id},success:function(){window.alert(self.getParameter("ActivityStream.ItemReport.CompletedText"))}})}),e.preventDefault(),e.stopPropagation()},handleDeleteClick:function(e){e.stopPropagation(),e.preventDefault();var $delete_btn=r$(e.currentTarget),id=$delete_btn.data("id");if(!id)return R.Logger.error("Could not delete activity item because id was not found in activity_delete element"),!1;var is_reply=$delete_btn.data("is_reply");R.FB.deleteAction(id),this.getEl().find("."+this.getSuIdClassName(id,is_reply)).hide("fast")}})}(),r$.fn.slimscroll=function(o){o=o||{};var hidden_parents=this.parents(":hidden");return hidden_parents.each(function(index,el){r$(el).addClass("sl_make_not_hidden")}),o.isMaxHeight||this.filter(".slim-scroll-enabled").each(function(){var $slim_scroll_div=r$(this).parents(".slimScrollDiv");r$(this).css({height:"auto"}),$slim_scroll_div.css({height:"auto"}),$slim_scroll_div.parent().css({height:"auto"});var new_height=$slim_scroll_div.parent().css("height");r$(this).css({height:new_height}),$slim_scroll_div.css({height:new_height}),o.isMaxHeight&&r$(this).addClass("slim-scroll-max-height")}),this.not(".slim-scroll-enabled").each(function(){r$(this).addClass("slim-scroll-enabled"),o.isMaxHeight&&r$(this).addClass("slim-scroll-max-height");var isOverPanel,isOverBar,isDragg,queueHide,barHeight,divS="<div></div>",minBarHeight=30,wheelStep=30,cwidth=o.width||r$(this).parent().css("width"),cheight=o.height||r$(this).parent().css("height"),size=o.size||"7px",color=o.color||"#000",position=o.position||"right",opacity=o.opacity||.4,alwaysVisible=o.alwaysVisible===!0,me=r$(this),wrapper=r$(divS).css({position:"relative",overflow:"hidden",width:cwidth,height:cheight}).attr({"class":"slimScrollDiv"});me.css({overflow:"hidden",width:cwidth,height:cheight});var rail=r$(divS).css({width:"15px",height:"100%",position:"absolute",top:0}),bar=r$(divS).attr({"class":"slimScrollBar ",style:"border-radius: "+size}).css({background:color,width:size,position:"absolute",top:0,opacity:opacity,display:alwaysVisible?"block":"none",BorderRadius:size,MozBorderRadius:size,WebkitBorderRadius:size,zIndex:99}),posCss=position=="right"?{right:"2px"}:{left:"1px"};rail.css(posCss),bar.css(posCss),me.wrap(wrapper),me.parent().append(bar),me.parent().append(rail),bar.draggable({axis:"y",containment:"parent",start:function(){isDragg=!0},stop:function(){isDragg=!1,hideBar()},drag:function(){scrollContent(0,r$(this).position().top,!1)}}),rail.hover(function(){showBar()},function(){hideBar()}),bar.hover(function(){isOverBar=!0},function(){isOverBar=!1}),me.hover(function(){isOverPanel=!0,showBar(),hideBar()},function(){isOverPanel=!1,hideBar()});var _onWheel=function(e){if(!isOverPanel)return;e=e||window.event;var delta=0;e.wheelDelta&&(delta=-e.wheelDelta/120),e.detail&&(delta=e.detail/3),scrollContent(0,delta,!0),e.preventDefault&&e.preventDefault(),e.returnValue=!1},scrollContent=function(x,y,isWheel){var delta=y;if(isWheel){delta=bar.position().top+y*wheelStep,delta=Math.max(delta,0);var maxTop=me.outerHeight()-bar.outerHeight();delta=Math.min(delta,maxTop),bar.css({top:delta+"px"})}var percentScroll=parseInt(bar.position().top,10)/(me.outerHeight()-bar.outerHeight());delta=percentScroll*(me[0].scrollHeight-me.outerHeight()),me.scrollTop(delta),showBar()},attachWheel=function(){window.addEventListener?(this.addEventListener("DOMMouseScroll",_onWheel,!1),this.addEventListener("mousewheel",_onWheel,!1)):document.attachEvent("onmousewheel",_onWheel)};attachWheel();var getBarHeight=function(){barHeight=Math.max(me.outerHeight()/me[0].scrollHeight*me.outerHeight(),minBarHeight),bar.css({height:barHeight+"px"})};getBarHeight();var showBar=function(){getBarHeight(),clearTimeout(queueHide);if(barHeight>=me.outerHeight())return;bar.fadeIn("fast")},hideBar=function(){alwaysVisible||(queueHide=setTimeout(function(){!isOverBar&&!isDragg&&bar.fadeOut("slow")},1e3))}}),hidden_parents.each(function(index,el){r$(el).removeClass("sl_make_not_hidden")}),this},function($){var fns={setState:function(is_on,animate,callback){var $this=$(this),slider_position=is_on?$this.data("slider_on_position"):$this.data("slider_off_position"),slider_css={left:slider_position},after_switch=function(){typeof callback=="function"&&callback()};animate?$this.data("slider").animate(slider_css,"fast","swing",after_switch):($this.data("slider").css(slider_css),after_switch())},isOn:function(){return $(this).data("slider").position().left==$(this).data("slider_on_position")},flip:function(animate,callback){this.setState(!this.isOn(),animate,callback)}};$.fn.uiswitch=function(o){var $uiswitch=this,opts={on_class:o.on_class||"switch_on",off_class:o.off_class||"switch_off",slider_class:o.slider_class||"switch_slider",onSwitchChange:o.onSwitchChange||function(){}};$uiswitch.each(function(){var self=this,$self=$(self);$self.data("slider",$("."+opts.slider_class,self).addClass("switch_clickable"));var on=$("."+opts.on_class,self).addClass("switch_clickable"),off=$("."+opts.off_class,self).addClass("switch_clickable");$self.data("slider_on_position",off.position().left),$self.data("slider_off_position",on.position().left),$(".switch_clickable",self).click(function(event){event.preventDefault(),self.flip(!0,function(){opts.onSwitchChange(self)})}),$.extend(self,fns)});var uiswitch_fns={};return $.each(fns,function(name,func){uiswitch_fns[name]=function(){var args=arguments;$uiswitch.each(function(){func.apply(this,args)})}}),$.extend($uiswitch,uiswitch_fns),$uiswitch}}(r$),function($){var uid="ar"+(new Date).getTime();function autoResize(config){return this.filter(autoResize.resizableFilterSelector).each(function(){new AutoResizer($(this),config)}),this}$.fn.autoResize=autoResize,autoResize.defaults={onResize:function(){},onBeforeResize:function(){return 123},onAfterResize:function(){return 555},animate:{duration:200,complete:function(){}},extraSpace:50,minHeight:"original",maxHeight:500,minWidth:"original",maxWidth:500},autoResize.cloneCSSProperties=["lineHeight","textDecoration","letterSpacing","fontSize","fontFamily","fontStyle","fontWeight","textTransform","textAlign","direction","wordSpacing","fontSizeAdjust","paddingTop","paddingLeft","paddingBottom","paddingRight","width"],autoResize.cloneCSSValues={position:"absolute",top:-9999,left:-9999,opacity:0,overflow:"hidden"},autoResize.resizableFilterSelector=["textarea:not(textarea."+uid+")","input:not(input[type])","input[type=text]","input[type=password]","input[type=email]","input[type=url]"].join(",");function AutoResizer(el,config){el.data("AutoResizer")&&el.data("AutoResizer").destroy(),config=this.config=$.extend(!0,{},autoResize.defaults,config),this.el=el,this.nodeName=el[0].nodeName.toLowerCase(),this.originalHeight=el.height(),this.previousScrollTop=null,this.value=el.val(),config.maxWidth==="original"&&(config.maxWidth=el.width()),config.minWidth==="original"&&(config.minWidth=el.width()),config.maxHeight==="original"&&(config.maxHeight=el.height()),config.minHeight==="original"&&(config.minHeight=el.height()),this.nodeName==="textarea"&&el.css({resize:"none",overflowY:"hidden"}),el.data("AutoResizer",this),config.animate.complete=function(f){return function(){return config.onAfterResize.call(el),f.apply(this,arguments)}}(config.animate.complete),this.bind()}autoResize.AutoResizer=AutoResizer,AutoResizer.prototype={bind:function(){var check=$.proxy(function(){return this.check(),!0},this);this.unbind(),this.el.bind("keyup.autoResize",check).bind("change.autoResize",check).bind("paste.autoResize",function(){setTimeout(function(){check()},0)}),this.el.is(":hidden")||this.check(null,!0)},unbind:function(){this.el.unbind(".autoResize")},createClone:function(){var el=this.el,clone=this.nodeName==="textarea"?el.clone():$("<span/>");this.clone=clone,$.each(autoResize.cloneCSSProperties,function(i,p){clone[0].style[p]=el.css(p)}),clone.removeAttr("name").removeAttr("id").addClass(uid).attr("tabIndex",-1).css(autoResize.cloneCSSValues),this.nodeName==="textarea"?clone.height("auto"):clone.width("auto").css({whiteSpace:"nowrap"})},check:function(e,immediate){this.clone||(this.createClone(),this.injectClone());var config=this.config,clone=this.clone,el=this.el,value=el.val();if(value===this.prevValue)return!0;this.prevValue=value;if(this.nodeName==="input"){clone.text(value);var cloneWidth=clone.width(),newWidth=cloneWidth+config.extraSpace>=config.minWidth?cloneWidth+config.extraSpace:config.minWidth,currentWidth=el.width();newWidth=Math.min(newWidth,config.maxWidth);if(newWidth<currentWidth&&newWidth>=config.minWidth||newWidth>=config.minWidth&&newWidth<=config.maxWidth)config.onBeforeResize.call(el),config.onResize.call(el),el.scrollLeft(0),config.animate&&!immediate?el.stop(1,1).animate({width:newWidth},config.animate):(el.width(newWidth),config.onAfterResize.call(el));return}clone.width(el.width()).height(0).val(value).scrollTop(1e4);var scrollTop=clone[0].scrollHeight;if(this.previousScrollTop===scrollTop)return;this.previousScrollTop=scrollTop,scrollTop+config.extraSpace>=config.maxHeight?(el.css("overflowY",""),scrollTop=config.maxHeight,immediate=!0):scrollTop<=config.minHeight?scrollTop=config.minHeight:(el.css("overflowY","hidden"),scrollTop+=config.extraSpace),config.onBeforeResize.call(el),config.onResize.call(el),config.animate&&!immediate?el.stop(1,1).animate({height:scrollTop},config.animate):(el.height(scrollTop),config.onAfterResize.call(el))},destroy:function(){this.unbind(),this.el.removeData("AutoResizer"),delete this.el,this.clone&&(this.clone.remove(),delete this.clone)},injectClone:function(){(autoResize.cloneContainer||(autoResize.cloneContainer=$("<arclones/>").appendTo("body"))).append(this.clone)}}}(r$),R.Module.FBLogin=function(config){R.Module.prototype.initializer.call(this,config),this.initializer(config)},function(){R.Module.FBLogin.prototype=new R.Module;var templates;r$.extend(R.Module.FBLogin.prototype,{name:"FBLogin",dismissalKey:"",render_options:{show_sl_dismiss_button:!0},initializer:function(){this.dismissalKey="SL-DISMISSAL-"+R.Core.config.customer_name,templates=R.Module.FBLogin.templates,this.initializeRenderOptions(),this.setupTemplates(),this.render(),this.checkDismissButton()},checkDismissButton:function(){var dismissal=R.StorageManager.getLocalObject(this.dismissalKey);if(dismissal!==null){var now=new Date,duration=this.getParameter("FBLogin.Dismissal.DaysToHide"),difference=now.getTime()-dismissal.time;difference<duration*24*60*60*1e3&&this.getEl().addClass("rondavu_hideme")}},initHtmlEvents:function(){this.delegate("click",function(){this.getEl().addClass("rondavu_hideme"),R.StorageManager.setLocalObject(this.dismissalKey,{time:(new Date).getTime()})},".sl_dismiss_button"),this.delegate("click",function(){this.FB.login(null)},".sl_fb_login_button",{is_cta:!0})},handleMessage:function(){},setupTemplates:function(){this.getModuleHtml=templates.fblogin},initializeRenderOptions:function(){this.render_options.super_title_bar_enable=this.getBooleanParameter("Common.Layout.SuperTitleBar.Enable"),this.render_options.super_title_bar_text=this.getParameter("Common.Layout.SuperTitleBar.Text"),this.render_options.super_title_bar_icon=R.Util.fixUrl(R.Core.getCDNUrl(),"SFS"+this.getParameter("Common.Layout.SuperTitleBar.Icon")),this.render_options.title_bar_enable=this.getBooleanParameter("Common.Layout.TitleBar.Enable"),this.render_options.title_bar_text=this.getParameter("Common.Layout.TitleBar.Text"),this.render_options.login_button_cta=this.getParameter("FBLogin.Text"),this.render_options.show_sl_dismiss_button=this.getBooleanParameter("FBLogin.Dismissal.Enable")},render:function(){var html=this.getModuleHtml(this.render_options);this.getEl().html(html)}})}(),function(){var template=Handlebars.template,templates=R.Module.FBLogin.templates={},partials=Handlebars.partials=Handlebars.partials||{};partials["R.Module.FBLogin.module_templates.fblogin"]=templates.fblogin=template(function(Handlebars,depth0,helpers,partials,data){helpers=helpers||Handlebars.helpers;var buffer="",stack1,foundHelper,functionType="function",escapeExpression=this.escapeExpression,self=this;function program1(depth0,data){var buffer="",stack1,foundHelper;buffer+=' <div class="rondavu_super_title_bar"> ',stack1=depth0.super_title_bar_icon,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(2,program2,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=" ",buffer+=" ",foundHelper=helpers.super_title_bar_text,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.super_title_bar_text,stack1=typeof stack1===functionType?stack1():stack1);if(stack1||stack1===0)buffer+=stack1;return buffer+=" </div> ",buffer}function program2(depth0,data){var buffer="",stack1,foundHelper;return buffer+=' <span class="sl_icon_wrapper"> <img src="',foundHelper=helpers.super_title_bar_icon,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.super_title_bar_icon,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+'" alt="icon" /> </span> ',buffer}function program4(depth0,data){var buffer="",stack1,foundHelper;buffer+=' <div class="rondavu_title_bar"> ',buffer+=" ",foundHelper=helpers.title_bar_text,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.title_bar_text,stack1=typeof stack1===functionType?stack1():stack1);if(stack1||stack1===0)buffer+=stack1;return buffer+=" </div> ",buffer}function program6(depth0,data){return' <span class="sl_dismiss_button">x</span> '}stack1=depth0.super_title_bar_enable,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(1,program1,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=" ",stack1=depth0.title_bar_enable,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(4,program4,data)});if(stack1||stack1===0)buffer+=stack1;buffer+=' <div class="rondavu_module_content"> ',buffer+=' <div class="sl_button_container"> <div class="sl_button sl_fb_login_button"> <span class="sl_button_icon"></span> <span class="sl_button_cta_container"> <span class="sl_button_cta"> ',foundHelper=helpers.login_button_cta,foundHelper?stack1=foundHelper.call(depth0,{hash:{}}):(stack1=depth0.login_button_cta,stack1=typeof stack1===functionType?stack1():stack1),buffer+=escapeExpression(stack1)+' </span> </span> <span class="rondavu_button_end"> </span> </div> </div> ',stack1=depth0.show_sl_dismiss_button,stack1=helpers["if"].call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(6,program6,data)});if(stack1||stack1===0)buffer+=stack1;return buffer+=" </div>",buffer})}();function initRondavuJs(){rondavu._.customer_config=rondavu._.customer_config||{no_customer_config:!0};var config=rondavu._.customer_config;window.RondavuData=window.RondavuData||null,rondavu._.customer_config.default_rondavudata_version&&(window.RondavuData||(window.RondavuData={}),window.RondavuData.config||(window.RondavuData.config={version:rondavu._.customer_config.default_rondavudata_version})),window.RondavuData&&!window.RondavuData.primary_mo&&rondavu._.customer_config.og_primary_mo_enable&&(window.RondavuData.primary_mo=R.PageDataManager.getOpenGraphPrimaryMo()),config.page_data=window.RondavuData,config.page_data&&config.page_data.page&&config.page_data.page.disable&&(config.enabled=!1),R.Logger.init(),R.Logger.info("before init core");try{R.Logger.info("after assign"),R.Core.init(config),R.Logger.info("after init")}catch(ex){try{R.Logger.error("Fatal error initializing Rondavu Core",ex)}catch(ex2){throw ex2}}}initRondavuJs()})()
